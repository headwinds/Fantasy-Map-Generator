(function(t){function e(e){for(var o,r,s=e[0],l=e[1],u=e[2],d=0,p=[];d<s.length;d++)r=s[d],n[r]&&p.push(n[r][0]),n[r]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(t[o]=l[o]);c&&c(e);while(p.length)p.shift()();return i.push.apply(i,u||[]),a()}function a(){for(var t,e=0;e<i.length;e++){for(var a=i[e],o=!0,s=1;s<a.length;s++){var l=a[s];0!==n[l]&&(o=!1)}o&&(i.splice(e--,1),t=r(r.s=a[0]))}return t}var o={},n={app:0},i=[];function r(e){if(o[e])return o[e].exports;var a=o[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=o,r.d=function(t,e,a){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(a,o,function(e){return t[e]}.bind(null,o));return a},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var u=0;u<s.length;u++)e(s[u]);var c=l;i.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"034f":function(t,e,a){"use strict";var o=a("c21b"),n=a.n(o);n.a},"270f":function(t,e,a){"use strict";var o=a("7676"),n=a.n(o);n.a},"56d7":function(t,a,o){"use strict";o.r(a);o("cadf"),o("551c"),o("097d");var n=o("2b0e"),i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("FantasyMapGenerator",{attrs:{msg:""}})],1)},r=[],s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"hello"},[a("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",version:"1.1","xmlns:xlink":"http://www.w3.org/1999/xlink",width:"100%",height:"100%"}},[a("defs",[a("g",{attrs:{id:"filters"}},[a("filter",{attrs:{id:"blurFilter",x:"-1",y:"-1",width:"100",height:"100"}},[a("feGaussianBlur",{attrs:{in:"SourceGraphic",stdDeviation:"0.2"}})],1),a("filter",{attrs:{id:"blur1",x:"-1",y:"-1",width:"100",height:"100"}},[a("feGaussianBlur",{attrs:{in:"SourceGraphic",stdDeviation:"1"}})],1),a("filter",{attrs:{id:"blur5",x:"-1",y:"-1",width:"100",height:"100"}},[a("feGaussianBlur",{attrs:{in:"SourceGraphic",stdDeviation:"5"}})],1),a("filter",{attrs:{id:"blur10",x:"-1",y:"-1",width:"100",height:"100"}},[a("feGaussianBlur",{attrs:{in:"SourceGraphic",stdDeviation:"10"}})],1),a("filter",{attrs:{id:"splotch"}},[a("feTurbulence",{attrs:{type:"fractalNoise",baseFrequency:".01",numOctaves:"4"}}),a("feColorMatrix",{attrs:{values:"0 0 0 0 0, 0 0 0 0 0, 0 0 0 0 0, 0 0 0 -0.9 1.2",result:"texture"}}),a("feComposite",{attrs:{in:"SourceGraphic",in2:"texture",operator:"in"}})],1),a("filter",{attrs:{id:"bluredSplotch"}},[a("feTurbulence",{attrs:{type:"fractalNoise",baseFrequency:".01",numOctaves:"4"}}),a("feColorMatrix",{attrs:{values:"0 0 0 0 0, 0 0 0 0 0, 0 0 0 0 0, 0 0 0 -0.9 1.2",result:"texture"}}),a("feComposite",{attrs:{in:"SourceGraphic",in2:"texture",operator:"in"}}),a("feGaussianBlur",{attrs:{stdDeviation:"4"}})],1),a("filter",{attrs:{id:"dropShadow"}},[a("feGaussianBlur",{attrs:{in:"SourceAlpha",stdDeviation:"2"}}),a("feOffset",{attrs:{dx:"1",dy:"2"}}),a("feMerge",[a("feMergeNode"),a("feMergeNode",{attrs:{in:"SourceGraphic"}})],1)],1),a("filter",{attrs:{id:"dropShadow01"}},[a("feGaussianBlur",{attrs:{in:"SourceAlpha",stdDeviation:".1"}}),a("feOffset",{attrs:{dx:".2",dy:".3"}}),a("feMerge",[a("feMergeNode"),a("feMergeNode",{attrs:{in:"SourceGraphic"}})],1)],1),a("filter",{attrs:{id:"dropShadow05"}},[a("feGaussianBlur",{attrs:{in:"SourceAlpha",stdDeviation:".5"}}),a("feOffset",{attrs:{dx:".5",dy:".7"}}),a("feMerge",[a("feMergeNode"),a("feMergeNode",{attrs:{in:"SourceGraphic"}})],1)],1),a("filter",{attrs:{id:"outline"}},[a("feGaussianBlur",{attrs:{in:"SourceAlpha",stdDeviation:"1"}}),a("feMerge",[a("feMergeNode"),a("feMergeNode",{attrs:{in:"SourceGraphic"}})],1)],1),a("filter",{attrs:{id:"pencil"}},[a("feTurbulence",{attrs:{baseFrequency:"0.03",numOctaves:"6",type:"fractalNoise"}}),a("feDisplacementMap",{attrs:{scale:"3",in:"SourceGraphic",xChannelSelector:"R",yChannelSelector:"G"}})],1),a("filter",{attrs:{id:"turbulence"}},[a("feTurbulence",{attrs:{baseFrequency:"0.1",numOctaves:"3",type:"fractalNoise"}}),a("feDisplacementMap",{attrs:{scale:"10",in:"SourceGraphic",xChannelSelector:"R",yChannelSelector:"G"}})],1),a("filter",{attrs:{id:"filter-grayscale"}},[a("feColorMatrix",{attrs:{values:"0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0"}})],1),a("filter",{attrs:{id:"filter-sepia"}},[a("feColorMatrix",{attrs:{values:"0.393 0.769 0.189 0 0 0.349 0.686 0.168 0 0 0.272 0.534 0.131 0 0 0 0 0 1 0"}})],1),a("filter",{attrs:{id:"filter-dingy"}},[a("feColorMatrix",{attrs:{values:"1 0 0 0 0 0 1 0 0 0 0 0.3 0.3 0 0 0 0 0 1 0"}})],1),a("filter",{attrs:{id:"filter-tint"}},[a("feColorMatrix",{attrs:{values:"1.1 0 0 0 0  0 1.1 0 0 0  0 0 0.9 0 0  0 0 0 1 0"}})],1)]),a("g",{attrs:{id:"deftemp"}}),a("g",{attrs:{id:"defs-icons"}},[a("symbol",{attrs:{id:"icon-anchor",viewBox:"0 0 30 29"}},[a("title",[t._v("Port")]),a("path",{attrs:{d:"M15 4c0-0.547-0.453-1-1-1s-1 0.453-1 1 0.453 1 1 1 1-0.453 1-1zM28 18.5v5.5c0 0.203-0.125 0.391-0.313 0.469-0.063 0.016-0.125 0.031-0.187 0.031-0.125 0-0.25-0.047-0.359-0.141l-1.453-1.453c-2.453 2.953-6.859 4.844-11.688 4.844s-9.234-1.891-11.688-4.844l-1.453 1.453c-0.094 0.094-0.234 0.141-0.359 0.141-0.063 0-0.125-0.016-0.187-0.031-0.187-0.078-0.313-0.266-0.313-0.469v-5.5c0-0.281 0.219-0.5 0.5-0.5h5.5c0.203 0 0.391 0.125 0.469 0.313s0.031 0.391-0.109 0.547l-1.563 1.563c1.406 1.891 4.109 3.266 7.203 3.687v-10.109h-3c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h3v-2.547c-1.188-0.688-2-1.969-2-3.453 0-2.203 1.797-4 4-4s4 1.797 4 4c0 1.484-0.812 2.766-2 3.453v2.547h3c0.547 0 1 0.453 1 1v2c0 0.547-0.453 1-1 1h-3v10.109c3.094-0.422 5.797-1.797 7.203-3.687l-1.563-1.563c-0.141-0.156-0.187-0.359-0.109-0.547s0.266-0.313 0.469-0.313h5.5c0.281 0 0.5 0.219 0.5 0.5z"}})])]),a("g",{attrs:{id:"defs-markers"}},[a("symbol",{attrs:{id:"marker0",viewBox:"0 0 30 30"}},[a("path",{attrs:{d:"M6,19 l9,10 L24,19",fill:"#000000",stroke:"none"}}),a("circle",{attrs:{cx:"15",cy:"15",r:"10","stroke-width":"1",stroke:"#000000",fill:"#ffffff"}}),a("text",{attrs:{x:"50%",y:"50%",fill:"#000000","stroke-width":"0",stroke:"#000000","font-size":"22px","dominant-baseline":"central"}},[t._v("?")])])]),a("pattern",{attrs:{id:"oceanic",width:"100",height:"100",patternUnits:"userSpaceOnUse"}},[a("filter",{attrs:{id:"image"}},[a("feImage",{attrs:{x:"0",y:"0",width:"100",height:"100","xlink:href":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAAd0SU1FB+EIBw8dCqiO08AAABkhSURBVHhe7d3njiO31oXhlnOOsP/5/q/MNgx4xjmH/vTwm3cOp1ySSurg7oOzAKJY5OYOa2+ySlJ7vPv555+v33zzzatz8ffff4/rSy+9NK7u9X///ferH3/8cVxfffXVMbbb7a7eeuutq7/++mvIvf3221e//vrrmH/55ZefrwUyv/zyy7jCn3/+OWSsMUbOPbgm19hDhlj4X6xr2H399dfXH3/88bPbyzGTilBJCNfX11evvPLKIE1/Sd4ff/wxEshhBJOxXsLcWyuhFQFZ/TfeeOPqhx9+uHr33XeHzH8Ddvvgr5/17xWSYCchUh/B7VSJlZzXX3999H/66aexQ8hK9n5XP0+YOePkJKiiaKz7x4JbTUgVPJMw75wZCP/tt98G0TNU/2uvvfaCLrvA+EywndOOAsmRkHaYOTrsxvfee2/MHwI5ax7CsXd2QgR8X45HlB0U0XaGpJQMSfA8ct+xlo/kJJJMySLb7mpujoce9shkj86S2y6mC26bi93eqetD1RMRnL4rLKuTTURuDZQ8ku22Dz/8cKyLUMcWgl3BTusYbAwiV4JwYY4OOvlGRz5KOhk2W+ferr4N7J48eXLNEKUMcILTKmF2+i7B7pyA5T1IXMfVDLIlMVLmJCxRAVh3iERzkiOpoCCtM4YfffrZZFufrnZVc5dgt3f+2oNSApCwhZwtsA4OrZ0JPkZgIA9rgUbyJX7eFOIsKXYN4NILC1/5ZM71kH8VwEjqt99+e+21EbyxmGyHSJRge/DOR8FWzMRD95cmeon0bUnqfUAicNTucsTNWBbPkofxUN8nZSiQCEEV2Eym5Hz33XfjnhwltrL7jrlkzwU7GrteaZdBzEC8wujh6p7df2uHhJmrSzE+v0nIs/t/YGlE8GCJLdbVzvJAjaRjxKgIDfl02+YcMdbLxfvvvz+uYBwUDPuu1s0Vxg++3taD9abgC17ateLKX2MK2D256O/F4FY+h0QozOoQp0kUR8yR69VTpZf0doWxdqpEN+azhDXffPPNlR392WefvbBLENDOfUhwhImZr67i5Sef195eN+2xyD6Eqvadd94ZX2NU6YxrjEsCYukiT0bzfMpZjR5rVJFEW5se8u69vpoPcxWSe0jAiR2v+sXZNw6HPkrc6if1EPm9LKhqRDMVcZq+Z4Y5DrtKSlWOfM5DbzDm7QZrm7OO7LFnz2PByYQIHgSv+gSvHQPybFXy88NehURiuto1mp3Ti0LzYM5uyVXjmiQ2Zl6SSvhjxQsJEXi3ro4FhGmIRJhxpFWNyD+0/apw5GolYwYiI5b+LWTSxTfyPSAlSDLArgP2lt+VnQPPsGIWCxvFw+ahuM/FXHwjIUg1WECMu3fljES1oONCtXPWuPmUcjg9W5E9kHzYSmS+A9uSG/i1JcF0kGNbvPPnLvdiFluNHWMVnAZbC2oN8fePI8tRg2yKC1RgXRM3Vz/HwZWD1nMQStAwuOK04BBJvz4da8+DnA4djY5FbU4GkC9hxUC3B61xfreOXgQb459+ibBe47tdYc7OFCeu5mP5pjj65SJwZK4GmMk372reldPkEKAfSWyYN24+XWtIF3LICxZJWr6yC+azu4zDXEebBABC+WSNRrf4NPrNk6ffmhLlymfkz3y4gnHr6DzG5ymM77Ii7xJF1nKQIxwUVGOugud0ugW2rGSBlyRJ8Aygx711fLNuDWyUEGu2wK6KbAlgJ588NzzXEAzmyc0+VCjmggT2mp7P9LqWJOsaP4Rbfe2tag+RNyMi4ZiDp9AOdS3p+sd86Fhak6niD/lk/tCchBQX3ZLsWqHEj3kFwV8yxtN7qwm5CxTgqaTZkcudd9vgy5ZdyJfeHsFuc3SWKFfzvn1YxvXgE7IV7YqqcFn9zavEiAF97dCOOYX0boGEzkffjPQ86IRwknsqDmGC6VgKjp957NCR4oiIfNVqTXL6Wyr/XJyTrPAgEyIQBCLb1y8IlBTB+YzA5QgkY/wUofSR0UraGll9laOagXwPb7aMl8BTR9jWI27GeO1tUcagT7uIQEDjqhQ4ea6xc4E45PBlJsgYfxAE5pzT5z5DxGatq4SV7I4VfT6wo0jS307FgbX5RE4/rs5BydvtX/OuGVpucz9G5RAHGOeUVuK0nOTQbSKy2BaoZow/wPYI4Nk8PyJj/lC5dmxIcPFJZOskxJzGjrXAD8CRNfR7IHswz5zMPqwdm2tovVdx68eRZYADDDComdQ4J+C+TogUgbSV3ZMVeJk+BTYj3afdKow9ARnv22IoaK3XS8nQtxZJfCBn3NU4P2dy2LAb+OwTO+gHet33ViRGV+P5QG9rgb9+o2Ffv3jYiRc/GbjGDRtz8tK922fm2mTfTRG4FCmNUOQCRyKJE2xJBjIRZt69KtFXfSCYCsS4FugHOr7//vsxRy8bdFqTvdbrS0iy4mbTPOKNnQKdfHUVk8Tpx6ErfXyo4PRxwnZ+W6vg+GJN8T9/qBM0GEGHIOtkBVeGg/WUWy9ActQb4zRwhOOSRf6Z+WG3SuY49IuhteasBX1Nwkp0do1X3RpdZLpvDd9LuHVzzPkN1pMzxo51bBV/LxxOEDrc48h6vuAHF+bEbN44ffzQdy2BN3rL4hjSKC0gznM0MCKozJAjH8nm5x1lvGNCX/I4DAVfIEgwZn0J0fStb12EanQfAnvFoU9Hfs/+h/Sb6+hErHjzh4y+MbbnNWTjyrxYdnsnr2cjlwJRkiMQYLzd1hgnyDXG0Yi9FAIBuufCQD4brrCWCP5K1rzLtyCdMBefeDR2176tntEuIjvHf2efQzgt4wwiTWUIvCSdUwR0nJLfInPXEKcErfmhEP2U7bmhcPBBrmt4kB8M/9tg16AZ8fOOWsPRhPSWJPOaCnem2+Z3AbuKOypIEP1nCO7tLGP5cFe7oZ3GF7bzp0ru/pwdeY7s0R+onLGI4ICEcMYV9DtLI8z1EtDpeOvNC+ERAj0wVVdHnzO6BHo+aOfajyhX9tmhT8G5Z7+/qM8HLb4UCH86hk9hS2KeP9QJgyAZORQcxziaYvIa+QhDzrw16Raoq3nrCxjMRTQZa81HvDkyxntoIsH8V199Nd7f2Udk45r7NQKKIZ/ozfdiUyRs+QBovBcWfTb0yWWLv+bY5Iv5JYf0HeI17PbHwt6v//+uijLkjom9ck65Z7jgONwbCwORG8hoDGv6CEifNeA+koEefcHS306kI/Losi7dxswJno3ItdYc0PfRRx+NPpBZklWCkG99+oDNig5H7qFXdPo1KEa2tdbgTkKtnb99gPyxjp7d/sk/PKfMQoMWbsnmDAFxgB5Bea0rAQw2Tme2wByZ5bPJWk1ABVegNTsDrEVm/iITAXwAu4wuiaYPxMkftrWKjD9isZ4N8vkMfCTv2wE6er3tAzNZjR7AJd0S+Pnnn4+EfPLJJ2OePL/02RkJ2RtefYZwgENtRTIzYUtEAJmcEXBEAkf1XZEYyFd5W4EUxCGmZI+A9n36zRsDY2y4Rlw+5hO/KyCxmjeGwIgL7umRDHLpLgbzdLiXCHPAV7Bj84mP7OuT3+2raX//n291DXKSYFXvvgragpRzWn9OZM+GY8k9B2zYERUD4iKAzzNJUAJc+WZtc3aZNSVyDWTxEthid7bDFx/26HdPH375po8Dc6Aw2cyH3V5ofLlIyDUwwFC7ZyuBJeM+wW8kC0rQ+dB4c8gQh2SIC5nGyRq7CSSpQmB3PgHWwG5J0c+/cWTJqJsc3kr+Q0GBHSsEAXcC3DXsOglmSzGAJGl86Gg1x3e+Saj++GA4H03tiODZYF6SOkfJzW0LqtpjUBhszG8iVbliuQ8y7wMlBydimwtlJATpBntjOITeXsq8JiFjq+3XS5rrMqnAuAbWWcOpEg6SQZ+z3BGaHVdVNSromfNs0PGYIM6KuhjEa8ycsbO/y+oh6BcyCnvToEaFI5mRiCxJGsM19/QgGujS16wjQ2+VZCy9mvUS4i3GXA/Hxwi8iUkMF3+5iChAXK92ZZlKFV7lm2PML4HmjUuGMSQnQ6dmDtkdo67GyUiOJoGacfboBQVi/LHi4oSsIbKoRF7v3Sq3V1AEupKTGLKuEisJERvJEmLcVSXZoa3T7EC7yjx5jXxJn19QTr35PASclRBkVtGHgDSkIMPOod4aVevbW4koOfodOemt8t2vHUES0is6G/RLPtgdHYFkzNMhKWxl05x1hU6mXZVOBcIGtK6CIVtct43d3rnxZ0DAGZUVIVWuDznm/MDCKfIcQwQ5fW2JqlQwBRkJxjS66EgPGfbnyj6G9FvHH7uAXaQDvRFrng1jybMjyRFuraSaoxvye+lj8wphq7+nsPviiy+uVYjGIUYExUHOAWc46VrjMMdKWlXDsd7W6ABBkHNtbRAkOaSwD3TV549dB4jlx3K+fmDLOHmNDTHp88FVwoqJ//ltLh1kioHP7JAlQ959SeGTNWxpjZ2TKLbGDplJcXXPaA9IYwJZA4ccOz47WENH5Fqj0edKV85GtDEQfCTND/sZ9EJkQC8U89gaxID8NZkKCsTANv/4Q7d1IIYSnR4y+hUo/9mC5IF/it4YkBG/eWNiHsW6f/Bel3VvQQRlmgGCksKgsSoJCoBCfwVIxlgOVFGMRO7sjEB6xhh3LHJKP/Lo8NyxPr8EzIf8MOazDN8jiQ/1g/Wz/fogdmAnn4BcyQFXHBjHi89Ls61eOqxPh/VssbHkBl+aWMzT+/yDoUGCKdKPyGCBhRpFZKoQRnPWPD3GyBhDHCCUPOcitoLQwBr6+4IunQXkPvCR7NJXYJMP5OnMR5Ua6GwnKIgZ1rVePOkIxq03py+W+nwy5ycC1xJgbu6bk8i4uOi1N0WUIkpVlAzGKG7rCmAORkMUeeP1VfhwaBH0MVg3/tpvv6ajbokC5ieZORlgXuOrFqEaf4B+99DYsgDoEDufxBThc8EWHxjXyNptfV10UUIyGgQZ6ZyIAGCU8xrHchw4zcmtCVhDRMEWPfziJ78cT9Zbly9rST0GsWris7bYZrBR0X7wwQdjzP2ardWEIA3K5qFAyXGGIQFWAYLTWoeEKrNErR0xdwE+eg7NsehX6V1vA+yABFSAeFhL0iGMH6iQhVi5oQC5M3HmTymVFMEiQOVZV+VVla7Geo7cF9oF9w1c4JT9rYnfffnll+Mn3AiiBGGuxkEwy7P3LiEAgcxJ+7dIPQc4U3izn76Exd0p/sQHL/xApaojomomqO8Vz/1dVDb9zlTPpSqJLwojHxwH3rqMk7PGriR/7rl/V+CjODoBehp0wrRb9EuaJFqT7Pg3Fwm1G2TYAq2xJTqeyJwLDjgS6WC3s904sjV654oy10tE5JcQV3PWeGDSWbD/JopTPHwUp2Y87no04FlhmRsP9QLaSjB51SCrlCOP4VPnpA+QCAPyHEQqPda6r5pCBHPcmuC+Fwoy1tlB7TRr5l8e/23wq8SIV4z1X+BkP3D0tZeSQMFMljmJoQgx5mtr7/yQ8f4bP0dhiaRDazeQZQO5+ux0jPHDlS3yqq0g3bPt/f4myD6d2bsUEsL/5akjXnh+Qp1KCKeIcGp2yPbi5JMnT4ZScxFbAK1DYgYFOFd68G0BWXKuazKBbW9ykkCebGv4yxc+rSXzmF5ymoS6SuihJNBNxlXcx/Seg4s+GCLEspzoHhwjmgrlqMRoQRBk57FLgXRJoY9e9viC+CBR5hGrD0jU8tm6ZeWeiz42tIO3QmGxnf2LEnIKiEI4km6rcg6BDRXNJsI7rqpa48iakyFpqv/U2xk56yuidu/W5LE7o/UljN5l8l5IiGAIGNKv0twXLAhUW6sEMv3NreDJCNx6zbqtAV2KCAT+aNk1h2gFI2lgrDcefePFnM/mwP2svx259ry8BOP/sIM0Sqsq6IxWIeYFwDiHOKPvgezN5hA8yDgP1iHkrpOxBCLbFeKI0IrGmJjFZ9e4SqC4rSt+MZsD43Gi0alB+uLxEOhlBx98e87TnvSRkIgmZKul2HivbJJmrMRwhhxcQnaOsLk8x42n+y6g4MQwH1tsau0WpPGRXyUkjoy5J0dPp0lcljTo6LKG/pJIV+v1vaaPv+311yEpIky5flnmFOdyAHkqjHI7xNqZPK/CbeOIdaWnRofABA+90XjbAkSxd26SL4X4kMKvYyBXI6+JzRVn2swFDnFm3vicKMhm3I//pM2EG4LIQpR7hhgmjFzzmnEN1rYmUq03h3B9hjmjQZWpeoyRHQ49s5XefCnwZPh5X8niw6lE9YGUn7WSE1f5K15jdIqDbHyNhzpFiLMgAcIEUti206fQvX6JctWADok0Tg9Z9+Tp1kpAcE9WYOQFA9nzvMqP9NhV7eb7SI648nnu88c9HuPAmJiNVYR8xAl/xZvsjLNfexnqSjGDHTNgDEnI1QKHzblqjVUtdgx5Dp9CBMxJ37LuPsC3uIG56NZAlu/iIXurn0MolSCNocBEjjLOcNWCTNVyKdq59J0K/qHA37fhqiKcd/edfDBcgnFQ0Wvb9DZgpykE4VSdCsC4gNk1/hB20qHvteBkQqrqfxvn+lEyWoeA5frm1+Zm3CcHLySEg72Dc0KrumWzY8E7PBnPCg/WUwFthR3EHbrnOnEsqSqwxdvmfLlkx3VeL5FdHLj6XEC2Nyh2l/ZuctyuYfzDAT6H5IRmazOuz0nOI7yHcg/x5JHjLUg7x0G6OmZc3bOxPFokJH/4Sc48v/LNlR8KZCsUXB8QrQXx0g/Fwi5ZycgHa/T5lR+3gfEvyvmQx7iHDEOMZ1Cw7sG9Ki4AzksOB4EOuyYHBRCx1iCdfEEbg36aLUF0Z0MT9Az+kANzbEiaOIznBzlXOiJvBntLIukhf4rgOJFQ9ot7Bpni34rxVyc5GiHAKcoiajbGkFbSrHGPEGvo4ygn3Sdn60sG0N+OKjH65NeCyAcFgTRr2GlNMEeGP+16a0HBuSfPPl/6VZGMdcsdRh+5eIgX9uPEPL3pJgt4me9D/tAx+z443S+65jjlGgGKIQO1GZwQgCtFjHIWIs0axguEA3YNIvXpJ5vDS8dPge3Od/DXj/kAdGsRAPnJZ2vN8YM/Gt/SFxfWKJ5iNW6spMP8zUNx0wd0aPUH8fs5OuZn0hjfOzz+O/UMcCZFLVLtFHFWK3FbURBQsI3RdxMInH/I5Wtkz0XATiRJUDKNIzUCxWZnLx/ewTqkk2evRARzuBJnnzOA3fgEeipqPuTreMsyGFEccs9gsJiDa+fkQwEiigMhERzpFZEx8zM57s27J7MVJRg/p7ghx07689FaSUvPSIgKM1kQsmWh60NNwClUVALXoCSI6y7AHiA2m8sTwK5QNMvE81dSR0IIUFJC5gebuc5JyWlrVV3/wzpwORezROCtMXy3m/XN64+EPH36dAz419OW1ZOwjHqLYkifcnMqoNfbZda3gl76OnZ6OLMrAHYqgMdcCBIgpo4nfInPzjD2PCHP5E/CZwhKkWfXIEdCJIkBDRhAKINkShRneuhZo+lb11VyrbVOY08znryrOcFoyyJ6qBA/v2eIzQdzLwA+j52VkIAQilwZiaQ5Wa4wk6apBEmpOoy59kZinh7z9Lpng750Cso6NtPl3lFb8h8TxIEDuCghhzAnZE4WojRjdgGZKsWanlHItIZz+uQRTUcfKo1JkuRpdmMoqHZrMo8Jt5oQhCEi4gEhSAXzyEScROi3m8i5kiGvGStxZPvahe52Qn1y86snufHW8qxAlp8XgJ/Jr6EYZkTXsXU3wfhguDzXbgpkIDyyXN0LJuLbRWCsNzu+RPZWeG0viZJGf2QbMw90Nwe9jESupPO9e7L6ZIqJjjkuOm4Tu72z11WPvxZBDCeczSCgHLwUgukNSpCCotOV/tsCopFGt6v7jkqQeFAYxvjFB2guWF+CEM9P9xKhT4e+9cabsyuXuraCnfFfUH366afPqwBhUFDGqt7HBIR77oijYwZZ9UF/WRDFjA8NSeQQT6dWgUoCxFlwn530SJLrjHYaVEDjGcIBAxpjyywPwWdGl0ofGsRS1V8C6zWIA7u75NKtQJc8tEu0Eka2hJZ483jGpzm6HHv0O6nGf0HF8NpDzwJnPQctShlDksapjD8UII9PfBP0lgISp3Xi0hCo6VeMa3qs0/Az7wBjrcMXXWAez83HXW+Qkvb8334n5OGHdIokoErJUFl1zwGyyVC+ltSt4DjMO/MuURz8lwyk9duIMXPaTNwhzPJwbI04yeNOwl19IGwHjX/rhCOcshvKJuHI1l8S3o9RWq+V+gWnj9z5jC7ZkFMcZJ9sgSgMclpr1o6JrYj84N4LDLBXu6QY6BJ/J8YaxAAzF0vgE2/jn2eiLIcskoBT4IgGJSFCtaF8T6QxxiKULePmJcO88Y4HaFsD2Ypji19bwI52F7uRXnHhAPgtZmhMgozjgA/i8p9Pm989ffr02peKM9oZEUeBRfoloiTO6Pf11lgvwV2T5wS5ZEsIOTLu80FfK0HkSxx5R+vSj4cGvhdPccSjcfGIQdH+45N6mTu0vRwnFCF8/ieRgrkqn54SIwkRrk/PnDzO9Jf0W9BDmL+an1gfKnAxH/Ean3GMi//EfHX1f4nyTnv/ee6gAAAAAElFTkSuQmCC"}})],1),a("rect",{attrs:{width:"100",height:"100",filter:"url(#image)",opacity:"0.2"}})]),a("pattern",{attrs:{id:"mottling",width:"16",height:"9",patternUnits:"userSpaceOnUse"}},[a("filter",{attrs:{id:"turb"}},[a("feTurbulence",{attrs:{type:"fractalNoise",baseFrequency:".7",numOctaves:"10",stitchTiles:"stitch"}})],1),a("rect",{attrs:{width:"16",height:"9",filter:"url(#turb)"}})]),a("g",{attrs:{id:"rose","stroke-width":"1"}},[a("g",{attrs:{id:"sL",stroke:"#3f3f3f"}},[a("line",{attrs:{x1:"0",y1:"-10000",x2:"0",y2:"10000"}}),a("line",{attrs:{x1:"-10000",y1:"0",x2:"10000",y2:"0"}})]),a("use",{attrs:{"xlink:href":"#sL",transform:"rotate(45)"}}),a("use",{attrs:{"xlink:href":"#sL",transform:"rotate(22.5)"}}),a("use",{attrs:{"xlink:href":"#sL",transform:"rotate(-22.5)"}}),a("use",{attrs:{"xlink:href":"#sL",transform:"rotate(11.25)"}}),a("use",{attrs:{"xlink:href":"#sL",transform:"rotate(-11.25)"}}),a("use",{attrs:{"xlink:href":"#sL",transform:"rotate(56.25)"}}),a("use",{attrs:{"xlink:href":"#sL",transform:"rotate(-56.25)"}}),a("g",{attrs:{"stroke-width":"8"}},[a("circle",{attrs:{r:"9",stroke:"#000000",fill:"#1b1b1b"}}),a("circle",{attrs:{r:"75",stroke:"#008000",fill:"#ffffff","fill-opacity":".1"}}),a("circle",{attrs:{r:"212",stroke:"#1b1b1b"}}),a("circle",{attrs:{r:"211",stroke:"#008000",fill:"#ffffff","fill-opacity":".1"}})]),a("g",{attrs:{stroke:"#1b1b1b"}},[a("circle",{attrs:{r:"71"}}),a("circle",{attrs:{r:"79"}}),a("circle",{attrs:{r:"94"}}),a("circle",{attrs:{r:"152"}}),a("circle",{attrs:{r:"164"}}),a("circle",{attrs:{r:"207"}})]),a("g",{attrs:{id:"s3"}},[a("g",{attrs:{id:"s2"}},[a("g",{attrs:{id:"s1",stroke:"#1b1b1b"}},[a("path",{attrs:{d:"M 39.416,95.16 C 33.65,103.95 30.76,110.5 28.93,117.18 C 15.24,113.43 13.54,127.15 23.04,131 C 13.71,145.8 7.84,173.93 0,212 L 0,103 A 103,103 0 0,0 39.416,95.16 z",fill:"#47a3d1"}}),a("path",{attrs:{d:"M 39.416,95.16 C 33.65,103.95 30.76,110.5 28.93,117.18 C 15.24,113.43 13.54,127.15 23.04,131 C 13.71,145.8 7.84,173.93 0,212 L 0,103 A 103,103 0 0,0 39.416,95.16 z",fill:"black",transform:"scale(-1,1)"}}),a("path",{attrs:{d:"M -31.995,160.849 A 164,164 0 0,0 31.995,160.849 C 18.9,170.1 8.4,176.3 0,207 C -8.4,176.3 -18.9,170.1 -31.995,160.849 z",fill:"#c2390f",transform:"rotate(22.5)"}})]),a("use",{attrs:{"xlink:href":"#s1",transform:"rotate(45)"}})]),a("use",{attrs:{"xlink:href":"#s2",transform:"rotate(90)"}})]),a("use",{attrs:{"xlink:href":"#s3",transform:"scale(-1)"}})])]),a("g",{attrs:{id:"initial"}},[a("rect",{attrs:{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#oceanic)"}}),a("use",{attrs:{"xlink:href":"#rose",id:"init-rose"}})])]),t._m(0),a("canvas",{staticStyle:{opacity:"0"},attrs:{id:"canvas"}}),t._m(1),t._m(2),t._m(3),t._m(4),a("div",{attrs:{id:"tooltip","data-main":"Сlick the arrow button to open options"}},[t._v("Сlick the arrow button to open options")]),t._m(5)])},l=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"loading"}},[a("div",{attrs:{id:"title_name"}},[t._v("Azgaar's")]),a("div",{attrs:{id:"title"}},[t._v("Fantasy Map Generator")]),a("div",{attrs:{id:"version"}},[t._v("v. 0.60b")]),a("p",{attrs:{id:"loading-text"}},[t._v("LOADING"),a("span",[t._v(".")]),a("span",[t._v(".")]),a("span",[t._v(".")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"hidden",attrs:{id:"optionsContainer"}},[a("div",{attrs:{id:"collapsible"}},[a("button",{staticClass:"options icon-right-open glow",attrs:{id:"optionsTrigger",onmouseover:"tip('Click to toggle options. Hotkey: O')"}}),a("button",{staticClass:"options",attrs:{id:"regenerate",onmouseover:"tip('Click to generate a new map. Hotkey: F6')"}},[t._v("New Map!")])]),a("div",{attrs:{id:"options"}},[a("div",{staticClass:"drag-trigger",attrs:{onmouseover:"tip('Drag to move options pane')"}}),a("div",{staticClass:"tab"},[a("button",{staticClass:"options",attrs:{id:"layoutTab",onmouseover:"tip('Click to open layout menu')"}},[t._v("Layout")]),a("button",{staticClass:"options",attrs:{id:"styleTab",onmouseover:"tip('Click to style menu')"}},[t._v("Style")]),a("button",{staticClass:"options",attrs:{id:"optionsTab",onmouseover:"tip('Click to change generation options')"}},[t._v("Options")]),a("button",{staticClass:"options",attrs:{id:"customizeTab",onmouseover:"tip('Click to open customization menu')"}},[t._v("Customize")]),a("button",{staticClass:"options",attrs:{id:"aboutTab",onmouseover:"tip('Click to see Generator info')"}},[t._v("?")])]),a("div",{staticClass:"tabcontent",attrs:{id:"layoutContent"}},[a("p",{staticStyle:{display:"inline-block"}},[t._v("Select preset:")]),a("select",{attrs:{id:"layoutPreset"}},[a("option",{attrs:{value:"layoutPolitical",selected:""}},[t._v("Political map")]),a("option",{attrs:{value:"layoutCultural"}},[t._v("Cultural map")]),a("option",{attrs:{value:"layoutHeightmap"}},[t._v("Heightmap")]),a("option",{attrs:{value:"layoutLandmass"}},[t._v("Pure landmass")])]),a("p",[t._v("Displayed layers. Drag to move, click to toggle")]),a("ul",{attrs:{id:"mapLayers"}},[a("li",{staticClass:"solid",attrs:{onmouseover:"tip('Toggle Ocean pattern (see Style tab for styling)')",id:"toggleOcean",onclick:"$('#oceanPattern').fadeToggle()"}},[t._v("Ocean")]),a("li",{staticClass:"buttonoff",attrs:{onmouseover:"tip('Toggle Heightmap (see Style tab for styling and Customize for editting)')",id:"toggleHeight"}},[t._v("Heightmap")]),a("li",{staticClass:"buttonoff",attrs:{onmouseover:"tip('Toggle Grid')",id:"toggleGrid",onclick:"$('#grid').fadeToggle()"}},[t._v("Grid")]),a("li",{staticClass:"buttonoff",attrs:{onmouseover:"tip('Toggle Overlay (overlay type can be set in Style tab)')",id:"toggleOverlay"}},[t._v("Overlay")]),a("li",{staticClass:"buttonoff",attrs:{onmouseover:"tip('Toggle Cultural map (does not work good when counties layer is on)')",id:"toggleCultures"}},[t._v("Cultures")]),a("li",{attrs:{onmouseover:"tip('Toggle Routes')",id:"toggleRoutes",onclick:"$('#routes').fadeToggle()"}},[t._v("Routes")]),a("li",{attrs:{onmouseover:"tip('Toggle Rivers')",id:"toggleRivers",onclick:"$('#rivers').fadeToggle()"}},[t._v("Rivers")]),a("li",{attrs:{onmouseover:"tip('Toggle Countries (open Customize tab for editting)')",id:"toggleCountries"}},[t._v("Countries")]),a("li",{attrs:{onmouseover:"tip('Toggle Borders')",id:"toggleBorders",onclick:"$('#borders').fadeToggle()"}},[t._v("Borders")]),a("li",{attrs:{onmouseover:"tip('Toggle Relief icons (draft version)')",id:"toggleRelief",onclick:"$('#terrain').fadeToggle()"}},[t._v("Relief")]),a("li",{attrs:{onmouseover:"tip('Toggle Labels (label groups can be toggled separately in Style tab)')",id:"toggleLabels",onclick:"$('#labels').fadeToggle()"}},[t._v("Labels")]),a("li",{attrs:{onmouseover:"tip('Toggle Burg icons')",id:"toggleIcons",onclick:"$('#icons').fadeToggle()"}},[t._v("Icons")]),a("li",{attrs:{onmouseover:"tip('Toggle Markers')",id:"toggleMarkers",onclick:"$('#markers').fadeToggle()"}},[t._v("Markers")])]),a("div",{attrs:{id:"layoutCheckboxes"}},[a("input",{staticClass:"checkbox",attrs:{id:"toggleTooltips",type:"checkbox",checked:"",onclick:"$('#tooltip').fadeToggle()"}}),a("label",{staticClass:"checkbox-label",attrs:{for:"toggleTooltips",onmouseover:"tip('Toogle tooltip line and legend box')"}},[t._v("Show tooltips")]),a("label",{staticStyle:{"margin-left":"10px"},attrs:{id:"optionSeedLabel",onmouseover:"tip('Map seed. Please do NOT consider as a save function, seed produces different maps in case of code and options change')"}},[t._v("Map seed:\n              "),a("input",{staticClass:"pureInput",staticStyle:{width:"50px"},attrs:{id:"optionsSeed",onmouseover:"tip('Map seed. Please do NOT consider as a save function, seed produces different maps in case of code and options change')",value:""}}),a("i",{staticClass:"icon-play",staticStyle:{"margin-left":"-3px",color:"#5d4651"},attrs:{onmouseover:"tip('Click to generate a map for this seed')",id:"optionsSeedGenerate"}})])])]),a("div",{staticClass:"tabcontent",attrs:{id:"styleContent"}},[a("p",{staticStyle:{display:"inline-block"}},[t._v("Select element:")]),a("select",{attrs:{id:"styleElementSelect"}},[a("option",{attrs:{value:"grid"}},[t._v("Grid")]),a("option",{attrs:{value:"neutralBorders"}},[t._v("Borders (neutral)")]),a("option",{attrs:{value:"stateBorders"}},[t._v("Borders (state)")]),a("option",{attrs:{value:"coastline"}},[t._v("Coastline")]),a("option",{attrs:{value:"regions"}},[t._v("Countries")]),a("option",{attrs:{value:"cults"}},[t._v("Cultures")]),a("option",{attrs:{value:"terrs"}},[t._v("Heightmap")]),a("option",{attrs:{value:"icons"}},[t._v("Icons")]),a("option",{attrs:{value:"labels"}},[t._v("Labels")]),a("option",{attrs:{value:"lakes"}},[t._v("Lakes")]),a("option",{attrs:{value:"landmass"}},[t._v("Landmass")]),a("option",{attrs:{value:"markers"}},[t._v("Markers")]),a("option",{attrs:{value:"ocean",selected:""}},[t._v("Ocean")]),a("option",{attrs:{value:"overlay"}},[t._v("Overlay")]),a("option",{attrs:{value:"terrain"}},[t._v("Relief")]),a("option",{attrs:{value:"rivers"}},[t._v("Rivers")]),a("option",{attrs:{value:"roads"}},[t._v("Roads")]),a("option",{attrs:{value:"ruler"}},[t._v("Rulers")]),a("option",{attrs:{value:"trails"}},[t._v("Trails")]),a("option",{attrs:{value:"searoutes"}},[t._v("Searoutes")]),a("option",{attrs:{value:"scaleBar"}},[t._v("Scale bar")])]),a("i",{staticClass:"icon-ccw",attrs:{id:"restoreStyle",onmouseover:"tip('Restore default style')"}}),a("div",{attrs:{id:"styleInputs"}},[a("div",{attrs:{id:"styleOverlay"}},[a("br"),a("span",[t._v("Ensure Overlay layer is active (see Layout tab)")]),a("br"),a("br"),t._v("Overlay type: "),a("select",{staticClass:"pureInput",attrs:{id:"styleOverlayType"}},[a("option",{attrs:{value:"pointyHex",selected:""}},[t._v("Hex grid (pointy)")]),a("option",{attrs:{value:"flatHex"}},[t._v("Hex grid (flat)")]),a("option",{attrs:{value:"square"}},[t._v("Square grid")]),a("option",{attrs:{value:"windrose"}},[t._v("Wind rose")])]),a("br"),a("br"),t._v("Size: "),a("input",{attrs:{id:"styleOverlaySize",type:"range",min:"2",max:"50",step:"0.1",value:"10"}}),a("output",{attrs:{id:"styleOverlaySizeOutput",onmouseover:"tip('Overlay size')"}},[t._v("10")]),a("output",{attrs:{id:"styleOverlaySizeFriendly",onmouseover:"tip('Size between two adjacent cells in map scale')"}},[t._v("(52 mi)")])]),a("div",{attrs:{id:"styleOcean"}},[a("br"),t._v("Elements:\n              "),a("input",{staticClass:"checkbox",attrs:{id:"styleOceanPattern",type:"checkbox",checked:""}}),a("label",{staticClass:"checkbox-label",attrs:{for:"styleOceanPattern",onmouseover:"tip('Toggle ocean pattern')"}},[t._v("Pattern")]),a("input",{staticClass:"checkbox",attrs:{id:"styleOceanLayers",type:"checkbox",checked:""}}),a("label",{staticClass:"checkbox-label",attrs:{for:"styleOceanLayers",onmouseover:"tip('Toggle ocean layers')"}},[t._v("Layers")]),a("br"),t._v("\n              Background: "),a("input",{attrs:{id:"styleOceanBack",type:"color",value:"#000000"}}),a("output",{attrs:{id:"styleOceanBackOutput"}},[t._v("#000000")]),a("br"),t._v("\n              Foreground: "),a("input",{attrs:{id:"styleOceanFore",type:"color",value:"#53679f"}}),a("output",{attrs:{id:"styleOceanForeOutput"}},[t._v("#53679f")])]),a("div",{attrs:{id:"styleFill"}},[t._v("\n              Fill: "),a("input",{attrs:{id:"styleFillInput",type:"color",value:"#5E4FA2"}}),a("output",{attrs:{id:"styleFillOutput"}},[t._v("#5E4FA2")])]),a("div",{attrs:{id:"styleStroke"}},[t._v("\n              Stroke: "),a("input",{attrs:{id:"styleStrokeInput",type:"color",value:"#5E4FA2"}}),a("output",{attrs:{id:"styleStrokeOutput"}},[t._v("#5E4FA2")])]),a("div",{attrs:{id:"styleStrokeWidth"}},[a("br"),t._v("Stroke width: "),a("input",{attrs:{id:"styleStrokeWidthInput",type:"range",min:"0",max:"3",step:"0.01",value:"1"}}),a("output",{attrs:{id:"styleStrokeWidthOutput"}},[t._v("1")])]),a("div",{attrs:{id:"styleStrokeDasharray"}},[a("br"),t._v("Stroke dasharray: "),a("input",{staticClass:"pureInput",attrs:{id:"styleStrokeDasharrayInput",value:"1 2"}})]),a("div",{attrs:{id:"styleStrokeLinecap"}},[a("br"),t._v("Stroke linecap: "),a("select",{staticClass:"pureInput",attrs:{id:"styleStrokeLinecapInput"}},[a("option",{attrs:{value:"inherit",selected:""}},[t._v("Inherit")]),a("option",{attrs:{value:"butt"}},[t._v("Butt")]),a("option",{attrs:{value:"round"}},[t._v("Round")]),a("option",{attrs:{value:"square"}},[t._v("Square")])])]),a("div",{attrs:{id:"styleFontSize"}},[a("br"),t._v("Font size: "),a("button",{staticClass:"whiteButton",attrs:{onmouseover:"tip('Multiply all Fonts size by 1.1')",id:"styleFontPlus"}},[t._v("+")]),a("button",{staticClass:"whiteButton",attrs:{onmouseover:"tip('Multiply all Fonts size by 0.9')",id:"styleFontMinus"}},[t._v("-")])]),a("div",{attrs:{id:"styleSize"}},[a("br"),t._v("Radius: "),a("button",{staticClass:"whiteButton",attrs:{onmouseover:"tip('Multiply Radius by 1.1')",id:"styleFillPlus"}},[t._v("+")]),a("button",{staticClass:"whiteButton",attrs:{onmouseover:"tip('Multiply Radius by 0.9')",id:"styleFillMinus"}},[t._v("-")]),a("span",[t._v(" Stroke: ")]),a("button",{staticClass:"whiteButton",attrs:{onmouseover:"tip('Multiply Stroke-width by 1.1')",id:"styleStrokePlus"}},[t._v("+")]),a("button",{staticClass:"whiteButton",attrs:{onmouseover:"tip('Multiply Stroke-width by 0.9')",id:"styleStrokeMinus"}},[t._v("-")])]),a("div",{attrs:{id:"styleOpacity"}},[a("br"),t._v("Opacity: "),a("input",{attrs:{id:"styleOpacityInput",type:"range",min:"0",max:"1",step:"0.01",value:"1"}}),a("output",{attrs:{id:"styleOpacityOutput"}},[t._v("1")])]),a("div",{attrs:{id:"styleFilter"}},[a("br"),t._v("Filter: "),a("select",{staticClass:"pureInput",attrs:{id:"styleFilterInput"}},[a("option",{attrs:{value:"",selected:""}},[t._v("None")]),a("option",{attrs:{value:"url(#blurFilter)"}},[t._v("Blur 0.2")]),a("option",{attrs:{value:"url(#blur1)"}},[t._v("Blur 1")]),a("option",{attrs:{value:"url(#blur5)"}},[t._v("Blur 5")]),a("option",{attrs:{value:"url(#blur10)"}},[t._v("Blur 10")]),a("option",{attrs:{value:"url(#splotch)"}},[t._v("Splotch")]),a("option",{attrs:{value:"url(#bluredSplotch)"}},[t._v("Blured Splotch")]),a("option",{attrs:{value:"url(#dropShadow01)"}},[t._v("Shadow 0.1")]),a("option",{attrs:{value:"url(#dropShadow05)"}},[t._v("Shadow 0.5")]),a("option",{attrs:{value:"url(#dropShadow)"}},[t._v("Shadow 2")]),a("option",{attrs:{value:"url(#outline)"}},[t._v("Outline")]),a("option",{attrs:{value:"url(#pencil)"}},[t._v("Pencil")]),a("option",{attrs:{value:"url(#turbulence)"}},[t._v("Turbulence")])])]),a("div",{attrs:{id:"styleScheme"}},[a("br"),t._v("Color scheme: "),a("select",{staticClass:"pureInput",attrs:{id:"styleSchemeInput"}},[a("option",{attrs:{value:"bright",selected:""}},[t._v("Bright")]),a("option",{attrs:{value:"light"}},[t._v("Light")]),a("option",{attrs:{value:"green"}},[t._v("Green")]),a("option",{attrs:{value:"monochrome"}},[t._v("Monochrome")])])]),a("div",{attrs:{id:"styleLabelGroups"}},[a("fieldset",[a("legend",[t._v("Label groups:")]),a("input",{staticClass:"checkbox",attrs:{id:"hideLabels",type:"checkbox",checked:""}}),a("label",{staticClass:"checkbox-label",attrs:{for:"hideLabels",onmouseover:"tip('Allow system to hide labels if their size in too small on that scale)')"}},[t._v("Toggle visibility automatically")]),a("div",{attrs:{id:"styleLabelGroupItems"}})])])]),a("div",{attrs:{id:"mapFilters"}},[a("p",[t._v("Toggle filters:")]),a("button",{staticClass:"radio",attrs:{id:"grayscale"}},[t._v("Grayscale")]),a("button",{staticClass:"radio",attrs:{id:"sepia"}},[t._v("Sepia")]),a("button",{staticClass:"radio",attrs:{id:"dingy"}},[t._v("Dingy")]),a("button",{staticClass:"radio",attrs:{id:"tint"}},[t._v("Tint")])])]),a("div",{staticClass:"tabcontent",attrs:{id:"optionsContent"}},[a("p",{attrs:{onmouseover:"tip('Map generation setting. Generate a new map to apply the settings')"}},[t._v("Generation options (new map to apply):")]),a("table",[a("tr",[a("td"),a("td",{attrs:{onmouseover:"tip('Map canvas height and width in pixels. Highly affects performance')"}},[t._v("Map size")]),a("td",{staticStyle:{width:"130px"}},[a("span",{attrs:{onmouseover:"tip('Map width')"}},[t._v("w:")]),a("input",{staticClass:"pairedNumber",attrs:{id:"mapWidthInput",type:"number",min:"240",value:"960"}}),a("span",{attrs:{onmouseover:"tip('Map height')"}},[t._v("h:")]),a("input",{staticClass:"pairedNumber",attrs:{id:"mapHeightInput",type:"number",min:"135",value:"540"}})]),a("td",[a("i",{staticClass:"icon-resize-full-alt",attrs:{onmouseover:"tip('Fit map to screen size')",id:"updateFullscreen"}})])]),a("tr",[a("td"),a("td",{attrs:{onmouseover:"tip('Cells density controls underlying graph size and hightly affects performance')"}},[t._v("Map cells density")]),a("td",[a("input",{attrs:{id:"sizeInput",type:"range",min:"1",max:"3",value:"1"}})]),a("td",[a("output",{attrs:{id:"sizeOutput"}},[t._v("1")])])]),a("tr",[a("td",[a("i",{staticClass:"icon-lock-open",attrs:{onmouseover:"tip('Lock to restrict option randomization on new map generation')","data-locked":"0",id:"lockTemplateInput"}})]),a("td",{attrs:{onmouseover:"tip('Select template to be used for a Heightmap generation')"}},[t._v("Heightmap template")]),a("td",[a("select",{attrs:{id:"templateInput"}},[a("option",{attrs:{value:"Volcano"}},[t._v("Volcano")]),a("option",{attrs:{value:"High Island"}},[t._v("High Island")]),a("option",{attrs:{value:"Low Island"}},[t._v("Low Island")]),a("option",{attrs:{value:"Continents"}},[t._v("Continents")]),a("option",{attrs:{value:"Archipelago"}},[t._v("Archipelago")]),a("option",{attrs:{value:"Atoll"}},[t._v("Atoll")]),a("option",{attrs:{value:"Mainland"}},[t._v("Mainland")]),a("option",{attrs:{value:"Peninsulas"}},[t._v("Peninsulas")])])]),a("td")]),a("tr",[a("td",[a("i",{staticClass:"icon-lock-open",attrs:{onmouseover:"tip('Lock to restrict option randomization on new map generation')","data-locked":"0",id:"lockManorsInput"}})]),a("td",{attrs:{onmouseover:"tip('Define how many Settlements should be placed')"}},[t._v("Burgs count")]),a("td",[a("input",{attrs:{id:"manorsInput",type:"range",min:"0",max:"999",value:"500"}})]),a("td",[a("output",{attrs:{id:"manorsOutput"}},[t._v("500")])])]),a("tr",[a("td",[a("i",{staticClass:"icon-lock-open",attrs:{onmouseover:"tip('Lock to restrict option randomization on new map generation')","data-locked":"0",id:"lockRegionsInput"}})]),a("td",{attrs:{onmouseover:"tip('Define how many Countries should be created')"}},[t._v("States count")]),a("td",[a("input",{attrs:{id:"regionsInput",type:"range",min:"0",max:"100",value:"13"}})]),a("td",[a("output",{attrs:{id:"regionsOutput"}},[t._v("13")])])]),a("tr",[a("td",[a("i",{staticClass:"icon-lock-open",attrs:{onmouseover:"tip('Lock to restrict option randomization on new map generation')","data-locked":"0",id:"lockPowerInput"}})]),a("td",{attrs:{onmouseover:"tip('Define Countries size variety. Set to 0 to have all countries sized the same')"}},[t._v("States disbalance")]),a("td",[a("input",{attrs:{id:"powerInput",type:"range",min:"0",max:"10",step:"0.2",value:"5"}})]),a("td",[a("output",{attrs:{id:"powerOutput"}},[t._v("5")]),a("br")])]),a("tr",[a("td",[a("i",{staticClass:"icon-lock",attrs:{onmouseover:"tip('Unlock to allow option randomization on new map generation')","data-locked":"1",id:"lockNeutralInput"}})]),a("td",{attrs:{onmouseover:"tip('Minimal distance to closest burg to consider land neutral')"}},[t._v("Neutral distance")]),a("td",[a("input",{attrs:{id:"neutralInput",type:"range",min:"1",max:"500",step:"1",value:"200"}})]),a("td",[a("output",{attrs:{id:"neutralOutput"}},[t._v("200")])])]),a("tr",{staticStyle:{display:"none"}},[a("td",[a("i",{staticClass:"icon-lock",attrs:{onmouseover:"tip('Unlock to allow option randomization on new map generation')","data-locked":"1",id:"lockNamesInput"}})]),a("td",{attrs:{onmouseover:"tip('Define name generation style for burgs. Only the first one works offline')"}},[t._v("Burg names style")]),a("td",[a("select",{attrs:{id:"namesInput"}},[a("option",{attrs:{value:"0"}},[t._v("Pseudo-real (Culture based simulation; internal generation)")]),a("option",{attrs:{value:"1"}},[t._v("High Fantasy (English only; external resource)")])])]),a("td")]),a("tr",[a("td",[a("i",{staticClass:"icon-lock-open",attrs:{onmouseover:"tip('Lock to restrict option randomization on new map generation')","data-locked":"0",id:"lockCulturesInput"}})]),a("td",{attrs:{onmouseover:"tip('Define how many Cultures should be generated')"}},[t._v("Cultures count")]),a("td",[a("input",{attrs:{id:"culturesInput",type:"range",min:"1",max:"13",value:"7"}})]),a("td",[a("output",{attrs:{id:"culturesOutput"}},[t._v("7")])])]),a("tr",[a("td",[a("i",{staticClass:"icon-lock-open",attrs:{onmouseover:"tip('Lock to restrict option randomization on new map generation')","data-locked":"0",id:"lockPrecInput"}})]),a("td",{attrs:{onmouseover:"tip('Set precipitation level. Controls river quantity and power')"}},[t._v("Precipitation")]),a("td",[a("input",{attrs:{id:"precInput",type:"range",min:"0",max:"25",value:"10"}})]),a("td",[a("output",{attrs:{id:"precOutput"}},[t._v("15")])])]),a("tr",[a("td",[a("i",{staticClass:"icon-lock",attrs:{onmouseover:"tip('Unlock to allow option randomization on new map generation')","data-locked":"1",id:"lockSwampinessInput"}})]),a("td",{attrs:{onmouseover:"tip('Define the land swampiness. Increase to see more marshes on Relief map')"}},[t._v("Swampiness")]),a("td",[a("input",{attrs:{id:"swampinessInput",type:"range",min:"0",max:"100",value:"10"}})]),a("td",[a("output",{attrs:{id:"swampinessOutput"}},[t._v("10")])])]),a("tr",[a("td"),a("td",{attrs:{onmouseover:"tip('Define the coast outline contours scheme')"}},[t._v("Ocean layers")]),a("td",[a("select",{attrs:{id:"outlineLayersInput"}},[a("option",{attrs:{value:"random"}},[t._v("Random")]),a("option",{attrs:{value:"none"}},[t._v("No outline")]),a("option",{attrs:{value:"-6,-3,-1",selected:""}},[t._v("Standard 3")]),a("option",{attrs:{value:"-6,-4,-2"}},[t._v("Indented 3")]),a("option",{attrs:{value:"-9,-6,-3,-1"}},[t._v("Standard 4")]),a("option",{attrs:{value:"-6,-5,-4,-3,-2,-1"}},[t._v("Smooth 6")]),a("option",{attrs:{value:"-9,-8,-7,-6,-5,-4,-3,-2,-1"}},[t._v("Smooth 9")])])]),a("td")])]),a("p",{attrs:{onmouseover:"tip('Generator settings. Getting applied immediately on change')"}},[t._v("Generator settings:")]),a("table",[a("tr",[a("td"),a("td",{attrs:{onmouseover:"tip('Set dialog and tool windows transparency')"}},[t._v("Transparency")]),a("td",[a("input",{attrs:{id:"transparencyInput",type:"range",min:"0",max:"100",value:"0",oninput:"transparencyOutput.value = this.value"}})]),a("td",[a("output",{attrs:{id:"transparencyOutput"}},[t._v("0")])])]),a("tr",[a("td"),a("td",{attrs:{onmouseover:"tip('Define relative size of a saved png images. Consider saving big images is slow')"}},[t._v("PNG resolution")]),a("td",[a("input",{attrs:{id:"pngResolutionInput",type:"range",min:"1",max:"10",value:"5",oninput:"pngResolutionOutput.value = this.value + 'x'"}})]),a("td",[a("output",{attrs:{id:"pngResolutionOutput"}},[t._v("5x")])])]),a("tr",[a("td"),a("td",{attrs:{onmouseover:"tip('Set mininum and maximum zoom level')"}},[t._v("Zoom extent")]),a("td",{staticStyle:{width:"130px"}},[a("span",{attrs:{onmouseover:"tip('Zoom out limit')"}},[t._v("o:")]),a("input",{staticClass:"pairedNumber",attrs:{id:"zoomExtentMin",type:"number",min:"0.2",step:"0.1",max:"20",value:"1"}}),a("span",{attrs:{onmouseover:"tip('Zoom in limit')"}},[t._v("i:")]),a("input",{staticClass:"pairedNumber",attrs:{id:"zoomExtentMax",type:"number",min:"1",max:"50",value:"20"}})]),a("td",[a("i",{staticClass:"icon-ccw",attrs:{onmouseover:"tip('Restore default [1, 20] zoom extent')",id:"zoomExtentDefault"}})])])]),a("button",{attrs:{id:"optionsReset",onmouseover:"tip('Click to restore default options')"}},[t._v("Reset Defaults")])]),a("div",{staticClass:"tabcontent",staticStyle:{display:"block"},attrs:{id:"customizeContent"}},[a("div",{attrs:{id:"openEditor"}},[a("p",[t._v("Customize:")]),a("button",{attrs:{id:"editHeightmap",onmouseover:"tip('Click to open Heightmap customization menu')"}},[t._v("Heightmap")]),a("button",{attrs:{id:"editCountries",onmouseover:"tip('Click to open Countries Editor')"}},[t._v("Countries")]),a("button",{attrs:{id:"editCultures",onmouseover:"tip('Click to open Cultures Editor')"}},[t._v("Cultures")]),a("button",{attrs:{id:"editScale",onmouseover:"tip('Click to open Scale Editor')"}},[t._v("Scale")])]),a("div",{staticStyle:{display:"none"},attrs:{id:"customizeHeightmap"}},[a("p",[t._v("Heightmap customization:")]),a("div",[a("button",{attrs:{onmouseover:"tip('Edit the current Heightmap')",id:"fromHeightmap"}},[t._v("Edit")]),a("button",{attrs:{onmouseover:"tip('Remove all data and start from scratch')",id:"fromScratch"}},[t._v("Clear all")]),a("button",{staticClass:"buttonoff",attrs:{onmouseover:"tip('Finalize the Heightmap. Not allowed if landmass area is insufficient')",id:"getMap"}},[t._v("Complete")])]),a("div",{staticClass:"hidden",attrs:{id:"customizationMenu"}},[a("div",{attrs:{id:"customizeTools"}},[a("label",{attrs:{onmouseover:"tip('Customization Tools')"}},[t._v("Tools:")]),a("br"),a("button",{attrs:{onmouseover:"tip('Display brushes panel')",id:"paintBrushes"}},[t._v("Paint Brushes")]),a("button",{attrs:{onmouseover:"tip('Open template editor')",id:"applyTemplate"}},[t._v("Template Editor")]),a("button",{attrs:{onmouseover:"tip('Open Image Converter')",id:"convertImage"}},[t._v("Image Converter")]),a("button",{attrs:{onmouseover:"tip('Show Heightmap in perspective')",id:"perspectiveView"}},[t._v("Perspective View")])]),a("div",{attrs:{id:"customizeOptions"}},[a("input",{staticClass:"checkbox",attrs:{id:"renderOcean",type:"checkbox"}}),a("label",{staticClass:"checkbox-label",attrs:{for:"renderOcean",onmouseover:"tip('Render cells below sea level')"}},[t._v("Render ocean cells")]),a("input",{staticClass:"checkbox",attrs:{id:"changeHeights",type:"checkbox"}}),a("label",{staticClass:"checkbox-label",attrs:{for:"changeHeights",onmouseover:"tip('Allow system to change custom heights if reasonable')"}},[t._v("Change heights")])]),a("label",{attrs:{onmouseover:"tip('Number of Land cells and landmass/ocean ratio')"}},[t._v("Landmass:\n                "),a("span",{attrs:{id:"landmassCounter"}},[t._v("0")]),t._v(" ("),a("span",{attrs:{id:"landmassRatio"}},[t._v("0")]),t._v("%); Average Elevation: "),a("span",{attrs:{id:"landmassAverage"}},[t._v("0")])]),a("hr")])]),a("div",{attrs:{id:"addFeature"}},[a("p",[t._v("Click to add:")]),a("button",{attrs:{id:"addBurg",onmouseover:"tip('Click on map to place a burg')"}},[t._v("Burg")]),a("button",{attrs:{id:"addLabel",onmouseover:"tip('Click on map to place label')"}},[t._v("Label")]),a("button",{attrs:{id:"addRelief",onmouseover:"tip('Click on map to place a relief icon')"}},[t._v("Relief Icon")]),a("button",{attrs:{id:"addRiver",onmouseover:"tip('Click on map to place new river or extend an existing one')"}},[t._v("River")]),a("button",{attrs:{id:"addRoute",onmouseover:"tip('Click on map to place a route')"}},[t._v("Route")]),a("button",{attrs:{id:"addMarker",onmouseover:"tip('Click on map to place a marker')"}},[t._v("Marker")])]),a("div",{attrs:{id:"cellInfo"}},[a("p",[t._v("Cell info:")]),a("div",[t._v("\n              Coord: "),a("span",{attrs:{id:"infoX"}},[t._v("0")]),t._v("/"),a("span",{attrs:{id:"infoY"}},[t._v("0")]),a("br"),t._v("\n              Cell: "),a("span",{attrs:{id:"infoCell"}},[t._v("0")]),a("br"),t._v("\n              Area: "),a("span",{attrs:{id:"infoArea"}},[t._v("0")]),a("br"),t._v("\n              Height: "),a("span",{attrs:{id:"infoHeight"}},[t._v("0")]),a("br"),t._v("\n              Flux: "),a("span",{attrs:{id:"infoFlux"}},[t._v("0")])]),a("div",[t._v("\n              Type: "),a("span",{attrs:{id:"infoFeature"}},[t._v("n/a")]),a("br"),t._v("\n              Country: "),a("span",{attrs:{id:"infoCountry"}},[t._v("n/a")]),a("br"),t._v("\n              Culture: "),a("span",{attrs:{id:"infoCulture"}},[t._v("n/a")]),a("br"),t._v("\n              Population: "),a("span",{attrs:{id:"infoPopulation"}},[t._v("0")]),a("br"),t._v("\n              Burg: "),a("span",{attrs:{id:"infoBurg"}},[t._v("n/a")])])])]),a("div",{staticClass:"tabcontent",attrs:{id:"aboutContent"}},[a("p",[a("a",{attrs:{href:"https://github.com/Azgaar/Fantasy-Map-Generator",target:"_blank"}},[t._v("Fantasy Map Generator")]),t._v(" is an "),a("a",{attrs:{href:"https://github.com/Azgaar/Fantasy-Map-Generator/blob/master/LICENSE",target:"_blank"}},[t._v("open source")]),t._v(" tool which procedurally generates fantasy maps. You may use auto-generated maps as they are, edit them or even create a map from scratch. Check out the "),a("a",{attrs:{href:"https://github.com/Azgaar/Fantasy-Map-Generator/wiki/Quick-Start-Tutorial",target:"_blank"}},[t._v("quick start tutorial")]),t._v(" and "),a("a",{attrs:{href:"https://github.com/Azgaar/Fantasy-Map-Generator/wiki",target:"_blank"}},[t._v("project wiki")]),t._v(" for guidance. Join our "),a("a",{attrs:{href:"https://www.reddit.com/r/FantasyMapGenerator/",target:"_blank"}},[t._v("Reddit Community")]),t._v(" if you have questions, need any help, have a suggestion or just want to share a created map.")]),a("p",[t._v("The project is under active development. For older versions see the "),a("a",{attrs:{href:"https://github.com/Azgaar/Fantasy-Map-Generator/wiki/Changelog",target:"_blank"}},[t._v("changelog")]),t._v(". Some details are covered in my "),a("a",{attrs:{href:"https://azgaar.wordpress.com/",target:"_blank"}},[t._v("blog")]),t._v(". To track the current progress see the "),a("a",{attrs:{href:"https://trello.com/b/7x832DG4/fantasy-map-generator",target:"_blank"}},[t._v("devboard")]),t._v(".")]),a("p",[t._v("Please report bugs "),a("a",{attrs:{href:"https://github.com/Azgaar/Fantasy-Map-Generator/issues",target:"_blank"}},[t._v("here")]),t._v(". You may also "),a("a",{attrs:{href:"mailto:maxganiev@yandex.ru",target:"_blank"}},[t._v("send me")]),t._v(" an email.")]),a("ul",{staticClass:"share-buttons"},[a("li",[a("a",{attrs:{href:"https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fazgaar.github.io%2FFantasy-Map-Generator%2F&quote=",onmouseover:"tip('Share on Facebook')",target:"_blank"}},[a("img",{attrs:{alt:"Share on Facebook",src:"images/Facebook.png"}})])]),a("li",[a("a",{attrs:{href:"https://twitter.com/intent/tweet?source=https%3A%2F%2Fazgaar.github.io%2FFantasy-Map-Generator&text=%23FantasyMapGenerator%0A%0Ahttps%3A//azgaar.github.io/Fantasy-Map-Generator",target:"_blank",onmouseover:"tip('Tweet')"}},[a("img",{attrs:{alt:"Tweet",src:"images/Twitter.png"}})])]),a("li",[a("a",{attrs:{href:"http://www.tumblr.com/share?v=3&u=https%3A%2F%2Fazgaar.github.io%2FFantasy-Map-Generator",target:"_blank",onmouseover:"tip('Post to Tumblr')"}},[a("img",{attrs:{alt:"Post to Tumblr",src:"images/Tumblr.png"}})])]),a("li",[a("a",{attrs:{href:"http://pinterest.com/pin/create/button/?url=https%3A%2F%2Fazgaar.github.io%2FFantasy-Map-Generator",target:"_blank",onmouseover:"tip('Pin it')"}},[a("img",{attrs:{alt:"Pin it",src:"images/Pinterest.png"}})])]),a("li",[a("a",{attrs:{href:"http://www.reddit.com/submit?url=https%3A%2F%2Fazgaar.github.io%2FFantasy-Map-Generator",target:"_blank",onmouseover:"tip('Submit to Reddit')"}},[a("img",{attrs:{alt:"Submit to Reddit",src:"images/Reddit.png"}})])])])]),a("div",{attrs:{id:"sticked"}},[a("button",{staticClass:"options",attrs:{id:"randomMap",onmouseover:"tip('Generate a new map based on options. May take about 1 minute. Hotkey: F6')"}},[t._v("New Map")]),a("button",{staticClass:"options",attrs:{id:"saveButton",onmouseover:"tip('Select file format to save map')"}},[t._v("Save as")]),a("div",{attrs:{id:"saveDropdown"}},[a("div",{attrs:{id:"saveMap",onmouseover:"tip('Save as fully functional map in .map format. Hotkey: M')"}},[t._v(".map")]),a("div",{attrs:{id:"saveSVG",onmouseover:"tip('Download the map as .svg image (open in browser or in Inkscape. Hotkey: S)')"}},[t._v(".svg")]),a("div",{attrs:{id:"savePNG",onmouseover:"tip('Download the visible part of the map as 4K .png image. Please ensure popups are not blocked! Hotkey: P')"}},[t._v(".png")])]),a("button",{staticClass:"options",attrs:{id:"loadMap",onmouseover:"tip('Load fully functional map in a .map format. Hotkey: L')"}},[t._v("Load")]),a("button",{staticClass:"options",attrs:{id:"zoomReset",onmouseover:"tip('Reset map zoom. Hotkey: 0')"}},[t._v("Reset Zoom")])])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{"background-color":"#ffffff"},attrs:{id:"dialogs"}},[a("div",{staticClass:"dialog",staticStyle:{display:"none"},attrs:{id:"labelEditor"}},[a("button",{staticClass:"icon-tags",attrs:{id:"labelGroupButton",onmouseover:"tip('Edit label Group')"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"labelGroupButtons"}},[a("select",{attrs:{id:"labelGroupSelect",onmouseover:"tip('Select Group for this label')"}}),a("input",{attrs:{id:"labelGroupInput",placeholder:"new group name",onmouseover:"tip('Declare new Group for this label')"}}),a("span",{staticClass:"icon-plus",attrs:{id:"labelGroupNew",onmouseover:"tip('Declare new Group for this label')"}}),a("span",{staticClass:"icon-trash",attrs:{id:"labelGroupRemove",onmouseover:"tip('Remove the Group with all labels')"}})]),a("button",{staticClass:"icon-pencil",attrs:{id:"labelTextButton",onmouseover:"tip('Edit label Text')"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"labelTextButtons"}},[a("input",{attrs:{id:"labelText"}}),a("span",{staticClass:"icon-shuffle",attrs:{id:"labelTextRandom",onmouseover:"tip('Generate random name')"}})]),a("button",{staticClass:"icon-font",attrs:{id:"labelFontButton",onmouseover:"tip('Select Font for the entire Group')"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"labelFontButtons"}},[a("span",{staticClass:"icon-plus",attrs:{id:"labelExternalFont",onmouseover:"tip('Fetch fonts by linking @font-face declaration, just populate with font name if using Google font (fonts.google.com)')"}}),a("select",{attrs:{id:"labelFontSelect",onmouseover:"tip('Select one of the default Fonts')"}}),t._v('/ class="hidden">\n          '),a("i",{staticClass:"icon-text-height",attrs:{id:"labelSizeIcon"}}),a("input",{staticClass:"editNumber",attrs:{id:"labelSize",onmouseover:"tip('Change Font size for the label Group')",value:"14",type:"number",min:"1",max:"100",step:".5"}})]),a("button",{staticClass:"icon-brush",attrs:{id:"labelStyleButton",onmouseover:"tip('Select text color and opacity for the label Group')"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"labelStyleButtons"}},[a("input",{staticClass:"editColor",attrs:{id:"labelColor",type:"color",value:"#3e3e4b"}}),a("i",{staticClass:"icon-adjust hidden",attrs:{id:"labelOpacityIcon"}}),a("input",{staticClass:"editNumber",attrs:{id:"labelOpacity",onmouseover:"tip('Change Opacity for the entire Group')",value:"1",type:"number",min:"0",max:"1",step:"0.02"}}),a("i",{staticClass:"icon-clone hidden",attrs:{id:"labelShadowIcon"}}),a("input",{attrs:{id:"labelShadow",onmouseover:"tip('Change Shadow for the entire Group')",value:"1",type:"number",min:"0",max:"1",step:"0.02",disabled:""}})]),a("button",{staticClass:"icon-ccw",attrs:{id:"labelAngleButton",onmouseover:"tip('Rotate the label')"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"labelAngleButtons"}},[a("input",{staticClass:"editRange",attrs:{id:"labelAngle",value:"0",type:"range",min:"-90",max:"90",step:"0.2"}}),a("span",{staticClass:"labelValue",attrs:{id:"labelAngleValue"}},[t._v("0°")]),a("button",{staticClass:"icon-arc",attrs:{id:"labelCurve",onmouseover:"tip('Show control points to curve the label')"}}),a("button",{staticClass:"icon-minus",attrs:{id:"labelCurveCancel",onmouseover:"tip('Convert curved label into a normal one')"}})]),a("button",{staticClass:"icon-edit",attrs:{id:"labelLegend",onmouseover:"tip('Edit free text notes (legend) for this label')"}}),a("button",{staticClass:"icon-clone",attrs:{id:"labelCopy",onmouseover:"tip('Copy the label')"}}),a("button",{staticClass:"icon-trash",attrs:{id:"labelRemoveSingle",onmouseover:"tip('Remove the label')"}})]),a("div",{staticClass:"dialog",staticStyle:{display:"none"},attrs:{id:"riverEditor"}},[a("button",{staticClass:"icon-sort-alt-up",attrs:{id:"riverWidth",onmouseover:"tip('Change river width and widening')",onclick:'$("#riverEditor > *").not(this).not("#riverResizeButtons").toggle();'}}),a("div",{staticStyle:{display:"none"},attrs:{id:"riverWidthButtons"}},[a("i",{staticClass:"icon-w",attrs:{id:"riverWidthIcon",onmouseover:"tip('Change river width')"}}),a("input",{attrs:{id:"riverWidthInput",onmouseover:"tip('Change river width')",value:"1",type:"range",min:"0.2",max:"5",step:"0.1"}}),a("i",{staticClass:"icon-i",attrs:{id:"riverIncrementIcon",onmouseover:"tip('Change river bed increment (widening speed)')"}}),a("input",{attrs:{id:"riverIncrement",onmouseover:"tip('Change river bed increment (widening speed)')",value:"1",type:"range",min:"0.02",max:"2",step:"0.02"}})]),a("button",{staticClass:"icon-shuffle",attrs:{id:"riverRegenerate",onmouseover:"tip('Regenerate river')"}}),a("button",{staticClass:"icon-ccw",attrs:{id:"riverResize",onmouseover:"tip('Visually transform (rotate, rescale) river')",onclick:'$("#riverEditor > *").not(this).not("#riverWidthButtons").toggle();'}}),a("div",{staticStyle:{display:"none"},attrs:{id:"riverResizeButtons"}},[a("i",{staticClass:"icon-a",attrs:{id:"riverAngleIcon",onmouseover:"tip('Rotate river (set angle)')"}}),a("input",{attrs:{id:"riverAngle",onmouseover:"tip('Rotate river (set angle)')",value:"0",type:"range",min:"-90",max:"90",step:"0.2"}}),a("span",{attrs:{id:"riverAngleValue"}},[t._v("0°")]),a("i",{staticClass:"icon-s",attrs:{id:"riverScaleIcon",onmouseover:"tip('Change river scale')"}}),a("input",{attrs:{id:"riverScale",onmouseover:"tip('Change river scale')",value:"1",type:"number",min:"0.1",max:"3",step:"0.01"}}),a("span",{staticClass:"icon-cancel pointer",attrs:{id:"riverReset",onmouseover:"tip('Reset transformation to default')"}})]),a("button",{staticClass:"icon-clone",attrs:{id:"riverCopy",onmouseover:"tip('Copy river')"}}),a("button",{staticClass:"icon-edit",attrs:{id:"riverLegend",onmouseover:"tip('Edit free text notes (legend) for the river')"}}),a("button",{staticClass:"icon-map-pin",attrs:{id:"riverNew",onmouseover:"tip('Create new river clicking on map')"}}),a("button",{staticClass:"icon-trash",attrs:{id:"riverRemove",onmouseover:"tip('Remove river')"}})]),a("div",{staticClass:"dialog",staticStyle:{display:"none"},attrs:{id:"routeEditor"}},[a("button",{staticClass:"icon-map-signs",attrs:{id:"routeGroups",onmouseover:"tip('Change path group')",onclick:"$('#routeEditor').children().not(this).toggle()"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"routeGroupsSelection"}},[a("select",{attrs:{id:"routeGroup",onmouseover:"tip('Select a group for this route')"}},[a("option",{attrs:{value:"roads",selected:""}},[t._v("roads")])])]),a("button",{attrs:{id:"routeLength"}},[t._v("0")]),a("button",{staticClass:"icon-unlink",attrs:{id:"routeSplit",onmouseover:"tip('Click on a control point to split the route')",onclick:"$(this).toggleClass('pressed')"}}),a("button",{staticClass:"icon-edit",attrs:{id:"routeLegend",onmouseover:"tip('Edit free text notes (legend) for the route')"}}),a("button",{staticClass:"icon-map-pin",attrs:{id:"routeNew",onmouseover:"tip('Create new route clicking on map')"}}),a("button",{staticClass:"icon-trash",attrs:{id:"routeRemove",onmouseover:"tip('Remove route')"}})]),a("div",{staticClass:"dialog",staticStyle:{display:"none"},attrs:{id:"iconEditor"}},[a("button",{staticClass:"icon-tags",attrs:{id:"iconGroups",onmouseover:"tip('Change icon group')"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"iconGroupsSelection"}},[a("select",{attrs:{id:"iconGroup",onmouseover:"tip('Select a group for this icon')"}}),a("i",{staticClass:"icon-trash pointer",attrs:{id:"iconRemoveGroup",onmouseover:"tip('Remove selected icon group')"}})]),a("button",{staticClass:"editButton icon-brush",attrs:{id:"iconColors",onmouseover:"tip('Change icon colors')"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"iconColorsSection"}},[a("i",{staticClass:"icon-f",attrs:{onmouseover:"tip('Change group fill color')"}}),a("input",{staticClass:"editColor",attrs:{id:"iconFillColor",onmouseover:"tip('Change group fill color')",type:"color",value:"#000000"}}),a("i",{staticClass:"icon-s",attrs:{onmouseover:"tip('Change group stroke color')"}}),a("input",{staticClass:"editColor",attrs:{id:"iconStrokeColor",onmouseover:"tip('Change group stroke color')",type:"color",value:"#000000"}})]),a("button",{staticClass:"icon-resize-full",attrs:{id:"iconSetSize",onmouseover:"tip('Change group size')"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"iconSizeSection"}},[a("i",{staticClass:"icon-s",attrs:{onmouseover:"tip('Change size for group icon')"}}),a("input",{staticClass:"editRange",attrs:{id:"iconSize",onmouseover:"tip('Change size for group icon')",type:"range",value:"1",min:".5",max:"10",step:".05"}}),a("i",{staticClass:"icon-w",attrs:{onmouseover:"tip('Change group stroke-width')"}}),a("input",{staticClass:"editNumber",attrs:{id:"iconStrokeWidth",onmouseover:"tip('Change group stroke-width')",type:"number",value:"1",min:"0",max:"5",step:".02"}})]),a("button",{staticClass:"icon-clone",attrs:{id:"iconCopy",onmouseover:"tip('Copy the icon')"}}),a("button",{staticClass:"icon-trash",attrs:{id:"iconRemove",onmouseover:"tip('Remove icon')"}})]),a("div",{staticClass:"dialog",staticStyle:{display:"none"},attrs:{id:"reliefEditor"}},[a("button",{staticClass:"icon-tags",attrs:{id:"reliefGroups",onmouseover:"tip('Change relief icon')"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"reliefGroupsSelection"}},[a("select",{attrs:{id:"reliefGroup",onmouseover:"tip('Change relief icon')"}},[a("option",{attrs:{value:"mounts",selected:""}},[t._v("mounts")]),a("option",{attrs:{value:"hills"}},[t._v("hills")]),a("option",{attrs:{value:"swamps"}},[t._v("swamps")]),a("option",{attrs:{value:"forests"}},[t._v("forests")])]),a("i",{staticClass:"icon-trash pointer",attrs:{id:"reliefRemoveGroup",onmouseover:"tip('Remove all icons within selected group')"}})]),a("button",{staticClass:"icon-clone",attrs:{id:"reliefCopy",onmouseover:"tip('Copy the relief icon')"}}),a("button",{staticClass:"icon-plus",attrs:{id:"reliefAddfromEditor",onmouseover:"tip('Add relief Icon')"}}),a("button",{staticClass:"icon-eraser",attrs:{id:"reliefBulkRemove",onmouseover:"tip('Erase all relief icons in radius')"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"reliefBulkRemoveSection"}},[a("input",{attrs:{id:"reliefBulkRemoveRadius",oninput:"tip('Eraser brush size: '+this.value); reliefBulkRemoveRadiusNumber.value = this.value",type:"range",min:"1",max:"7",value:"3"}}),a("input",{attrs:{id:"reliefBulkRemoveRadiusNumber",oninput:"tip('Eraser brush size: '+this.value); reliefBulkRemoveRadius.value = this.value",type:"number",min:"1",max:"7",value:"3"}})]),a("button",{staticClass:"icon-trash",attrs:{id:"reliefRemove",onmouseover:"tip('Remove this relief icon')"}})]),a("div",{staticClass:"dialog",staticStyle:{display:"none"},attrs:{id:"burgEditor"}},[a("button",{staticClass:"icon-tags",attrs:{id:"burgGroup",onmouseover:"tip('Change Burg Group')"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"burgGroupSection"}},[a("select",{staticStyle:{width:"117px"},attrs:{id:"burgSelectGroup",onmouseover:"tip('Select a Group for this Burg')"}}),a("input",{staticStyle:{display:"none",width:"113px"},attrs:{id:"burgInputGroup",placeholder:"type new Group name",onmouseover:"tip('Create new Group for the Burg')"}}),a("i",{staticClass:"icon-plus pointer",attrs:{id:"burgAddGroup",onmouseover:"tip('Create new Group for the Burg')"}}),a("i",{staticClass:"icon-trash pointer",attrs:{id:"burgRemoveGroup",onmouseover:"tip('Remove selected Burg Group')"}})]),a("button",{staticClass:"icon-map-signs",attrs:{id:"burgEditLabel",onmouseover:"tip('Change label for the Burg Group')"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"burgEditLabelSection"}},[a("button",{staticClass:"icon-pencil",attrs:{id:"burgName",onmouseover:"tip('Change Burg name')"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"burgNameSection"}},[a("input",{staticStyle:{width:"117px"},attrs:{id:"burgNameInput",onmouseover:"tip('Populate to rename the Burg')"}}),a("span",{staticClass:"icon-book pointer",attrs:{id:"burgNameReCulture",onmouseover:"tip('Generate culture-specific name for the Burg')"}}),a("span",{staticClass:"icon-globe pointer",attrs:{id:"burgNameReRandom",onmouseover:"tip('Generate random name for the Burg')"}})]),a("button",{staticClass:"icon-font",attrs:{id:"burgSelectFont",onmouseover:"tip('Select font for the Burg Group label')"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"burgSelectFontSection"}},[a("i",{staticClass:"icon-link pointer",attrs:{id:"burgToggleExternalFont",onmouseover:"tip('Fetch fonts by linking @font-face declaration, just populate with font name if using Google font (fonts.google.com)')"}}),a("input",{staticStyle:{display:"none",width:"113px"},attrs:{id:"burgInputExternalFont",placeholder:"link to @font-face",onmouseover:"tip('Fetch fonts by linking @font-face declaration')"}}),a("select",{staticStyle:{width:"117px"},attrs:{id:"burgSelectDefaultFont",onmouseover:"tip('Select a font for the Group')"}})]),a("button",{staticClass:"icon-text-height",attrs:{id:"burgSetFontSize",onmouseover:"tip('Set font size for the Burg Group label')"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"burgFontSizeSection"}},[a("input",{staticStyle:{width:"117px"},attrs:{id:"burgSetLabelSize",onmouseover:"tip('Set font size for the Burg Group label')",value:"14",type:"number",min:"1",max:"100",step:".5"}})]),a("button",{staticClass:"icon-brush",attrs:{id:"burgLabelColor",onmouseover:"tip('Set label color for the Burg Group')"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"burgLabelColorSection"}},[a("input",{staticClass:"editColor",attrs:{onmouseover:"tip('Set label color for the Burg Group')",id:"burgLabelColorInput",type:"color",value:"#3e3e4b"}}),a("i",{staticClass:"icon-adjust",attrs:{onmouseover:"tip('Set label opacity for the Burg Group')"}}),a("input",{attrs:{onmouseover:"tip('Set label opacity for the Burg Group')",id:"burgLabelOpacity",value:"1",type:"number",min:"0",max:"1",step:"0.02"}})]),a("button",{staticClass:"icon-ccw",attrs:{id:"burgLabelRotation",onmouseover:"tip('Rotate the label')"}}),a("div",{staticStyle:{display:"none",width:"142px"},attrs:{id:"burgLabelRotationSection"}},[a("input",{staticStyle:{width:"98px"},attrs:{id:"burgLabelAngle",value:"0",type:"range",min:"-90",max:"90",step:"0.2"}}),a("output",{attrs:{id:"burgLabelAngleOutput"}},[t._v("0°")])])]),a("button",{staticClass:"icon-fort-awesome",attrs:{id:"burgEditIcon",onmouseover:"tip('Change icon for the Burg Group')"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"burgEditIconSection"}},[a("button",{staticClass:"icon-dot-circled",attrs:{id:"burgIconFill",onmouseover:"tip('Change icon fill')"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"burgIconFillSection"}},[a("i",{staticClass:"icon-resize-full",attrs:{onmouseover:"tip('Change icon size')"}}),a("input",{staticClass:"editRange",staticStyle:{width:"60px"},attrs:{id:"burgIconSize",onmouseover:"tip('Change icon size')",type:"range",value:"1",min:".1",max:"5",step:".05"}}),a("i",{staticClass:"icon-adjust",attrs:{onmouseover:"tip('Set icon fill opacity')"}}),a("input",{staticStyle:{width:"40px"},attrs:{id:"burgIconFillOpacity",onmouseover:"tip('Set icon fill opacity')",value:"1",type:"number",min:"0",max:"1",step:"0.02"}}),a("input",{staticClass:"editColor",attrs:{id:"burgIconFillColor",onmouseover:"tip('Change icon fill color')",type:"color",value:"#000000"}})]),a("button",{staticClass:"icon-circle-empty",attrs:{id:"burgIconStroke",onmouseover:"tip('Change icon stroke')"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"burgIconStrokeSection"}},[a("i",{staticClass:"icon-resize-horizontal",attrs:{onmouseover:"tip('Change icon stroke width')"}}),a("input",{staticStyle:{width:"40px"},attrs:{id:"burgIconStrokeWidth",onmouseover:"tip('Change icon stroke width')",type:"number",value:"1",min:"0",max:"2",step:".02"}}),a("i",{staticClass:"icon-adjust",attrs:{onmouseover:"tip('Set icon stroke opacity')"}}),a("input",{staticStyle:{width:"40px"},attrs:{id:"burgIconStrokeOpacity",onmouseover:"tip('Set icon stroke opacity')",value:"1",type:"number",min:"0",max:"1",step:"0.02"}}),a("input",{staticClass:"editColor",attrs:{id:"burgIconStrokeColor",onmouseover:"tip('Change icon stroke color')",type:"color",value:"#000000"}})])]),a("button",{staticClass:"icon-cog-alt",attrs:{id:"burgFeatures",onmouseover:"tip('Change Burg features')"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"burgFeaturesSection"}},[a("button",{staticClass:"icon-star",attrs:{id:"burgToggleCapital",onmouseover:"tip('Mark the Burg as country capital. Neutral burg cannot be a capital')"}}),a("button",{staticClass:"icon-anchor",attrs:{id:"burgTogglePort",onmouseover:"tip('Mark the Burg as port (toggle anchor icon)')"}}),a("i",{staticClass:"icon-users",attrs:{onmouseover:"tip('Set Burg population')"}}),a("input",{staticStyle:{width:"40px"},attrs:{id:"burgPopulation",onmouseover:"tip('Set Burg population (in population points)')",type:"number",value:"1",min:"0",step:"1"}}),a("output",{attrs:{id:"burgPopulationFriendly",onmouseover:"tip('Burg population (in people)')"}},[t._v("1000")])]),a("button",{staticClass:"icon-map",attrs:{id:"burgSeeInMFCG",onmouseover:"tip('See the burg representation in Medieval Fantasy City Generator by watabou')"}}),a("button",{staticClass:"icon-target",attrs:{id:"burgRelocate",onmouseover:"tip('Move burg to a different cell')"}}),a("button",{staticClass:"icon-edit",attrs:{id:"burglLegend",onmouseover:"tip('Edit free text notes (legend) for this burg')"}}),a("button",{staticClass:"icon-plus",attrs:{id:"burgAddfromEditor",onmouseover:"tip('Add new Burg')"}}),a("button",{staticClass:"icon-trash",attrs:{id:"burgRemove",onmouseover:"tip('Remove the Burg')"}})]),a("div",{staticClass:"dialog",staticStyle:{display:"none"},attrs:{id:"markerEditor"}},[a("button",{staticClass:"icon-tags",attrs:{id:"markerGroup",onmouseover:"tip('Change marker type')"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"markerGroupSection"}},[a("select",{staticStyle:{width:"117px"},attrs:{id:"markerSelectGroup",onmouseover:"tip('Select type for the selected marker')"}}),a("input",{staticStyle:{display:"none",width:"113px"},attrs:{id:"markerInputGroup",placeholder:"type new type name",onmouseover:"tip('Create new type for selected marker')"}}),a("i",{staticClass:"icon-plus pointer",attrs:{id:"markerAddGroup",onmouseover:"tip('Pick out selected marker into a new type')"}}),a("i",{staticClass:"icon-trash pointer",attrs:{id:"markerRemoveGroup",onmouseover:"tip('Remove all markers of that type')"}})]),a("button",{staticClass:"icon-star",attrs:{id:"markerIconButton",onmouseover:"tip('Change marker icon and edit positioning')"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"markerIconButtons"}},[a("i",{staticClass:"icon-resize-full",attrs:{onmouseover:"tip('Change marker icon size')"}}),a("input",{staticClass:"editRange",attrs:{id:"markerIconSize",onmouseover:"tip('Change marker icon size')",value:"22",type:"range",min:"10",max:"30",step:"0.5"}}),a("i",{staticClass:"icon-resize-horizontal",attrs:{onmouseover:"tip('Change marker horizontal shift')"}}),a("input",{staticStyle:{width:"38px"},attrs:{id:"markerIconShiftX",onmouseover:"tip('Change marker horizontal shift')",value:"50",type:"number",min:"0",max:"100"}}),a("i",{staticClass:"icon-resize-vertical",attrs:{onmouseover:"tip('Change marker vertical shift')"}}),a("input",{staticStyle:{width:"38px"},attrs:{id:"markerIconShiftY",onmouseover:"tip('Change marker vertical shift')",value:"50",type:"number",min:"0",max:"100"}}),a("i",{staticClass:"icon-pencil",attrs:{onmouseover:"tip('Paste custom unicode symbol to use as icon')"}}),a("input",{staticStyle:{width:"38px"},attrs:{id:"markerIconCustom",onmouseover:"tip('Paste custom unicode symbol to use as icon')"}}),a("table",{attrs:{id:"markerIconTable"}}),a("div",{staticStyle:{"font-style":"italic",color:"darkgrey"}},[t._v("Please note icons look different in different browsers!")])]),a("button",{staticClass:"icon-brush",attrs:{id:"markerStyleButton",onmouseover:"tip('Change marker size and colors')"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"markerStyleButtons"}},[a("i",{staticClass:"icon-map-pin",attrs:{onmouseover:"tip('Change marker base style')"}}),t._v(":\n          "),a("input",{staticClass:"editRange",attrs:{id:"markerSize",onmouseover:"tip('Change marker size')",value:"1",type:"range",min:"0.1",max:"10",step:"0.2"}}),a("input",{staticClass:"editColor",attrs:{id:"markerBase",onmouseover:"tip('Change marker base color')",type:"color",value:"#ffffff"}}),a("input",{staticClass:"editColor",attrs:{id:"markerFill",onmouseover:"tip('Change marker fill color')",type:"color",value:"#000000"}}),a("br"),a("i",{staticClass:"icon-star",attrs:{onmouseover:"tip('Change marker icon style')"}}),t._v(":\n          "),a("input",{staticClass:"editColor",attrs:{id:"markerIconFill",onmouseover:"tip('Change marker icon fill color')",type:"color",value:"#000000"}}),a("input",{staticStyle:{width:"40px"},attrs:{id:"markerIconStrokeWidth",onmouseover:"tip('Change marker icon stroke width')",value:"0",type:"number",min:"0",max:"2",step:"0.1"}}),a("input",{staticClass:"editColor",attrs:{id:"markerIconStroke",onmouseover:"tip('Change marker icon stroke color')",type:"color",value:"#000000"}})]),a("button",{staticClass:"icon-info-circled",attrs:{id:"markerToggleBubble",onmouseover:"tip('Toggle marker bubble display')"}}),a("button",{staticClass:"icon-edit",attrs:{id:"markerLegendButton",onmouseover:"tip('Edit place legend (free text notes)')"}}),a("button",{staticClass:"icon-plus",attrs:{id:"markerAdd",onmouseover:"tip('Add additional marker of that type')"}}),a("button",{staticClass:"icon-trash",attrs:{id:"markerRemove",onmouseover:"tip('Remove the marker')"}})]),a("div",{staticClass:"dialog stable",staticStyle:{display:"none"},attrs:{id:"templateEditor"}},[a("div",{attrs:{id:"templateTop"}},[t._v("\n          Base template: "),a("select",{attrs:{id:"templateSelect","data-prev":"templateCustom",onmouseover:"tip('Select base template')"}},[a("option",{attrs:{value:"templateCustom",selected:""}},[t._v("Custom")]),a("option",{attrs:{value:"templateVolcano"}},[t._v("Volcano")]),a("option",{attrs:{value:"templateHighIsland"}},[t._v("High Island")]),a("option",{attrs:{value:"templateLowIsland"}},[t._v("Low Island")]),a("option",{attrs:{value:"templateContinents"}},[t._v("Continents")]),a("option",{attrs:{value:"templateArchipelago"}},[t._v("Archipelago")]),a("option",{attrs:{value:"templateAtoll"}},[t._v("Atoll")]),a("option",{attrs:{value:"templateMainland"}},[t._v("Mainland")]),a("option",{attrs:{value:"templatePeninsulas"}},[t._v("Peninsulas")])])]),a("div",{attrs:{id:"templateTools"}},[a("button",{staticClass:"noicon",attrs:{id:"templateMountain",onmouseover:"tip('Mountain: high big blob. Can be placed only once and only as a first step')"}},[t._v("M")]),a("button",{staticClass:"noicon",attrs:{id:"templateHill",onmouseover:"tip('Hill: small blob')"}},[t._v("H")]),a("button",{staticClass:"noicon",attrs:{id:"templatePit",onmouseover:"tip('Pit: round depression')"}},[t._v("P")]),a("button",{staticClass:"noicon",attrs:{id:"templateRange",onmouseover:"tip('Range: elongated elevation')"}},[t._v("R")]),a("button",{staticClass:"noicon",attrs:{id:"templateTrough",onmouseover:"tip('Trough: elongated depression')"}},[t._v("T")]),a("button",{staticClass:"noicon",attrs:{id:"templateStrait",onmouseover:"tip('Strait: centered vertical depression')"}},[t._v("S")]),a("button",{staticClass:"noicon",attrs:{id:"templateAdd",onmouseover:"tip('Add or subtract value from all heights')"}},[t._v("+")]),a("button",{staticClass:"noicon",attrs:{id:"templateMultiply",onmouseover:"tip('Multiply all heights by factor')"}},[t._v("*")]),a("button",{staticClass:"noicon",attrs:{id:"templateSmooth",onmouseover:"tip('Smooth the map replacing cell heights by an average values of its neighbors')"}},[t._v("~")])]),a("div",{attrs:{id:"templateBody","data-changed":"0"}},[a("div",{attrs:{"data-type":"Mountain"}},[t._v("Mountain\n            "),a("span",{staticClass:"icon-trash-empty",attrs:{onmouseover:"tip('Remove step')",onclick:"this.parentNode.parentNode.removeChild(this.parentNode)"}})])]),a("div",{attrs:{id:"templateBottom"}},[a("button",{staticClass:"icon-play-circled2",attrs:{id:"templateRun",onmouseover:"tip('Apply current template')"}}),a("button",{staticClass:"icon-ccw",attrs:{id:"templateUndo",onmouseover:"tip('Undo the latest action')",disabled:""}}),a("button",{staticClass:"icon-cw",attrs:{id:"templateRedo",onmouseover:"tip('Redo the action')",disabled:""}}),a("button",{staticClass:"icon-check",attrs:{id:"templateComplete",onmouseover:"tip('Finalize the Heightmap. Not allowed if insufficient land area available')"}}),a("button",{staticClass:"icon-download",attrs:{id:"templateSave",onmouseover:"tip('Save template')"}}),a("button",{staticClass:"icon-upload",attrs:{id:"templateLoad",onmouseover:"tip('Open previously saved template')"}}),a("button",{staticClass:"icon-mail-alt",attrs:{id:"templateMail",onclick:"window.open('mailto:maxganiev@yandex.com?Subject=Template%20suggestion', '_blank')",onmouseover:"tip('Send a template suggestion to me')"}})])]),a("div",{staticClass:"dialog stable",staticStyle:{display:"none"},attrs:{id:"imageConverter"}},[a("div",{attrs:{id:"convertImageButtons"}},[a("button",{staticClass:"icon-upload",attrs:{id:"convertImageLoad",onmouseover:"tip('Load image to convert')"}}),a("button",{staticClass:"icon-adjust",attrs:{id:"convertAutoLum",onmouseover:"tip('Auto-assign colors based on liminosity')"}}),a("button",{staticClass:"icon-brush",attrs:{id:"convertAutoHue",onmouseover:"tip('Auto-assign colors based on hue')"}}),a("button",{staticClass:"icon-minus-squared",attrs:{id:"convertColorsMinus",onmouseover:"tip('Reduce the number of colors. Minimal number is 3')"}}),a("button",{staticClass:"icon-plus-squared",attrs:{id:"convertColorsPlus",onmouseover:"tip('Increase the number of colors. Maximum number is 256')"}}),a("input",{staticStyle:{display:"none"},attrs:{id:"convertColors",value:"12"}}),a("button",{staticClass:"icon-eye",attrs:{id:"convertImageGrid",onmouseover:"tip('Toggle grid')"}}),a("button",{staticClass:"icon-clone",attrs:{id:"convertOverlayButton",onmouseover:"tip('Change overlay opacity')"}}),a("input",{staticStyle:{display:"none"},attrs:{id:"convertOverlay",onmouseover:"tip('Change overlay opacity')",type:"range",min:"0",max:"1",step:"0.01",value:"0"}}),a("span",{staticStyle:{display:"none"},attrs:{id:"convertOverlayValue",onmouseover:"tip('Overlay opacity')"}},[t._v("0")]),a("button",{staticClass:"icon-check",attrs:{id:"convertComplete",onmouseover:"tip('Complete conversion. All unassigned colors will be considered as ocean')"}})]),a("div",{attrs:{id:"colorsSelect"}},[a("div",{attrs:{id:"colorScheme"}}),a("span",{attrs:{id:"colorsSelectValue"}},[t._v("0")])]),a("div",{staticStyle:{display:"none"},attrs:{id:"colorsAssigned"}},[a("label",[t._v("Assigned colors: ")]),a("br")]),a("div",{staticStyle:{display:"none"},attrs:{id:"colorsUnassigned"}},[a("label",[t._v("Unassigned colors: ")]),a("br")])]),a("div",{staticClass:"dialog stable",staticStyle:{display:"none"},attrs:{id:"brushesPanel"}},[a("div",{attrs:{id:"brushesButtons"}},[a("button",{staticClass:"noicon",attrs:{id:"brushElevate",onmouseover:"tip('Click and drag the map to increase cells elevation')"}},[t._v("↥")]),a("button",{staticClass:"noicon",attrs:{id:"brushDepress",onmouseover:"tip('Click and drag the map to decrease cells elevation')"}},[t._v("↧")]),a("button",{staticClass:"noicon",attrs:{id:"brushAlign",onmouseover:"tip('Click and drag the map to align cells elevation')"}},[t._v("=")]),a("button",{staticClass:"noicon",attrs:{id:"brushSmooth",onmouseover:"tip('Click and drag the map to smooth cells elevation')"}},[t._v("~")]),a("button",{staticClass:"feature noicon",attrs:{id:"brushHill",onmouseover:"tip('Click on the map to place a Hill')"}},[t._v("H")]),a("button",{staticClass:"feature noicon",attrs:{id:"brushPit",onmouseover:"tip('Click on the map to place a Pit')"}},[t._v("P")]),a("button",{staticClass:"feature noicon",attrs:{id:"brushRange",onmouseover:"tip('Select two points to place a Range')"}},[t._v("R")]),a("button",{staticClass:"feature noicon",attrs:{id:"brushTrough",onmouseover:"tip('Select two points to place a Trought')"}},[t._v("T")])]),a("div",{staticStyle:{display:"table"}},[a("label",{staticClass:"disabled italic",attrs:{id:"brushRadiusLabel",onmouseover:"tip('Set the brush effective radius. Works only with 4 brushes above')"}},[t._v("R:")]),a("input",{staticClass:"disabled",attrs:{id:"brushRadius",oninput:"tip('Brush radius: '+this.value)",type:"range",min:"1",max:"10",value:"3",disabled:""}}),a("label",{staticClass:"italic",attrs:{onmouseover:"tip('Set the brush power in points of height')"}},[t._v("H:")]),a("input",{attrs:{id:"brushPower",oninput:"tip('Brush power: '+this.value)",type:"range",min:"1",max:"30",value:"5"}})]),a("div",{attrs:{id:"modifyButtons"}},[a("button",{staticClass:"icon-ccw",attrs:{id:"undo",onmouseover:"tip('Undo the latest action (Ctrl + Z)')",disabled:""}}),a("button",{staticClass:"icon-cw",attrs:{id:"redo",onmouseover:"tip('Redo the action (Ctrl + Y)')",disabled:""}}),a("button",{staticClass:"icon-exchange",attrs:{id:"rescaleButton",onmouseover:"tip('Show rescaler slider')"}}),a("input",{staticClass:"hidden",attrs:{id:"rescaler",onmouseover:"tip('Slide to change map height')",type:"range",min:"1",max:"10",step:"0.1",value:"5"}}),a("button",{staticClass:"icon-if",attrs:{id:"rescaleCondButton",onmouseover:"tip('Conditional rescaler')"}}),a("label",{staticClass:"condition hidden"},[t._v("h ≥")]),a("input",{staticClass:"condition hidden",attrs:{id:"rescaleLower",onmouseover:"tip('Set lower threshold')",value:"20",type:"number",min:"0",max:"100"}}),a("label",{staticClass:"condition hidden"},[t._v("≤")]),a("input",{staticClass:"condition hidden",attrs:{id:"rescaleHigher",onmouseover:"tip('Set higher threshold')",value:"100",type:"number",min:"1",max:"100"}}),a("label",{staticClass:"condition hidden"},[t._v("⇒")]),a("select",{staticClass:"condition hidden",attrs:{id:"conditionSign"}},[a("option",{attrs:{value:"×",selected:""}},[t._v("×")]),a("option",{attrs:{value:"÷"}},[t._v("÷")]),a("option",{attrs:{value:"+"}},[t._v("+")]),a("option",{attrs:{value:"-"}},[t._v("-")]),a("option",{attrs:{value:"^"}},[t._v("^")])]),a("input",{staticClass:"condition hidden",attrs:{id:"rescaleModifier",onmouseover:"tip('Set modifier value')",type:"number",value:"0.9",min:"0",max:"1.5",step:"0.01"}}),a("button",{staticClass:"icon-play-circled2 condition hidden",attrs:{id:"rescaleExecute",onmouseover:"tip('Run condition')"}}),a("button",{staticClass:"icon-smooth",attrs:{id:"smoothHeights",onmouseover:"tip('Smooth all heights')"}}),a("button",{staticClass:"icon-disrupt",attrs:{id:"disruptHeights",onmouseover:"tip('Disrupt (randomize) heights')"}}),a("button",{staticClass:"icon-eraser",attrs:{id:"brushClear",onmouseover:"tip('Clear all height')"}})])]),a("div",{staticClass:"dialog stable",staticStyle:{display:"none"},attrs:{id:"perspectivePanel"}},[a("canvas",{attrs:{id:"perspective",width:"480",height:"150"}})]),a("div",{staticClass:"dialog stable",staticStyle:{display:"none"},attrs:{id:"countriesEditor","data-type":"absolute"}},[a("div",{attrs:{id:"countriesHeader"}},[a("div",{staticClass:"sortable alphabetically",staticStyle:{"margin-left":"14px"},attrs:{onmouseover:"tip('Click to sort alphabetically by country name')","data-sortby":"country"}},[t._v("Country ")]),a("div",{staticClass:"sortable alphabetically",staticStyle:{"margin-left":"30px"},attrs:{onmouseover:"tip('Click to sort alphabetically by capital name')","data-sortby":"capital"}},[t._v("Capital ")]),a("div",{staticClass:"sortable hidden",staticStyle:{"margin-left":"24px"},attrs:{onmouseover:"tip('Click to sort by country expansion value')","data-sortby":"expansion"}},[t._v("Expan. ")]),a("div",{staticClass:"sortable",staticStyle:{"margin-left":"30px"},attrs:{onmouseover:"tip('Click to sort by country cells count')","data-sortby":"cells"}},[t._v("Cells ")]),a("div",{staticClass:"sortable",staticStyle:{"margin-left":"6px"},attrs:{onmouseover:"tip('Click to sort by country burgs count')","data-sortby":"burgs"}},[t._v("Burgs ")]),a("div",{staticClass:"sortable",staticStyle:{"margin-left":"20px"},attrs:{onmouseover:"tip('Click to sort by country area')","data-sortby":"area"}},[t._v("Area ")]),a("div",{staticClass:"sortable",staticStyle:{"margin-left":"22px"},attrs:{onmouseover:"tip('Click to sort by country population')","data-sortby":"population"}},[t._v("Population ")])]),a("div",{attrs:{id:"countriesBody"}}),a("div",{staticClass:"totalLine",attrs:{id:"countriesFooter"}},[a("div",{staticStyle:{"margin-left":"5px"}},[t._v("Countries: "),a("span",{attrs:{id:"countriesFooterCountries"}},[t._v("0")])]),a("div",{staticStyle:{"margin-left":"20px"}},[t._v("Burgs: "),a("span",{attrs:{id:"countriesFooterBurgs"}},[t._v("0")])]),a("div",{staticStyle:{"margin-left":"20px"}},[t._v("Land Area: "),a("span",{attrs:{id:"countriesFooterArea"}},[t._v("0")])]),a("div",{staticStyle:{"margin-left":"20px"}},[t._v("Population: "),a("span",{attrs:{id:"countriesFooterPopulation"}},[t._v("0")])])]),a("div",{attrs:{id:"countriesBottom"}},[a("button",{staticClass:"icon-map-signs",attrs:{id:"editScaleCountries",onmouseover:"tip('Change demographical and geographical measurements')"}}),a("button",{staticClass:"icon-percent",attrs:{id:"countriesPercentage",onmouseover:"tip('Toggle percentage / absolut values views')"}}),a("button",{staticClass:"icon-cog-alt",attrs:{id:"countriesRegenerate",onmouseover:"tip('Regenerate countries based on amended Expansion values')"}}),a("button",{staticClass:"icon-brush",attrs:{id:"countriesManually",onmouseover:"tip('Manually re-assign countries')"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"countriesManuallyButtons"}},[a("button",{staticClass:"icon-check",attrs:{id:"countriesManuallyComplete",onmouseover:"tip('Apply assignment')"}}),a("button",{staticClass:"icon-flag",attrs:{id:"countriesAddM",onmouseover:"tip('Proclaim a new country')"}}),a("button",{staticClass:"icon-cancel",attrs:{id:"countriesManuallyCancel",onmouseover:"tip('Cancel assignment')"}}),a("label",{staticClass:"italic",attrs:{onmouseover:"tip('Set the brush size')"}},[t._v("Brush size:")]),a("input",{attrs:{id:"countriesManuallyBrush",oninput:"tip('Brush size: '+this.value); countriesManuallyBrushNumber.value = this.value",type:"range",min:"1",max:"7",value:"3"}}),a("input",{attrs:{id:"countriesManuallyBrushNumber",oninput:"tip('Brush size: '+this.value); countriesManuallyBrush.value = this.value",type:"number",min:"1",max:"7",value:"3"}})]),a("div",{staticStyle:{display:"none"},attrs:{id:"countriesRegenerateButtons"}},[a("button",{staticClass:"icon-check",attrs:{id:"countriesApply",onmouseover:"tip('Apply assignment')"}}),a("button",{staticClass:"icon-shuffle",attrs:{id:"countriesRandomize",onmouseover:"tip('Randomize countries Expansion value')"}}),a("button",{staticClass:"icon-flag",attrs:{id:"countriesAddR",onmouseover:"tip('Proclaim a new country')"}}),a("label",{staticClass:"italic",attrs:{onmouseover:"tip('Distance to a consider a land as neutral')"}},[t._v("Neutral distance:")]),a("input",{attrs:{id:"countriesNeutral",oninput:"tip('Neutral distance: '+this.value); countriesNeutralNumber.value = this.value",type:"range",min:"1",max:"500",value:"200"}}),a("input",{staticStyle:{width:"42px"},attrs:{id:"countriesNeutralNumber",oninput:"tip('Neutral distance: '+this.value); countriesNeutral.value = this.value",type:"number",min:"1",max:"500",value:"200"}})]),a("button",{staticClass:"icon-flag",attrs:{id:"countriesAddG",onmouseover:"tip('Proclaim a new country')"}}),a("button",{staticClass:"icon-arrows-cw",attrs:{id:"countriesRegenerateNames",onmouseover:"tip('Regenerate countries names')"}}),a("button",{staticClass:"icon-download",attrs:{id:"countriesExport",onmouseover:"tip('Save country-related data as a text file (.csv)')"}}),a("button",{staticClass:"icon-upload",attrs:{id:"burgNamesImport",onmouseover:"tip('Load burg names from a text file. Each name should be on a new line!')"}}),a("button",{staticClass:"icon-trash",attrs:{id:"removeCountries",onmouseover:"tip('Remove all countries')"}})])]),a("div",{staticClass:"dialog stable",staticStyle:{display:"none"},attrs:{id:"burgsEditor"}},[a("div",{attrs:{id:"burgsHeader"}},[a("div",{staticClass:"sortable alphabetically",staticStyle:{"margin-left":"19px"},attrs:{onmouseover:"tip('Click to sort alphabetically by burg name')","data-sortby":"burg"}},[t._v("Burg ")]),a("div",{staticClass:"sortable alphabetically",staticStyle:{"margin-left":"29px"},attrs:{onmouseover:"tip('Click to sort alphabetically by culture name')","data-sortby":"culture"}},[t._v("Culture ")]),a("div",{staticClass:"sortable",staticStyle:{"margin-left":"14px"},attrs:{onmouseover:"tip('Click to sort by country population')","data-sortby":"population"}},[t._v("Population ")]),a("div",{staticClass:"sortable alphabetically",staticStyle:{"margin-left":"6px"},attrs:{onmouseover:"tip('Click to sort by country burg type')","data-sortby":"type"}},[t._v("Type ")])]),a("div",{attrs:{id:"burgsBody"}}),a("div",{staticClass:"totalLine",attrs:{id:"burgsFooter"}},[a("div",{staticStyle:{"margin-left":"4px"},attrs:{onmouseover:"tip('Burgs number')"}},[t._v("Burgs: "),a("span",{attrs:{onmouseover:"tip('Burgs number')",id:"burgsFooterBurgs"}},[t._v("0")])]),a("div",{staticStyle:{"margin-left":"10px"}},[t._v("Average burg:  \n            "),a("span",{staticClass:"icon-book",attrs:{onmouseover:"tip('Dominant culture')"}}),a("span",{attrs:{onmouseover:"tip('Dominant culture')",id:"burgsFooterCulture"}},[t._v("no")]),t._v(" \n            "),a("span",{staticClass:"icon-male",attrs:{onmouseover:"tip('Average burg population')"}}),a("input",{attrs:{onmouseover:"tip('Average burg population. Change to recalculate population for all burgs within country')",id:"burgsFooterPopulation",type:"number",min:"1",max:"1000000",step:"100",value:"0"}})])]),a("div",{attrs:{id:"burgsBottom"}},[a("button",{staticClass:"icon-map-signs",attrs:{id:"editScaleBurgs",onmouseover:"tip('Change demographical and geographical measurements')"}}),a("button",{staticClass:"icon-star",attrs:{id:"changeCapital",onmouseover:"tip('Click on a burg line to make it a new capital')"}}),a("button",{staticClass:"icon-arrows-cw",attrs:{id:"regenerateBurgNames",onmouseover:"tip('Regenerate burg names based on assigned culture')"}}),a("button",{staticClass:"icon-fort-awesome",attrs:{id:"burgAdd",onmouseover:"tip('Add new burg')"}}),a("button",{staticClass:"icon-trash",attrs:{id:"removeBurgs",onmouseover:"tip('Remove all burgs')"}})])]),a("div",{staticClass:"dialog stable",staticStyle:{display:"none"},attrs:{id:"culturesEditor","data-type":"absolute"}},[a("div",{attrs:{id:"culturesHeader"}},[a("div",{staticClass:"sortable alphabetically",staticStyle:{"margin-left":"14px"},attrs:{onmouseover:"tip('Click to sort by culture name')","data-sortby":"culture"}},[t._v("Culture ")]),a("div",{staticClass:"sortable",staticStyle:{"margin-left":"16px"},attrs:{onmouseover:"tip('Click to sort by culture cells count')","data-sortby":"cells"}},[t._v("Cells ")]),a("div",{staticClass:"sortable",staticStyle:{"margin-left":"18px"},attrs:{onmouseover:"tip('Click to sort by culture area')","data-sortby":"area"}},[t._v("Area ")]),a("div",{staticClass:"sortable",staticStyle:{"margin-left":"30px"},attrs:{onmouseover:"tip('Click to sort by culture population')","data-sortby":"population"}},[t._v("Population ")]),a("div",{staticClass:"sortable alphabetically",staticStyle:{"margin-left":"3px"},attrs:{onmouseover:"tip('Click to sort by culture namesbase')","data-sortby":"base"}},[t._v("Namesbase ")])]),a("div",{attrs:{id:"culturesBody"}}),a("div",{staticClass:"totalLine",attrs:{id:"culturesFooter"}},[a("div",{staticStyle:{"margin-left":"7px"},attrs:{onmouseover:"tip('Cultures number (active / total)')"}},[t._v("Cultures: "),a("span",{attrs:{id:"culturesFooterCultures"}},[t._v("0 / 7")])]),a("div",{staticStyle:{"margin-left":"7px"},attrs:{onmouseover:"tip('Total Land cells number')"}},[t._v("Cells: "),a("span",{attrs:{id:"culturesFooterCells"}},[t._v("0")])]),a("div",{staticStyle:{"margin-left":"7px"},attrs:{onmouseover:"tip('Total Land Area')"}},[t._v("Area: "),a("span",{attrs:{id:"culturesFooterArea"}},[t._v("0")])]),a("div",{staticStyle:{"margin-left":"7px"},attrs:{onmouseover:"tip('Total Population')"}},[t._v("Population: "),a("span",{attrs:{id:"culturesFooterPopulation"}},[t._v("0")])])]),a("div",{attrs:{id:"culturesBottom"}},[a("button",{staticClass:"icon-percent",attrs:{id:"culturesPercentage",onmouseover:"tip('Toggle percentage / absolut values views')"}}),a("button",{staticClass:"icon-brush",attrs:{id:"culturesManually",onmouseover:"tip('Manually re-assign cultures')"}}),a("div",{staticStyle:{display:"none"},attrs:{id:"culturesManuallyButtons"}},[a("button",{staticClass:"icon-check",attrs:{id:"culturesManuallyComplete",onmouseover:"tip('Apply assignment')"}}),a("button",{staticClass:"icon-cancel",attrs:{id:"culturesManuallyCancel",onmouseover:"tip('Cancel assignment')"}}),a("label",{staticClass:"italic",attrs:{onmouseover:"tip('Set the brush size')"}},[t._v("Brush size:")]),a("input",{attrs:{id:"culturesManuallyBrush",oninput:"tip('Brush size: '+this.value); culturesManuallyBrushNumber.value = this.value",type:"range",min:"1",max:"7",value:"3"}}),a("input",{attrs:{id:"culturesManuallyBrushNumber",oninput:"tip('Brush size: '+this.value); culturesManuallyBrush.value = this.value",type:"number",min:"1",max:"7",value:"3"}})]),a("button",{staticClass:"icon-shuffle",attrs:{id:"culturesRandomize",onmouseover:"tip('Randomly re-distribute cultures')"}}),a("button",{staticClass:"icon-arrows-cw",attrs:{id:"culturesRegenerateNames",onmouseover:"tip('Re-generate all Burg names based on assigned culture')"}}),a("button",{staticClass:"icon-list-bullet",attrs:{id:"culturesEditNamesBase",onmouseover:"tip('Edit a database used for names generation')"}}),a("button",{staticClass:"icon-plus",attrs:{id:"culturesAdd",onmouseover:"tip('Add a new culture')"}}),a("button",{staticClass:"icon-download",attrs:{id:"culturesExport",onmouseover:"tip('Save cultures-related data as a text file (.csv)')"}})])]),a("div",{staticClass:"dialog stable textual",staticStyle:{display:"none"},attrs:{id:"namesbaseEditor"}},[a("div",{attrs:{id:"namesbaseBasesTop"}},[a("span",[t._v("Select base: ")]),a("select",{attrs:{id:"namesbaseSelect",onmouseover:"tip('Select base to edit')",value:"0"}}),a("span",[t._v("Base name: ")]),a("input",{attrs:{id:"namesbaseName",onmouseover:"tip('Type to change a base name')",placeholder:"Base name",autocorrect:"off",spellcheck:"false"}})]),a("div",{attrs:{id:"namesbaseBody"}},[a("span",[t._v("Names data:")]),a("br"),a("textarea",{attrs:{id:"namesbaseTextarea","data-base":"0",cols:"70",rows:"10",onmouseover:"tip('Names data: a comma separated list of source names used for names generation')",placeholder:"Provide a names data: a comma separated list of source names",autocorrect:"off",spellcheck:"false"}}),a("br"),a("div",[a("span",[t._v("Method: ")]),a("select",{attrs:{onmouseover:"tip('Select generation method')",id:"namesbaseMethod"}},[a("option",{attrs:{value:"let-to-let"}},[t._v("Markov let-to-let")]),a("option",{attrs:{value:"let-to-syl"}},[t._v("Markov let-to-syl")]),a("option",{attrs:{value:"syl-to-syl"}},[t._v("Markov syl-to-syl")]),a("option",{attrs:{value:"selection"}},[t._v("Random selection")])]),a("span",[t._v("   Length: ")]),a("input",{attrs:{id:"namesbaseMin",onmouseover:"tip('Minimal name length recommendation')",type:"number",min:"2",max:"100",value:"4"}}),a("input",{attrs:{id:"namesbaseMax",onmouseover:"tip('Maximal name length recommendation')",type:"number",min:"2",value:"10"}}),a("span",[t._v("Dublication: ")]),a("input",{attrs:{id:"namesbaseDouble",onmouseover:"tip('Populate with letters that can used twice in a row')",autocorrect:"off",spellcheck:"false",value:"abc"}})]),a("fieldset",[a("legend",[t._v("Generated examples: ")]),a("div",{attrs:{id:"namesbaseExamples",onmouseover:"tip('Generated examples. Click to re-gererate')"}})])]),a("div",{attrs:{id:"namesbaseBottom"}},[a("button",{staticClass:"icon-cancel",attrs:{id:"namesbaseDefault",onmouseover:"tip('Restore default namesbase')"}}),a("button",{staticClass:"icon-plus",attrs:{id:"namesbaseAdd",onmouseover:"tip('Add a new base')"}}),a("button",{staticClass:"icon-cw",attrs:{id:"namesbaseUpdateExamples",onmouseover:"tip('Re-generate examples based on provided data and generation method')"}}),a("button",{staticClass:"icon-download",attrs:{id:"namesbaseDownload",onmouseover:"tip('Download namesbase to PC')"}}),a("button",{staticClass:"icon-upload",attrs:{id:"namesbaseUpload",onmouseover:"tip('Upload a namesbase from PC')"}}),a("button",{staticClass:"icon-mail-alt",attrs:{id:"namesbaseMail",onclick:"window.open('mailto:maxganiev@yandex.com?Subject=Namesbase%20suggestion', '_blank')",onmouseover:"tip('Send a namesbase suggestion to me')"}})])]),a("div",{staticClass:"dialog stable textual",staticStyle:{display:"none"},attrs:{id:"legendEditor"}},[a("div",[a("span",[t._v("Select object: ")]),a("select",{staticStyle:{width:"120px"},attrs:{id:"legendSelect",onmouseover:"tip('Select object')"}}),a("span",[t._v("Object name: ")]),a("input",{staticStyle:{width:"120px"},attrs:{id:"legendName",onmouseover:"tip('Type to change object name')",autocorrect:"off",spellcheck:"false"}})]),a("div",[a("span",[t._v("Legend:")]),a("br"),a("textarea",{attrs:{id:"legendText",cols:"70",rows:"7",onmouseover:"tip('Legend is a free text note, enter any object description you like')",placeholder:"Legend is a free text note, enter any object description you like"}})]),a("div",[a("button",{staticClass:"icon-target",attrs:{id:"legendFocus",onmouseover:"tip('Focus map on selected object')"}}),a("button",{staticClass:"icon-download",attrs:{id:"legendDownload",onmouseover:"tip('Download legends to PC')"}}),a("button",{staticClass:"icon-upload",attrs:{id:"legendUpload",onmouseover:"tip('Upload legends from PC')"}}),a("button",{staticClass:"icon-trash",attrs:{id:"legendRemove",onmouseover:"tip('Remove this note')"}})])]),a("div",{staticClass:"dialog stable",staticStyle:{display:"none"},attrs:{id:"scaleEditor"}},[a("div",{attrs:{id:"scaleBody"}},[a("div",{staticClass:"scaleHeader"},[a("span",{staticClass:"icon-map-signs"}),a("div",[t._v("Distances: ")])]),a("div",[a("div",[t._v("Distance unit: ")]),a("select",{attrs:{onmouseover:"tip('Select Distance unit')",id:"distanceUnit"}},[a("option",{attrs:{value:"mi",selected:""}},[t._v("Mile")]),a("option",{attrs:{value:"km"}},[t._v("Kilometer")]),a("option",{attrs:{value:"lg"}},[t._v("League")]),a("option",{attrs:{value:"vr"}},[t._v("Versta")]),a("option",{attrs:{value:"custom_name"}},[t._v("Custom name")])])]),a("div",[a("div",{attrs:{onmouseover:"tip('Select how many distance unit are in one pixel')"}},[t._v("1 map pixel =")]),a("input",{attrs:{id:"distanceScale",onmouseover:"tip('Select how many distance unit are in one pixel')",type:"range",min:"0.1",max:"10",value:"3",step:"0.1"}}),a("input",{staticClass:"output",attrs:{id:"scaleOutput",onmouseover:"tip('Enter how many distance unit are in one pixel')",type:"text",value:"3 mi"}})]),a("div",[a("div",{attrs:{onmouseover:"tip('Type area unit name, leave `square` just to add ² to the distance unit selected above')"}},[t._v("Area unit: ")]),a("input",{attrs:{id:"areaUnit",onmouseover:"tip('Type area unit name, leave `square` just to add ² to the distance unit selected above')",type:"text",value:"square"}})]),a("div",{staticClass:"scaleHeader"},[a("span",{staticClass:"icon-signal"}),a("div",[t._v("Altitude: ")])]),a("div",[a("div",[t._v("Height unit: ")]),a("select",{attrs:{onmouseover:"tip('Select Height unit')",id:"heightUnit"}},[a("option",{attrs:{value:"ft",selected:""}},[t._v("Feet")]),a("option",{attrs:{value:"m"}},[t._v("Meters")]),a("option",{attrs:{value:"f"}},[t._v("Fathoms")])])]),a("div",[a("div",{attrs:{onmouseover:"tip('Select height exponent, i.e. a value showing altitude change sharpness')"}},[t._v("Exponent: ")]),a("input",{attrs:{id:"heightExponent",onmouseover:"tip('Select height exponent, i.e. a value showing altitude change sharpness')",onchange:"heightOutput.value = this.value",type:"range",min:"1.5",max:"2",value:"1.73",step:"0.01"}}),a("input",{staticClass:"output",attrs:{id:"heightOutput",onmouseover:"tip('Select height exponent, i.e. a value showing altitude change sharpness')",type:"text",value:"1.73"}})]),a("div",{staticClass:"scaleHeader"},[a("span",{staticClass:"icon-minus"}),a("div",[t._v("Scale bar: ")])]),a("div",[a("div",{attrs:{onmouseover:"tip('Change scale bar size')"}},[t._v("Scale bar size: ")]),a("input",{attrs:{id:"barSize",onmouseover:"tip('Set scale bar size')",type:"range",min:"0.5",max:"4",value:"2",step:"0.1"}}),a("output",{attrs:{id:"barSizeOutput"}},[t._v("1")])]),a("div",[a("div",{attrs:{onmouseover:"tip('Change scale bar label, leave blank to hide label')"}},[t._v("Scale bar label: ")]),a("input",{attrs:{id:"barLabel",onmouseover:"tip('Set scale bar label, leave blank to hide label')",type:"text",placeholder:"hidden",value:""}})]),a("div",[a("div",{attrs:{onmouseover:"tip('Set background for Scale bar')"}},[t._v("Background opacity: ")]),a("input",{attrs:{id:"barBackOpacity",onmouseover:"tip('Set Scale bar background opacity')",type:"range",min:"0",max:"1",value:"0.2",step:"0.01"}}),a("input",{attrs:{id:"barBackColor",onmouseover:"tip('Set Scale bar background color')",type:"color",value:"#ffffff"}})]),a("div",{staticClass:"scaleHeader"},[a("span",{staticClass:"icon-male"}),a("div",[t._v("Population: ")])]),a("div",[a("div",{attrs:{onmouseover:"tip('Set how many people are in one population point')"}},[t._v("1 population point =")]),a("input",{attrs:{id:"populationRate",onmouseover:"tip('Set how many people are in one population point, in Kilos')",type:"range",min:"0.1",max:"10",value:"1",step:"0.1"}}),a("input",{staticClass:"output",attrs:{id:"populationRateOutput",onmouseover:"tip('Enter the population rate, in Kilos')",type:"text",value:"1K"}})]),a("div",[a("div",[t._v("Urbanization rate: ")]),a("input",{attrs:{id:"urbanization",onmouseover:"tip('Set the ubranization (burgs population relative to all population) rate')",type:"range",min:"0.01",max:"5",value:"1",step:"0.01"}}),a("input",{staticClass:"output",attrs:{id:"urbanizationOutput",onmouseover:"tip('Enter the ubranization (burgs population relative to all population) rate')",type:"text",value:"1"}})])]),a("div",{attrs:{id:"scaleBottom"}},[a("button",{staticClass:"icon-align-center",attrs:{id:"toggleScaleBar",onmouseover:"tip('Click to toggle scale bar')"}}),a("button",{staticClass:"icon-eye-off",attrs:{onmouseover:"tip('Click to toggle rulers (measurers)')",onclick:'$("#ruler").fadeToggle()'}}),a("button",{staticClass:"icon-brush",attrs:{id:"addOpisometer",onmouseover:"tip('Drag to measure curve length with opisometer')"}}),a("button",{staticClass:"icon-resize-horizontal",attrs:{id:"addRuler",onmouseover:"tip('Click to place additional linear ruler')"}}),a("button",{staticClass:"icon-check-empty",attrs:{id:"addPlanimeter",onmouseover:"tip('Drag to measure a polygon area with planimeter')"}}),a("button",{staticClass:"icon-trash",attrs:{id:"removeAllRulers",onmouseover:"tip('Remove all rulers from the map. Click on ruler label to remove ruler separately')"}})])]),a("div",{staticStyle:{display:"none"},attrs:{id:"alert"}},[a("p",{attrs:{id:"alertMessage"}},[t._v("Warning!")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{display:"none"},attrs:{id:"map-dragged"}},[a("p",[t._v("Drop to upload")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"legend"}},[a("div",{attrs:{id:"legendHeader"}}),a("div",{attrs:{id:"legendBody"}})])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"hidden",attrs:{id:"fileInputs"}},[a("input",{attrs:{type:"file",accept:".map",id:"mapToLoad"}}),a("input",{attrs:{type:"file",accept:".txt,.csv",id:"burgsListToLoad"}}),a("input",{attrs:{type:"file",accept:".txt",id:"lagendsToLoad"}}),a("input",{attrs:{type:"file",accept:"image/*",id:"imageToLoad"}}),a("input",{attrs:{type:"file",accept:".txt",id:"templateToLoad"}}),a("input",{attrs:{type:"file",accept:".txt",id:"namesbaseToLoad"}})])}],u=(o("20d6"),o("9393")),c=(o("4917"),o("ac4d"),o("8a81"),o("7cdf"),o("5695"),o("a032"),o("4f7f"),o("8afe")),d=(o("6b54"),o("6762"),o("2fdb"),o("c5f6"),o("fca0"),o("a481"),o("55dd"),o("84b4"),o("28a5"),o("6bde")),p=(o("c7c6"),o("7f7f"),o("7514"),o("ac6a"),o("34ef"),{name:"FantasyMapGenerator",mounted:function(){console.log("mounted"),h()},props:{msg:String}});function h(){var t="0.60b";document.title+=" v. "+t;var a,o,n,i,r,s,l=d3.select("svg"),p=l.select("#deftemp"),h=l.append("g").attr("id","viewbox"),g=h.append("g").attr("id","ocean"),m=g.append("g").attr("id","oceanLayers"),f=g.append("g").attr("id","oceanPattern"),b=h.append("g").attr("id","landmass"),y=h.append("g").attr("id","terrs"),k=h.append("g").attr("id","grid"),C=h.append("g").attr("id","overlay"),S=h.append("g").attr("id","rivers"),w=h.append("g").attr("id","terrain"),M=h.append("g").attr("id","cults"),x=h.append("g").attr("id","regions"),A=h.append("g").attr("id","borders"),B=A.append("g").attr("id","stateBorders"),E=A.append("g").attr("id","neutralBorders"),I=h.append("g").attr("id","lakes"),z=h.append("g").attr("id","routes"),T=z.append("g").attr("id","roads").attr("data-type","land"),L=z.append("g").attr("id","trails").attr("data-type","land"),R=z.append("g").attr("id","searoutes").attr("data-type","sea"),P=h.append("g").attr("id","coastline"),H=h.append("g").attr("id","labels"),O=H.append("g").attr("id","burgLabels"),N=h.append("g").attr("id","icons"),G=N.append("g").attr("id","burgIcons"),F=h.append("g").attr("id","markers"),_=h.append("g").attr("id","ruler"),j=h.append("g").attr("id","debug");H.append("g").attr("id","countries"),G.append("g").attr("id","capitals"),O.append("g").attr("id","capitals"),G.append("g").attr("id","towns"),O.append("g").attr("id","towns"),N.append("g").attr("id","capital-anchors"),N.append("g").attr("id","town-anchors"),w.append("g").attr("id","hills"),w.append("g").attr("id","mounts"),w.append("g").attr("id","swamps"),w.append("g").attr("id","forests"),f.append("rect").attr("fill","url(#oceanic)").attr("stroke","none"),m.append("rect").attr("id","oceanBase");var K,D,U,V,Y=[],W={},J=0,q=[],X=0,Z=!0,Q=[],tt=[],et=[],at=[],ot=[],nt=[],it=[],rt=["Almendra+SC","Georgia","Times+New+Roman","Comic+Sans+MS","Lucida+Sans+Unicode","Courier+New"],st=[],lt=[],ut={},ct=[],dt=[],pt="aeiouy",ht=document.getElementById("canvas"),vt=ht.getContext("2d"),gt=d3.scaleSequential(d3.interpolateSpectral),mt=d3.scaleOrdinal(d3.schemeSet2),ft=d3.scaleOrdinal(d3.schemeCategory20),bt=1,yt=d3.zoom().scaleExtent([1,20]).on("zoom",At);l.call(yt);var kt=d3.line().x(function(t){return t.scX}).y(function(t){return t.scY}).curve(d3.curveCatmullRom);Rt();var Ct=+mapWidthInput.value,St=+mapHeightInput.value,wt=Ct,Mt=St;$("#loading, #initial").remove(),l.style("background-color","#000000"),$("#optionsContainer, #tooltip").show(),localStorage.getItem("disable_click_arrow_tooltip")&&(tooltip.innerHTML="",tooltip.setAttribute("data-main",""),$("#optionsTrigger").removeClass("glow")),$("#optionsContainer").draggable({handle:".drag-trigger",snap:"svg",snapMode:"both"}),$("#mapLayers").sortable({items:"li:not(.solid)",cancel:".solid",update:mo}),$("#templateBody").sortable({items:"div:not(div[data-type='Mountain'])"}),$("#mapLayers, #templateBody").disableSelection();var xt=d3.drag().container(function(){return this}).subject(function(){var t=[d3.event.x,d3.event.y];return[t,t]}).on("start",Ut);function At(){var t=Math.abs(bt-d3.event.transform.k);bt=d3.event.transform.k,d3.event.transform.x,d3.event.transform.y,h.attr("transform",d3.event.transform),t>.001&&(Et(),$e())}function Bt(t,e,a,o){var n=d3.zoomIdentity.translate(t*-a+Ct/2,e*-a+St/2).scale(a);l.transition().duration(o).call(yt.transform,n)}function $t(t){yt.transform(l,d3.zoomIdentity)}function Et(){var t=bt>2.6?"url(#blurFilter)":"url(#dropShadow)";if(bt>1.5&&bt<=2.6&&(t=null),P.attr("filter",t),H.selectAll("g").each(function(t){var e=d3.select(this);if("burgLabels"!==e.attr("id")){var a=+e.attr("data-size"),o=no((a+a/bt)/2,2);o<2&&(o=2),e.attr("font-size",o),hideLabels.checked&&(e.classed("hidden",o*bt<6),cn())}}),F.selectAll("use").each(function(t){var e=d3.select(this),a=+e.attr("data-x"),o=+e.attr("data-y"),n=+e.attr("data-size"),i=5*n+25/bt;i<1&&(i=1),e.attr("x",a-i/2).attr("y",o-i).attr("width",i).attr("height",i)}),_.size()&&"none"!==_.style("display")){if(_.selectAll("g").size()<1)return;var e=no(1/Math.pow(bt,.3),1);_.selectAll("circle:not(.center)").attr("r",2*e).attr("stroke-width",.5*e),_.selectAll("circle.center").attr("r",1.2*e).attr("stroke-width",.3*e),_.selectAll("text").attr("font-size",10*e),_.selectAll("line, path").attr("stroke-width",e)}}pn();var It=localStorage.getItem("version");function zt(){console.group("Random map"),console.time("TOTAL"),rn(),Nt(),Gt(),Ft(Y),Qt(),$e(),te(),be(),ye(),Pe(),He(),ke(),Oe(),Ge(),De(),Be(),Ka(),ea(),aa(),Ga(),console.timeEnd("TOTAL"),console.groupEnd("Random map")}function Tt(){var t=new URL(window.location.href);o=t.searchParams,a=o.get("seed")||Math.floor(1e9*Math.random()),console.log(" seed: "+a),optionsSeed.value=a,Math.seedrandom(a)}function Lt(){a=Math.floor(1e9*Math.random()),console.log(" seed: "+a),optionsSeed.value=a,Math.seedrandom(a)}function Rt(){localStorage.getItem("mapWidth")&&localStorage.getItem("mapHeight")?(mapWidthInput.value=localStorage.getItem("mapWidth"),mapHeightInput.value=localStorage.getItem("mapHeight")):(mapWidthInput.value=window.innerWidth,mapHeightInput.value=window.innerHeight),localStorage.getItem("graphSize")?(U=localStorage.getItem("graphSize"),sizeInput.value=sizeOutput.value=U):U=+sizeInput.value,localStorage.getItem("template")&&(templateInput.value=localStorage.getItem("template"),lockTemplateInput.setAttribute("data-locked",1),lockTemplateInput.className="icon-lock"),localStorage.getItem("manors")&&(manorsInput.value=manorsOutput.value=localStorage.getItem("manors"),lockManorsInput.setAttribute("data-locked",1),lockManorsInput.className="icon-lock"),localStorage.getItem("regions")&&(regionsInput.value=regionsOutput.value=localStorage.getItem("regions"),lockRegionsInput.setAttribute("data-locked",1),lockRegionsInput.className="icon-lock"),localStorage.getItem("power")&&(powerInput.value=powerOutput.value=localStorage.getItem("power"),lockPowerInput.setAttribute("data-locked",1),lockPowerInput.className="icon-lock"),localStorage.getItem("neutral")&&(neutralInput.value=neutralOutput.value=localStorage.getItem("neutral")),localStorage.getItem("names")&&(namesInput.value=localStorage.getItem("names"),lockNamesInput.setAttribute("data-locked",1),lockNamesInput.className="icon-lock"),localStorage.getItem("cultures")&&(culturesInput.value=culturesOutput.value=localStorage.getItem("cultures"),lockCulturesInput.setAttribute("data-locked",1),lockCulturesInput.className="icon-lock"),localStorage.getItem("prec")&&(precInput.value=precOutput.value=localStorage.getItem("prec"),lockPrecInput.setAttribute("data-locked",1),lockPrecInput.className="icon-lock"),localStorage.getItem("swampiness")&&(swampinessInput.value=swampinessOutput.value=localStorage.getItem("swampiness")),localStorage.getItem("outlineLayers")&&(outlineLayersInput.value=localStorage.getItem("outlineLayers")),localStorage.getItem("pngResolution")&&(pngResolutionInput.value=localStorage.getItem("pngResolution"),pngResolutionOutput.value=pngResolutionInput.value+"x"),localStorage.getItem("transparency")?(transparencyInput.value=transparencyOutput.value=localStorage.getItem("transparency"),_a(transparencyInput.value)):_a(0)}function Pt(){localStorage.clear(),mapWidthInput.value=window.innerWidth,mapHeightInput.value=window.innerHeight,sn(),U=sizeInput.value=sizeOutput.value=1,$("#options i[class^='icon-lock']").each(function(){this.setAttribute("data-locked",0),this.className="icon-lock-open","lockNeutralInput"!==this.id&&"lockSwampinessInput"!==this.id||(this.setAttribute("data-locked",1),this.className="icon-lock")}),neutralInput.value=neutralOutput.value=200,swampinessInput.value=swampinessOutput.value=10,outlineLayersInput.value="-6,-3,-1",transparencyInput.value=transparencyOutput.value=0,_a(0),pngResolutionInput.value=5,pngResolutionOutput.value="5x",Nt()}function Ht(){Ot(),st=[{name:"Shwazen",color:"#b3b3b3",base:0},{name:"Angshire",color:"#fca463",base:1},{name:"Luari",color:"#99acfb",base:2},{name:"Tallian",color:"#a6d854",base:3},{name:"Toledi",color:"#ffd92f",base:4},{name:"Slovian",color:"#e5c494",base:5},{name:"Norse",color:"#dca3e4",base:6},{name:"Elladian",color:"#66c4a0",base:7},{name:"Latian",color:"#ff7174",base:8},{name:"Soomi",color:"#85c8fa",base:9},{name:"Koryo",color:"#578880",base:10},{name:"Hantzu",color:"#becb8d",base:11},{name:"Yamoto",color:"#ffd9da",base:12}]}function Ot(){ct=[{name:"German",method:"let-to-syl",min:4,max:11,d:"lt",m:.1},{name:"English",method:"let-to-syl",min:5,max:10,d:"",m:.3},{name:"French",method:"let-to-syl",min:4,max:10,d:"lns",m:.3},{name:"Italian",method:"let-to-syl",min:4,max:11,d:"clrt",m:.2},{name:"Castillian",method:"let-to-syl",min:4,max:10,d:"lr",m:0},{name:"Ruthenian",method:"let-to-syl",min:4,max:9,d:"",m:0},{name:"Nordic",method:"let-to-syl",min:5,max:9,d:"kln",m:.1},{name:"Greek",method:"let-to-syl",min:4,max:10,d:"ls",m:.2},{name:"Roman",method:"let-to-syl",min:5,max:10,d:"",m:1},{name:"Finnic",method:"let-to-syl",min:3,max:10,d:"aktu",m:0},{name:"Korean",method:"let-to-syl",min:5,max:10,d:"",m:0},{name:"Chinese",method:"let-to-syl",min:5,max:9,d:"",m:0},{name:"Japanese",method:"let-to-syl",min:3,max:9,d:"",m:0}],dt=[["Achern","Aichhalden","Aitern","Albbruck","Alpirsbach","Altensteig","Althengstett","Appenweier","Auggen","Wildbad","Badenen","Badenweiler","Baiersbronn","Ballrechten","Bellingen","Berghaupten","Bernau","Biberach","Biederbach","Binzen","Birkendorf","Birkenfeld","Bischweier","Blumberg","Bollen","Bollschweil","Bonndorf","Bosingen","Braunlingen","Breisach","Breisgau","Breitnau","Brigachtal","Buchenbach","Buggingen","Buhl","Buhlertal","Calw","Dachsberg","Dobel","Donaueschingen","Dornhan","Dornstetten","Dottingen","Dunningen","Durbach","Durrheim","Ebhausen","Ebringen","Efringen","Egenhausen","Ehrenkirchen","Ehrsberg","Eimeldingen","Eisenbach","Elzach","Elztal","Emmendingen","Endingen","Engelsbrand","Enz","Enzklosterle","Eschbronn","Ettenheim","Ettlingen","Feldberg","Fischerbach","Fischingen","Fluorn","Forbach","Freiamt","Freiburg","Freudenstadt","Friedenweiler","Friesenheim","Frohnd","Furtwangen","Gaggenau","Geisingen","Gengenbach","Gernsbach","Glatt","Glatten","Glottertal","Gorwihl","Gottenheim","Grafenhausen","Grenzach","Griesbach","Gutach","Gutenbach","Hag","Haiterbach","Hardt","Harmersbach","Hasel","Haslach","Hausach","Hausen","Hausern","Heitersheim","Herbolzheim","Herrenalb","Herrischried","Hinterzarten","Hochenschwand","Hofen","Hofstetten","Hohberg","Horb","Horben","Hornberg","Hufingen","Ibach","Ihringen","Inzlingen","Kandern","Kappel","Kappelrodeck","Karlsbad","Karlsruhe","Kehl","Keltern","Kippenheim","Kirchzarten","Konigsfeld","Krozingen","Kuppenheim","Kussaberg","Lahr","Lauchringen","Lauf","Laufenburg","Lautenbach","Lauterbach","Lenzkirch","Liebenzell","Loffenau","Loffingen","Lorrach","Lossburg","Mahlberg","Malsburg","Malsch","March","Marxzell","Marzell","Maulburg","Monchweiler","Muhlenbach","Mullheim","Munstertal","Murg","Nagold","Neubulach","Neuenburg","Neuhausen","Neuried","Neuweiler","Niedereschach","Nordrach","Oberharmersbach","Oberkirch","Oberndorf","Oberbach","Oberried","Oberwolfach","Offenburg","Ohlsbach","Oppenau","Ortenberg","otigheim","Ottenhofen","Ottersweier","Peterstal","Pfaffenweiler","Pfalzgrafenweiler","Pforzheim","Rastatt","Renchen","Rheinau","Rheinfelden","Rheinmunster","Rickenbach","Rippoldsau","Rohrdorf","Rottweil","Rummingen","Rust","Sackingen","Sasbach","Sasbachwalden","Schallbach","Schallstadt","Schapbach","Schenkenzell","Schiltach","Schliengen","Schluchsee","Schomberg","Schonach","Schonau","Schonenberg","Schonwald","Schopfheim","Schopfloch","Schramberg","Schuttertal","Schwenningen","Schworstadt","Seebach","Seelbach","Seewald","Sexau","Simmersfeld","Simonswald","Sinzheim","Solden","Staufen","Stegen","Steinach","Steinen","Steinmauern","Straubenhardt","Stuhlingen","Sulz","Sulzburg","Teinach","Tiefenbronn","Tiengen","Titisee","Todtmoos","Todtnau","Todtnauberg","Triberg","Tunau","Tuningen","uhlingen","Unterkirnach","Reichenbach","Utzenfeld","Villingen","Villingendorf","Vogtsburg","Vohrenbach","Waldachtal","Waldbronn","Waldkirch","Waldshut","Wehr","Weil","Weilheim","Weisenbach","Wembach","Wieden","Wiesental","Wildberg","Winzeln","Wittlingen","Wittnau","Wolfach","Wutach","Wutoschingen","Wyhlen","Zavelstein"],["Abingdon","Albrighton","Alcester","Almondbury","Altrincham","Amersham","Andover","Appleby","Ashboume","Atherstone","Aveton","Axbridge","Aylesbury","Baldock","Bamburgh","Barton","Basingstoke","Berden","Bere","Berkeley","Berwick","Betley","Bideford","Bingley","Birmingham","Blandford","Blechingley","Bodmin","Bolton","Bootham","Boroughbridge","Boscastle","Bossinney","Bramber","Brampton","Brasted","Bretford","Bridgetown","Bridlington","Bromyard","Bruton","Buckingham","Bungay","Burton","Calne","Cambridge","Canterbury","Carlisle","Castleton","Caus","Charmouth","Chawleigh","Chichester","Chillington","Chinnor","Chipping","Chisbury","Cleobury","Clifford","Clifton","Clitheroe","Cockermouth","Coleshill","Combe","Congleton","Crafthole","Crediton","Cuddenbeck","Dalton","Darlington","Dodbrooke","Drax","Dudley","Dunstable","Dunster","Dunwich","Durham","Dymock","Exeter","Exning","Faringdon","Felton","Fenny","Finedon","Flookburgh","Fowey","Frampton","Gateshead","Gatton","Godmanchester","Grampound","Grantham","Guildford","Halesowen","Halton","Harbottle","Harlow","Hatfield","Hatherleigh","Haydon","Helston","Henley","Hertford","Heytesbury","Hinckley","Hitchin","Holme","Hornby","Horsham","Kendal","Kenilworth","Kilkhampton","Kineton","Kington","Kinver","Kirby","Knaresborough","Knutsford","Launceston","Leighton","Lewes","Linton","Louth","Luton","Lyme","Lympstone","Macclesfield","Madeley","Malborough","Maldon","Manchester","Manningtree","Marazion","Marlborough","Marshfield","Mere","Merryfield","Middlewich","Midhurst","Milborne","Mitford","Modbury","Montacute","Mousehole","Newbiggin","Newborough","Newbury","Newenden","Newent","Norham","Northleach","Noss","Oakham","Olney","Orford","Ormskirk","Oswestry","Padstow","Paignton","Penkneth","Penrith","Penzance","Pershore","Petersfield","Pevensey","Pickering","Pilton","Pontefract","Portsmouth","Preston","Quatford","Reading","Redcliff","Retford","Rockingham","Romney","Rothbury","Rothwell","Salisbury","Saltash","Seaford","Seasalter","Sherston","Shifnal","Shoreham","Sidmouth","Skipsea","Skipton","Solihull","Somerton","Southam","Southwark","Standon","Stansted","Stapleton","Stottesdon","Sudbury","Swavesey","Tamerton","Tarporley","Tetbury","Thatcham","Thaxted","Thetford","Thornbury","Tintagel","Tiverton","Torksey","Totnes","Towcester","Tregoney","Trematon","Tutbury","Uxbridge","Wallingford","Wareham","Warenmouth","Wargrave","Warton","Watchet","Watford","Wendover","Westbury","Westcheap","Weymouth","Whitford","Wickwar","Wigan","Wigmore","Winchelsea","Winkleigh","Wiscombe","Witham","Witheridge","Wiveliscombe","Woodbury","Yeovil"],["Adon","Aillant","Amilly","Andonville","Ardon","Artenay","Ascheres","Ascoux","Attray","Aubin","Audeville","Aulnay","Autruy","Auvilliers","Auxy","Aveyron","Baccon","Bardon","Barville","Batilly","Baule","Bazoches","Beauchamps","Beaugency","Beaulieu","Beaune","Bellegarde","Boesses","Boigny","Boiscommun","Boismorand","Boisseaux","Bondaroy","Bonnee","Bonny","Bordes","Bou","Bougy","Bouilly","Boulay","Bouzonville","Bouzy","Boynes","Bray","Breteau","Briare","Briarres","Bricy","Bromeilles","Bucy","Cepoy","Cercottes","Cerdon","Cernoy","Cesarville","Chailly","Chaingy","Chalette","Chambon","Champoulet","Chanteau","Chantecoq","Chapell","Charme","Charmont","Charsonville","Chateau","Chateauneuf","Chatel","Chatenoy","Chatillon","Chaussy","Checy","Chevannes","Chevillon","Chevilly","Chevry","Chilleurs","Choux","Chuelles","Clery","Coinces","Coligny","Combleux","Combreux","Conflans","Corbeilles","Corquilleroy","Cortrat","Coudroy","Coullons","Coulmiers","Courcelles","Courcy","Courtemaux","Courtempierre","Courtenay","Cravant","Crottes","Dadonville","Dammarie","Dampierre","Darvoy","Desmonts","Dimancheville","Donnery","Dordives","Dossainville","Douchy","Dry","Echilleuses","Egry","Engenville","Epieds","Erceville","Ervauville","Escrennes","Escrignelles","Estouy","Faverelles","Fay","Feins","Ferolles","Ferrieres","Fleury","Fontenay","Foret","Foucherolles","Freville","Gatinais","Gaubertin","Gemigny","Germigny","Gidy","Gien","Girolles","Givraines","Gondreville","Grangermont","Greneville","Griselles","Guigneville","Guilly","Gyleslonains","Huetre","Huisseau","Ingrannes","Ingre","Intville","Isdes","Jargeau","Jouy","Juranville","Bussiere","Laas","Ladon","Lailly","Langesse","Leouville","Ligny","Lombreuil","Lorcy","Lorris","Loury","Louzouer","Malesherbois","Marcilly","Mardie","Mareau","Marigny","Marsainvilliers","Melleroy","Menestreau","Merinville","Messas","Meung","Mezieres","Migneres","Mignerette","Mirabeau","Montargis","Montbarrois","Montbouy","Montcresson","Montereau","Montigny","Montliard","Mormant","Morville","Moulinet","Moulon","Nancray","Nargis","Nesploy","Neuville","Neuvy","Nevoy","Nibelle","Nogent","Noyers","Ocre","Oison","Olivet","Ondreville","Onzerain","Orleans","Ormes","Orville","Oussoy","Outarville","Ouzouer","Pannecieres","Pannes","Patay","Paucourt","Pers","Pierrefitte","Pithiverais","Pithiviers","Poilly","Potier","Prefontaines","Presnoy","Pressigny","Puiseaux","Quiers","Ramoulu","Rebrechien","Rouvray","Rozieres","Rozoy","Ruan","Sandillon","Santeau","Saran","Sceaux","Seichebrieres","Semoy","Sennely","Sermaises","Sigloy","Solterre","Sougy","Sully","Sury","Tavers","Thignonville","Thimory","Thorailles","Thou","Tigy","Tivernon","Tournoisis","Trainou","Treilles","Trigueres","Trinay","Vannes","Varennes","Vennecy","Vieilles","Vienne","Viglain","Vignes","Villamblain","Villemandeur","Villemoutiers","Villemurlin","Villeneuve","Villereau","Villevoques","Villorceau","Vimory","Vitry","Vrigny","Ivre"],["Accumoli","Acquafondata","Acquapendente","Acuto","Affile","Agosta","Alatri","Albano","Allumiere","Alvito","Amaseno","Amatrice","Anagni","Anguillara","Anticoli","Antrodoco","Anzio","Aprilia","Aquino","Arce","Arcinazzo","Ardea","Ariccia","Arlena","Arnara","Arpino","Arsoli","Artena","Ascrea","Atina","Ausonia","Bagnoregio","Barbarano","Bassano","Bassiano","Bellegra","Belmonte","Blera","Bolsena","Bomarzo","Borbona","Borgo","Borgorose","Boville","Bracciano","Broccostella","Calcata","Camerata","Campagnano","Campodimele","Campoli","Canale","Canepina","Canino","Cantalice","Cantalupo","Canterano","Capena","Capodimonte","Capranica","Caprarola","Carbognano","Casalattico","Casalvieri","Casape","Casaprota","Casperia","Cassino","Castelforte","Castelliri","Castello","Castelnuovo","Castiglione","Castro","Castrocielo","Cave","Ceccano","Celleno","Cellere","Ceprano","Cerreto","Cervara","Cervaro","Cerveteri","Ciampino","Ciciliano","Cineto","Cisterna","Cittaducale","Cittareale","Civita","Civitavecchia","Civitella","Colfelice","Collalto","Colle","Colleferro","Collegiove","Collepardo","Collevecchio","Colli","Colonna","Concerviano","Configni","Contigliano","Corchiano","Coreno","Cori","Cottanello","Esperia","Fabrica","Faleria","Falvaterra","Fara","Farnese","Ferentino","Fiamignano","Fiano","Filacciano","Filettino","Fiuggi","Fiumicino","Fondi","Fontana","Fonte","Fontechiari","Forano","Formello","Formia","Frascati","Frasso","Frosinone","Fumone","Gaeta","Gallese","Gallicano","Gallinaro","Gavignano","Genazzano","Genzano","Gerano","Giuliano","Gorga","Gradoli","Graffignano","Greccio","Grottaferrata","Grotte","Guarcino","Guidonia","Ischia","Isola","Itri","Jenne","Labico","Labro","Ladispoli","Lanuvio","Lariano","Latera","Lenola","Leonessa","Licenza","Longone","Lubriano","Maenza","Magliano","Mandela","Manziana","Marano","Marcellina","Marcetelli","Marino","Marta","Mazzano","Mentana","Micigliano","Minturno","Mompeo","Montalto","Montasola","Monte","Montebuono","Montefiascone","Monteflavio","Montelanico","Monteleone","Montelibretti","Montenero","Monterosi","Monterotondo","Montopoli","Montorio","Moricone","Morlupo","Morolo","Morro","Nazzano","Nemi","Nepi","Nerola","Nespolo","Nettuno","Norma","Olevano","Onano","Oriolo","Orte","Orvinio","Paganico","Palestrina","Paliano","Palombara","Pastena","Patrica","Percile","Pescorocchiano","Pescosolido","Petrella","Piansano","Picinisco","Pico","Piedimonte","Piglio","Pignataro","Pisoniano","Pofi","Poggio","Poli","Pomezia","Pontecorvo","Pontinia","Ponza","Ponzano","Posta","Pozzaglia","Priverno","Proceno","Prossedi","Riano","Rieti","Rignano","Riofreddo","Ripi","Rivodutri","Rocca","Roccagiovine","Roccagorga","Roccantica","Roccasecca","Roiate","Ronciglione","Roviano","Sabaudia","Sacrofano","Salisano","Sambuci","Santa","Santi","Santopadre","Saracinesco","Scandriglia","Segni","Selci","Sermoneta","Serrone","Settefrati","Sezze","Sgurgola","Sonnino","Sora","Soriano","Sperlonga","Spigno","Stimigliano","Strangolagalli","Subiaco","Supino","Sutri","Tarano","Tarquinia","Terelle","Terracina","Tessennano","Tivoli","Toffia","Tolfa","Torre","Torri","Torrice","Torricella","Torrita","Trevi","Trevignano","Trivigliano","Turania","Tuscania","Vacone","Valentano","Vallecorsa","Vallemaio","Vallepietra","Vallerano","Vallerotonda","Vallinfreda","Valmontone","Varco","Vasanello","Vejano","Velletri","Ventotene","Veroli","Vetralla","Vicalvi","Vico","Vicovaro","Vignanello","Viterbo","Viticuso","Vitorchiano","Vivaro","Zagarolo"],["Abanades","Ablanque","Adobes","Ajofrin","Alameda","Alaminos","Alarilla","Albalate","Albares","Albarreal","Albendiego","Alcabon","Alcanizo","Alcaudete","Alcocer","Alcolea","Alcoroches","Aldea","Aldeanueva","Algar","Algora","Alhondiga","Alique","Almadrones","Almendral","Almoguera","Almonacid","Almorox","Alocen","Alovera","Alustante","Angon","Anguita","Anover","Anquela","Arbancon","Arbeteta","Arcicollar","Argecilla","Arges","Armallones","Armuna","Arroyo","Atanzon","Atienza","Aunon","Azuqueca","Azutan","Baides","Banos","Banuelos","Barcience","Bargas","Barriopedro","Belvis","Berninches","Borox","Brihuega","Budia","Buenaventura","Bujalaro","Burguillos","Burujon","Bustares","Cabanas","Cabanillas","Calera","Caleruela","Calzada","Camarena","Campillo","Camunas","Canizar","Canredondo","Cantalojas","Cardiel","Carmena","Carranque","Carriches","Casa","Casarrubios","Casas","Casasbuenas","Caspuenas","Castejon","Castellar","Castilforte","Castillo","Castilnuevo","Cazalegas","Cebolla","Cedillo","Cendejas","Centenera","Cervera","Checa","Chequilla","Chillaron","Chiloeches","Chozas","Chueca","Cifuentes","Cincovillas","Ciruelas","Ciruelos","Cobeja","Cobeta","Cobisa","Cogollor","Cogolludo","Condemios","Congostrina","Consuegra","Copernal","Corduente","Corral","Cuerva","Domingo","Dosbarrios","Driebes","Duron","El","Embid","Erustes","Escalona","Escalonilla","Escamilla","Escariche","Escopete","Espinosa","Espinoso","Esplegares","Esquivias","Estables","Estriegana","Fontanar","Fuembellida","Fuensalida","Fuentelsaz","Gajanejos","Galve","Galvez","Garciotum","Gascuena","Gerindote","Guadamur","Henche","Heras","Herreria","Herreruela","Hijes","Hinojosa","Hita","Hombrados","Hontanar","Hontoba","Horche","Hormigos","Huecas","Huermeces","Huerta","Hueva","Humanes","Illan","Illana","Illescas","Iniestola","Irueste","Jadraque","Jirueque","Lagartera","Las","Layos","Ledanca","Lillo","Lominchar","Loranca","Los","Lucillos","Lupiana","Luzaga","Luzon","Madridejos","Magan","Majaelrayo","Malaga","Malaguilla","Malpica","Mandayona","Mantiel","Manzaneque","Maqueda","Maranchon","Marchamalo","Marjaliza","Marrupe","Mascaraque","Masegoso","Matarrubia","Matillas","Mazarete","Mazuecos","Medranda","Megina","Mejorada","Mentrida","Mesegar","Miedes","Miguel","Millana","Milmarcos","Mirabueno","Miralrio","Mocejon","Mochales","Mohedas","Molina","Monasterio","Mondejar","Montarron","Mora","Moratilla","Morenilla","Muduex","Nambroca","Navalcan","Negredo","Noblejas","Noez","Nombela","Noves","Numancia","Nuno","Ocana","Ocentejo","Olias","Olmeda","Ontigola","Orea","Orgaz","Oropesa","Otero","Palmaces","Palomeque","Pantoja","Pardos","Paredes","Pareja","Parrillas","Pastrana","Pelahustan","Penalen","Penalver","Pepino","Peralejos","Peralveche","Pinilla","Pioz","Piqueras","Polan","Portillo","Poveda","Pozo","Pradena","Prados","Puebla","Puerto","Pulgar","Quer","Quero","Quintanar","Quismondo","Rebollosa","Recas","Renera","Retamoso","Retiendas","Riba","Rielves","Rillo","Riofrio","Robledillo","Robledo","Romanillos","Romanones","Rueda","Sacecorbo","Sacedon","Saelices","Salmeron","San","Santa","Santiuste","Santo","Sartajada","Sauca","Sayaton","Segurilla","Selas","Semillas","Sesena","Setiles","Sevilleja","Sienes","Siguenza","Solanillos","Somolinos","Sonseca","Sotillo","Sotodosos","Talavera","Tamajon","Taragudo","Taravilla","Tartanedo","Tembleque","Tendilla","Terzaga","Tierzo","Tordellego","Tordelrabano","Tordesilos","Torija","Torralba","Torre","Torrecilla","Torrecuadrada","Torrejon","Torremocha","Torrico","Torrijos","Torrubia","Tortola","Tortuera","Tortuero","Totanes","Traid","Trijueque","Trillo","Turleque","Uceda","Ugena","Ujados","Urda","Utande","Valdarachas","Valdesotos","Valhermoso","Valtablado","Valverde","Velada","Viana","Vinuelas","Yebes","Yebra","Yelamos","Yeles","Yepes","Yuncler","Yunclillos","Yuncos","Yunquera","Zaorejas","Zarzuela","Zorita"],["Belgorod","Beloberezhye","Belyi","Belz","Berestiy","Berezhets","Berezovets","Berezutsk","Bobruisk","Bolonets","Borisov","Borovsk","Bozhesk","Bratslav","Bryansk","Brynsk","Buryn","Byhov","Chechersk","Chemesov","Cheremosh","Cherlen","Chern","Chernigov","Chernitsa","Chernobyl","Chernogorod","Chertoryesk","Chetvertnia","Demyansk","Derevesk","Devyagoresk","Dichin","Dmitrov","Dorogobuch","Dorogobuzh","Drestvin","Drokov","Drutsk","Dubechin","Dubichi","Dubki","Dubkov","Dveren","Galich","Glebovo","Glinsk","Goloty","Gomiy","Gorodets","Gorodische","Gorodno","Gorohovets","Goroshin","Gorval","Goryshon","Holm","Horobor","Hoten","Hotin","Hotmyzhsk","Ilovech","Ivan","Izborsk","Izheslavl","Kamenets","Kanev","Karachev","Karna","Kavarna","Klechesk","Klyapech","Kolomyya","Kolyvan","Kopyl","Korec","Kornik","Korochunov","Korshev","Korsun","Koshkin","Kotelno","Kovyla","Kozelsk","Kozelsk","Kremenets","Krichev","Krylatsk","Ksniatin","Kulatsk","Kursk","Kursk","Lebedev","Lida","Logosko","Lomihvost","Loshesk","Loshichi","Lubech","Lubno","Lubutsk","Lutsk","Luchin","Luki","Lukoml","Luzha","Lvov","Mtsensk","Mdin","Medniki","Melecha","Merech","Meretsk","Mescherskoe","Meshkovsk","Metlitsk","Mezetsk","Mglin","Mihailov","Mikitin","Mikulino","Miloslavichi","Mogilev","Mologa","Moreva","Mosalsk","Moschiny","Mozyr","Mstislav","Mstislavets","Muravin","Nemech","Nemiza","Nerinsk","Nichan","Novgorod","Novogorodok","Obolichi","Obolensk","Obolensk","Oleshsk","Olgov","Omelnik","Opoka","Opoki","Oreshek","Orlets","Osechen","Oster","Ostrog","Ostrov","Perelai","Peremil","Peremyshl","Pererov","Peresechen","Perevitsk","Pereyaslav","Pinsk","Ples","Polotsk","Pronsk","Proposhesk","Punia","Putivl","Rechitsa","Rodno","Rogachev","Romanov","Romny","Roslavl","Rostislavl","Rostovets","Rsha","Ruza","Rybchesk","Rylsk","Rzhavesk","Rzhev","Rzhischev","Sambor","Serensk","Serensk","Serpeysk","Shilov","Shuya","Sinech","Sizhka","Skala","Slovensk","Slutsk","Smedin","Sneporod","Snitin","Snovsk","Sochevo","Sokolec","Starica","Starodub","Stepan","Sterzh","Streshin","Sutesk","Svinetsk","Svisloch","Terebovl","Ternov","Teshilov","Teterin","Tiversk","Torchevsk","Toropets","Torzhok","Tripolye","Trubchevsk","Tur","Turov","Usvyaty","Uteshkov","Vasilkov","Velil","Velye","Venev","Venicha","Verderev","Vereya","Veveresk","Viazma","Vidbesk","Vidychev","Voino","Volodimer","Volok","Volyn","Vorobesk","Voronich","Voronok","Vorotynsk","Vrev","Vruchiy","Vselug","Vyatichsk","Vyatka","Vyshegorod","Vyshgorod","Vysokoe","Yagniatin","Yaropolch","Yasenets","Yuryev","Yuryevets","Zaraysk","Zhitomel","Zholvazh","Zizhech","Zubkov","Zudechev","Zvenigorod"],["Akureyri","Aldra","Alftanes","Andenes","Austbo","Auvog","Bakkafjordur","Ballangen","Bardal","Beisfjord","Bifrost","Bildudalur","Bjerka","Bjerkvik","Bjorkosen","Bliksvaer","Blokken","Blonduos","Bolga","Bolungarvik","Borg","Borgarnes","Bosmoen","Bostad","Bostrand","Botsvika","Brautarholt","Breiddalsvik","Bringsli","Brunahlid","Budardalur","Byggdakjarni","Dalvik","Djupivogur","Donnes","Drageid","Drangsnes","Egilsstadir","Eiteroga","Elvenes","Engavogen","Ertenvog","Eskifjordur","Evenes","Eyrarbakki","Fagernes","Fallmoen","Fellabaer","Fenes","Finnoya","Fjaer","Fjelldal","Flakstad","Flateyri","Flostrand","Fludir","Gardabær","Gardur","Gimstad","Givaer","Gjeroy","Gladstad","Godoya","Godoynes","Granmoen","Gravdal","Grenivik","Grimsey","Grindavik","Grytting","Hafnir","Halsa","Hauganes","Haugland","Hauknes","Hella","Helland","Hellissandur","Hestad","Higrav","Hnifsdalur","Hofn","Hofsos","Holand","Holar","Holen","Holkestad","Holmavik","Hopen","Hovden","Hrafnagil","Hrisey","Husavik","Husvik","Hvammstangi","Hvanneyri","Hveragerdi","Hvolsvollur","Igeroy","Indre","Inndyr","Innhavet","Innes","Isafjordur","Jarklaustur","Jarnsreykir","Junkerdal","Kaldvog","Kanstad","Karlsoy","Kavosen","Keflavik","Kjelde","Kjerstad","Klakk","Kopasker","Kopavogur","Korgen","Kristnes","Krutoga","Krystad","Kvina","Lande","Laugar","Laugaras","Laugarbakki","Laugarvatn","Laupstad","Leines","Leira","Leiren","Leland","Lenvika","Loding","Lodingen","Lonsbakki","Lopsmarka","Lovund","Luroy","Maela","Melahverfi","Meloy","Mevik","Misvaer","Mornes","Mosfellsbær","Moskenes","Myken","Naurstad","Nesberg","Nesjahverfi","Nesset","Nevernes","Obygda","Ofoten","Ogskardet","Okervika","Oknes","Olafsfjordur","Oldervika","Olstad","Onstad","Oppeid","Oresvika","Orsnes","Orsvog","Osmyra","Overdal","Prestoya","Raudalaekur","Raufarhofn","Reipo","Reykholar","Reykholt","Reykjahlid","Rif","Rinoya","Rodoy","Rognan","Rosvika","Rovika","Salhus","Sanden","Sandgerdi","Sandoker","Sandset","Sandvika","Saudarkrokur","Selfoss","Selsoya","Sennesvik","Setso","Siglufjordur","Silvalen","Skagastrond","Skjerstad","Skonland","Skorvogen","Skrova","Sleneset","Snubba","Softing","Solheim","Solheimar","Sorarnoy","Sorfugloy","Sorland","Sormela","Sorvaer","Sovika","Stamsund","Stamsvika","Stave","Stokka","Stokkseyri","Storjord","Storo","Storvika","Strand","Straumen","Strendene","Sudavik","Sudureyri","Sundoya","Sydalen","Thingeyri","Thorlakshofn","Thorshofn","Tjarnabyggd","Tjotta","Tosbotn","Traelnes","Trofors","Trones","Tverro","Ulvsvog","Unnstad","Utskor","Valla","Vandved","Varmahlid","Vassos","Vevelstad","Vidrek","Vik","Vikholmen","Vogar","Vogehamn","Vopnafjordur"],["Abdera","Abila","Abydos","Acanthus","Acharnae","Actium","Adramyttium","Aegae","Aegina","Aegium","Aenus","Agrinion","Aigosthena","Akragas","Akrai","Akrillai","Akroinon","Akrotiri","Alalia","Alexandreia","Alexandretta","Alexandria","Alinda","Amarynthos","Amaseia","Ambracia","Amida","Amisos","Amnisos","Amphicaea","Amphigeneia","Amphipolis","Amphissa","Ankon","Antigona","Antipatrea","Antioch","Antioch","Antiochia","Andros","Apamea","Aphidnae","Apollonia","Argos","Arsuf","Artanes","Artemita","Argyroupoli","Asine","Asklepios","Aspendos","Assus","Astacus","Athenai","Athmonia","Aytos","Ancient","Baris","Bhrytos","Borysthenes","Berge","Boura","Bouthroton","Brauron","Byblos","Byllis","Byzantium","Bythinion","Callipolis","Cebrene","Chalcedon","Calydon","Carystus","Chamaizi","Chalcis","Chersonesos","Chios","Chytri","Clazomenae","Cleonae","Cnidus","Colosse","Corcyra","Croton","Cyme","Cyrene","Cythera","Decelea","Delos","Delphi","Demetrias","Dicaearchia","Dimale","Didyma","Dion","Dioscurias","Dodona","Dorylaion","Dyme","Edessa","Elateia","Eleusis","Eleutherna","Emporion","Ephesus","Ephyra","Epidamnos","Epidauros","Eresos","Eretria","Erythrae","Eubea","Gangra","Gaza","Gela","Golgi","Gonnos","Gorgippia","Gournia","Gortyn","Gythium","Hagios","Hagia","Halicarnassus","Halieis","Helike","Heliopolis","Hellespontos","Helorus","Hemeroskopeion","Heraclea","Hermione","Hermonassa","Hierapetra","Hierapolis","Himera","Histria","Hubla","Hyele","Ialysos","Iasus","Idalium","Imbros","Iolcus","Itanos","Ithaca","Juktas","Kallipolis","Kamares","Kameiros","Kannia","Kamarina","Kasmenai","Katane","Kerkinitida","Kepoi","Kimmerikon","Kios","Klazomenai","Knidos","Knossos","Korinthos","Kos","Kourion","Kume","Kydonia","Kynos","Kyrenia","Lamia","Lampsacus","Laodicea","Lapithos","Larissa","Lato","Laus","Lebena","Lefkada","Lekhaion","Leibethra","Leontinoi","Lepreum","Lessa","Lilaea","Lindus","Lissus","Epizephyrian","Madytos","Magnesia","Mallia","Mantineia","Marathon","Marmara","Maroneia","Masis","Massalia","Megalopolis","Megara","Mesembria","Messene","Metapontum","Methana","Methone","Methumna","Miletos","Misenum","Mochlos","Monastiraki","Morgantina","Mulai","Mukenai","Mylasa","Myndus","Myonia","Myra","Myrmekion","Mutilene","Myos","Nauplios","Naucratis","Naupactus","Naxos","Neapoli","Neapolis","Nemea","Nicaea","Nicopolis","Nirou","Nymphaion","Nysa","Oenoe","Oenus","Odessos","Olbia","Olous","Olympia","Olynthus","Opus","Orchomenus","Oricos","Orestias","Oreus","Oropus","Onchesmos","Pactye","Pagasae","Palaikastro","Pandosia","Panticapaeum","Paphos","Parium","Paros","Parthenope","Patrae","Pavlopetri","Pegai","Pelion","Peiraieús","Pella","Percote","Pergamum","Petsofa","Phaistos","Phaleron","Phanagoria","Pharae","Pharnacia","Pharos","Phaselis","Philippi","Pithekussa","Philippopolis","Platanos","Phlius","Pherae","Phocaea","Pinara","Pisa","Pitane","Pitiunt","Pixous","Plataea","Poseidonia","Potidaea","Priapus","Priene","Prousa","Pseira","Psychro","Pteleum","Pydna","Pylos","Pyrgos","Rhamnus","Rhegion","Rhithymna","Rhodes","Rhypes","Rizinia","Salamis","Same","Samos","Scyllaeum","Selinus","Seleucia","Semasus","Sestos","Scidrus","Sicyon","Side","Sidon","Siteia","Sinope","Siris","Sklavokampos","Smyrna","Soli","Sozopolis","Sparta","Stagirus","Stratos","Stymphalos","Sybaris","Surakousai","Taras","Tanagra","Tanais","Tauromenion","Tegea","Temnos","Tenedos","Tenea","Teos","Thapsos","Thassos","Thebai","Theodosia","Therma","Thespiae","Thronion","Thoricus","Thurii","Thyreum","Thyria","Tiruns","Tithoraea","Tomis","Tragurion","Trapeze","Trapezus","Tripolis","Troizen","Troliton","Troy","Tylissos","Tyras","Tyros","Tyritake","Vasiliki","Vathypetros","Zakynthos","Zakros","Zankle"],["Abila","Adflexum","Adnicrem","Aelia","Aelius","Aeminium","Aequum","Agrippina","Agrippinae","Ala","Albanianis","Ambianum","Andautonia","Apulum","Aquae","Aquaegranni","Aquensis","Aquileia","Aquincum","Arae","Argentoratum","Ariminum","Ascrivium","Atrebatum","Atuatuca","Augusta","Aurelia","Aurelianorum","Batavar","Batavorum","Belum","Biriciana","Blestium","Bonames","Bonna","Bononia","Borbetomagus","Bovium","Bracara","Brigantium","Burgodunum","Caesaraugusta","Caesarea","Caesaromagus","Calleva","Camulodunum","Cannstatt","Cantiacorum","Capitolina","Castellum","Castra","Castrum","Cibalae","Clausentum","Colonia","Concangis","Condate","Confluentes","Conimbriga","Corduba","Coria","Corieltauvorum","Corinium","Coriovallum","Cornoviorum","Danum","Deva","Divodurum","Dobunnorum","Drusi","Dubris","Dumnoniorum","Durnovaria","Durocobrivis","Durocornovium","Duroliponte","Durovernum","Durovigutum","Eboracum","Edetanorum","Emerita","Emona","Euracini","Faventia","Flaviae","Florentia","Forum","Gerulata","Gerunda","Glevensium","Hadriani","Herculanea","Isca","Italica","Iulia","Iuliobrigensium","Iuvavum","Lactodurum","Lagentium","Lauri","Legionis","Lemanis","Lentia","Lepidi","Letocetum","Lindinis","Lindum","Londinium","Lopodunum","Lousonna","Lucus","Lugdunum","Luguvalium","Lutetia","Mancunium","Marsonia","Martius","Massa","Matilo","Mattiacorum","Mediolanum","Mod","Mogontiacum","Moridunum","Mursa","Naissus","Nervia","Nida","Nigrum","Novaesium","Noviomagus","Olicana","Ovilava","Parisiorum","Partiscum","Paterna","Pistoria","Placentia","Pollentia","Pomaria","Pons","Portus","Praetoria","Praetorium","Pullum","Ragusium","Ratae","Raurica","Regina","Regium","Regulbium","Rigomagus","Roma","Romula","Rutupiae","Salassorum","Salernum","Salona","Scalabis","Segovia","Silurum","Sirmium","Siscia","Sorviodurum","Sumelocenna","Tarraco","Taurinorum","Theranda","Traiectum","Treverorum","Tungrorum","Turicum","Ulpia","Valentia","Venetiae","Venta","Verulamium","Vesontio","Vetera","Victoriae","Victrix","Villa","Viminacium","Vindelicorum","Vindobona","Vinovia","Viroconium"],["Aanekoski","Abjapaluoja","Ahlainen","Aholanvaara","Ahtari","Aijala","Aimala","Akaa","Alajarvi","Alatornio","Alavus","Antsla","Aspo","Bennas","Bjorkoby","Elva","Emasalo","Espoo","Esse","Evitskog","Forssa","Haapajarvi","Haapamaki","Haapavesi","Haapsalu","Haavisto","Hameenlinna","Hameenmaki","Hamina","Hanko","Harjavalta","Hattuvaara","Haukipudas","Hautajarvi","Havumaki","Heinola","Hetta","Hinkabole","Hirmula","Hossa","Huittinen","Husula","Hyryla","Hyvinkaa","Iisalmi","Ikaalinen","Ilmola","Imatra","Inari","Iskmo","Itakoski","Jamsa","Jarvenpaa","Jeppo","Jioesuu","Jiogeva","Joensuu","Jokela","Jokikyla","Jokisuu","Jormua","Juankoski","Jungsund","Jyvaskyla","Kaamasmukka","Kaarina","Kajaani","Kalajoki","Kallaste","Kankaanpaa","Kannus","Kardla","Karesuvanto","Karigasniemi","Karkkila","Karkku","Karksinuia","Karpankyla","Kaskinen","Kasnas","Kauhajoki","Kauhava","Kauniainen","Kauvatsa","Kehra","Keila","Kellokoski","Kelottijarvi","Kemi","Kemijarvi","Kerava","Keuruu","Kiikka","Kiipu","Kilinginiomme","Kiljava","Kilpisjarvi","Kitee","Kiuruvesi","Kivesjarvi","Kiviioli","Kivisuo","Klaukkala","Klovskog","Kohtlajarve","Kokemaki","Kokkola","Kolho","Koria","Koskue","Kotka","Kouva","Kouvola","Kristiina","Kaupunki","Kuhmo","Kunda","Kuopio","Kuressaare","Kurikka","Kusans","Kuusamo","Kylmalankyla","Lahti","Laitila","Lankipohja","Lansikyla","Lappeenranta","Lapua","Laurila","Lautiosaari","Lepsama","Liedakkala","Lieksa","Lihula","Littoinen","Lohja","Loimaa","Loksa","Loviisa","Luohuanylipaa","Lusi","Maardu","Maarianhamina","Malmi","Mantta","Masaby","Masala","Matasvaara","Maula","Miiluranta","Mikkeli","Mioisakula","Munapirtti","Mustvee","Muurahainen","Naantali","Nappa","Narpio","Nickby","Niinimaa","Niinisalo","Nikkila","Nilsia","Nivala","Nokia","Nummela","Nuorgam","Nurmes","Nuvvus","Obbnas","Oitti","Ojakkala","Ollola","onningeby","Orimattila","Orivesi","Otanmaki","Otava","Otepaa","Oulainen","Oulu","Outokumpu","Paavola","Paide","Paimio","Pakankyla","Paldiski","Parainen","Parkano","Parkumaki","Parola","Perttula","Pieksamaki","Pietarsaari","Pioltsamaa","Piolva","Pohjavaara","Porhola","Pori","Porrasa","Porvoo","Pudasjarvi","Purmo","Pussi","Pyhajarvi","Raahe","Raasepori","Raisio","Rajamaki","Rakvere","Rapina","Rapla","Rauma","Rautio","Reposaari","Riihimaki","Rovaniemi","Roykka","Ruonala","Ruottala","Rutalahti","Saarijarvi","Salo","Sastamala","Saue","Savonlinna","Seinajoki","Sillamae","Sindi","Siuntio","Somero","Sompujarvi","Suonenjoki","Suurejaani","Syrjantaka","Tampere","Tamsalu","Tapa","Temmes","Tiorva","Tormasenvaara","Tornio","Tottijarvi","Tulppio","Turenki","Turi","Tuukkala","Tuurala","Tuuri","Tuuski","Ulvila","Unari","Upinniemi","Utti","Uusikaarlepyy","Uusikaupunki","Vaaksy","Vaalimaa","Vaarinmaja","Vaasa","Vainikkala","Valga","Valkeakoski","Vantaa","Varkaus","Vehkapera","Vehmasmaki","Vieki","Vierumaki","Viitasaari","Viljandi","Vilppula","Viohma","Vioru","Virrat","Ylike","Ylivieska","Ylojarvi"],["Sabi","Wiryeseong","Hwando","Gungnae","Ungjin","Wanggeomseong","Ganggyeong","Jochiwon","Cheorwon","Beolgyo","Gangjin","Gampo","Yecheon","Geochang","Janghang","Hadong","Goseong","Yeongdong","Yesan","Sintaein","Geumsan","Boseong","Jangheung","Uiseong","Jumunjin","Janghowon","Hongseong","Gimhwa","Gwangcheon","Guryongpo","Jinyeong","Buan","Damyang","Jangseong","Wando","Angang","Okcheon","Jeungpyeong","Waegwan","Cheongdo","Gwangyang","Gochang","Haenam","Yeonggwang","Hanam","Eumseong","Daejeong","Hanrim","Samrye","Yongjin","Hamyang","Buyeo","Changnyeong","Yeongwol","Yeonmu","Gurye","Hwasun","Hampyeong","Namji","Samnangjin","Dogye","Hongcheon","Munsan","Gapyeong","Ganghwa","Geojin","Sangdong","Jeongseon","Sabuk","Seonghwan","Heunghae","Hapdeok","Sapgyo","Taean","Boeun","Geumwang","Jincheon","Bongdong","Doyang","Geoncheon","Pungsan","Punggi","Geumho","Wonju","Gaun","Hayang","Yeoju","Paengseong","Yeoncheon","Yangpyeong","Ganseong","Yanggu","Yangyang","Inje","Galmal","Pyeongchang","Hwacheon","Hoengseong","Seocheon","Cheongyang","Goesan","Danyang","Hamyeol","Muju","Sunchang","Imsil","Jangsu","Jinan","Goheung","Gokseong","Muan","Yeongam","Jindo","Seonsan","Daegaya","Gunwi","Bonghwa","Seongju","Yeongdeok","Yeongyang","Ulleung","Uljin","Cheongsong","wayang","Namhae","Sancheong","Uiryeong","Gaya","Hapcheon","Wabu","Dongsong","Sindong","Wondeok","Maepo","Anmyeon","Okgu","Sariwon","Dolsan","Daedeok","Gwansan","Geumil","Nohwa","Baeksu","Illo","Jido","Oedong","Ocheon","Yeonil","Hamchang","Pyeonghae","Gijang","Jeonggwan","Aewor","Gujwa","Seongsan","Jeongok","Seonggeo","Seungju","Hongnong","Jangan","Jocheon","Gohan","Jinjeop","Bubal","Beobwon","Yeomchi","Hwado","Daesan","Hwawon","Apo","Nampyeong","Munsan","Sinbuk","Munmak","Judeok","Bongyang","Ungcheon","Yugu","Unbong","Mangyeong","Dong","Naeseo","Sanyang","Soheul","Onsan","Eonyang","Nongong","Dasa","Goa","Jillyang","Bongdam","Naesu","Beomseo","Opo","Gongdo","Jingeon","Onam","Baekseok","Jiksan","Mokcheon","Jori","Anjung","Samho","Ujeong","Buksam","Tongjin","Chowol","Gonjiam","Pogok","Seokjeok","Poseung","Ochang","Hyangnam","Baebang","Gochon","Songak","Samhyang","Yangchon","Osong","Aphae","Ganam","Namyang","Chirwon","Andong","Ansan","Anseong","Anyang","Asan","Boryeong","Bucheon","Busan","Changwon","Cheonan","Cheongju","Chuncheon","Chungju","Daegu","Daejeon","Dangjin","Dongducheon","Donghae","Gangneung","Geoje","Gimcheon","Gimhae","Gimje","Gimpo","Gongju","Goyang","Gumi","Gunpo","Gunsan","Guri","Gwacheon","Gwangju","Gwangju","Gwangmyeong","Gyeongju","Gyeongsan","Gyeryong","Hwaseong","Icheon","Iksan","Incheon","Jecheon","Jeongeup","Jeonju","Jeju","Jinju","Naju","Namyangju","Namwon","Nonsan","Miryang","Mokpo","Mungyeong","Osan","Paju","Pocheon","Pohang","Pyeongtaek","Sacheon","Sangju","Samcheok","Sejong","Seogwipo","Seongnam","Seosan","Seoul","Siheung","Sokcho","Suncheon","Suwon","Taebaek","Tongyeong","Uijeongbu","Uiwang","Ulsan","Yangju","Yangsan","Yeongcheon","Yeongju","Yeosu","Yongin","Chungmu","Daecheon","Donggwangyang","Geumseong","Gyeongseong","Iri","Jangseungpo","Jeomchon","Jeongju","Migeum","Onyang","Samcheonpo","Busan","Busan","Cheongju","Chuncheon","Daegu","Daegu","Daejeon","Daejeon","Gunsan","Gwangju","Gwangju","Gyeongseong","Incheon","Incheon","Iri","Jeonju","Jinhae","Jinju","Masan","Masan","Mokpo","Songjeong","Songtan","Ulsan","Yeocheon","Cheongjin","Gaeseong","Haeju","Hamheung","Heungnam","Jinnampo","Najin","Pyeongyang","Seongjin","Sineuiju","Songnim","Wonsan"],["Anding","Anlu","Anqing","Anshun","Baan","Baixing","Banyang","Baoding","Baoqing","Binzhou","Caozhou","Changbai","Changchun","Changde","Changling","Changsha","Changtu","Changzhou","Chaozhou","Cheli","Chengde","Chengdu","Chenzhou","Chizhou","Chongqing","Chuxiong","Chuzhou","Dading","Dali","Daming","Datong","Daxing","Dean","Dengke","Dengzhou","Deqing","Dexing","Dihua","Dingli","Dongan","Dongchang","Dongchuan","Dongping","Duyun","Fengtian","Fengxiang","Fengyang","Fenzhou","Funing","Fuzhou","Ganzhou","Gaoyao","Gaozhou","Gongchang","Guangnan","Guangning","Guangping","Guangxin","Guangzhou","Guide","Guilin","Guiyang","Hailong","Hailun","Hangzhou","Hanyang","Hanzhong","Heihe","Hejian","Henan","Hengzhou","Hezhong","Huaian","Huaide","Huaiqing","Huanglong","Huangzhou","Huining","Huizhou","Hulan","Huzhou","Jiading","Jian","Jianchang","Jiande","Jiangning","Jiankang","Jianning","Jiaxing","Jiayang","Jilin","Jinan","Jingjiang","Jingzhao","Jingzhou","Jinhua","Jinzhou","Jiujiang","Kaifeng","Kaihua","Kangding","Kuizhou","Laizhou","Lanzhou","Leizhou","Liangzhou","Lianzhou","Liaoyang","Lijiang","Linan","Linhuang","Linjiang","Lintao","Liping","Liuzhou","Longan","Longjiang","Longqing","Longxing","Luan","Lubin","Lubin","Luzhou","Mishan","Nanan","Nanchang","Nandian","Nankang","Nanning","Nanyang","Nenjiang","Ningan","Ningbo","Ningguo","Ninguo","Ningwu","Ningxia","Ningyuan","Pingjiang","Pingle","Pingliang","Pingyang","Puer","Puzhou","Qianzhou","Qingyang","Qingyuan","Qingzhou","Qiongzhou","Qujing","Quzhou","Raozhou","Rende","Ruian","Ruizhou","Runing","Shafeng","Shajing","Shaoqing","Shaowu","Shaoxing","Shaozhou","Shinan","Shiqian","Shouchun","Shuangcheng","Shulei","Shunde","Shunqing","Shuntian","Shuoping","Sicheng","Sien","Sinan","Sizhou","Songjiang","Suiding","Suihua","Suining","Suzhou","Taian","Taibei","Tainan","Taiping","Taiwan","Taiyuan","Taizhou","Taonan","Tengchong","Tieli","Tingzhou","Tongchuan","Tongqing","Tongren","Tongzhou","Weihui","Wensu","Wenzhou","Wuchang","Wuding","Wuzhou","Xian","Xianchun","Xianping","Xijin","Xiliang","Xincheng","Xingan","Xingde","Xinghua","Xingjing","Xingqing","Xingyi","Xingyuan","Xingzhong","Xining","Xinmen","Xiping","Xuanhua","Xunzhou","Xuzhou","Yanan","Yangzhou","Yanji","Yanping","Yanqi","Yanzhou","Yazhou","Yichang","Yidu","Yilan","Yili","Yingchang","Yingde","Yingtian","Yingzhou","Yizhou","Yongchang","Yongping","Yongshun","Yongzhou","Yuanzhou","Yuezhou","Yulin","Yunnan","Yunyang","Zezhou","Zhangde","Zhangzhou","Zhaoqing","Zhaotong","Zhenan","Zhending","Zhengding","Zhenhai","Zhenjiang","Zhenxi","Zhenyun","Zhongshan","Zunyi"],["Nanporo","Naie","Kamisunagawa","Yuni","Naganuma","Kuriyama","Tsukigata","Urausu","Shintotsukawa","Moseushi","Chippubetsu","Uryu","Hokuryu","Numata","Tobetsu","Suttsu","Kuromatsunai","Rankoshi","Niseko","Kimobetsu","Kyogoku","Kutchan","Kyowa","Iwanai","Shakotan","Furubira","Niki","Yoichi","Toyoura","Toyako","Sobetsu","Shiraoi","Atsuma","Abira","Mukawa","Hidaka","Biratori","Niikappu","Urakawa","Samani","Erimo","Shinhidaka","Matsumae","Fukushima","Shiriuchi","Kikonai","Nanae","Shikabe","Mori","Yakumo","Oshamambe","Esashi","Kaminokuni","Assabu","Otobe","Okushiri","Imakane","Setana","Takasu","Higashikagura","Toma","Pippu","Aibetsu","Kamikawa","Higashikawa","Biei","Kamifurano","Nakafurano","Minamifurano","Horokanai","Wassamu","Kenbuchi","Shimokawa","Bifuka","Nakagawa","Mashike","Obira","Tomamae","Haboro","Enbetsu","Teshio","Hamatonbetsu","Nakatonbetsu","Esashi","Toyotomi","Horonobe","Rebun","Rishiri","Rishirifuji","Bihoro","Tsubetsu","Ozora","Shari","Kiyosato","Koshimizu","Kunneppu","Oketo","Saroma","Engaru","Yubetsu","Takinoue","Okoppe","Omu","Otofuke","Shihoro","Kamishihoro","Shikaoi","Shintoku","Shimizu","Memuro","Taiki","Hiroo","Makubetsu","Ikeda","Toyokoro","Honbetsu","Ashoro","Rikubetsu","Urahoro","Kushiro","Akkeshi","Hamanaka","Shibecha","Teshikaga","Shiranuka","Betsukai","Nakashibetsu","Shibetsu","Rausu","Hiranai","Imabetsu","Sotogahama","Ajigasawa","Fukaura","Fujisaki","Owani","Itayanagi","Tsuruta","Nakadomari","Noheji","Shichinohe","Rokunohe","Yokohama","Tohoku","Oirase","Oma","Sannohe","Gonohe","Takko","Nanbu","Hashikami","Shizukuishi","Kuzumaki","Iwate","Shiwa","Yahaba","Nishiwaga","Kanegasaki","Hiraizumi","Sumita","Otsuchi","Yamada","Iwaizumi","Karumai","Hirono","Ichinohe","Zao","Shichikashuku","Ogawara","Murata","Shibata","Kawasaki","Marumori","Watari","Yamamoto","Matsushima","Shichigahama","Rifu","Taiwa","Osato","Shikama","Kami","Wakuya","Misato","Onagawa","Minamisanriku","Kosaka","Fujisato","Mitane","Happo","Gojome","Hachirogata","Ikawa","Misato","Ugo","Yamanobe","Nakayama","Kahoku","Nishikawa","Asahi","Oe","Oishida","Kaneyama","Mogami","Funagata","Mamurogawa","Takahata","Kawanishi","Oguni","Shirataka","Iide","Mikawa","Shonai","Yuza","Koori","Kunimi","Kawamata","Kagamiishi","Shimogo","Tadami","Minamiaizu","Nishiaizu","Bandai","Inawashiro","Aizubange","Yanaizu","Mishima","Kaneyama","Aizumisato","Yabuki","Tanagura","Yamatsuri","Hanawa","Ishikawa","Asakawa","Furudono","Miharu","Ono","Hirono","Naraha","Tomioka","Okuma","Futaba","Namie","Shinchi","Ibaraki","Oarai","Shirosato","Daigo","Ami","Kawachi","Yachiyo","Goka","Sakai","Tone","Kaminokawa","Mashiko","Motegi","Ichikai","Haga","Mibu","Nogi","Shioya","Takanezawa","Nasu","Nakagawa","Yoshioka","Kanna","Shimonita","Kanra","Nakanojo","Naganohara","Kusatsu","Higashiagatsuma","Minakami","Tamamura","Itakura","Meiwa","Chiyoda","Oizumi","Ora","Ina","Miyoshi","Moroyama","Ogose","Namegawa","Ranzan","Ogawa","Kawajima","Yoshimi","Hatoyama","Tokigawa","Yokoze","Minano","Nagatoro","Ogano","Misato","Kamikawa","Kamisato","Yorii","Miyashiro","Sugito","Matsubushi","Shisui","Sakae","Kozaki","Tako","Tonosho","Kujukuri","Shibayama","Yokoshibahikari","Ichinomiya","Mutsuzawa","Shirako","Nagara","Chonan","Otaki","Onjuku","Kyonan","Mizuho","Hinode","Okutama","Oshima","Hachijo","Aikawa","Hayama","Samukawa","Oiso","Ninomiya","Nakai","Oi","Matsuda","Yamakita","Kaisei","Hakone","Manazuru","Yugawara","Seiro","Tagami","Aga","Izumozaki","Yuzawa","Tsunan","Kamiichi","Tateyama","Nyuzen","Asahi","Kawakita","Tsubata","Uchinada","Shika","Hodatsushimizu","Nakanoto","Anamizu","Noto","Eiheiji","Ikeda","Minamiechizen","Echizen","Mihama","Takahama","Oi","Wakasa","Ichikawamisato","Hayakawa","Minobu","Nanbu","Fujikawa","Showa","Nishikatsura","Fujikawaguchiko","Koumi","Sakuho","Karuizawa","Miyota","Tateshina","Nagawa","Shimosuwa","Fujimi","Tatsuno","Minowa","Iijima","Matsukawa","Takamori","Anan","Agematsu","Nagiso","Kiso","Ikeda","Sakaki","Obuse","Yamanouchi","Shinano","Iizuna","Ginan","Kasamatsu","Yoro","Tarui","Sekigahara","Godo","Wanouchi","Anpachi","Ibigawa","Ono","Ikeda","Kitagata","Sakahogi","Tomika","Kawabe","Hichiso","Yaotsu","Shirakawa","Mitake","Higashiizu","Kawazu","Minamiizu","Matsuzaki","Nishiizu","Kannami","Shimizu","Nagaizumi","Oyama","Yoshida","Kawanehon","Mori","Togo","Toyoyama","Oguchi","Fuso","Oharu","Kanie","Agui","Higashiura","Minamichita","Mihama","Taketoyo","Mihama","Kota","Shitara","Toei","Kisosaki","Toin","Komono","Asahi","Kawagoe","Taki","Meiwa","Odai","Tamaki","Watarai","Taiki","Minamiise","Kihoku","Mihama","Kiho","Hino","Ryuo","Aisho","Toyosato","Kora","Taga","Oyamazaki","Kumiyama","Ide","Ujitawara","Kasagi","Wazuka","Seika","Kyotamba","Ine","Yosano","Shimamoto","Toyono","Nose","Tadaoka","Kumatori","Tajiri","Misaki","Taishi","Kanan","Inagawa","Taka","Inami","Harima","Ichikawa","Fukusaki","Kamikawa","Taishi","Kamigori","Sayo","Kami","Shinonsen","Heguri","Sango","Ikaruga","Ando","Kawanishi","Miyake","Tawaramoto","Takatori","Kanmaki","Oji","Koryo","Kawai","Yoshino","Oyodo","Shimoichi","Kushimoto","Kimino","Katsuragi","Kudoyama","Koya","Yuasa","Hirogawa","Aridagawa","Mihama","Hidaka","Yura","Inami","Minabe","Hidakagawa","Shirahama","Kamitonda","Susami","Nachikatsuura","Taiji","Kozagawa","Iwami","Wakasa","Chizu","Yazu","Misasa","Yurihama","Kotoura","Hokuei","Daisen","Nanbu","Hoki","Nichinan","Hino","Kofu","Okuizumo","Iinan","Kawamoto","Misato","Onan","Tsuwano","Yoshika","Ama","Nishinoshima","Okinoshima","Wake","Hayashima","Satosho","Yakage","Kagamino","Shoo","Nagi","Kumenan","Misaki","Kibichuo","Fuchu","Kaita","Kumano","Saka","Kitahiroshima","Akiota","Osakikamijima","Sera","Jinsekikogen","Suooshima","Waki","Kaminoseki","Tabuse","Hirao","Abu","Katsuura","Kamikatsu","Ishii","Kamiyama","Naka","Mugi","Minami","Kaiyo","Matsushige","Kitajima","Aizumi","Itano","Kamiita","Tsurugi","Higashimiyoshi","Tonosho","Shodoshima","Miki","Naoshima","Utazu","Ayagawa","Kotohira","Tadotsu","Manno","Kamijima","Kumakogen","Masaki","Tobe","Uchiko","Ikata","Kihoku","Matsuno","Ainan","Toyo","Nahari","Tano","Yasuda","Motoyama","Otoyo","Tosa","Ino","Niyodogawa","Nakatosa","Sakawa","Ochi","Yusuhara","Tsuno","Shimanto","Otsuki","Kuroshio","Nakagawa","Umi","Sasaguri","Shime","Sue","Shingu","Hisayama","Kasuya","Ashiya","Mizumaki","Okagaki","Onga","Kotake","Kurate","Keisen","Chikuzen","Tachiarai","Oki","Hirokawa","Kawara","Soeda","Itoda","Kawasaki","Oto","Fukuchi","Kanda","Miyako","Yoshitomi","Koge","Chikujo","Yoshinogari","Kiyama","Kamimine","Miyaki","Genkai","Arita","Omachi","Kohoku","Shiroishi","Tara","Nagayo","Togitsu","Higashisonogi","Kawatana","Hasami","Ojika","Saza","Shinkamigoto","Misato","Gyokuto","Nankan","Nagasu","Nagomi","Ozu","Kikuyo","Minamioguni","Oguni","Takamori","Mifune","Kashima","Mashiki","Kosa","Yamato","Hikawa","Ashikita","Tsunagi","Nishiki","Taragi","Yunomae","Asagiri","Reihoku","Hiji","Kusu","Kokonoe","Mimata","Takaharu","Kunitomi","Aya","Takanabe","Shintomi","Kijo","Kawaminami","Tsuno","Kadogawa","Misato","Takachiho","Hinokage","Gokase","Satsuma","Nagashima","Yusui","Osaki","Higashikushira","Kinko","Minamiosumi","Kimotsuki","Nakatane","Minamitane","Yakushima","Setouchi","Tatsugo","Kikai","Tokunoshima","Amagi","Isen","Wadomari","China","Yoron","Motobu","Kin","Kadena","Chatan","Nishihara","Yonabaru","Haebaru","Kumejima","Yaese","Taketomi","Yonaguni"]]}function Nt(){var t=no((Ct+St)/1500,2);if(0==lockRegionsInput.getAttribute("data-locked")&&(regionsInput.value=regionsOutput.value=oo(7,17)),0==lockManorsInput.getAttribute("data-locked")){var e=20*regionsInput.value+oo(180*t);manorsInput.value=manorsOutput.innerHTML=e}0==lockPowerInput.getAttribute("data-locked")&&(powerInput.value=powerOutput.value=oo(2,8)),0==lockNeutralInput.getAttribute("data-locked")&&(neutralInput.value=neutralOutput.value=oo(100,300)),0==lockNamesInput.getAttribute("data-locked")&&(namesInput.value=oo(0,1)),0==lockCulturesInput.getAttribute("data-locked")&&(culturesInput.value=culturesOutput.value=oo(5,10)),0==lockPrecInput.getAttribute("data-locked")&&(precInput.value=precOutput.value=oo(3,12)),0==lockSwampinessInput.getAttribute("data-locked")&&(swampinessInput.value=swampinessOutput.value=oo(100))}function Gt(){console.time("placePoints"),Y=[],Y=go(),K=new Uint8Array(Y.length),console.timeEnd("placePoints")}function Ft(t){console.time("calculateVoronoi"),i=n(t),i.edges.forEach(function(t){t[0][0]=no(t[0][0],2),t[0][1]=no(t[0][1],2),t[1][0]=no(t[1][0],2),t[1][1]=no(t[1][1],2)}),r=i.polygons(),console.log(" cells: "+t.length),console.timeEnd("calculateVoronoi")}function _t(){var t=d3.mouse(this),e=i.find(t[0],t[1]).index;if(e){var a=Q[e];infoX.innerHTML=no(t[0]),infoY.innerHTML=no(t[1]),infoCell.innerHTML=e,infoArea.innerHTML=jt(a.area,"n/a",2),infoHeight.innerHTML=Kt(1===J?K[e]:a.height),infoFlux.innerHTML=jt(a.flux,"n/a",2);var o=void 0===a.region?"n/a":"neutral"===a.region?"neutral":ot[a.region].name+" ("+a.region+")";infoCountry.innerHTML=o;var n="no"!==jt(a.culture)?lt[a.culture].name+" ("+a.culture+")":"n/a";infoCulture.innerHTML=n,infoPopulation.innerHTML=jt(a.pop,"n/a",2),infoBurg.innerHTML="no"!==jt(a.manor)?at[a.manor].name+" ("+a.manor+")":"no";var r=nt[a.fn];if(void 0!==r){var s=r.land?"Island":r.border?"Ocean":"Lake";infoFeature.innerHTML=s+" ("+a.fn+")"}else infoFeature.innerHTML="n/a"}if(toggleTooltips.checked){tooltip.innerHTML=tooltip.getAttribute("data-main");var l=event.target.tagName,u=event.composedPath(),c=u[u.length-7].id,d=u[u.length-8].id;"rivers"===c&&v("Click to open River Editor"),"routes"===c&&v("Click to open Route Editor"),"terrain"===c&&v("Click to open Relief Icon Editor"),"labels"===c&&v("Click to open Label Editor"),"icons"===c&&v("Click to open Icon Editor"),"markers"===c&&v("Click to open Marker Editor"),"ruler"===c&&("path"!==l&&"line"!==l||v("Drag to move the measurer"),"text"===l&&v("Click to remove the measurer"),"circle"===l&&v("Drag to adjust the measurer")),"burgIcons"===d&&v("Click to open Burg Editor"),"burgLabels"===d&&v("Click to open Burg Editor");var p=event.target.id;""===p&&(p=event.target.parentNode.id),"burgLabels"===d&&(p="burg"+event.target.getAttribute("data-id"));var h=it.find(function(t){return t.id===p}),g=document.getElementById("legend"),m=document.getElementById("legendHeader"),f=document.getElementById("legendBody");void 0!==h&&""!==h.legend?(g.style.display="block",m.innerHTML=h.name,f.innerHTML=h.legend):(g.style.display="none",m.innerHTML="",f.innerHTML="")}if(1===J){var b=j.selectAll(".line");if(1===j.selectAll(".tag").size()){var y=+j.select(".tag").attr("cx"),k=+j.select(".tag").attr("cy");b.size()?b.attr("x1",y).attr("y1",k).attr("x2",t[0]).attr("y2",t[1]):j.insert("line",":first-child").attr("class","line").attr("x1",y).attr("y1",k).attr("x2",t[0]).attr("y2",t[1])}else b.remove()}if(J>0){var C=$("#brushesButtons > .pressed"),S=C.attr("id");if("brushRange"===S||"brushTrough"===S)return;if(5!==J&&!C.length&&!$("div.selected").length)return;var w=0;1===J?(w=brushRadius.value,"brushHill"!==S&&"brushPit"!==S||(w=Math.pow(4*brushPower.value,.5))):2===J?w=countriesManuallyBrush.value:4===J?w=culturesManuallyBrush.value:5===J&&(w=reliefBulkRemoveRadius.value);var M=no(6/U*w,1),x="#373737";if(2===J){var A=+$("div.selected").attr("id").slice(5);x="neutral"===ot[A].color?"white":ot[A].color}if(4===J){var B=+$("div.selected").attr("id").slice(7);x=lt[B].color}Dt(t[0],t[1],M,x)}}function jt(t,e,a){return null===t||void 0===t?e||"no":a?t.toFixed(a):t}function Kt(t){var e=+heightExponent.value,a=heightUnit.value,o=1;"ft"===a&&(o=3.28),"f"===a&&(o=.5468);var n=-990;return t>=20&&(n=Math.pow(t-18,e)),t<20&&t>0&&(n=(t-20)/t*50),t+" ("+no(n*o)+" "+a+")"}function Dt(t,e,a,o){var n=j.selectAll(".circle");n.size()||(n=j.insert("circle",":first-child").attr("class","circle")),n.attr("cx",t).attr("cy",e),a&&n.attr("r",a),o&&n.attr("stroke",o)}function Ut(){var t,e,a=d3.event.x,o=d3.event.y,n=i.find(a,o).index,r=n,s=$("#addOpisometer").hasClass("pressed"),l=$("#addPlanimeter").hasClass("pressed"),u=no(1/Math.pow(bt,.3),1);if(s||l){$("#ruler").show();var c=s?"opisometer":"planimeter",d=_.append("g").attr("class",c).call(d3.drag().on("start",Ie)),p=[{scX:no(a,2),scY:no(o,2)}];if(s)var h=d.append("path").attr("class","opisometer white").attr("stroke-width",u),v=no(30/distanceScale.value,2),g=d.append("path").attr("class","opisometer gray").attr("stroke-dasharray",v).attr("stroke-width",u);else h=d.append("path").attr("class","planimeter").attr("stroke-width",u);var m=d.append("text").attr("dy",-1).attr("font-size",10*u)}d3.event.on("drag",function(){t=d3.event.x,e=d3.event.y;var u=i.find(t,e).index;if(1===J){if(u===r&&t!==a&&e!==o)return;r=u;var c=$("#brushesButtons > .pressed"),d=c.attr("id"),v=+brushPower.value;"brushHill"===d&&(de(u,"hill",v),Se()),"brushPit"===d&&(ve(1,v,u),Se()),"brushRange"===d&&"brushTrough"===d||(Dt(t,e),Xt(u,n))}if(2===J||4===J){if(0===$("div.selected").length)return;if(u===r)return;r=u;var f=2===J?+countriesManuallyBrush.value:+culturesManuallyBrush.value,b=no(6/U*f,1);Dt(t,e,b);var y=Wt(u,f);y&&(2===J&&Jt(y),4===J&&qt(y))}if(s||l){var k=p[p.length-1],C=Math.hypot(k.scX-t,k.scY-e);if(C>5&&p.push({scX:t,scY:e}),s){kt.curve(d3.curveBasis);var S=io(kt(p));h.attr("d",S),g.attr("d",S);var w=no(h.node().getTotalLength()),M=no(w*distanceScale.value)+" "+distanceUnit.value;m.attr("x",t).attr("y",e-10).text(M)}else{kt.curve(d3.curveBasisClosed);S=io(kt(p));h.attr("d",S)}}}),d3.event.on("end",function(){if(1===J&&Me(),s||l)if($("#addOpisometer, #addPlanimeter").removeClass("pressed"),Vt(),s){var t=no(h.node().getTotalLength()),e=h.node().getPointAtLength(t/2),a=h.node().getPointAtLength(t/2-1),o=no(t*distanceScale.value)+" "+distanceUnit.value,n=a.x>e.x?Math.atan2(a.y-e.y,a.x-e.x):Math.atan2(e.y-a.y,e.x-a.x),i=no(180*n/Math.PI,3),r="rotate("+i+" "+e.x+" "+e.y+")";m.attr("data-points",JSON.stringify(p)).attr("data-dist",t).attr("x",e.x).attr("y",e.y).attr("transform",r).text(o).on("click",Yt),d.append("circle").attr("cx",p[0].scX).attr("cy",p[0].scY).attr("r",2*u).attr("stroke-width",.5*u).attr("data-edge","start").call(d3.drag().on("start",Le)),d.append("circle").attr("cx",p[p.length-1].scX).attr("cy",p[p.length-1].scY).attr("r",2*u).attr("stroke-width",.5*u).attr("data-edge","end").call(d3.drag().on("start",Le))}else{var c=p.map(function(t){return[t.scX,t.scY]}),v=no(Math.abs(d3.polygonArea(c))),g=v*Math.pow(distanceScale.value,2);g=ro(g),"square"===areaUnit.value?g+=" "+distanceUnit.value+"²":g+=" "+areaUnit.value;e=polylabel([c],1);m.attr("x",no(e[0],2)).attr("y",no(e[1],2)).attr("data-area",v).text(g).on("click",Yt)}})}function Vt(){h.style("cursor","default").on(".drag",null).on("click",null)}function Yt(){$(this.parentNode).remove()}function Wt(t,e){var a=e,o=[t];if(a>1&&(o=o.concat(Q[t].neighbors)),o=$.grep(o,function(t){return Q[t].height>=20}),2===a)return o;var n=Q[t].neighbors;while(a>2){var i=n.slice();n=[],i.map(function(t){Q[t].neighbors.forEach(function(t){-1===o.indexOf(t)&&(o.push(t),n.push(t))})}),a--}return o=$.grep(o,function(t){return Q[t].height>=20}),o}function Jt(t){if(0!==t.length){var e=x.select("#temp"),a=+$("div.selected").attr("id").slice(5),o="neutral"===ot[a].color?"white":ot[a].color;t.map(function(t){var n=e.select("path[data-cell='"+t+"']"),i="neutral"===Q[t].region?ot.length-1:Q[t].region,s=n.size()?+n.attr("data-state"):i;a!==s&&ot[s].capital!==Q[t].manor&&(n.size()?n.attr("data-state",a).attr("fill",o).attr("stroke",o):e.append("path").attr("data-cell",t).attr("data-state",a).attr("d","M"+r[t].join("L")+"Z").attr("fill",o).attr("stroke",o))})}}function qt(t){if(0!==t.length){var e=+$("div.selected").attr("id").slice(7),a=lt[e].color;t.map(function(t){var o=M.select("#cult"+t),n=null!==o.attr("data-culture")?+o.attr("data-culture"):Q[t].culture;n!==e&&o.attr("data-culture",e).attr("fill",a).attr("stroke",a)})}}function Xt(t,e){var a=+brushPower.value,o=+brushRadius.value,n=$("#brushesButtons > .pressed").attr("id");if(!$("#brushesButtons > .pressed").hasClass("feature")){var i=[t];o>1&&(i=i.concat(Q[t].neighbors)),o>2&&function(){var e=Q[t].neighbors;while(o>2){var a=e.slice();e=[],a.map(function(t){Q[t].neighbors.forEach(function(t){-1===i.indexOf(t)&&(i.push(t),e.push(t))})}),o--}}();var r=K[e];i.map(function(t){if("brushElevate"===n&&(K[t]<20?K[t]=20:K[t]+=a,K[t]>100&&(K[t]=100)),"brushDepress"===n&&(K[t]-=a,K[t]>100&&(K[t]=0)),"brushAlign"===n&&(K[t]=r),"brushSmooth"===n){var e=[K[t]];Q[t].neighbors.forEach(function(t){e.push(K[t])}),K[t]=(K[t]+d3.mean(e))/2}}),we(i)}}function Zt(){var t=d3.mouse(this),e=Ja(t),a=j.selectAll(".tag");if(a.size()){var o=+a.attr("data-cell");j.selectAll(".tag, .line").remove();var n=+brushPower.value,i="brushRange"===$("#brushesButtons > .pressed").attr("id")?1:-1,r=pe(i,n,o,e);we(r)}else a=j.append("circle").attr("data-cell",e).attr("class","tag").attr("r",3).attr("cx",t[0]).attr("cy",t[1])}function Qt(t){console.time("detectNeighbors");var e="";Q=[],r.map(function(a,o){var n,r=[];t&&(e+="M"+a.join("L")+"Z"),i.cells[o].halfedges.forEach(function(t){var e=i.edges[t];if(e.left&&e.right){var a=e.left.index===o?e.right.index:e.left.index;r.push(a)}else n="border"}),Q.push({index:o,data:a.data,height:0,type:n,neighbors:r})}),t&&k.append("path").attr("d",io(e,1)),console.timeEnd("detectNeighbors")}function te(){if(console.time("defineHeightmap"),0==lockTemplateInput.getAttribute("data-locked")){var t=Math.random();templateInput.value=t>.95?"Volcano":t>.75?"High Island":t>.55?"Low Island":t>.35?"Continents":t>.15?"Archipelago":t>.1?"Mainland":t>.01?"Peninsulas":"Atoll"}var e=templateInput.value;"Volcano"===e&&ee(),"High Island"===e&&ae(),"Low Island"===e&&oe(),"Continents"===e&&ne(),"Archipelago"===e&&ie(),"Atoll"===e&&re(),"Mainland"===e&&se(),"Peninsulas"===e&&le(),console.log(" template: "+e),console.timeEnd("defineHeightmap")}function ee(t){ue(),ge("all",10,1),ce(5,.35),pe(3),pe(-4)}function ae(t){ue(),ge("all",10,1),pe(6),ce(12,.25),pe(-3),ge("land",0,.75),ve(1),ce(3,.15)}function oe(t){ue(),ge("all",10,1),me(2),pe(2),ce(4,.4),ce(12,.2),pe(-8),ge("land",0,.35)}function ne(t){ue(),ge("all",10,1),ce(30,.25);var e=Math.ceil(4*Math.random()+4);he(e),ve(10),pe(-10),ge("land",0,.6),me(2),pe(3)}function ie(t){ue(),ge("all",10,1),ce(12,.15),pe(8);var e=Math.ceil(2*Math.random()+2);he(e),pe(-15),ve(10),ge("land",-5,.7),me(3)}function re(t){ue(),ge("all",10,1),ce(2,.35),pe(2),me(1),ge("27-100",0,.1)}function se(t){ue(),ge("all",10,1),ce(30,.2),pe(10),ve(20),ce(10,.15),pe(-10),ge("land",0,.4),pe(10),me(3)}function le(t){ue(),ge("all",15,1),ce(30,0),pe(5),ve(15);var e=Math.ceil(5*Math.random()+15);he(e)}function ue(){var t=Math.floor(Math.random()*Ct/3+Ct/3),e=Math.floor(Math.random()*St*.2+.4*St),a=i.find(t,e).index,o=10*Math.random()+90;de(a,"mountain",o)}function ce(t,e){for(var a=0;a<t;a++){var o=0,n=void 0,r=void 0;do{r=40*Math.random()+10;var s=Math.floor(Math.random()*Ct*(1-2*e)+Ct*e),l=Math.floor(Math.random()*St*(1-2*e)+St*e);n=i.find(s,l).index,o++}while(K[n]+r>90&&o<100);de(n,"hill",r)}}function de(t,e,a){var o,n,i,r=Math.ceil(1e5*Math.random());switch(+U){case 1:n=.991,i=.91;break;case 2:n=.9967,i=.951;break;case 3:n=.999,i=.975;break;case 4:n=.9994,i=.98;break}o="mountain"===e?i:n;var s=[t];"mountain"===e&&(K[t]=a);for(var l=0;l<s.length&&a>=1;l++)"mountain"===e?a=K[s[l]]*o-a/100:a*=o,Q[s[l]].neighbors.forEach(function(t){if(Q[t].used!==r){var e=.2*Math.random()+.9;K[t]+=a*e,K[t]>100&&(K[t]=100),Q[t].used=r,s.push(t)}})}function pe(t,e,a,o){for(var n=Math.ceil(1e5*Math.random()),r=Math.abs(t),s=[],l=function(r){s=[];var l=0,u=a,c=o;if(!u||!c)do{var d=Math.floor(Math.random()*(.7*Ct))+.15*Ct,p=Math.floor(Math.random()*(.6*St))+.2*St;u=i.find(d,p).index;var h=Math.floor(Math.random()*(.7*Ct))+.15*Ct,v=Math.floor(Math.random()*(.6*St))+.2*St;c=i.find(h,v).index,l=Math.hypot(h-d,v-p)}while(l<150/U||l>300/U);if(u&&c)for(var g=function(t){var e=1e4;Q[u].neighbors.forEach(function(t){l=Math.hypot(Q[c].data[0]-Q[t].data[0],Q[c].data[1]-Q[t].data[1]),Math.random()>.8&&(l/=2),l<e&&(e=l,u=t)}),s.push(u)},m=0;u!=c&&m<1e4;m++)g(m);var f=e||10*Math.random()+10;s.map(function(e){var a=.4*Math.random()+.8;t>0?K[e]+=f*a:K[e]>=10&&(K[e]-=f*a),Q[e].neighbors.forEach(function(e){if(Q[e].used!==n){Q[e].used=n,a=.4*Math.random()+.8;var o=f/2*a;t>0?K[e]+=o:K[e]>=10&&(K[e]-=o),K[e]>100&&(K[e]=t>0?100:5)}}),K[e]>100&&(K[e]=t>0?100:5)})},u=0;u<r;u++)l(u);return s}function he(t){for(var e=Math.ceil(1e5*Math.random()),a=Math.floor(Math.random()*Ct*.35+.3*Ct),o=Math.floor(Ct-a-.1*Ct+Math.random()*Ct*.2),n=i.find(a,.1*St).index,r=i.find(o,.9*St).index,s=[],l=function(t){var e=1e4;Q[n].neighbors.forEach(function(t){var a=Math.hypot(Q[r].data[0]-Q[t].data[0],Q[r].data[1]-Q[t].data[1]);Math.random()>.8&&(a/=2),a<e&&(e=a,n=t)}),s.push(n)},u=0;n!==r&&u<1e3;u++)l(u);for(var c=[];t>0;t--)s.map(function(t){Q[t].neighbors.forEach(function(t){Q[t].used!==e&&(Q[t].used=e,c.push(t),K[t]*=.23,(K[t]>100||K[t]<5)&&(K[t]=5))}),s=c.slice()})}function ve(t,e,a){for(var o=Math.ceil(1e5*Math.random()),n=function(t){var n=e?e+10:10*Math.random()+20,i=a;if(!i){var r=$.grep(Q,function(t){return K[t.index]>=20});if(!r.length)return{v:void 0};var s=Math.floor(Math.random()*r.length);i=r[s].index}var l=[i],u=[];K[i]-=n,(K[i]<5||K[i]>100)&&(K[i]=5),Q[i].used=o;for(var c=1;c<1e4;c++){var d=.4*Math.random()+.8;if(n-=c/.6*d,n<1)break;l.map(function(t){Q[t].neighbors.forEach(function(t){Q[t].used!==o&&(Q[t].used=o,Math.random()>.8||(u.push(t),K[t]-=n,(K[t]<5||K[t]>100)&&(K[t]=5)))})}),l=u.slice(),u=[]}},i=0;i<t;i++){var r=n(i);if("object"===Object(d["a"])(r))return r.v}}function ge(t,e,a){function o(o){return e&&(o+=e),1!==a&&("^2"===a&&(a=(o-20)/100),"^3"===a&&(a=(o-20)*(o-20)/100),"land"===t?o=20+(o-20)*a:o*=a),o<0&&(o=0),o>100&&(o=100),o}for(var n="land"===t?20:"all"===t?0:+t.split("-")[0],i="land"===t||"all"===t?100:+t.split("-")[1],r=0;r<K.length;r++)K[r]<n||K[r]>i||(K[r]=o(K[r]))}function me(t){for(var e=t||2,a=function(t){var a=[K[t]];Q[t].neighbors.forEach(function(t){a.push(K[t])}),K[t]=(K[t]*(e-1)+d3.mean(a))/e},o=0;o<K.length;o++)a(o)}function fe(){for(var t=0;t<K.length;t++)K[t]<18||Math.random()<.5||(K[t]+=2-4*Math.random())}function be(){console.time("markFeatures"),Math.seedrandom(a);for(var t=function(t,e){var a=Q[e[0]];a.fn=t;var o=K[e[0]]>=20,n="border"===a.type;n&&o&&(a.ctype=2);var i=function(){var a=e.pop();"border"===Q[a].type&&(n=!0,o&&(Q[a].ctype=2)),Q[a].neighbors.forEach(function(n){var i=K[n]>=20;o===i&&void 0===Q[n].fn&&(Q[n].fn=t,e.push(n)),o&&!i&&(Q[a].ctype=2,Q[n].ctype=-1,Q[a].harbor=Q[a].harbor?Q[a].harbor+1:1)})};while(e.length)i();nt.push({i:t,land:o,border:n});for(var r=0;r<Q.length;r++)if(void 0===Q[r].fn){e[0]=r;break}},e=0,o=[0];o.length>0;e++)t(e,o);console.timeEnd("markFeatures")}function ye(){console.time("drawOcean");var t=[],e=.8,a=$.grep(Q,function(t){return-1===t.ctype});Math.random()<e&&(t.push(-1),e=.2);for(var o=function(o){Math.random()<e?(t.unshift(o),e=.2):e+=.2,a.map(function(t){t.neighbors.forEach(function(t){Q[t].ctype||(Q[t].ctype=o)})}),a=$.grep(Q,function(t){return t.ctype===o})},n=-2;a.length>0&&n>-10;n--)o(n);if("none"!==outlineLayersInput.value){"random"!==outlineLayersInput.value&&(t=outlineLayersInput.value.split(","));for(var r=no(.4/t.length,2),s=function(e){for(var a=[],o=+t[e],n=function(t){if(Q[t].ctype<o||void 0===Q[t].ctype)return"continue";if(Q[t].ctype>o&&"border"!==Q[t].type)return"continue";var e=i.cells[t];e.halfedges.forEach(function(e){var n=i.edges[e],r=n[0].join(" "),s=n[1].join(" ");if(n.left&&n.right){var l=n.left.index===t?n.right.index:n.left.index;Q[l].ctype<o&&a.push({start:r,end:s})}else a.push({start:r,end:s})})},s=0;s<Q.length;s++)n(s);kt.curve(d3.curveBasis);var l=.8-e/10;l<.2&&(l=.2);var u=Re(a,0,l);m.append("path").attr("d",u).attr("fill","#ecf2f9").style("opacity",r)},l=0;l<t.length;l++)s(l);console.timeEnd("drawOcean")}}function ke(){console.time("reGraph");var t=[],e=[],a=precInput.value/5e3,o=500,n=0,s=2;Q.map(function(a,i){var l=a.height||K[i];l>100&&(l=100);var u=a.pit,c=a.ctype;if(!(-1!==c&&-2!==c&&l<20)){var d=no(a.data[0],1),p=no(a.data[1],1),h=a.fn,v=a.harbor,g=a.lake;n<o&&!g&&u>s&&2!==c&&(g=2,n++);var m=a.region,f=a.culture,b=$.grep(e,function(t){return t[0]==d&&t[1]==p});if(b.length||(e.push([d,p]),t.push({index:t.length,data:[d,p],height:l,pit:u,ctype:c,fn:h,harbor:v,lake:g,region:m,culture:f})),2===c||-1===c){if("border"===a.type)return;if(!nt[h].land&&!nt[h].border)return;a.neighbors.forEach(function(a){if(Q[a].ctype===c){var o=(2*d+Q[a].data[0])/3,n=(2*p+Q[a].data[1])/3;if(o=no(o,1),n=no(n,1),b=$.grep(e,function(t){return t[0]===o&&t[1]===n}),b.length)return;e.push([o,n]),t.push({index:t.length,data:[o,n],height:l,pit:u,ctype:c,fn:h,harbor:v,lake:g,region:m,culture:f})}})}2===g&&r[a.index].forEach(function(o){if(!(Math.random()>.8)){var n=.6*Math.random()+.8,i=no((o[0]*n+a.data[0])/(1+n),2);n=.6*Math.random()+.8;var r=no((o[1]*n+a.data[1])/(1+n),2);b=$.grep(e,function(t){return i===t[0]&&r===t[1]}),b.length||(e.push([i,r]),t.push({index:t.length,data:[i,r],height:l,pit:u,ctype:c,fn:h,region:m,culture:f}))}})}}),console.log("small lakes candidates: "+n),Q=t,Ft(e);var l="";Q.map(function(t,e){if(t.height>=20){t.area=no(Math.abs(d3.polygonArea(r[e])),2);var o=no(a*t.area,2);t.flux=t.lake?10*o:o}var n=[];i.cells[e].halfedges.forEach(function(a){var o=i.edges[a];if(void 0!==o.left&&void 0!==o.right){var r=o.left.index===e?o.right.index:o.left.index;n.push(r),e<r&&t.height>=20&&1!==t.lake&&Q[r].height>=20&&1!==Q[r].lake&&(l+="M"+o[0][0]+","+o[0][1]+"L"+o[1][0]+","+o[1][1])}else t.height>=20&&(t.ctype=99)}),t.neighbors=n,void 0===t.region&&delete t.region,void 0===t.culture&&delete t.culture}),k.append("path").attr("d",l),console.timeEnd("reGraph")}function Ce(){$("#landmass").empty();for(var t=renderOcean.checked?1:20,e=0;e<K.length;e++)if(!(K[e]<t)){K[e]>100&&(K[e]=100);var a=gt(1-K[e]/100);b.append("path").attr("id","cell"+e).attr("d","M"+r[e].join("L")+"Z").attr("fill",a).attr("stroke",a)}}function Se(){for(var t=renderOcean.checked?1:20,e=0;e<K.length;e++){K[e]>100&&(K[e]=100);var a=b.select("#cell"+e),o=gt(1-K[e]/100);a.size()?K[e]<t?a.remove():a.attr("fill",o).attr("stroke",o):K[e]>=t&&(a=b.append("path").attr("id","cell"+e).attr("d","M"+r[e].join("L")+"Z").attr("fill",o).attr("stroke",o))}}function we(t){if(void 0!==t){var e=renderOcean.checked?1:20;t.map(function(t){K[t]>100&&(K[t]=100);var a=b.select("#cell"+t),o=gt(1-K[t]/100);a.size()?K[t]<e?a.remove():a.attr("fill",o).attr("stroke",o):K[t]>=e&&(a=b.append("path").attr("id","cell"+t).attr("d","M"+r[t].join("L")+"Z").attr("fill",o).attr("stroke",o))})}}function Me(){var t=0;t=renderOcean.checked?K.reduce(function(t,e){return e>=20?t+1:t},0):b.selectAll("*").size(),q=q.slice(0,X),q[X]=K.slice(),X++,undo.disabled=templateUndo.disabled=X<=1,redo.disabled=templateRedo.disabled=!0;var e=Math.trunc(d3.mean(K)),a=no(t/K.length*100);landmassCounter.innerHTML=t,landmassRatio.innerHTML=a,landmassAverage.innerHTML=e,$("#perspectivePanel").is(":visible")&&ko()}function xe(t){X=t,redo.disabled=templateRedo.disabled=X>=q.length,undo.disabled=templateUndo.disabled=X<=1,void 0!==q[X-1]&&(K=q[X-1].slice(),Se())}function Ae(){q=[],X=0,redo.disabled=templateRedo.disabled=!0,undo.disabled=templateUndo.disabled=!0,Me()}function Be(){console.time("drawCoastline"),Math.seedrandom(a);var t=p.append("mask").attr("id","shape").attr("fill","black").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%");$("#landmass").empty();for(var e,o,n=Ct,r=0,s=[],l=[],u=function(t){var a=tt[t].index,u=i.cells[a],c=tt[t].fn;tt[t].height=Math.trunc(tt[t].height),s[c]||(s[c]=[],l[c]=[]),u.halfedges.forEach(function(u){var d=i.edges[u],p=d[0].join(" "),h=d[1].join(" ");if(d.left&&d.right){var v=d.left.index===a?d.right.index:d.left.index;if(Q[v].height=Math.trunc(Q[v].height),Q[v].height<20){if(Q[v].ctype=-1,1!==tt[t].ctype){tt[t].ctype=1;var g=(tt[t].data[0]+Q[v].data[0])/2,m=(tt[t].data[1]+Q[v].data[1])/2;tt[t].haven=v,tt[t].coastX=no(g+.1*(tt[t].data[0]-g),1),tt[t].coastY=no(m+.1*(tt[t].data[1]-m),1),tt[t].data[0]=no(g+.5*(tt[t].data[0]-g),1),tt[t].data[1]=no(m+.5*(tt[t].data[1]-m),1)}if(nt[Q[v].fn].border)s[c].push({start:p,end:h}),d[0][0]<n&&(n=d[0][0],e=d[0]),d[1][0]<n&&(n=d[1][0],e=d[1]),d[0][0]>r&&(r=d[0][0],o=d[0]),d[1][0]>r&&(r=d[1][0],o=d[1]);else{var f=Q[v].fn;l[c][f]||(l[c][f]=[]),l[c][f].push({start:p,end:h})}}}else s[c].push({start:p,end:h})})},c=0;c<tt.length;c++)u(c);for(var d=0;d<nt.length;d++)if(s[d]){if(!s[d].length&&l[d].length){var h=l[d].indexOf(d3.max(l[d]));s[d]=l[d][h],l[d][h]=[]}kt.curve(d3.curveCatmullRomClosed.alpha(.1));var v=Re(s[d],3,0);v&&(t.append("path").attr("d",v).attr("fill","white"),P.append("path").attr("d",v)),kt.curve(d3.curveBasisClosed),l[d].forEach(function(e){var a=Re(e,3,0);a&&(t.append("path").attr("d",a).attr("fill","black"),I.append("path").attr("d",a))})}b.append("rect").attr("x",0).attr("y",0).attr("width",Ct).attr("height",St),Ee(e,o),console.timeEnd("drawCoastline")}function $e(){if(!$("#scaleBar").hasClass("hidden")){l.select("#scaleBar").remove();var t=+barSize.value,e=distanceScale.value,a=distanceUnit.value,o=l.append("g").attr("id","scaleBar").on("click",Xo).on("mousemove",function(){v("Click to open Scale Editor, drag to move")}).call(d3.drag().on("start",Ie)),n=100,i=n*t*e/bt;i=i>900?no(i,-3):i>90?no(i,-2):i>9?no(i,-1):no(i);var r=i*bt/e,s=0,u=0;o.append("line").attr("x1",s+.5).attr("y1",u).attr("x2",s+r+t-.5).attr("y2",u).attr("stroke-width",t).attr("stroke","white"),o.append("line").attr("x1",s).attr("y1",u+t).attr("x2",s+r+t).attr("y2",u+t).attr("stroke-width",t).attr("stroke","#3d3d3d");var c=t+" "+no(r/5-t,2);o.append("line").attr("x1",s).attr("y1",u).attr("x2",s+r+t).attr("y2",u).attr("stroke-width",no(3*t,2)).attr("stroke-dasharray",c).attr("stroke","#3d3d3d");for(var d=0;d<6;d++){var p=no(d*r/5,2),h=no(p*e/bt);5===d?o.append("text").attr("x",s+p).attr("y",u-2*t).attr("font-size",no(5*t,1)).text(h+" "+a):o.append("text").attr("x",s+p).attr("y",u-2*t).attr("font-size",no(5*t,1)).text(h)}""!==barLabel.value&&o.append("text").attr("x",s+(r+1)/2).attr("y",u+2*t).attr("dominant-baseline","text-before-edge").attr("font-size",no(5*t,1)).text(barLabel.value);var g=o.node().getBBox();o.insert("rect",":first-child").attr("x",-10).attr("y",-20).attr("width",g.width+10).attr("height",g.height+15).attr("stroke-width",t).attr("stroke","none").attr("filter","url(#blur5)").attr("fill",barBackColor.value).attr("opacity",+barBackOpacity.value),ln()}}function Ee(t,e){var a=_.append("g").attr("class","linear").call(d3.drag().on("start",Ie));t||(t=[0,0]),e||(e=[wt,Mt]);var o=no(t[0],2),n=no(t[1],2),i=no(e[0],2),r=no(e[1],2);a.append("line").attr("x1",o).attr("y1",n).attr("x2",i).attr("y2",r).attr("class","white"),a.append("line").attr("x1",o).attr("y1",n).attr("x2",i).attr("y2",r).attr("class","gray").attr("stroke-dasharray",10),a.append("circle").attr("r",2).attr("cx",o).attr("cy",n).attr("stroke-width",.5).attr("data-edge","left").call(d3.drag().on("drag",ze)),a.append("circle").attr("r",2).attr("cx",i).attr("cy",r).attr("stroke-width",.5).attr("data-edge","rigth").call(d3.drag().on("drag",ze));var s=no((o+i)/2,2),l=no((n+r)/2,2);a.append("circle").attr("r",1.2).attr("cx",s).attr("cy",l).attr("stroke-width",.3).attr("class","center").call(d3.drag().on("start",Te));var u=180*Math.atan2(r-n,i-o)/Math.PI,c="rotate("+u+" "+s+" "+l+")",d=no(Math.hypot(o-i,n-r)),p=no(d*distanceScale.value)+" "+distanceUnit.value;a.append("text").attr("x",s).attr("y",l).attr("dy",-1).attr("transform",c).attr("data-dist",d).text(p).on("click",Yt).attr("font-size",10)}function Ie(){var t=d3.select(this),e=Qe(t.attr("transform")),a=+e[0]-d3.event.x,o=+e[1]-d3.event.y;d3.event.on("drag",function(){var n=d3.event.x,i=d3.event.y,r="translate(".concat(a+n,",").concat(o+i,") rotate(").concat(e[2]," ").concat(e[3]," ").concat(e[4],")");t.attr("transform",r);var s=this.parentNode.parentNode.id;"burgIcons"!==s&&"burgLabels"!==s||v('Use dragging for fine-tuning only, to move burg to a different cell use "Relocate" button'),"labels"===s&&j.select("circle").attr("transform",r)}),d3.event.on("end",function(){if("scaleBar"===t.attr("id")){var e=d3.event.x,n=d3.event.y,i=Math.abs(a-e)+Math.abs(o-n);if(i>5){var r=t.node().getBoundingClientRect();sessionStorage.setItem("scaleBar",[r.right,r.bottom])}}})}function ze(){var t,e,a=d3.select(this.parentNode),o=d3.select(this).attr("data-edge"),n=d3.event.x,i=d3.event.y;d3.select(this).attr("cx",n).attr("cy",i);var r=a.selectAll("line");"left"===o?(r.attr("x1",n).attr("y1",i),t=+r.attr("x2"),e=+r.attr("y2")):(r.attr("x2",n).attr("y2",i),t=+r.attr("x1"),e=+r.attr("y1"));var s=no((n+t)/2,2),l=no((i+e)/2,2);a.select(".center").attr("cx",s).attr("cy",l);var u=no(Math.hypot(t-n,e-i)),c=no(u*distanceScale.value)+" "+distanceUnit.value,d=t>n?Math.atan2(e-i,t-n):Math.atan2(i-e,n-t),p=no(180*d/Math.PI,3),h="rotate("+p+" "+s+" "+l+")";a.select("text").attr("x",s).attr("y",l).attr("transform",h).attr("data-dist",u).text(c)}function Te(){var t,e,a,o,n=d3.select(this.parentNode),i=d3.event.x,r=d3.event.y,s=n.selectAll("line"),l=+s.attr("x1"),u=+s.attr("y1"),c=+s.attr("x2"),d=+s.attr("y2"),p=_.insert("g",":first-child");p.attr("transform",n.attr("transform")).call(d3.drag().on("start",Ie));var h=no(1/Math.pow(bt,.3),1);p.append("line").attr("class","white").attr("stroke-width",h);var v=+n.select(".gray").attr("stroke-dasharray");p.append("line").attr("class","gray").attr("stroke-dasharray",v).attr("stroke-width",h),p.append("text").attr("dy",-1).on("click",Yt).attr("font-size",10*h).attr("stroke-width",h),d3.event.on("drag",function(){i=d3.event.x,r=d3.event.y,d3.select(this).attr("cx",i).attr("cy",r),s.attr("x1",l).attr("y1",u).attr("x2",i).attr("y2",r);var h=no(Math.hypot(l-i,u-r)),v=no(h*distanceScale.value)+" "+distanceUnit.value,g=l>i?Math.atan2(u-r,l-i):Math.atan2(r-u,i-l);t=no((i+l)/2,2),e=no((r+u)/2,2);var m="rotate("+no(180*g/Math.PI,3)+" "+t+" "+e+")";n.select("text").attr("x",t).attr("y",e).attr("transform",m).attr("data-dist",h).text(v),h=no(Math.hypot(c-i,d-r)),v=no(h*distanceScale.value)+" "+distanceUnit.value,g=c>i?Math.atan2(d-r,c-i):Math.atan2(r-d,i-c),a=no((i+c)/2,2),o=no((r+d)/2,2),m="rotate("+no(180*g/Math.PI,3)+" "+a+" "+o+")",p.selectAll("line").attr("x1",i).attr("y1",r).attr("x2",c).attr("y2",d),p.select("text").attr("x",a).attr("y",o).attr("transform",m).attr("data-dist",h).text(v)}),d3.event.on("end",function(){n.selectAll("circle").remove(),n.append("circle").attr("cx",l).attr("cy",u).attr("r",2*h).attr("stroke-width",.5*h).attr("data-edge","left").call(d3.drag().on("drag",ze)),n.append("circle").attr("cx",i).attr("cy",r).attr("r",2*h).attr("stroke-width",.5*h).attr("data-edge","rigth").call(d3.drag().on("drag",ze)),n.append("circle").attr("cx",t).attr("cy",e).attr("r",1.2*h).attr("stroke-width",.3*h).attr("class","center").call(d3.drag().on("start",Te)),p.append("circle").attr("cx",i).attr("cy",r).attr("r",2*h).attr("stroke-width",.5*h).attr("data-edge","left").call(d3.drag().on("drag",ze)),p.append("circle").attr("cx",c).attr("cy",d).attr("r",2*h).attr("stroke-width",.5*h).attr("data-edge","rigth").call(d3.drag().on("drag",ze)),p.append("circle").attr("cx",a).attr("cy",o).attr("r",1.2*h).attr("stroke-width",.3*h).attr("class","center").call(d3.drag().on("start",Te))})}function Le(){var t=d3.select(this),e=+t.attr("cx"),a=+t.attr("cy"),o=d3.select(this.parentNode),n=o.select(".white"),i=o.select(".gray"),r=o.select("text"),s=JSON.parse(r.attr("data-points"));e===s[0].scX&&a===s[0].scY&&s.reverse(),d3.event.on("drag",function(){var e=d3.event.x,a=d3.event.y;t.attr("cx",e).attr("cy",a);var o=s[s.length-1],l=Math.hypot(o.scX-e,o.scY-a);if(l>5){s.push({scX:e,scY:a}),kt.curve(d3.curveBasis);var u=io(kt(s));n.attr("d",u),i.attr("d",u);var c=no(n.node().getTotalLength()),d=no(c*distanceScale.value)+" "+distanceUnit.value;r.attr("x",e).attr("y",a).text(d)}}),d3.event.on("end",function(){var t=no(n.node().getTotalLength()),e=n.node().getPointAtLength(t/2),a=n.node().getPointAtLength(t/2-1),o=no(t*distanceScale.value)+" "+distanceUnit.value,i=a.x>e.x?Math.atan2(a.y-e.y,a.x-e.x):Math.atan2(e.y-a.y,e.x-a.x),l=no(180*i/Math.PI,3),u="rotate("+l+" "+e.x+" "+e.y+")";r.attr("data-points",JSON.stringify(s)).attr("data-dist",t).attr("x",e.x).attr("y",e.y).attr("transform",u).text(o)})}function Re(t,e,a){var o="";if(t.length<3)return"";while(t.length>2){var n=[],i=t[0].start,r=t[0].end;t.shift();var s=i.split(" ");n.push({scX:+s[0],scY:+s[1]}),s=r.split(" "),n.push({scX:+s[0],scY:+s[1]});for(var l=+s[0],u=+s[1],c=0;r!==i&&c<1e5;c++){for(var d=null,p=null,h=0;h<t.length;h++){var v=t[h];if(v.start==r||v.end==r){d=v,r=d.start==r?d.end:d.start,p=h;break}}if(!d)return console.error("Next edge is not found"),"";if(s=r.split(" "),e||a){var g=Math.hypot(+s[0]-l,+s[1]-u);g>=e&&Math.random()>a&&(n.push({scX:+s[0],scY:+s[1]}),l=+s[0],u=+s[1])}else n.push({scX:+s[0],scY:+s[1]});if(t.splice(p,1),99999===c){console.error("Line not ended, limit reached");break}}o+=kt(n)}return io(o,1)}function Pe(){console.time("elevateLakes");var t=$.grep(Q,function(t,e){return K[e]<20&&!nt[t.fn].border});t.sort(function(t,e){return K[e.index]-K[t.index]});for(var e=function(e){var a=[],o=t[e].index;Q[o].height=K[o],t[e].neighbors.forEach(function(t){var e=Q[t].height||K[t];e>=20&&a.push(e)}),a.length&&(Q[o].height=d3.min(a)-1),Q[o].height<20&&(Q[o].height=20),t[e].lake=1},a=0;a<t.length;a++)e(a);console.timeEnd("elevateLakes")}function He(){console.time("resolveDepressionsPrimary"),tt=$.grep(Q,function(t,e){return t.height||(t.height=K[e]),t.height>=20}),tt.sort(function(t,e){return e.height-t.height});for(var t=10,e=0,a=1;a>0&&e<t;e++){a=0;for(var o=0;o<tt.length;o++){var n=tt[o].index;if("border"!==tt[o].type){var i=tt[o].neighbors.map(function(t){return Q[t].height}),r=d3.min(i);Q[n].height<=r&&(a++,tt[o].pit=tt[o].pit?tt[o].pit+1:1,Q[n].height=r+2)}}0===e&&console.log(" depressions init: "+a)}console.timeEnd("resolveDepressionsPrimary")}function Oe(){console.time("resolveDepressionsSecondary"),tt=$.grep(Q,function(t){return t.height>=20}),tt.sort(function(t,e){return e.height-t.height});for(var t=100,e=0,a=1;a>0&&e<t;e++){a=0;for(var o=0;o<tt.length;o++)if(99!==tt[o].ctype){var n=tt[o].neighbors.map(function(t){return Q[t].height}),i=d3.min(n);tt[o].height<=i&&(a++,tt[o].pit=tt[o].pit?tt[o].pit+1:1,tt[o].height=Math.trunc(i+2))}0===e&&console.log(" depressions reGraphed: "+a),e===t-1&&console.error("Error: resolveDepressions iteration limit")}console.timeEnd("resolveDepressionsSecondary")}function Ne(){tt.forEach(function(t){t.pit&&(t.height=Math.trunc(t.height-2*t.pit),t.height<20&&(t.height=20))})}function Ge(){console.time("flux"),et=[];var t=0;tt.sort(function(t,e){return e.height-t.height});for(var e=function(e){var a=tt[e].index,o=tt[e].data[0],n=tt[e].data[1],i=tt[e].fn;if(99===tt[e].ctype){if(void 0!==tt[e].river){var r,s,l=Math.min(n,St-n,o,Ct-o);l===n&&(r=o,s=0),l===St-n&&(r=o,s=St),l===o&&(r=0,s=n),l===Ct-o&&(r=Ct,s=n),et.push({river:tt[e].river,cell:a,x:r,y:s})}return"continue"}void 0!==nt[i].river&&tt[e].river!==nt[i].river&&(tt[e].river=void 0,tt[e].flux=0);var u=1e3,c=void 0;if(tt[e].neighbors.forEach(function(t){Q[t].height<u&&(u=Q[t].height,c=t)}),void 0!==c&&tt[e].flux>1)if(void 0===tt[e].river&&(tt[e].river=t,et.push({river:t,cell:a,x:o,y:n}),t+=1),void 0==Q[c].river)Q[c].river=tt[e].river;else{var d=Q[c].river,p=$.grep(et,function(t){return t.river==tt[e].river}),h=$.grep(et,function(t){return t.river==d}),v=p.length,g=h.length;v>=g&&(Q[c].river=tt[e].river,v+=1,g-=1),Q[c].height>=20&&v>1&&g>1&&(Q[c].confluence?Q[c].confluence+=g-1:Q[c].confluence=g-1)}if(Q[c].flux&&(Q[c].flux+=tt[e].flux),void 0!==tt[e].river){var m=Q[c].data[0],f=Q[c].data[1];if(Q[c].height<20){var b=(m+o)/2+(m-o)/10,y=(f+n)/2+(f-n)/10;et.push({river:tt[e].river,cell:a,x:b,y:y})}else 1===Q[c].lake&&(i=Q[c].fn,void 0===nt[i].river&&(nt[i].river=tt[e].river)),et.push({river:tt[e].river,cell:c,x:m,y:f})}},a=0;a<tt.length;a++)e(a);console.timeEnd("flux"),Fe(t)}function Fe(t){console.time("drawRiverLines");for(var e=function(t){var e=$.grep(et,function(e){return e.river===t});if(e.length>1){var a=_e(e,1),o=no(.8+.4*Math.random(),1),n=no(.8+.4*Math.random(),1),i=je(a,o,n);S.append("path").attr("d",i).attr("id","river"+t).attr("data-width",o).attr("data-increment",n)}},a=0;a<t;a++)e(a);S.selectAll("path").on("click",Ve),console.timeEnd("drawRiverLines")}function _e(t,e){for(var a=[],o=1,n=0;n<t.length;n++){var i=t[n].x,r=t[n].y,s=t[n].cell,l=Q[s].confluence||0;if(a.push([i,r,l]),n+1<t.length){var u=t[n+1].x,c=t[n+1].y,d=Math.atan2(c-r,u-i),p=1/(n+1),h=p+.3+.3*Math.random()*e;Math.random()>.5&&(o*=-1);var v=Math.hypot(u-i,c-r);if(v>8||v>4&&t.length<6){var g=(2*i+u)/3,m=(2*r+c)/3,f=(i+2*u)/3,b=(r+2*c)/3;g+=-Math.sin(d)*h*o,m+=Math.cos(d)*h*o,Math.random()>.8&&(o*=-1),f+=Math.sin(d)*h*o,b+=-Math.cos(d)*h*o,a.push([g,m],[f,b])}else if(v>4||t.length<6){var y=(i+u)/2,k=(r+c)/2;y+=-Math.sin(d)*h*o,k+=Math.cos(d)*h*o,a.push([y,k])}}}return a}function je(t,e,a){kt.curve(d3.curveCatmullRom.alpha(.1));var o=.03;e=e||1,a=a||1;var n=0;t.map(function(e,a){if(0===a)return 0;n+=Math.hypot(e[0]-t[a-1][0],e[1]-t[a-1][1])});var i,r=no((1e3+30*n)*a),s=[],l=[],u=t.length-1,c=n/t.length,d=t[0][0],p=t[0][1],h=Math.atan2(p-t[1][1],d-t[1][0]),v=d+-Math.sin(h)*o,g=p+Math.cos(h)*o;s.push({scX:v,scY:g});var m=d+Math.sin(h)*o,f=p+-Math.cos(h)*o;l.unshift({scX:m,scY:f});for(var b=1;b<u;b++){d=t[b][0],p=t[b][1],i=t[b][2],i&&(o+=Math.atan(10*i/r));var y=t[b-1][0],k=t[b-1][1],C=t[b+1][0],S=t[b+1][1];h=Math.atan2(k-S,y-C);var w=Math.atan(Math.pow(b*c,2)/r)/2*e+o;v=d+-Math.sin(h)*w,g=p+Math.cos(h)*w,s.push({scX:v,scY:g}),m=d+Math.sin(h)*w,f=p+-Math.cos(h)*w,l.unshift({scX:m,scY:f})}d=t[u][0],p=t[u][1],i=t[u][2],i&&(o+=Math.atan(10*i/r)),h=Math.atan2(t[u-1][1]-p,t[u-1][0]-d),v=d+-Math.sin(h)*w,g=p+Math.cos(h)*w,s.push({scX:v,scY:g}),m=d+Math.sin(h)*w,f=p+-Math.cos(h)*w,l.unshift({scX:m,scY:f});var M=kt(l),x=kt(s);return x=x.substring(x.indexOf("C")),io(M+x,2)}function Ke(t,e,a){kt.curve(d3.curveCatmullRom.alpha(.1)),e=e||1;var o=.02*e;a=a||1;for(var n=t.map(function(t){return{scX:t[0],scY:t[1]}}),i=p.append("path").attr("d",kt(n)),r=i.node().getTotalLength(),s=no((1e3+30*r)*a),l=[],u=[],c=0;c<r;c++){var d=i.node().getPointAtLength(c),h=i.node().getPointAtLength(c-.1),v=i.node().getPointAtLength(c+.1),g=Math.atan2(h.y-v.y,h.x-v.x),m=Math.atan(Math.pow(c,2)/s)/2*e+o,f=d.x+-Math.sin(g)*m,b=d.y+Math.cos(g)*m;l.push({scX:f,scY:b});var y=d.x+Math.sin(g)*m,k=d.y+-Math.cos(g)*m;u.unshift({scX:y,scY:k})}d=i.node().getPointAtLength(r),h=i.node().getPointAtLength(r-.1),g=Math.atan2(h.y-d.y,h.x-d.x),m=Math.atan(Math.pow(r,2)/s)/2*e+o,f=d.x+-Math.sin(g)*m,b=d.y+Math.cos(g)*m;l.push({scX:f,scY:b});y=d.x+Math.sin(g)*m,k=d.y+-Math.cos(g)*m;u.unshift({scX:y,scY:k}),i.remove();var C=kt(u),S=kt(l);return S=S.substring(S.indexOf("C")),io(C+S,2)}function De(){console.time("addLakes");for(var t=0,e=0;e<tt.length;e++)1===tt[e].lake&&(tt[e].height=19,tt[e].ctype=-1),2===tt[e].lake&&t<100&&(void 0!==tt[e].river?(tt[e].height=19,tt[e].ctype=-1,tt[e].fn=-1,t++):(tt[e].lake=void 0,tt[e].neighbors.forEach(function(e){1!==Q[e].lake&&void 0!==Q[e].river?(Q[e].lake=2,Q[e].height=19,Q[e].ctype=-1,Q[e].fn=-1,t++):2===Q[e].lake&&(Q[e].lake=void 0)})));console.log("small lakes: "+t);var a=$.grep(tt,function(t){return-1===t.fn}),o=function(){var t=-1,e=[a[0].index],o=[];a[0].session="addLakes";while(e.length){var n=e.pop();o.push(n),-1!==Q[n].fn&&(t=Q[n].fn),Q[n].neighbors.forEach(function(t){Q[t].lake&&"addLakes"!==Q[t].session&&(Q[t].session="addLakes",e.push(t))})}-1===t&&(t=nt.length,nt.push({i:t,land:!1,border:!1})),o.forEach(function(e){Q[e].fn=t}),a=$.grep(tt,function(t){return-1===t.fn})};while(a.length)o();tt=$.grep(Q,function(t){return t.height>=20}),console.timeEnd("addLakes")}function Ue(){if(!J){Ze(),Fa("#labelEditor, .stable"),D=d3.select(this).call(d3.drag().on("start",Ie)).classed("draggable",!0);var t=d3.select(this.parentNode);a(),labelGroupSelect.value=t.attr("id"),labelFontSelect.value=rt.indexOf(t.attr("data-font")),labelSize.value=t.attr("data-size"),labelColor.value=ao(t.attr("fill")),labelOpacity.value=t.attr("opacity"),labelText.value=D.text();var e=Qe(D.attr("transform"));labelAngle.value=e[2],labelAngleValue.innerHTML=Math.abs(+e[2])+"°",$("#labelEditor").dialog({title:"Edit Label: "+labelText.value,minHeight:30,width:"auto",maxWidth:275,resizable:!1,position:{my:"center top+10",at:"bottom",of:this},close:Ze}),W.editLabel||(W.editLabel=!0,Za(),$("#labelGroupButton").click(function(){$("#labelEditor > button").not(this).toggle(),$("#labelGroupButtons").toggle()}),document.getElementById("labelGroupSelect").addEventListener("change",function(){document.getElementById(this.value).appendChild(D.remove().node())}),document.getElementById("labelGroupNew").addEventListener("click",function(){"none"===$("#labelGroupInput").css("display")?($("#labelGroupInput").css("display","inline-block"),$("#labelGroupSelect").css("display","none"),labelGroupInput.focus()):($("#labelGroupSelect").css("display","inline-block"),$("#labelGroupInput").css("display","none"))}),document.getElementById("labelExternalFont").addEventListener("click",function(){"none"===$("#labelFontInput").css("display")?($("#labelFontInput").css("display","inline-block"),$("#labelFontSelect").css("display","none"),labelFontInput.focus()):($("#labelFontSelect").css("display","inline-block"),$("#labelFontInput").css("display","none"))}),document.getElementById("labelGroupInput").addEventListener("change",function(){if(this.value){var t=this.value.toLowerCase().replace(/ /g,"_").replace(/[^\w\s]/gi,"");Number.isFinite(+t.charAt(0))&&(t="g"+t);while(H.selectAll("#"+t).size())t+="_new";o(t)}else v("Please provide a valid group name")}),document.getElementById("labelGroupRemove").addEventListener("click",function(){var t=d3.select(D.node().parentNode),e=t.attr("id"),a=t.selectAll("text").size();if(a<2)return en(e),void $("#labelEditor").dialog("close");alertMessage.innerHTML="Are you sure you want to remove all labels ("+a+") of that group?",$("#alert").dialog({resizable:!1,title:"Remove label group",buttons:{Remove:function(){$(this).dialog("close"),en(e),$("#labelEditor").dialog("close")},Cancel:function(){$(this).dialog("close")}}})}),$("#labelTextButton").click(function(){$("#labelEditor > button").not(this).toggle(),$("#labelTextButtons").toggle()}),document.getElementById("labelText").addEventListener("input",function(){if(this.value){D.select("textPath").size()?D.select("textPath").text(this.value):D.text(this.value),$("div[aria-describedby='labelEditor'] .ui-dialog-title").text("Edit Label: "+this.value);var t=D.attr("id")||"";if(t.includes("regionLabel")){var e=+D.attr("id").slice(11);ot[e].name=this.value}}else v("Name should not be blank, set opacity to 0 to hide label or click remove button to delete")}),document.getElementById("labelTextRandom").addEventListener("click",function(){var t=D.text(),e=D.attr("id")||"";if(e.includes("regionLabel")){var a=+D.attr("id").slice(11);t=$a(a.i),ot[a].name=t}else{var o=D.node().getBBox(),n=(V.find(o.x+o.width/2,o.y+o.height/2),Math.floor(Math.random()*lt.length));t=Sa(n)}labelText.value=t,$("div[aria-describedby='labelEditor'] .ui-dialog-title").text("Edit Label: "+t),D.select("textPath").size()?D.select("textPath").text(t):D.text(t)}),$("#labelFontButton").click(function(){$("#labelEditor > button").not(this).toggle(),$("#labelFontButtons").toggle()}),document.getElementById("labelFontSelect").addEventListener("change",function(){var t=D.node().parentNode,e=rt[this.value].split(":")[0].replace(/\+/g," ");t.setAttribute("font-family",e),t.setAttribute("data-font",rt[this.value])}),document.getElementById("labelFontInput").addEventListener("change",function(){Qa(this.value).then(function(t){t&&(labelExternalFont.click(),labelFontInput.value="",1===t&&$("#labelFontSelect").val(rt.length-1).change())})}),document.getElementById("labelSize").addEventListener("input",function(){var t=D.node().parentNode,e=+this.value;t.setAttribute("data-size",e),t.setAttribute("font-size",no((e+e/bt)/2,2))}),$("#labelStyleButton").click(function(){$("#labelEditor > button").not(this).toggle(),$("#labelStyleButtons").toggle()}),document.getElementById("labelColor").addEventListener("input",function(){var t=D.node().parentNode;t.setAttribute("fill",this.value)}),document.getElementById("labelOpacity").addEventListener("input",function(){var t=D.node().parentNode;t.setAttribute("opacity",this.value)}),$("#labelAngleButton").click(function(){$("#labelEditor > button").not(this).toggle(),$("#labelAngleButtons").toggle()}),document.getElementById("labelAngle").addEventListener("input",function(){var t=Qe(D.attr("transform"));labelAngleValue.innerHTML=Math.abs(+this.value)+"°";var e=D.node().getBBox(),a=+this.value,o="translate(".concat(t[0],",").concat(t[1],") rotate(").concat(a," ").concat(e.x+e.width/2," ").concat(e.y+e.height/2,")");D.attr("transform",o)}),document.getElementById("labelCurve").addEventListener("click",function(){var t=D.node().getBBox(),e=t.x+t.width/2,a=t.y+t.height/2;if(!D.select("textPath").size()){var o=D.attr("id"),i="#textPath_"+o,r="M".concat(e-t.width,",").concat(a," q").concat(t.width,",0 ").concat(2*t.width,",0"),s=D.text(),l=D.attr("x"),u=D.attr("y");D.text(null).attr("data-x",l).attr("data-y",u).attr("x",null).attr("y",null),p.append("path").attr("id","textPath_"+o).attr("d",r),D.append("textPath").attr("href",i).attr("startOffset","50%").text(s)}j.select("circle").size()||j.append("circle").attr("id","textPathControl").attr("r",1.6).attr("cx",e).attr("cy",a).attr("transform",D.attr("transform")||null).call(d3.drag().on("start",n))}),document.getElementById("labelCurveCancel").addEventListener("click",function(){if(D.select("textPath").size()){var t=D.text(),e=D.attr("data-x"),a=D.attr("data-y");D.text(),D.attr("x",e).attr("y",a).attr("data-x",null).attr("data-y",null).text(t),p.select("#textPath_"+D.attr("id")).remove(),j.select("circle").remove()}}),document.getElementById("labelLegend").addEventListener("click",function(){var t=D.attr("id"),e=D.text();qo(t,e)}),document.getElementById("labelCopy").addEventListener("click",function(){var t=d3.select(D.node().parentNode);copy=t.append(function(t){return D.node().cloneNode(!0)});var e="label"+Date.now().toString().slice(7);copy.attr("id",e).attr("class",null).on("click",Ue);var a=+t.attr("font-size")+1;if(copy.select("textPath").size()){var o=p.select("#textPath_"+D.attr("id")).attr("d"),n=p.append("path").attr("id","textPath_"+e);copy.select("textPath").attr("href","#textPath_"+e);var i=o.split(" "),r=+i[0].split(",")[0].slice(1),s=+i[0].split(",")[1];n.attr("d","M".concat(r-a,",").concat(s-a," ").concat(i[1]," ").concat(i[2]))}else{var l=+D.attr("x")-a,u=+D.attr("y")-a;while(t.selectAll("text[x='"+l+"']").size())l-=a,u-=a;copy.attr("x",l).attr("y",u)}}),document.getElementById("labelRemoveSingle").addEventListener("click",function(){alertMessage.innerHTML="Are you sure you want to remove the label?",$("#alert").dialog({resizable:!1,title:"Remove label",buttons:{Remove:function(){$(this).dialog("close"),D.remove(),p.select("#textPath_"+D.attr("id")).remove(),$("#labelEditor").dialog("close")},Cancel:function(){$(this).dialog("close")}}})}))}function a(){labelGroupSelect.innerHTML="",H.selectAll("g:not(#burgLabels)").each(function(t){if("burgLabels"!==this.parentNode.id){var e=d3.select(this).attr("id"),a=document.createElement("option");a.value=a.innerHTML=e,labelGroupSelect.add(a)}})}function o(t){var e=D.node().parentNode.cloneNode(!1),o=H.append(function(t){return e}).attr("id",t);o.append(function(t){return D.remove().node()}),a(),$("#labelGroupSelect, #labelGroupInput").toggle(),labelGroupInput.value="",labelGroupSelect.value=t,cn()}function n(){var t=p.select("#textPath_"+D.attr("id")),e=t.attr("d").split(" "),a=e[0].split(","),o=e[1].split(","),n=d3.event.y;d3.event.on("drag",function(){var i=d3.event.y-n,r=+o[1]+8*i;d3.select(this).attr("cy",d3.event.y),t.attr("d","".concat(a[0],",").concat(+a[1]-i," ").concat(o[0],",").concat(r," ").concat(e[2]))})}}function Ve(){if(!J){if(D){var t=d3.select(this).attr("id")===D.attr("id"),e=d3.mouse(this);if("new"===D.attr("data-river"))return r([e[0],e[1]]),void d();if(t)return void o(e)}Ze(),Fa("#riverEditor, .stable"),D=d3.select(this),D.call(d3.drag().on("start",l));var a=Qe(D.attr("transform"));riverAngle.value=a[2],riverAngleValue.innerHTML=Math.abs(+a[2])+"°",riverScale.value=a[5],riverWidthInput.value=+D.attr("data-width"),riverIncrement.value=+D.attr("data-increment"),$("#riverEditor").dialog({title:"Edit River",minHeight:30,width:"auto",resizable:!1,position:{my:"center top+20",at:"top",of:d3.event},close:function(){$("#riverNew").hasClass("pressed")&&d(),Ze()}}),j.select(".controlPoints").size()||j.append("g").attr("class","controlPoints"),n(),W.editRiver||(W.editRiver=!0,$("#riverWidthInput, #riverIncrement").change(function(){var t=+riverWidthInput.value,e=+riverIncrement.value;D.attr("data-width",t).attr("data-increment",e),u()}),$("#riverRegenerate").click(function(){var t,e,a,o,n=[],i=[],s=D.node(),l=s.getTotalLength()/2,u=l/8>>0,c=l/u;c===1/0&&(c=l);for(var d=l,p=l;d>0;d-=c,p+=c)a=s.getPointAtLength(d),o=s.getPointAtLength(p),t=(a.x+o.x)/2,e=(a.y+o.y)/2,n.push([t,e]);a=s.getPointAtLength(0),o=s.getPointAtLength(2*l),t=(a.x+o.x)/2,e=(a.y+o.y)/2,n.push([t,e]);for(var h=.3+1.4*Math.random(),v=0;v<n.length;v++)if(t=n[v][0],e=n[v][1],i.push([t,e]),v+1<n.length){var g=n[v+1][0],m=n[v+1][1],f=Math.random()>.5?1:-1,b=Math.atan2(m-e,g-t),y=2/(v+1),k=y+.3+Math.random()*h;t=(t+g)/2,e=(e+m)/2,t+=-Math.sin(b)*k*f,e+=Math.cos(b)*k*f,i.push([t,e])}var C=.6*+riverWidthInput.value+Math.random(),S=.9*+riverIncrement.value+.2*Math.random();riverWidthInput.value=C,riverIncrement.value=S,D.attr("data-width",C).attr("data-increment",S);var w=Ke(i,C,S);D.attr("d",w).attr("data-width",C).attr("data-increment",S),j.select(".controlPoints").selectAll("*").remove(),i.map(function(t){r(t)})}),$("#riverAngle").on("input",function(){var t=Qe(D.attr("transform"));riverAngleValue.innerHTML=Math.abs(+this.value)+"°";var e=D.node().getBBox(),a=+this.value,o=+t[5],n="translate(".concat(t[0],",").concat(t[1],") rotate(").concat(a," ").concat((e.x+e.width/2)*o," ").concat((e.y+e.height/2)*o,") scale(").concat(o,")");D.attr("transform",n),j.select(".controlPoints").attr("transform",n)}),$("#riverReset").click(function(){D.attr("transform",""),j.select(".controlPoints").attr("transform",""),riverAngle.value=0,riverAngleValue.innerHTML="0°",riverScale.value=1}),$("#riverScale").change(function(){var t=Qe(D.attr("transform")),e=+t[5],a=+this.value,o=D.node().getBBox(),n=o.x+o.width/2,i=o.y+o.height/2,r=+t[0]+n*(e-a),s=+t[1]+i*(e-a),l=+t[3]*a/e,u=+t[4]*a/e,c="translate(".concat(r,",").concat(s,") rotate(").concat(t[2]," ").concat(l," ").concat(u,") scale(").concat(a,")");D.attr("transform",c),j.select(".controlPoints").attr("transform",c)}),$("#riverNew").click(function(){$(this).hasClass("pressed")?d():($(".pressed").removeClass("pressed"),$(this).addClass("pressed"),D&&D.call(d3.drag().on("drag",null)),j.select(".controlPoints").selectAll("*").remove(),h.style("cursor","crosshair").on("click",c))}),$("#riverCopy").click(function(){var t=Qe(D.attr("transform")),e=D.attr("d"),a=2,o=2,n="translate(".concat(t[0]-a,",").concat(t[1]-o,") rotate(").concat(t[2]," ").concat(t[3]," ").concat(t[4],") scale(").concat(t[5],")");while(S.selectAll("[transform='"+n+"'][d='"+e+"']").size()>0)a+=2,o+=2,n="translate(".concat(t[0]-a,",").concat(t[1]-o,") rotate(").concat(t[2]," ").concat(t[3]," ").concat(t[4],") scale(").concat(t[5],")");var i=+$("#rivers > path").last().attr("id").slice(5)+1;S.append("path").attr("d",e).attr("transform",n).attr("id","river"+i).on("click",Ve).attr("data-width",D.attr("data-width")).attr("data-increment",D.attr("data-increment")),Ze()}),document.getElementById("riverLegend").addEventListener("click",function(){var t=D.attr("id");qo(t,t)}),$("#riverRemove").click(function(){alertMessage.innerHTML="Are you sure you want to remove the river?",$("#alert").dialog({resizable:!1,title:"Remove river",buttons:{Remove:function(){$(this).dialog("close");var t=+D.attr("id").slice(5),e=no(precInput.value/Math.sqrt(Q.length),2);tt.map(function(a){a.river===t&&(a.river=void 0,a.flux=e)}),D.remove(),Ze(),$("#riverEditor").dialog("close")},Cancel:function(){$(this).dialog("close")}}})}))}function o(t){var e=[];j.select(".controlPoints").selectAll("circle").each(function(){var a=+d3.select(this).attr("cx"),o=+d3.select(this).attr("cy");e.push(Math.hypot(t[0]-a,t[1]-o))});var a=e.length;if(e.length>1){var o=e.slice(0).sort(function(t,e){return t-e}),n=e.indexOf(o[0]),i=e.indexOf(o[1]);a=n<=i?n+1:i+1}var r=":nth-child("+(a+1)+")";j.select(".controlPoints").insert("circle",r).attr("cx",t[0]).attr("cy",t[1]).attr("r",.35).call(d3.drag().on("drag",s)).on("click",function(t){$(this).remove(),u()}),u()}function n(){var t=D.node(),e=t.getTotalLength()/2,a=e/5>>0,o=e/a;o===1/0&&(o=e);for(var n=e,i=e;n>0;n-=o,i+=o){var s=t.getPointAtLength(n),l=t.getPointAtLength(i),u=[(s.x+l.x)/2,(s.y+l.y)/2];r(u)}var c=t.getPointAtLength(0),d=t.getPointAtLength(2*e),p=[(c.x+d.x)/2,(c.y+d.y)/2];r(p)}function r(t){j.select(".controlPoints").append("circle").attr("cx",t[0]).attr("cy",t[1]).attr("r",.35).call(d3.drag().on("drag",s)).on("click",function(t){$(this).remove(),u()})}function s(){d3.select(this).attr("cx",d3.event.x).attr("cy",d3.event.y),u()}function l(){var t=d3.event.x,e=d3.event.y,a=Qe(D.attr("transform"));d3.event.on("drag",function(){var o=d3.event.x,n=d3.event.y,i="translate(".concat(+a[0]+o-t,",").concat(+a[1]+n-e,") rotate(").concat(a[2]," ").concat(a[3]," ").concat(a[4],") scale(").concat(a[5],")");D.attr("transform",i),j.select(".controlPoints").attr("transform",i)})}function u(){var t=[];j.select(".controlPoints").selectAll("circle").each(function(){var e=d3.select(this);t.push([+e.attr("cx"),+e.attr("cy")])});var e=+riverWidthInput.value,a=+riverIncrement.value,o=Ke(t,e,a);D.attr("d",o)}function c(){var t=d3.mouse(this);if(r([t[0],t[1]]),D&&"new"===D.attr("data-river")){u();var e=i.find(t[0],t[1]).index,a=Q[e].fn,o=!nt[a].land&&nt[a].border;o&&j.select(".controlPoints").selectAll("circle").size()>5&&d()}else{var n=+$("#rivers > path").last().attr("id").slice(5)+1;D=S.append("path").attr("data-river","new").attr("id","river"+n).attr("data-width",2).attr("data-increment",1).on("click",d)}}function d(){if($("#riverNew").removeClass("pressed"),Vt(),D&&"new"===D.attr("data-river")){u(),D.attr("data-river",""),D.call(d3.drag().on("start",l)).on("click",Ve);var t=+D.attr("id").slice(5);j.select(".controlPoints").selectAll("circle").each(function(){var e=+d3.select(this).attr("cx"),a=+d3.select(this).attr("cy"),o=i.find(e,a,3);o&&void 0===Q[o.index].river&&(Q[o.index].river=t)}),Ze(),j.append("g").attr("class","controlPoints")}}}function Ye(){if(!J){if(D){var t=d3.select(this).attr("id")===D.attr("id"),e=d3.mouse(this);if("new"===D.attr("data-route"))return r({x:e[0],y:e[1]}),void p();if(t)return void o(e)}if(Ze(),Fa("#routeEditor, .stable"),this&&this!==window){D=d3.select(this),j.select(".controlPoints").size()||j.append("g").attr("class","controlPoints"),n(),g();var a=d3.select(this.parentNode).attr("id");routeGroup.value=a,$("#routeEditor").dialog({title:"Edit Route",minHeight:30,width:"auto",resizable:!1,position:{my:"center top+20",at:"top",of:d3.event},close:function(){$("#addRoute").hasClass("pressed")&&p(),$("#routeSplit").hasClass("pressed")&&$("#routeSplit").removeClass("pressed"),Ze()}})}else D=null;W.editRoute||(W.editRoute=!0,$("#routeGroup").change(function(){$(D.node()).detach().appendTo($("#"+this.value))}),document.getElementById("routeLegend").addEventListener("click",function(){var t=D.attr("id");qo(t,t)}),$("#routeNew").click(function(){$(this).hasClass("pressed")?p():($(".pressed").removeClass("pressed"),$("#routeNew, #addRoute").addClass("pressed"),j.select(".controlPoints").selectAll("*").remove(),u(),h.style("cursor","crosshair").on("click",d),v("Click on map to add route point",!0))}),$("#routeRemove").click(function(){alertMessage.innerHTML="Are you sure you want to remove the route?",$("#alert").dialog({resizable:!1,title:"Remove route",buttons:{Remove:function(){$(this).dialog("close"),D.remove(),$("#routeEditor").dialog("close")},Cancel:function(){$(this).dialog("close")}}})}))}function o(t){var e=[];j.select(".controlPoints").selectAll("circle").each(function(){var a=+d3.select(this).attr("cx"),o=+d3.select(this).attr("cy");e.push(Math.hypot(t[0]-a,t[1]-o))});var a=e.length;if(e.length>1){var o=e.slice(0).sort(function(t,e){return t-e}),n=e.indexOf(o[0]),i=e.indexOf(o[1]);a=n<=i?n+1:i+1}var r=":nth-child("+(a+1)+")";j.select(".controlPoints").insert("circle",r).attr("cx",t[0]).attr("cy",t[1]).attr("r",.35).call(d3.drag().on("drag",s)).on("click",function(t){$(this).remove(),l()}),l()}function n(){if(D.size()){var t=D.node(),e=t.getTotalLength(),a=e/5>>0,o=e/a;o===1/0&&(o=e);for(var n=0;n<=e;n+=o){var i=t.getPointAtLength(n);r(i)}routeLength.innerHTML=no(e*distanceScale.value)+" "+distanceUnit.value}}function r(t){var e=j.select(".controlPoints").size()?j.select(".controlPoints"):j.append("g").attr("class","controlPoints");e.append("circle").attr("cx",t.x).attr("cy",t.y).attr("r",.35).call(d3.drag().on("drag",s)).on("click",function(t){$("#routeSplit").hasClass("pressed")?m(this):($(this).remove(),l())})}function s(){d3.select(this).attr("cx",d3.event.x).attr("cy",d3.event.y),l()}function l(){var t=[];j.select(".controlPoints").selectAll("circle").each(function(){var e=d3.select(this);t.push({scX:+e.attr("cx"),scY:+e.attr("cy")})}),kt.curve(d3.curveCatmullRom.alpha(.1)),D.attr("d",kt(t));var e=D.node().getTotalLength();routeLength.innerHTML=no(e*distanceScale.value)+" "+distanceUnit.value}function u(){var t=D&&D.node()?D.node().parentNode.id:"searoutes",e=z.select("#"+t),a=t+""+e.selectAll("*").size();D=e.append("path").attr("data-route","new").attr("id",a).on("click",Ye),g(),$("#routeEditor").dialog({title:"Edit Route",minHeight:30,width:"auto",resizable:!1,close:function(){$("#addRoute").hasClass("pressed")&&p(),$("#routeSplit").hasClass("pressed")&&$("#routeSplit").removeClass("pressed"),Ze()}})}function d(){var t=d3.mouse(this),e=no(t[0],2),a=no(t[1],2);r({x:e,y:a}),l()}function p(){if($("#routeNew, #addRoute").removeClass("pressed"),Vt(),D.size()){if("new"===D.attr("data-route")){l(),D.attr("data-route","");for(var t=D.node(),e=t.getTotalLength(),a=[],o=0;o<=e;o++){var n=t.getPointAtLength(o),r=i.find(n.x,n.y);if(!r)return;a.push(r.index)}var s=Object(c["a"])(new Set(a));s.map(function(t){void 0!==Q[t].path?Q[t].path+=1:Q[t].path=1})}v("",!0)}}function g(){routeGroup.innerHTML="",z.selectAll("g").each(function(){var t=document.createElement("option");t.value=t.innerHTML=this.id,routeGroup.add(t)})}function m(t){var e=d3.select(D.node().parentNode);$("#routeSplit").removeClass("pressed");var a=[],o=[],i=a;j.select(".controlPoints").selectAll("circle").each(function(){var e=d3.select(this);i.push({scX:+e.attr("cx"),scY:+e.attr("cy")}),this===t&&(i=o,i.push({scX:+e.attr("cx"),scY:+e.attr("cy")})),e.remove()}),kt.curve(d3.curveCatmullRom.alpha(.1)),D.attr("d",kt(a));var r=routeGroup.value+""+e.selectAll("*").size();e.append("path").attr("id",r).attr("d",kt(o)).on("click",Ye),n()}}function We(){if(!J&&(!D||!this.isSameNode(D.node()))){Ze(),Fa("#iconEditor, .stable"),D=d3.select(this).call(d3.drag().on("start",Ie)).classed("draggable",!0);var t=d3.select(this.parentNode);e(),iconGroup.value=t.attr("id"),iconFillColor.value=t.attr("fill"),iconStrokeColor.value=t.attr("stroke"),iconSize.value=t.attr("size"),iconStrokeWidth.value=t.attr("stroke-width"),$("#iconEditor").dialog({title:"Edit icon: "+t.attr("id"),minHeight:30,width:"auto",resizable:!1,position:{my:"center top+20",at:"top",of:d3.event},close:Ze}),W.editIcon||(W.editIcon=!0,$("#iconGroups").click(function(){$("#iconEditor > button").not(this).toggle(),$("#iconGroupsSelection").toggle()}),$("#iconGroup").change(function(){var t=this.value,e=$("#icons > #"+t);$(D.node()).detach().appendTo(e)}),$("#iconCopy").click(function(){var t=d3.select(D.node().parentNode),e=D.node().cloneNode();e.removeAttribute("data-id");for(var a=Qe(e.getAttribute("transform")),o=10/Math.sqrt(bt),n="translate("+no(a[0]-o,1)+","+no(a[1]-o,1)+")",i=2;t.selectAll("[transform='"+n+"']").size()>0;i++)n="translate("+no(a[0]-o*i,1)+","+no(a[1]-o*i,1)+")";e.setAttribute("transform",n),t.node().insertBefore(e,null),e.addEventListener("click",We)}),$("#iconRemoveGroup").click(function(){var t=d3.select(D.node().parentNode),e=t.selectAll("*").size();if(e<2)return t.remove(),void $("#labelEditor").dialog("close");var a="Are you sure you want to remove all '"+iconGroup.value+"' icons ("+e+")?";alertMessage.innerHTML=a,$("#alert").dialog({resizable:!1,title:"Remove icon group",buttons:{Remove:function(){$(this).dialog("close"),t.remove(),$("#iconEditor").dialog("close")},Cancel:function(){$(this).dialog("close")}}})}),$("#iconColors").click(function(){$("#iconEditor > button").not(this).toggle(),$("#iconColorsSection").toggle()}),$("#iconFillColor").change(function(){var t=d3.select(D.node().parentNode);t.attr("fill",this.value)}),$("#iconStrokeColor").change(function(){var t=d3.select(D.node().parentNode);t.attr("stroke",this.value)}),$("#iconSetSize").click(function(){$("#iconEditor > button").not(this).toggle(),$("#iconSizeSection").toggle()}),$("#iconSize").change(function(){var t=d3.select(D.node().parentNode),e=+this.value;t.attr("size",e),t.selectAll("*").each(function(){d3.select(this).attr("width",e).attr("height",e)})}),$("#iconStrokeWidth").change(function(){var t=d3.select(D.node().parentNode);t.attr("stroke-width",this.value)}),$("#iconRemove").click(function(){alertMessage.innerHTML="Are you sure you want to remove the icon?",$("#alert").dialog({resizable:!1,title:"Remove icon",buttons:{Remove:function(){$(this).dialog("close"),D.remove(),$("#iconEditor").dialog("close")},Cancel:function(){$(this).dialog("close")}}})}))}function e(){iconGroup.innerHTML="";var e=t.attr("id").includes("anchor");N.selectAll("g").each(function(t){var a=d3.select(this).attr("id");if("burgs"!==a&&(e||!a.includes("anchor"))&&(!e||a.includes("anchor"))){var o=document.createElement("option");o.value=o.innerHTML=a,iconGroup.add(o)}})}}function Je(){if(!J&&(!D||!this.isSameNode(D.node()))){Ze(),Fa("#reliefEditor, .stable"),D=d3.select(this).raise().call(d3.drag().on("start",Ie)).classed("draggable",!0);var t=D.node().parentNode.id;reliefGroup.value=t;var e=document.getElementById("reliefBulkRemoveSection");"none"!=e.style.display&&reliefBulkRemove.click(),$("#reliefEditor").dialog({title:"Edit relief icon",minHeight:30,width:"auto",resizable:!1,position:{my:"center top+40",at:"top",of:d3.event},close:Ze}),W.editReliefIcon||(W.editReliefIcon=!0,$("#reliefGroups").click(function(){$("#reliefEditor > button").not(this).toggle(),$("#reliefGroupsSelection").toggle()}),$("#reliefGroup").change(function(){var t=this.value,e=D.node().getBBox(),a=e.x,o=e.y+e.height/2,n=i.find(a,o).index,r=void 0!==n?Q[n].height:50;D.remove(),D=Da(r/100,t,a,o,n),D.call(d3.drag().on("start",Ie))}),$("#reliefCopy").click(function(){for(var t=d3.select(D.node().parentNode),e=D.node().cloneNode(!0),a=Qe(e.getAttribute("transform")),o=10/Math.sqrt(bt),n="translate("+no(a[0]-o,1)+","+no(a[1]-o,1)+")",i=2;t.selectAll("[transform='"+n+"']").size()>0;i++)n="translate("+no(a[0]-o*i,1)+","+no(a[1]-o*i,1)+")";e.setAttribute("transform",n),t.node().insertBefore(e,null),e.addEventListener("click",Je)}),$("#reliefAddfromEditor").click(function(){Wa(),$("#addRelief").click()}),$("#reliefRemoveGroup").click(function(){var t=d3.select(D.node().parentNode),e=t.selectAll("*").size();if(e<2)return t.selectAll("*").remove(),void $("#labelEditor").dialog("close");var a="Are you sure you want to remove all '"+reliefGroup.value+"' icons ("+e+")?";alertMessage.innerHTML=a,$("#alert").dialog({resizable:!1,title:"Remove all icons within group",buttons:{Remove:function(){$(this).dialog("close"),t.selectAll("*").remove(),$("#reliefEditor").dialog("close")},Cancel:function(){$(this).dialog("close")}}})}),$("#reliefBulkRemove").click(function(){$("#reliefEditor > button").not(this).toggle();var t=document.getElementById("reliefBulkRemoveSection");"none"===t.style.display?(t.style.display="inline-block",v("Drag to remove relief icons in radius",!0),h.style("cursor","crosshair").call(d3.drag().on("drag",a)),J=5):(t.style.display="none",Vt(),J=0)}),$("#reliefRemove").click(function(){alertMessage.innerHTML="Are you sure you want to remove the icon?",$("#alert").dialog({resizable:!1,title:"Remove relief icon",buttons:{Remove:function(){$(this).dialog("close"),D.remove(),$("#reliefEditor").dialog("close")},Cancel:function(){$(this).dialog("close")}}})}))}function a(){var t=d3.mouse(this),e=i.find(t[0],t[1]).index,a=+reliefBulkRemoveRadius.value,n=no(6/U*a,1);Dt(t[0],t[1],n);var r=Wt(e,a);r&&o(r)}function o(t){0!==t.length&&t.map(function(t){var e=w.selectAll("g").selectAll("g[data-cell='"+t+"']");e.remove()})}}function qe(){if(!J){Ze(),Fa("#burgEditor, .stable"),D=d3.select(this);var t=+D.attr("data-id");if(void 0!==t){d3.selectAll("[data-id='"+t+"']").call(d3.drag().on("start",Ie)).classed("draggable",!0);var e=D.node().parentNode.id,o=O.select("#"+e),n=G.select("#"+e);burgNameInput.value=at[t].name,l(),burgSelectGroup.value=o.attr("id"),burgSelectDefaultFont.value=rt.indexOf(o.attr("data-font")),burgSetLabelSize.value=o.attr("data-size"),burgLabelColorInput.value=ao(o.attr("fill")),burgLabelOpacity.value=void 0===o.attr("opacity")?1:+o.attr("opacity");var i=Qe(D.attr("transform"));burgLabelAngle.value=i[2],burgLabelAngleOutput.innerHTML=Math.abs(+i[2])+"°",burgIconSize.value=n.attr("size"),burgIconFillOpacity.value=void 0===n.attr("fill-opacity")?1:+n.attr("fill-opacity"),burgIconFillColor.value=n.attr("fill"),burgIconStrokeWidth.value=n.attr("stroke-width"),burgIconStrokeOpacity.value=void 0===n.attr("stroke-opacity")?1:+n.attr("stroke-opacity"),burgIconStrokeColor.value=n.attr("stroke");var r=Q[at[t].cell];if("neutral"!==r.region&&void 0!==r.region){burgToggleCapital.disabled=!1;var s=ot[at[t].region]&&t===ot[at[t].region].capital?1:0;d3.select("#burgToggleCapital").classed("pressed",s)}else burgToggleCapital.disabled=!0,d3.select("#burgToggleCapital").classed("pressed",!1);d3.select("#burgTogglePort").classed("pressed",void 0!==r.port),burgPopulation.value=at[t].population,burgPopulationFriendly.value=no(at[t].population*urbanization.value*populationRate.value*1e3),$("#burgEditor").dialog({title:"Edit Burg: "+at[t].name,minHeight:30,width:"auto",resizable:!1,position:{my:"center top+40",at:"top",of:d3.event},close:function(){d3.selectAll("[data-id='"+t+"']").call(d3.drag().on("drag",null)).classed("draggable",!1),D=null}}),W.editBurg||(W.editBurg=!0,Za(),$("#burgEditor > button").not("#burgAddfromEditor").not("#burgRelocate").not("#burgRemove").click(function(){$(this).next().is(":visible")?($("#burgEditor > button").show(),$(this).next("div").hide()):($("#burgEditor > *").not(this).hide(),$(this).next("div").show())}),$("#burgEditor > div > button").click(function(){$(this).next().is(":visible")?($("#burgEditor > div > button").show(),$(this).parent().prev().show(),$(this).next("div").hide()):($("#burgEditor > div > button").not(this).hide(),$(this).parent().prev().hide(),$(this).next("div").show())}),$("#burgSelectGroup").change(function(){var t=+D.attr("data-id"),e=this.value;ta(t,e)}),$("#burgInputGroup").change(function(){var t=this.value.toLowerCase().replace(/ /g,"_").replace(/[^\w\s]/gi,"");if(Number.isFinite(+t.charAt(0))&&(t="g"+t),O.select("#"+t).size())v('The group "'+t+'" is already exists');else{burgInputGroup.value="";var e=D.node().parentNode.id,a=O.select("#"+e).node().cloneNode(!1);a.id=t;var o=G.select("#"+e).node().cloneNode(!1);o.id=t,O.node().insertBefore(a,null),G.node().insertBefore(o,null);var n=document.createElement("option");n.value=n.innerHTML=t,burgSelectGroup.add(n),$("#burgSelectGroup").val(t).change(),$("#burgSelectGroup, #burgInputGroup").toggle(),cn()}}),$("#burgAddGroup").click(function(){"none"===$("#burgInputGroup").css("display")?($("#burgInputGroup").css("display","inline-block"),$("#burgSelectGroup").css("display","none"),burgInputGroup.focus()):($("#burgSelectGroup").css("display","inline-block"),$("#burgInputGroup").css("display","none"))}),$("#burgRemoveGroup").click(function(){var t=d3.select(D.node().parentNode),e=t.attr("id"),a=+D.attr("data-id"),o=t.selectAll("*").size(),n="Are you sure you want to remove all Burgs ("+o+") of that group?";alertMessage.innerHTML=n,$("#alert").dialog({resizable:!1,title:"Remove Burgs",buttons:{Remove:function(){$(this).dialog("close"),t.selectAll("*").each(function(t){var e=+d3.select(this).attr("data-id");if(void 0!==e){var a=at[e].cell,o=at[e].region;ot[o]&&(ot[o].capital===e&&(ot[o].capital="select"),ot[o].burgs--),at[e].region="removed",Q[a].manor=void 0}}),O.select("#"+e).selectAll("*").remove(),G.select("#"+e).selectAll("*").remove(),$("#icons g[id*='anchors'] [data-id="+a+"]").parent().children().remove(),Fa(".stable"),Qo(),$("#burgEditor").dialog("close")},Cancel:function(){$(this).dialog("close")}}})}),$("#burgNameInput").on("input",function(){if(""!==this.value){var t=+D.attr("data-id");O.selectAll("[data-id='"+t+"']").text(this.value),at[t].name=this.value,$("div[aria-describedby='burgEditor'] .ui-dialog-title").text("Edit Burg: "+this.value)}else v("Name should not be blank, set opacity to 0 to hide label or remove button to delete")}),$("#burgNameReCulture, #burgNameReRandom").click(function(){var t=+D.attr("data-id"),e="burgNameReCulture"===this.id?at[t].culture:Math.floor(Math.random()*lt.length),a=Sa(e);O.selectAll("[data-id='"+t+"']").text(a),at[t].name=a,burgNameInput.value=a,$("div[aria-describedby='burgEditor'] .ui-dialog-title").text("Edit Burg: "+a)}),$("#burgToggleExternalFont").click(function(){"none"===$("#burgInputExternalFont").css("display")?($("#burgInputExternalFont").css("display","inline-block"),$("#burgSelectDefaultFont").css("display","none"),burgInputExternalFont.focus()):($("#burgSelectDefaultFont").css("display","inline-block"),$("#burgInputExternalFont").css("display","none"))}),$("#burgSelectDefaultFont").change(function(){var t=D.node().parentNode.id,e=O.select("#"+t);if(""!==burgSelectDefaultFont.value){var a=rt[burgSelectDefaultFont.value].split(":")[0].replace(/\+/g," ");e.attr("font-family",a).attr("data-font",rt[burgSelectDefaultFont.value])}}),$("#burgInputExternalFont").change(function(){Qa(this.value).then(function(t){t&&(burgToggleExternalFont.click(),burgInputExternalFont.value="",1===t&&$("#burgSelectDefaultFont").val(rt.length-1).change())})}),$("#burgSetLabelSize").on("input",function(){var t=D.node().parentNode.id,e=O.select("#"+t);e.attr("data-size",+this.value),Et()}),$("#burgLabelColorInput").on("input",function(){var t=D.node().parentNode.id,e=O.select("#"+t);e.attr("fill",this.value)}),$("#burgLabelOpacity").on("input",function(){var t=D.node().parentNode.id,e=O.select("#"+t);e.attr("opacity",+this.value)}),$("#burgLabelAngle").on("input",function(){var t=+D.attr("data-id"),e=O.select("[data-id='"+t+"']"),a=Qe(e.attr("transform")),o=e.node().getBBox();burgLabelAngleOutput.innerHTML=Math.abs(+this.value)+"°";var n=+this.value,i="translate(".concat(a[0],",").concat(a[1],") rotate(").concat(n," ").concat(o.x+o.width/2," ").concat(o.y+o.height/2,")");e.attr("transform",i)}),$("#burgIconSize").on("input",function(){var t=D.node().parentNode.id,e=G.select("#"+t),a=+this.value;e.attr("size",a),e.selectAll("*").each(function(){d3.select(this).attr("r",a)})}),$("#burgIconFillOpacity").on("input",function(){var t=D.node().parentNode.id,e=G.select("#"+t);e.attr("fill-opacity",+this.value)}),$("#burgIconFillColor").on("input",function(){var t=D.node().parentNode.id,e=G.select("#"+t);e.attr("fill",this.value)}),$("#burgIconStrokeWidth").on("input",function(){var t=D.node().parentNode.id,e=G.select("#"+t);e.attr("stroke-width",+this.value)}),$("#burgIconStrokeOpacity").on("input",function(){var t=D.node().parentNode.id,e=G.select("#"+t);e.attr("stroke-opacity",+this.value)}),$("#burgIconStrokeColor").on("input",function(){var t=D.node().parentNode.id,e=G.select("#"+t);e.attr("stroke",this.value)}),$("#burgToggleCapital").click(function(){var t=+D.attr("data-id"),e=at[t].region;if(void 0!==ot[e]){var a=ot[at[t].region]&&t===ot[at[t].region].capital?0:1;if(a&&"select"!==ot[e].capital){var o=ot[e].capital;ta(o,"towns")}ot[e].capital=a?t:"select",d3.select("#burgToggleCapital").classed("pressed",a);var n=a?"capitals":"towns";ta(t,n)}}),$("#burgTogglePort").click(function(){var t=+D.attr("data-id"),e=Q[at[t].cell],a=void 0===e.port||void 0;if(e.port=a,d3.select("#burgTogglePort").classed("pressed",a),a){var o=D.node().parentNode.id,n="capitals"===o?"#capital-anchors":"#town-anchors",i=N.select(n),r=+i.attr("size"),s=no(at[t].x-.47*r,2),l=no(at[t].y-.47*r,2);i.append("use").attr("xlink:href","#icon-anchor").attr("data-id",t).attr("x",s).attr("y",l).attr("width",r).attr("height",r).on("click",We)}else $("#icons g[id*='anchors'] [data-id="+t+"]").remove()}),$("#burgPopulation").on("input",function(){var t=+D.attr("data-id");burgPopulationFriendly.value=no(this.value*urbanization.value*populationRate.value*1e3),at[t].population=+this.value}),$("#burgRelocate").click(function(){if($(this).hasClass("pressed"))$(".pressed").removeClass("pressed"),Vt(),v("",!0);else{$(".pressed").removeClass("pressed");var t=D.attr("data-id");$(this).addClass("pressed").attr("data-id",t),h.style("cursor","crosshair").on("click",u),v("Click on map to relocate burg. Hold Shift for continuous move",!0)}}),document.getElementById("burglLegend").addEventListener("click",function(){var t=+D.attr("data-id"),e="burg"+t,a=at[t].name;qo(e,a)}),$("#burgSeeInMFCG").click(function(){var t=+D.attr("data-id"),e=at[t].name,o=at[t].cell,n=no(at[t].population),i=n>65?65:n<6?6:n,r=a+""+t,s=Q[o].crossroad>2?1:0,l=Q[o].river?1:0,u=void 0!==Q[o].port?1:0,c=n>40?1:Math.random()<n/100?1:0,d=c&&Math.random()<.8?1:0,p="http://fantasycities.watabou.ru/",h="?name=".concat(e,"&size=").concat(i,"&seed=").concat(r,"&hub=").concat(s,"&random=0&continuous=0");h+="&river=".concat(l,"&coast=").concat(u,"&citadel=").concat(1&t,"&plaza=").concat(c,"&temple=").concat(d,"&walls=").concat(c,"&shantytown=").concat(c);var v=window.open(p+h,"_blank");v.focus()}),$("#burgAddfromEditor").click(function(){Wa(),$("#addBurg").click()}),$("#burgRemove").click(function(){alertMessage.innerHTML="Are you sure you want to remove the Burg?",$("#alert").dialog({resizable:!1,title:"Remove Burg",buttons:{Remove:function(){$(this).dialog("close");var t=+D.attr("data-id");d3.selectAll("[data-id='"+t+"']").remove();var e=at[t].cell,a=at[t].region;ot[a]&&(ot[a].capital===t&&(ot[a].capital="select"),ot[a].burgs--),at[t].region="removed",Q[e].manor=void 0,Fa(".stable"),Qo()},Cancel:function(){$(this).dialog("close")}}})}))}}function l(){burgSelectGroup.innerHTML="",G.selectAll("g").each(function(t){var e=document.createElement("option");e.value=e.innerHTML=d3.select(this).attr("id"),burgSelectGroup.add(e)})}function u(){var t=d3.mouse(this),e=Ja(t),a=+$("#burgRelocate").attr("data-id");if(!isNaN(a)&&at[a])if(Q[e].height<20)v("Cannot place burg in the water! Select a land cell",null,"error");else{if(void 0!==Q[e].manor&&Q[e].manor!==a)return v("There is already a burg in this cell. Please select a free cell",null,"error"),$("#grid").fadeIn(),void d3.select("#toggleGrid").classed("buttonoff",!1);var o=Q[e].region,n=at[a].region;if(ot[n]&&ot[n].capital===a&&o!==n)v("Capital cannot be moved to another country!",null,"error");else{!1===d3.event.shiftKey&&($("#burgRelocate").removeClass("pressed"),Vt(),v("",!0),o!==n&&(qa(n),qa(o),Qo()));var i=no(t[0],2),r=no(t[1],2);G.select("circle[data-id='"+a+"']").attr("transform",null).attr("cx",i).attr("cy",r),O.select("text[data-id='"+a+"']").attr("transform",null).attr("x",i).attr("y",r);var s=N.select("use[data-id='"+a+"']");if(s.size()){var l=s.attr("width"),u=no(i-.47*l,2),c=no(r-.47*l,2);s.attr("transform",null).attr("x",u).attr("y",c)}Q[e].manor=a,Q[at[a].cell].manor=void 0,at[a].x=i,at[a].y=r,at[a].region=o,at[a].cell=e}}}}function Xe(){if(!J){Ze(),Fa("#markerEditor, .stable"),D=d3.select(this).call(d3.drag().on("start",Ie)).classed("draggable",!0),$("#markerEditor").dialog({title:"Edit Marker",minHeight:30,width:"auto",maxWidth:275,resizable:!1,position:{my:"center top+30",at:"bottom",of:d3.event},close:Ze});var t=D.attr("href"),e=d3.select("#defs-markers").select(t),a=e.select("text");markerSelectGroup.value=t.slice(1),markerIconSize.value=parseFloat(a.attr("font-size")),markerIconShiftX.value=parseFloat(a.attr("x")),markerIconShiftY.value=parseFloat(a.attr("y")),markerIconFill.value=a.attr("fill"),markerIconStrokeWidth.value=a.attr("stroke-width"),markerIconStroke.value=a.attr("stroke"),markerSize.value=D.attr("data-size"),markerBase.value=e.select("path").attr("fill"),markerFill.value=e.select("circle").attr("fill");var o=e.select("circle").attr("opacity");markerToggleBubble.className="0"===o?"icon-info":"icon-info-circled";var n=document.getElementById("markerIconTable"),i=n.getElementsByClassName("selected");i.length&&i[0].removeAttribute("class"),i=document.querySelectorAll("#markerIcon"+a.text().codePointAt()),i.length&&(i[0].className="selected"),markerIconCustom.value=i.length?"":a.text(),W.editMarker||(W.editMarker=!0,$("#markerGroup").click(function(){$("#markerEditor > button").not(this).toggle(),$("#markerGroupSection").toggle(),r()}),document.getElementById("markerAddGroup").addEventListener("click",function(){"none"===$("#markerInputGroup").css("display")?($("#markerInputGroup").css("display","inline-block"),$("#markerSelectGroup").css("display","none"),markerInputGroup.focus()):($("#markerSelectGroup").css("display","inline-block"),$("#markerInputGroup").css("display","none"))}),document.getElementById("markerSelectGroup").addEventListener("change",function(){D.attr("href","#"+this.value),D.attr("data-id","#"+this.value)}),document.getElementById("markerInputGroup").addEventListener("change",function(){var t=this.value.toLowerCase().replace(/ /g,"_").replace(/[^\w\s]/gi,"");if(Number.isFinite(+t.charAt(0))&&(t="m"+t),d3.select("#defs-markers").select("#"+t).size())v('The type "'+t+'" is already exists');else{markerInputGroup.value="";var e=D.attr("href"),a=d3.select("#defs-markers").select(e).node().cloneNode(!0);a.id=t,D.attr("href","#"+t),D.attr("data-id","#"+t),document.getElementById("defs-markers").insertBefore(a,null);var o=document.createElement("option");o.value=o.innerHTML=t,markerSelectGroup.add(o),$("#markerSelectGroup").val(t).change(),$("#markerSelectGroup, #markerInputGroup").toggle(),r()}}),$("#markerIconButton").click(function(){$("#markerEditor > button").not(this).toggle(),$("#markerIconButtons").toggle(),$("#markerIconTable").text()||s(N)}),$("#markerRemoveGroup").click(function(){var t=D.attr("href"),e=document.querySelectorAll("use[data-id='"+t+"']"),a=1===e.length?"1 element":e.length+" elements",o="Are you sure you want to remove the marker ("+a+")?";alertMessage.innerHTML=o,$("#alert").dialog({resizable:!1,title:"Remove marker",buttons:{Remove:function(){$(this).dialog("close"),"#marker0"!==t&&d3.select("#defs-markers").select(t).remove(),e.forEach(function(t){t.remove()}),r(),$("#markerEditor").dialog("close")},Cancel:function(){$(this).dialog("close")}}})}),document.getElementById("markerIconSize").addEventListener("input",function(){var t=D.attr("href");d3.select("#defs-markers").select(t).select("text").attr("font-size",this.value+"px")}),document.getElementById("markerIconShiftX").addEventListener("input",function(){var t=D.attr("href");d3.select("#defs-markers").select(t).select("text").attr("x",this.value+"%")}),document.getElementById("markerIconShiftY").addEventListener("input",function(){var t=D.attr("href");d3.select("#defs-markers").select(t).select("text").attr("y",this.value+"%")}),document.getElementById("markerIconCustom").addEventListener("input",function(){if(this.value){var t=D.attr("href");d3.select("#defs-markers").select(t).select("text").text(this.value)}}),$("#markerStyleButton").click(function(){$("#markerEditor > button").not(this).toggle(),$("#markerStyleButtons").toggle()}),document.getElementById("markerSize").addEventListener("input",function(){var t=D.attr("data-id"),e=document.querySelectorAll("use[data-id='"+t+"']"),a=this.value;e.forEach(function(t){t.setAttribute("data-size",a)}),Et()}),document.getElementById("markerBase").addEventListener("input",function(){var t=D.attr("href");d3.select(t).select("path").attr("fill",this.value),d3.select(t).select("circle").attr("stroke",this.value)}),document.getElementById("markerFill").addEventListener("input",function(){var t=D.attr("href");d3.select(t).select("circle").attr("fill",this.value)}),document.getElementById("markerIconFill").addEventListener("input",function(){var t=D.attr("href");d3.select("#defs-markers").select(t).select("text").attr("fill",this.value)}),document.getElementById("markerIconStrokeWidth").addEventListener("input",function(){var t=D.attr("href");d3.select("#defs-markers").select(t).select("text").attr("stroke-width",this.value)}),document.getElementById("markerIconStroke").addEventListener("input",function(){var t=D.attr("href");d3.select("#defs-markers").select(t).select("text").attr("stroke",this.value)}),document.getElementById("markerToggleBubble").addEventListener("click",function(){var t=D.attr("href"),e=1;"icon-info-circled"===this.className?(this.className="icon-info",e=0):this.className="icon-info-circled",d3.select(t).select("circle").attr("opacity",e),d3.select(t).select("path").attr("opacity",e)}),document.getElementById("markerLegendButton").addEventListener("click",function(){var t=D.attr("id"),e=D.attr("href"),a=d3.select("#defs-markers").select(e).select("text").text(),o="Marker "+a;qo(t,o)}),document.getElementById("markerAdd").addEventListener("click",function(){document.getElementById("addMarker").click()}),document.getElementById("markerRemove").addEventListener("click",function(){alertMessage.innerHTML="Are you sure you want to remove the marker?",$("#alert").dialog({resizable:!1,title:"Remove marker",buttons:{Remove:function(){$(this).dialog("close"),D.remove(),$("#markerEditor").dialog("close")},Cancel:function(){$(this).dialog("close")}}})}))}function r(){markerSelectGroup.innerHTML="",d3.select("#defs-markers").selectAll("symbol").each(function(){var t=document.createElement("option");t.value=t.innerHTML=this.id,markerSelectGroup.add(t)});var t=D.attr("href").slice(1);markerSelectGroup.value=t}function s(){var t=[["2693","⚓","Anchor"],["26EA","⛪","Church"],["1F3EF","🏯","Japanese Castle"],["1F3F0","🏰","Castle"],["1F5FC","🗼","Tower"],["1F3E0","🏠","House"],["1F3AA","🎪","Tent"],["1F3E8","🏨","Hotel"],["1F4B0","💰","Money bag"],["1F4A8","💨","Dashing away"],["1F334","🌴","Palm"],["1F335","🌵","Cactus"],["1F33E","🌾","Sheaf"],["1F5FB","🗻","Mountain"],["1F30B","🌋","Volcano"],["1F40E","🐎","Horse"],["1F434","🐴","Horse Face"],["1F42E","🐮","Cow"],["1F43A","🐺","Wolf Face"],["1F435","🐵","Monkey face"],["1F437","🐷","Pig face"],["1F414","🐔","Chiken"],["1F411","🐑","Eve"],["1F42B","🐫","Camel"],["1F418","🐘","Elephant"],["1F422","🐢","Turtle"],["1F40C","🐌","Snail"],["1F40D","🐍","Snake"],["1F433","🐳","Whale"],["1F42C","🐬","Dolphin"],["1F420","🐟","Fish"],["1F432","🐲","Dragon Head"],["1F479","👹","Ogre"],["1F47B","👻","Ghost"],["1F47E","👾","Alien"],["1F480","💀","Skull"],["1F374","🍴","Fork and knife"],["1F372","🍲","Food"],["1F35E","🍞","Bread"],["1F357","🍗","Poultry leg"],["1F347","🍇","Grapes"],["1F34F","🍏","Apple"],["1F352","🍒","Cherries"],["1F36F","🍯","Honey pot"],["1F37A","🍺","Beer"],["1F377","🍷","Wine glass"],["1F3BB","🎻","Violin"],["1F3B8","🎸","Guitar"],["26A1","⚡","Electricity"],["1F320","🌠","Shooting star"],["1F319","🌙","Crescent moon"],["1F525","🔥","Fire"],["1F4A7","💧","Droplet"],["1F30A","🌊","Wave"],["231B","⌛","Hourglass"],["1F3C6","🏆","Goblet"],["26F2","⛲","Fountain"],["26F5","⛵","Sailboat"],["26FA","⛺","Tend"],["1F489","💉","Syringe"],["1F4D6","📚","Books"],["1F3AF","🎯","Archery"],["1F52E","🔮","Magic ball"],["1F3AD","🎭","Performing arts"],["1F3A8","🎨","Artist palette"],["1F457","👗","Dress"],["1F451","👑","Crown"],["1F48D","💍","Ring"],["1F48E","💎","Gem"],["1F514","🔔","Bell"],["1F3B2","🎲","Die"],["26A0","⚠","Alert"],["2317","⌗","Hash"],["2318","⌘","POI"],["2307","⌇","Wavy"],["21E6","⇦","Left arrow"],["21E7","⇧","Top arrow"],["21E8","⇨","Right arrow"],["21E9","⇩","Left arrow"],["21F6","⇶","Three arrows"],["2699","⚙","Gear"],["269B","⚛","Atom"],["0024","$","Dollar"],["2680","⚀","Die1"],["2681","⚁","Die2"],["2682","⚂","Die3"],["2683","⚃","Die4"],["2684","⚄","Die5"],["2685","⚅","Die6"],["26B4","⚴","Pallas"],["26B5","⚵","Juno"],["26B6","⚶","Vesta"],["26B7","⚷","Chiron"],["26B8","⚸","Lilith"],["263F","☿","Mercury"],["2640","♀","Venus"],["2641","♁","Earth"],["2642","♂","Mars"],["2643","♃","Jupiter"],["2644","♄","Saturn"],["2645","♅","Uranus"],["2646","♆","Neptune"],["2647","♇","Pluto"],["26B3","⚳","Ceres"],["2654","♔","Chess king"],["2655","♕","Chess queen"],["2656","♖","Chess rook"],["2657","♗","Chess bishop"],["2658","♘","Chess knight"],["2659","♙","Chess pawn"],["2660","♠","Spade"],["2663","♣","Club"],["2665","♥","Heart"],["2666","♦","Diamond"],["2698","⚘","Flower"],["2625","☥","Ankh"],["2626","☦","Orthodox"],["2627","☧","Chi Rho"],["2628","☨","Lorraine"],["2629","☩","Jerusalem"],["2670","♰","Syriac cross"],["2020","†","Dagger"],["262A","☪","Muslim"],["262D","☭","Soviet"],["262E","☮","Peace"],["262F","☯","Yin yang"],["26A4","⚤","Heterosexuality"],["26A2","⚢","Female homosexuality"],["26A3","⚣","Male homosexuality"],["26A5","⚥","Male and female"],["26AD","⚭","Rings"],["2690","⚐","White flag"],["2691","⚑","Black flag"],["263C","☼","Sun"],["263E","☾","Moon"],["2668","♨","Hot springs"],["2600","☀","Black sun"],["2601","☁","Cloud"],["2602","☂","Umbrella"],["2603","☃","Snowman"],["2604","☄","Comet"],["2605","★","Black star"],["2606","☆","White star"],["269D","⚝","Outlined star"],["2618","☘","Shamrock"],["21AF","↯","Lightning"],["269C","⚜","FleurDeLis"],["2622","☢","Radiation"],["2623","☣","Biohazard"],["2620","☠","Skull"],["2638","☸","Dharma"],["2624","☤","Caduceus"],["2695","⚕","Aeculapius staff"],["269A","⚚","Hermes staff"],["2697","⚗","Alembic"],["266B","♫","Music"],["2702","✂","Scissors"],["2696","⚖","Scales"],["2692","⚒","Hammer and pick"],["2694","⚔","Swords"]],e=document.getElementById("markerIconTable"),a="";e.addEventListener("click",l,!1),e.addEventListener("mouseover",u,!1);for(var o=0;o<t.length;o++){o%20===0&&(a=e.insertRow(0));var n=a.insertCell(0),i=String.fromCodePoint(parseInt(t[o][0],16));n.innerHTML=i,n.id="markerIcon"+i.codePointAt(),n.setAttribute("data-desc",t[o][2])}}function l(t){if(t.target!==t.currentTarget){var e=document.getElementById("markerIconTable"),a=e.getElementsByClassName("selected");a.length&&a[0].removeAttribute("class"),t.target.className="selected";var o=D.attr("href"),n=t.target.innerHTML;d3.select("#defs-markers").select(o).select("text").text(n)}t.stopPropagation()}function u(t){if(t.target!==t.currentTarget){var e=t.target.getAttribute("data-desc");v(t.target.innerHTML+" "+e)}t.stopPropagation()}}function Ze(){v("",!0),Vt(),5===J&&(J=0),D&&(D.call(d3.drag().on("drag",null)).attr("class",null),j.selectAll("*").remove(),h.style("cursor","default"),D=null)}function Qe(t){if(!t)return[0,0,0,0,0,1];var e=t.replace(/[a-z()]/g,"").replace(/[ ]/g,",").split(",");return[e[0]||0,e[1]||0,e[2]||0,e[3]||0,e[4]||0,e[5]||1]}function ta(t,e){$("#burgLabels [data-id="+t+"]").detach().appendTo($("#burgLabels > #"+e)),$("#burgIcons [data-id="+t+"]").detach().appendTo($("#burgIcons > #"+e));var a=$("#burgIcons > #"+e).attr("size");$("#burgIcons [data-id="+t+"]").attr("r",a);var o=$("#icons g[id*='anchors'] [data-id="+t+"]");if(o.length){var n="towns"===e?$("#town-anchors"):$("#capital-anchors");o.detach().appendTo(n);var i=n.attr("size"),r=no(at[t].x-.47*i,2),s=no(at[t].y-.47*i,2);o.attr("x",r).attr("y",s).attr("width",i).attr("height",i)}Qo()}function ea(){var t=+culturesInput.value;lt=d3.shuffle(st).slice(0,t);var e=d3.range(lt.length).map(function(t,e){var a=Math.floor(Math.random()*Ct*.8+.1*Ct),o=Math.floor(Math.random()*St*.8+.1*St),n=[a,o];return lt[e].center=n,n});V=d3.quadtree(e)}function aa(){console.group("manorsAndRegions"),ka(),oa(),ra(),ca(),na(),sa(),ya(),la(),ua(),wa("withCultures"),da(),pa(),ha(),ia(),ba(),Ma(),console.groupEnd("manorsAndRegions")}function oa(){console.time("rankPlacesGeography"),tt.map(function(t){var e=0;if(t.flux=no(t.flux,2),t.height<=40?e=2:t.height<=50?e=1.8:t.height<=60?e=1.6:t.height<=80&&(e=1.4),e+=(1-t.height/100)/3,t.ctype&&Math.random()<.8&&!t.river)t.score=0;else{t.harbor&&(1===t.harbor?e+=1:e-=.3),t.river&&(e+=1),t.river&&1===t.ctype&&(e+=1),t.flux>1&&(e+=Math.pow(t.flux,.3)),t.confluence&&(e+=Math.pow(t.confluence,.7));var a=t.neighbors.map(function(t){if(Q[t].height>=20)return Q[t].height});t.height,d3.mean(a)}t.score=no(Math.random()*e+e,3)}),tt.sort(function(t,e){return e.score-t.score}),console.timeEnd("rankPlacesGeography")}function na(){console.time("rankPlacesEconomy"),tt.map(function(t){var e=t.score,a=t.path||0;if(a){a=Math.pow(a,.2);var o=t.crossroad||0;e=e+a+o}t.score=no(Math.random()*e+e,2)}),tt.sort(function(t,e){return e.score-t.score}),console.timeEnd("rankPlacesEconomy")}function ia(){var t=.5,e=.9;at.map(function(t){var a=Q[t.cell],o=a.score;o<=0&&(o=no(Math.random(),2)),a.crossroad&&(o+=a.crossroad),a.confluence&&(o+=Math.pow(a.confluence,.3)),t.i!==t.region&&a.port&&(o*=1.5),t.i!==t.region||a.port||(o*=2),t.i===t.region&&a.port&&(o*=3),"neutral"===t.region&&(o*=e);var n=.6+.8*Math.random();t.population=no(o*n,1)});var a=90/Math.sqrt(Q.length,2);tt.map(function(e){var o=0,n=Math.pow(1-e.height/100,3);o=n*e.area*a,"neutral"===e.region&&(o*=t),e.pop=no(o,1)}),ot.map(function(t,e){var a=$.grep(at,function(t){return t.region===e});t.burgs=a.length;var o=0;a.map(function(t){o+=t.population}),t.urbanPopulation=no(o,2);var n=$.grep(Q,function(t){return t.region===e}),i=0;n.map(function(t){i+=t.pop}),t.cells=n.length,t.ruralPopulation=no(i,1)});var o=$.grep(Q,function(t){return"neutral"===t.region});if(o.length){var n=0,i=0,r=0,s=0;at.forEach(function(t){"neutral"===t.region&&(i+=t.population,n++)}),o.forEach(function(t){r+=t.pop,s+=Q[t.index].area}),ot.push({i:ot.length,color:"neutral",name:"Neutrals",capital:"neutral",cells:o.length,burgs:n,urbanPopulation:no(i,2),ruralPopulation:no(r,2),area:no(s)})}}function ra(){console.time("locateCapitals");var t=+regionsInput.value,e=(Ct+St)/2/t;console.log(" states: "+t);for(var a=0;at.length<t;a++){for(var o=at.length,n=tt[a].data[0],i=tt[a].data[1],r=1e4,s=0;s<at.length;s++){var l=Math.hypot(n-at[s].x,i-at[s].y);if(l<r&&(r=l),r<e)break}if(r>=e){var u=tt[a].index,c=V.find(n,i),d=Ia(c);at.push({i:o,cell:u,x:n,y:i,region:o,culture:d})}a===tt.length-1&&(console.error("Cannot place capitals with current spacing. Trying again with reduced spacing"),a=-1,at=[],e/=1.2)}var p=t<=8?mt:ft,h=+powerInput.value;at.forEach(function(e,a){var o=no(Math.random()*h/2+1,1),n=p(a/t);ot.push({i:a,color:n,power:o,capital:a});var i=Q[e.cell];i.manor=a,i.region=a,i.culture=e.culture}),console.timeEnd("locateCapitals")}function sa(){console.time("locateTowns");var t=+manorsInput.value,e=+neutralInput.value,a=d3.quadtree();at.forEach(function(t){a.add([t.x,t.y])});for(var o=0;at.length<t&&o<tt.length;o++){var n=tt[o].data[0],i=tt[o].data[1],r=a.find(n,i),s=Math.hypot(n-r[0],i-r[1]);if(!(s<6)){for(var l=tt[o].index,u="neutral",c=-1,d=e,p=0;p<ot.length;p++){var h=Math.hypot(at[p].x-n,at[p].y-i)/ot[p].power,v=at[p].cell;Q[l].fn!==Q[v].fn&&(h*=3),h<d&&(u=p,d=h)}if(d>e/5||"neutral"===u){var g=V.find(n,i);c=Ia(g)}else c=at[u].culture;tt[o].manor=at.length,tt[o].culture=c,tt[o].region=u,at.push({i:at.length,cell:l,x:n,y:i,region:u,culture:c}),a.add([n,i])}}if(at.length<t){var m="Cannot place all burgs. Requested "+t+", placed "+at.length;console.error(m)}console.timeEnd("locateTowns")}function la(){for(var t=0;t<at.length;t++){var e=t<regionsInput.value,a=Q[at[t].cell],o=at[t].x,n=at[t].y;if((e&&a.harbor||1===a.harbor)&&(void 0===a.haven?a.harbor=void 0:(a.port=Q[a.haven].fn,o=a.coastX,n=a.coastY)),a.river&&1!==a.type){var i=.2*a.flux;i<.2&&(i=.2),i>1&&(i=1),i=Math.random()>.5?i:-1*i,o=no(o+i,2),i=Math.random()>.5?i:-1*i,n=no(n+i,2)}a.data[0]=at[t].x=o,a.data[1]=at[t].y=n}}function ua(){console.time("checkAccessibility");for(var t=function(t){if(!nt[t].land)return"continue";var e=$.grep(tt,function(e){return void 0!==e.manor&&e.fn===t});if(!e.length)return"continue";var a=$.grep(e,function(t){return t.port&&!nt[t.port].border});if(a.length){var o=[];a.forEach(function(t){o[t.port]=o[t.port]?o[t.port]+1:1}),a.forEach(function(t){1===o[t.port]&&(t.port=void 0)})}var n=$.grep(e,function(t){return t.port&&nt[t.port].border});if(n.length)return"continue";var i=$.grep(e,function(t){return t.harbor&&nt[Q[t.harbor].fn].border&&1===t.ctype});if(i.length){var r=i[0];r.harbor=1,r.port=Q[r.haven].fn;var s=at[i[0].manor];r.data[0]=s.x=r.coastX,r.data[1]=s.y=r.coastY,r.score+=Math.floor((i.length-1)/2)}else e.forEach(function(t){t.score-=2})},e=0;e<nt.length;e++)t(e);console.timeEnd("checkAccessibility")}function ca(){if(console.time("generateMainRoads"),kt.curve(d3.curveBasis),!(ot.length<2||at.length<2)){for(var t=function(t){if(!nt[t].land)return"continue";var e=$.grep(tt,function(e){return void 0!==e.manor&&e.fn===t});if(e.length>1)for(var a=1;a<e.length;a++)for(var o=0;o<a;o++){var n=va(e[a].index,e[o].index,"main");fa(e[o].index,e[a].index,"main",n)}},e=0;e<nt.length;e++)t(e);console.timeEnd("generateMainRoads")}}function da(){if(console.time("generatePortRoads"),ot.length&&!(at.length<2)){for(var t=[],a=0;a<ot.length;a++){var o=at[a].cell;void 0===Q[o].port&&t.push(a)}for(var n=function(a){var o=$.grep(tt,function(e){return void 0!==e.port&&e.region===t[e]});if(!o.length)return"continue";var n=1e3,i=-1;if(o.map(function(t){var a=Math.hypot(e.data[0]-t.data[0],e.data[1]-t.data[1]);a<n&&a>1&&(n=a,i=t.index)}),-1!==i){var r=at[t[a]].cell,s=va(r,i,"direct");fa(i,r,"main",s)}},i=0;i<t.length;i++)n(i);console.timeEnd("generatePortRoads")}}function pa(){if(console.time("generateSmallRoads"),!(at.length<2)){for(var t=function(t){var e=$.grep(tt,function(e){return void 0!==e.manor&&e.fn===t}),r=e.length;if(r>1){for(var s=no((r+8)/10),l=0;l<s;l++)a=e[Math.floor(Math.random()*r)].index,o=e[Math.floor(Math.random()*r)].index,n=Math.hypot(Q[a].data[0]-Q[o].data[0],Q[a].data[1]-Q[o].data[1]),n>10&&(i=va(a,o,"direct"),fa(o,a,"small",i));e.map(function(a,o){if(!a.path&&o>0){var n=a.index,i=-1,r=$.grep(tt,function(e){return e.path&&e.fn===t});if(r.length>0){var s=1e4;r.map(function(t){var e=Math.hypot(a.data[0]-t.data[0],a.data[1]-t.data[1]);e<s&&(s=e,i=t.index)})}else i=e[0].index;var l=va(n,i,"main");fa(i,n,"small",l)}})}},e=0;e<nt.length;e++){var a,o,n,i;t(e)}console.timeEnd("generateSmallRoads")}}function ha(){console.time("generateOceanRoutes"),kt.curve(d3.curveBasis);for(var t=N.selectAll("#capital-anchors"),e=N.selectAll("#town-anchors"),a=t.attr("size")||2,o=e.attr("size")||1,n=[],i=0;i<at.length;i++){var r=at[i].cell,s=Q[r].port;if(void 0!==s){void 0===n[s]&&(n[s]=[]),n[s].push(r);var l=i<ot.length?t:e,u=i<ot.length?a:o,c=no(Q[r].data[0]-.47*u,2),d=no(Q[r].data[1]-.47*u,2);l.append("use").attr("xlink:href","#icon-anchor").attr("data-id",i).attr("x",c).attr("y",d).attr("width",u).attr("height",u),N.selectAll("use").on("click",We)}}for(var p=0;p<n.length;p++)if(n[p]&&!(n[p].length<2)){for(var h=[],v=0;v<n[p].length;v++){var g=n[p][v],m=Q[g].fn;void 0===h[m]&&(h[m]=[]),h[m].push(g)}for(var f=0;f<h.length;f++)if(h[f]&&!(h[f].length<2)){for(var b=h[f][0],y=ga(b,-1),k=1;k<h[f].length;k++)fa(h[f][k],b,"ocean",y);for(var C=f+1;C<h.length;C++)if(h[C]&&h[C].length&&h[f].length>3){var S=h[C][0];fa(S,b,"ocean",y)}if(nt[p].border&&!nt[f].border&&h[f].length>5){h[f].sort(function(t,e){return Q[e].cost-Q[t].cost});for(var w=2;w<h[f].length&&w<10;w++){var M=h[f][1],x=h[f][w],A=Math.hypot(Q[M].data[0]-Q[x].data[0],Q[M].data[1]-Q[x].data[1]),B=ma(M,x);if(B>4*A+10){var $=Q[M].cost+Q[x].cost,E=ga(M,x);if(Q[x].cost<$){fa(x,M,"ocean",E);break}}}}}}console.timeEnd("generateOceanRoutes")}function va(t,e,a){var o=new PriorityQueue({comparator:function(t,e){return t.p-e.p}}),n=[],i=[];i[t]=0,o.queue({e:t,p:0});var r=function(){var t=o.dequeue().e;if(t===e)return"break";var r=Q[t];r.neighbors.forEach(function(s){if(Q[s].height>=20){var l=Q[s].height/100*2;Q[s].path&&"main"===a?l=.15:("undefined"===typeof s.manor&&(l+=.1),"undefined"!==typeof s.river&&(l-=.1),Q[s].harbor&&(l*=.3),Q[s].path&&(l*=.5),l+=Math.hypot(Q[s].data[0]-r.data[0],Q[s].data[1]-r.data[1])/30);var u=i[t]+l;if(!n[s]||u<i[s]){i[s]=u,n[s]=t;var c=Math.hypot(Q[s].data[0]-Q[e].data[0],Q[s].data[1]-Q[e].data[1])/15,d=u+c;o.queue({e:s,p:d})}}})};while(o.length>0){var s=r();if("break"===s)break}return n}function ga(t,e){var a,o=new PriorityQueue({comparator:function(t,e){return t.p-e.p}}),n=[],i=[];n[t]="no",i[t]=0,o.queue({e:t,p:0});var r=function(){a=o.dequeue().e;var t=Q[a];t.neighbors.forEach(function(e){if(Q[e].ctype<0||Q[e].haven===a){var r=1;if(Q[e].ctype>0&&(r+=100),Q[e].ctype<-1){var s=Math.hypot(Q[e].data[0]-t.data[0],Q[e].data[1]-t.data[1]);r+=50+2*s}Q[e].path&&Q[e].ctype<0&&(r*=.8);var l=i[a]+r;n[e]||(i[e]=l,Q[e].cost=l,n[e]=a,o.queue({e:e,p:l}))}})};while(o.length>0&&a!==e)r();return n}function ma(t,e){var a,o,n=new PriorityQueue({comparator:function(t,e){return t.p-e.p}}),i=[],r=[];i[t]="no",r[t]=0,n.queue({e:t,p:0});var s=function(){a=n.dequeue().e;var t=Q[a];t.neighbors.forEach(function(e){if(Q[e].path&&(-1===Q[e].ctype||Q[e].haven===a)){var s=Math.hypot(Q[e].data[0]-t.data[0],Q[e].data[1]-t.data[1]);o=r[a]+s,i[e]||(r[e]=o,i[e]=a,n.queue({e:e,p:o}))}})};while(n.length>0&&a!==e)s();return o}function fa(t,e,a,o){var n=[],i=t,r=1e3,s=Q[t];"ocean"!==a&&s.path||n.push({scX:s.data[0],scY:s.data[1],i:t}),s.path||(s.path=1);for(var l=0;l<r;l++){i=o[i];var u=Q[i];if(!u)break;if(u.path?(u.path+=1,n.push({scX:u.data[0],scY:u.data[1],i:i}),s=u,c()):(u.path=1,s&&n.push({scX:s.data[0],scY:s.data[1],i:s.index}),s=void 0,n.push({scX:u.data[0],scY:u.data[1],i:i})),i===e||!o[i])break}function c(){if(n.length>1){if("main"===a||"small"===a){var t="main"===a?4:2,e=Q[n[0].i];e.path>1&&(e.crossroad||(e.crossroad=0),e.crossroad+=t);var o=Q[n[n.length-1].i];o.path>1&&(o.crossroad||(o.crossroad=0),o.crossroad+=t)}var i=kt(n);i=io(i,1);var r=0;"main"===a?(r=T.selectAll("path").size(),T.append("path").attr("d",i).attr("id","road"+r).on("click",Ye)):"small"===a?(r=L.selectAll("path").size(),L.append("path").attr("d",i).attr("id","trail"+r).on("click",Ye)):"ocean"===a&&(r=R.selectAll("path").size(),R.append("path").attr("d",i).attr("id","searoute"+r).on("click",Ye))}n=[]}c()}function ba(){console.time("drawManors");var t=G.select("#capitals"),e=O.select("#capitals"),a=G.select("#towns"),o=O.select("#towns"),n=t.attr("size")||1,i=a.attr("size")||.5;t.selectAll("*").remove(),e.selectAll("*").remove(),a.selectAll("*").remove(),o.selectAll("*").remove();for(var r=0;r<at.length;r++){var s=at[r].x,l=at[r].y,u=(at[r].cell,at[r].name),c=r<ot.length?t:a,d=r<ot.length?e:o,p=r<ot.length?n:i;c.append("circle").attr("id","burg"+r).attr("data-id",r).attr("cx",s).attr("cy",l).attr("r",p).on("click",qe),d.append("text").attr("data-id",r).attr("x",s).attr("y",l).attr("dy","-0.35em").text(u).on("click",qe)}console.timeEnd("drawManors")}function ya(){if(console.time("getNames"),"1"===namesInput.value){var t=new XMLHttpRequest,e="https://archivist.xalops.com/archivist-core/api/name/settlement?count=";t.open("GET",e+at.length,!0),t.onload=function(){for(var e=JSON.parse(t.responseText),a=0;a<at.length;a++)at[a].name=e[a],O.select("[data-id='"+a+"']").text(e[a]),a<ot.length&&(ot[a].name=$a(a),H.select("#countries").select("#regionLabel"+a).text(ot[a].name));console.log(e)},t.send(null)}if("0"===namesInput.value){for(var a=0;a<at.length;a++){var o=at[a].culture;at[a].name=Sa(o),a<ot.length&&(ot[a].name=$a(a))}console.timeEnd("getNames")}}function ka(){for(var t=0;t<dt.length;t++)ut[t]=Ca(t)}function Ca(t){for(var e=[],a=dt[t].join(" ").toLowerCase(),o=ct[t].method,n=-1,i=" ",r="";n<a.length-2;i=r,n+=r.length,r=""){var s=0,l=" ";if("let-to-let"===o)r=a[n+1];else for(var u=n+1;r.length<5;u++){if(void 0===a[u])break;if(r+=a[u]," "===r)break;if("o"!==a[u]&&"e"!==a[u]&&pt.includes(a[u])&&a[u+1]===a[u])break;if(" "===a[u+2]){r+=a[u+1];break}if(pt.includes(a[u])&&s++,s&&pt.includes(a[u+2]))break}n>=0&&(l=a[n],"syl-to-syl"===o&&(l=i)),void 0===e[l]&&(e[l]=[]),e[l].push(r)}return e}function Sa(t,e){void 0===e&&(lt[t]||(console.error("culture "+t+" is not defined. Will load default cultures and set first culture"),ea(),t=0),e=lt[t].base),ct[e]||(console.error("nameBase "+e+" is not defined. Will load default names data and first base"),ct[0]||Ot(),e=0);var a=ct[e].method,o=function(t){v("Names data for base "+ct[t].name+" is incorrect. Please fix in Namesbase Editor"),Jo()};if("selection"===a){if(dt[e].length<1)return void o(e);var n=oo(dt[e].length-1),i=dt[e][n];return i}var r=ut[e];if(void 0!==r&&void 0!==r[" "]){var s=ct[e].max,l=ct[e].min,u=ct[e].d,d="",p=r[" "];if(void 0!==p){for(var h=p[oo(p.length-1)],g=0;g<21;g++){if(" "===h&&Math.random()<.8){if(!(d.length<l))break;d="",p=r[" "]}else{var m="let-to-syl"===a&&h.length>1?h[h.length-1]:h;p=r[m],d+=h,d.length>s&&(d="")}if(void 0===p)return void o(e);h=p[oo(p.length-1)]}if(d.length<2&&(d=dt[e][oo(dt[e].length-1)]),d.includes(" ")){var f=d.split(" ");if(Math.random()>ct[e].m)d=f.join("");else{for(var b=0;b<f.length;b++)f[b].length<2&&(b||(f[1]=f[0]+f[1]),b&&(f[b-1]=f[b-1]+f[b]),f.splice(b,1),b--);d=f.join(" ")}}var y=Object(c["a"])(d).reduce(function(t,e,a,o){if(" "===e){if(!t.length)return"";if(a+1===o.length)return t}if(!t.length)return e.toUpperCase();if(" "===t.slice(-1))return t+e.toUpperCase();if(e===o[a-1]){if(!u.includes(e))return t;if(e===o[a-2])return t}return t+e},"");return y}o(e)}else o(e)}function wa(t){console.time("defineRegions");var e=d3.quadtree();at.forEach(function(t){"removed"!==t.region&&e.add([t.x,t.y])});var a=+neutralInput.value;tt.forEach(function(o){if(void 0!==o.manor&&"removed"!==at[o.manor].region)return o.region=at[o.manor].region,void(t&&void 0!==at[o.manor].culture&&(o.culture=at[o.manor].culture));var n=o.data[0],i=o.data[1],r=1e5,s=null;if(at.length){var l=e.find(n,i);r=Math.hypot(l[0]-n,l[1]-i),s=za(l)}if(r>a/2||null===s){if(o.region="neutral",t){var u=V.find(n,i);o.culture=Ia(u)}}else{var c=at[s].cell;if(Q[c].fn!==o.fn){var d=3*r;tt.forEach(function(t){if(t.fn===o.fn&&void 0!==t.manor){if("removed"===at[t.manor].region)return;var e=Math.hypot(t.data[0]-n,t.data[1]-i);e<d&&(d=e,s=t.manor)}})}o.region=at[s].region,t&&(o.culture=at[s].culture)}}),console.timeEnd("defineRegions")}function Ma(){console.time("drawRegions"),H.select("#countries").selectAll("*").remove();for(var t=[],e=[],a=[],o=[],n=0;n<ot.length;n++)t[n]=[],e[n]=[];for(var r=i.edges,s=0;s<r.length;s++)if(void 0!==r[s]){var l=r[s][0].join(" "),u=r[s][1].join(" "),c={start:l,end:u};if(void 0!==r[s].left)if(void 0!==r[s].right){var d=r[s].left.index,p=r[s].right.index,h=Q[d].region,v=Q[p].region;h!==v&&(Number.isInteger(h)&&(t[h].push(c),void 0===v?e[h].push(c):"neutral"===v&&o.push(c)),Number.isInteger(v)&&(t[v].push(c),void 0===h?e[v].push(c):"neutral"===h?o.push(c):Number.isInteger(h)&&a.push(c)))}else{var g=r[s].left.index,m=Q[g].region;Number.isInteger(m)&&t[m].push(c)}else{var f=r[s].right.index,b=Q[f].region;Number.isInteger(b)&&t[b].push(c)}}t.map(function(t,a){t.length&&(xa(t,a),Aa(e[a],a))}),Ba(a,"state"),Ba(o,"neutral"),console.timeEnd("drawRegions")}function xa(t,e){var a="",o=[];kt.curve(d3.curveLinear);var n=function(){var e=[],n=t[0].start,i=t[0].end;t.shift();var r=n.split(" ");e.push({scX:r[0],scY:r[1]}),r=i.split(" "),e.push({scX:r[0],scY:r[1]});for(var s=0;i!==n&&s<2e3;s++){var l=$.grep(t,function(t){return t.start==i||t.end==i});l.length>0&&(l[0].start==i?i=l[0].end:l[0].end==i&&(i=l[0].start),r=i.split(" "),e.push({scX:r[0],scY:r[1]}));var u=t.indexOf(l[0]);t.splice(u,1)}a+=kt(e)+"Z ",o[o.length]=e.map(function(t){return[+t.scX,+t.scY]})};while(t.length>2)n();var i=ot[e].color;x.append("path").attr("d",io(a,1)).attr("fill",i).attr("class","region"+e),o.sort(function(t,e){return e.length-t.length});var s=ot[e].capital;if(!isNaN(s)){var l=at[s].cell;o.push(r[l])}var u=ot[e].name,c=polylabel(o,1);H.select("#countries").append("text").attr("id","regionLabel"+e).attr("x",no(c[0])).attr("y",no(c[1])).text(u).on("click",Ue),ot[e].area=no(Math.abs(d3.polygonArea(o[0])))}function Aa(t,e){var a="",o=function(){var e=[],o=t[0].start,n=t[0].end;t.shift();var i=o.split(" ");e.push({scX:i[0],scY:i[1]}),i=n.split(" "),e.push({scX:i[0],scY:i[1]});var r=$.grep(t,function(t){return t.start==n||t.end==n});while(r.length>0){r[0].start==n?n=r[0].end:r[0].end==n&&(n=r[0].start),i=n.split(" "),e.push({scX:i[0],scY:i[1]});var s=t.indexOf(r[0]);t.splice(s,1),r=$.grep(t,function(t){return t.start==n||t.end==n})}a+=kt(e)};while(t.length>0)o();var n=ot[e].color;x.append("path").attr("d",io(a,1)).attr("fill","none").attr("stroke",n).attr("stroke-width",5).attr("class","region"+e)}function Ba(t,e){var a="";if(!(t.length<1)){var o=function(){var e=[],o=t[0].start,n=t[0].end;t.shift();var i=o.split(" ");e.push({scX:i[0],scY:i[1]}),i=n.split(" "),e.push({scX:i[0],scY:i[1]});var r=$.grep(t,function(t){return t.start==n||t.end==n});while(r.length>0){r[0].start==n?n=r[0].end:r[0].end==n&&(n=r[0].start),i=n.split(" "),e.push({scX:i[0],scY:i[1]});var s=t.indexOf(r[0]);t.splice(s,1),r=$.grep(t,function(t){return t.start==n||t.end==n})}a+=kt(e)};while(t.length>0)o();"state"===e&&B.append("path").attr("d",io(a,1)),"neutral"===e&&E.append("path").attr("d",io(a,1))}}function $a(t){var e=null;ot[t]&&at[ot[t].capital]&&(e=at[ot[t].capital].culture);var a="NameIdontWant";if(Math.random()<.85||null===e){null===e&&(e=oo(lt.length-1));for(var o=0;o<20&&a.length>7;o++)a=Sa(e)}else a=at[t].name;var n=lt[e].base,i=!1,r=a.slice(-2);if(5!==n||"sk"!==r&&"ev"!==r&&"ov"!==r)if(a.length>5&&1===n&&"ton"===a.slice(-3))a=a.slice(0,-3),i=!0;else if(a.length>6&&"berg"===a.slice(-4))a=a.slice(0,-4),i=!0;else{if(12===n)return pt.includes(a.slice(-1))?a:a+"u";if(10===n)return"guk"===a.slice(-3)?a:("g"===a.slice(-1)&&(a=a.slice(0,-1)),Math.random()<.2&&a.length<7&&(a+="guk"),a);if(11===n)return"guo"===a.slice(-3)?a:("g"===a.slice(-1)&&(a=a.slice(0,-1)),Math.random()<.3&&a.length<7&&(a+=" Guo"),a)}else a=a.slice(0,-2),i=!0;var s=pt.includes(a.slice(-1));if(s&&a.length>3?Math.random()<.85&&(pt.includes(a.slice(-2,-1))?(a=a.slice(0,-2),i=!0):Math.random()<.7&&(a=a.slice(0,-1),i=!0)):Math.random()<.6&&(i=!0),!1===i)return a;var l="ia",u=Math.random();return u<.05&&3===n?l="terra":u<.05&&4===n?l="terra":u<.05&&2==n?l="terre":u<.5&&0==n?l="land":u<.4&&1==n?l="land":u<.3&&6==n?l="land":u<.1&&7==n?l="eia":u<.4&&9==n&&(l="maa"),a.slice(-1*l.length)===l?a:(a.slice(-1)===l.charAt(0)&&(a=a.slice(0,-1)),a+l)}function Ea(t){console.time("recalculateCultures"),ot.forEach(function(t){if("neutral"!==t.capital&&"select"!==t.capital){var e=at[t.capital],a=V.find(e.x,e.y);e.culture=Ia(a)}});var e=d3.quadtree(),a=+neutralInput.value;at.forEach(function(t){if("removed"!==t.region)if(e.add([t.x,t.y]),"neutral"!==t.region){var o=ot[t.region].capital;if("neutral"!==o&&"select"!==o){var n=Math.hypot(t.x-at[o].x,t.y-at[o].y);if(n<=a/5)return void(t.culture=at[o].culture)}var i=V.find(t.x,t.y);t.culture=Ia(i)}else{var r=V.find(t.x,t.y);t.culture=Ia(r)}});tt.forEach(function(o){var n=o.data[0],i=o.data[1],r=e.find(n,i),s=o.culture,l=Math.hypot(r[0]-n,r[1]-i),u=za(r);if(l>a/2||void 0===u){var c=V.find(o.data[0],o.data[1]);o.culture=Ia(c)}else{var d=at[u].cell;if(Q[d].fn!==o.fn){var p=3*l;tt.forEach(function(t){if(t.fn===o.fn&&void 0!==t.manor){if("removed"===at[t.manor].region)return;var e=Math.hypot(t.data[0]-n,t.data[1]-i);e<p&&(p=e,u=t.manor)}})}o.culture=at[u].culture}if(o.culture!==s||t){var h=lt[o.culture].color;M.select("#cult"+o.index).attr("fill",h).attr("stroke",h)}}),console.timeEnd("recalculateCultures")}function Ia(t){for(var e=0;e<lt.length;e++)if(lt[e].center[0]===t[0]&&lt[e].center[1]===t[1])return e}function za(t){for(var e=0;e<at.length;e++)if(at[e].x===t[0]&&at[e].y===t[1])return e}function Ta(){if("MFCG"!==o.get("from")){var t=o.get("scale")||8,e=o.get("x"),a=o.get("y"),n=o.get("cell");null!==n&&(e=Q[+n].data[0],a=Q[+n].data[1]);var i=o.get("burg");null!==i&&(e=at[+i].x,a=at[+i].y),null!==e&&null!==a&&Bt(e,a,t,1600)}else La()}function La(){if(at.length){var t=+o.get("size"),e=+o.get("coast"),a=+o.get("port"),n=+o.get("river"),i=d(e,a,n);if(i.length||(i=d(e,!a,!n)),i.length||(i=d(!e,0,!n)),i.length||(i=at[0]),i.length){var r=d3.scan(i,function(e,a){return Math.abs(e.population-t)-Math.abs(a.population-t)}),s=i[r].i;if(t&&void 0!==s){at[s].population=t;var l=O.select("[data-id='"+s+"']");if(l.size()){v("Here stands the glorious city of "+at[s].name,!0),l.classed("drag",!0).on("mouseover",function(){d3.select(this).classed("drag",!1),v("",!0)});var u=+l.attr("x"),c=+l.attr("y");Bt(u,c,8,1600)}else console.error("Cannot find a label for MFCG burg "+s)}}else console.error("Cannot find a burg for MFCG")}else console.error("No burgs generated. Cannot select a burg for MFCG");function d(t,e,a){var o=[];return e&&a?o=$.grep(at,function(t){return void 0!==Q[t.cell].port&&void 0!==Q[t.cell].river}):!e&&t&&a?o=$.grep(at,function(t){return void 0===Q[t.cell].port&&1===Q[t.cell].ctype&&void 0!==Q[t.cell].river}):t||a?!t&&a?o=$.grep(at,function(t){return 1!==Q[t.cell].ctype&&void 0!==Q[t.cell].river}):t&&!a&&(o=$.grep(at,function(t){return 1===Q[t.cell].ctype&&void 0===Q[t.cell].river})):o=$.grep(at,function(t){return 1!==Q[t.cell].ctype&&void 0===Q[t.cell].river}),o}}function Ra(){var t=styleSchemeInput.value,e=gt;"light"===t&&(e=d3.scaleSequential(d3.interpolateRdYlGn)),"green"===t&&(e=d3.scaleSequential(d3.interpolateGreens)),"monochrome"===t&&(e=d3.scaleSequential(d3.interpolateGreys)),y.selectAll("path").size()?y.selectAll("path").remove():Q.map(function(t,a){var o=t.height;if(!(o<20)||t.lake){if(t.lake){var n=t.neighbors.map(function(t){if(Q[t].height>=20)return Q[t].height}),i=d3.mean(n);if(!i)return;o=Math.trunc(i),(o<20||isNaN(o))&&(o=20)}var s=e((100-o)/100);y.append("path").attr("d","M"+r[a].join("L")+"Z").attr("fill",s).attr("stroke",s)}})}function Pa(){0==M.selectAll("path").size()?tt.map(function(t){var e=lt[t.culture].color;M.append("path").attr("d","M"+r[t.index].join("L")+"Z").attr("id","cult"+t.index).attr("fill",e).attr("stroke",e)}):M.selectAll("path").remove()}function Ha(){if(0===C.selectAll("*").size()){var t=styleOverlayType.value,e=+styleOverlaySize.value;if("pointyHex"===t||"flatHex"===t){var a=Na(e,t),o="m"+Oa(e,t).slice(0,4).join("l"),n=a.map(function(t){return"M"+t+o}).join("");C.append("path").attr("d",n)}else if("square"===t){var i=d3.range(e,wt,e),r=d3.range(e,Mt,e);C.append("g").selectAll("line").data(i).enter().append("line").attr("x1",function(t){return t}).attr("x2",function(t){return t}).attr("y1",0).attr("y2",Mt),C.append("g").selectAll("line").data(r).enter().append("line").attr("y1",function(t){return t}).attr("y2",function(t){return t}).attr("x1",0).attr("x2",wt)}else{var s="translate(80 80) scale(".concat(e/20,")");d3.select("#rose").attr("transform",s),C.append("use").attr("xlink:href","#rose")}C.call(d3.drag().on("start",Ie)),dn()}else C.selectAll("*").remove()}function Oa(t,e){var a=0,o=0,n="pointyHex"===e?0:Math.PI/-6,i=Math.PI/3,r=[n,n+i,n+2*i,n+3*i,n+4*i,n+5*i];return r.map(function(e){var n=Math.sin(e)*t,i=-Math.cos(e)*t,r=n-a,s=i-o;return a=n,o=i,[r,s]})}function Na(t,e){for(var a=[],o=Math.sqrt(3),n="pointyHex"===e?o*t/2:3*t/2,i="pointyHex"===e?3*t/2:o*t/2,r="pointyHex"===e?o*t:3*t,s=0,l=0;s<St;s+=i,l++)for(var u=l%2?0:n;u<Ct;u+=r)a.push([u,s]);return a}function Ga(){console.time("cleanData"),Q.map(function(t){delete t.cost,delete t.used,delete t.coastX,delete t.coastY,void 0===t.ctype&&delete t.ctype,void 0===t.lake&&delete t.lake,t.height=Math.trunc(t.height),t.height>=20&&(t.flux=no(t.flux,2))}),$("#toggleHeight").hasClass("buttonoff")||y.selectAll("path").size()||Ra(),$("#toggleCultures").hasClass("buttonoff")||M.selectAll("path").size()||Pa(),Fa(),Et(),console.timeEnd("cleanData")}function Fa(t){t=t||"#except",$(".dialog:visible").not(t).each(function(t){$(this).dialog("close")})}function _a(t){localStorage.setItem("transparency",t);var e=(100-+t)/100,a="rgba(164, 139, 149, "+e+")",o="rgba(255, 255, 255, "+e+")";document.getElementById("options").style.backgroundColor=a,document.getElementById("dialogs").style.backgroundColor=o}function ja(){var t=d3.scaleSequential(d3.interpolateBlues);0==y.selectAll("path").size()?tt.map(function(e){y.append("path").attr("d","M"+r[e.index].join("L")+"Z").attr("fill",t(.1+e.flux)).attr("stroke",t(.1+e.flux))}):y.selectAll("path").remove()}function Ka(){console.time("drawRelief");var t,e,a,o,n=0,i=w.select("#hills"),s=w.select("#mounts"),l=w.select("#swamps"),u=w.select("#forests");w.selectAll("g").selectAll("g").remove(),tt.sort(Ua);for(var c=0;c<tt.length;c++)if(!tt[c].river){var d=tt[c].index,p=d3.polygonCentroid(r[d]);if(void 0!==p){var h=tt[c].height,v=tt[c].area;if(h>=70){t=.12*(h-55);for(var g=0,m=v;Math.random()<m/50;g++,m-=50){if(void 0===r[d][g])break;var f=s.append("g").attr("data-cell",d);if(g<2)a=p[0]-t/100*(1-g/10)-2*g,o=p[1]+t/400+g;else{var b=r[d][g];a=(1.2*p[0]+.8*b[0])/2,o=(1.2*p[1]+.8*b[1])/2}e=.8*Math.random()+.2;var y="M"+a+","+o+" L"+(a+t/3+e)+","+(o-t/4-1.2*e)+" L"+(a+t/1.1)+","+(o-t)+" L"+(a+t+e)+","+(o-t/1.2+e)+" L"+(a+2*t)+","+o,k="M"+a+","+o+" L"+(a+t/3+e)+","+(o-t/4-1.2*e)+" L"+(a+t/1.1)+","+(o-t)+" L"+(a+t/1.5)+","+o,C="M"+(a-.1)+","+(o+.3)+" L"+(a+2*t+.1)+","+(o+.3);C+="M"+(a+.4)+","+(o+.6)+" L"+(a+2*t-.3)+","+(o+.6),f.append("path").attr("d",io(y,1)).attr("stroke","#5c5c70"),f.append("path").attr("d",io(k,1)).attr("fill","#999999"),f.append("path").attr("d",io(C,1)).attr("class","strokes")}}else if(h>50){t=(h-40)/10,t>1.7&&(t=1.7);for(var S=0,M=v;Math.random()<M/30;S++,M-=30){if(1===tt[c].ctype&&S>0)break;if(void 0===r[d][S])break;var x=i.append("g").attr("data-cell",d);if(S<2)a=p[0]-t-1.2*S,o=p[1]+t/4+S/1.6;else{var A=r[d][S];a=(1.2*p[0]+.8*A[0])/2,o=(1.2*p[1]+.8*A[1])/2}var B="M"+a+","+o+" Q"+(a+t)+","+(o-t)+" "+(a+2*t)+","+o,$="M"+(a+.6*t)+","+(o+.1)+" Q"+(a+.95*t)+","+(o-.91*t)+" "+(a+2*t*.97)+","+o,E="M"+(a-.1)+","+(o+.2)+" L"+(a+2*t+.1)+","+(o+.2);E+="M"+(a+.4)+","+(o+.4)+" L"+(a+2*t-.3)+","+(o+.4),x.append("path").attr("d",io(B,1)).attr("stroke","#5c5c70"),x.append("path").attr("d",io($,1)).attr("fill","white"),x.append("path").attr("d",io(E,1)).attr("class","strokes")}}if(h>=21&&h<22&&n<+swampinessInput.value&&1!=tt[c].used){var I=l.append("g").attr("data-cell",d);n++,tt[c].used=1;var z=Va(p[0],p[1]);tt[c].neighbors.forEach(function(t){Q[t].height>=20&&Q[t].height<30&&!Q[t].river&&1!=Q[t].used&&(Q[t].used=1,z+=Va(Q[t].data[0],Q[t].data[1]))}),I.append("path").attr("d",io(z,1))}if(Math.random()<h/100&&h>=22&&h<48)for(var T=0,L=v;Math.random()<L/15;T++,L-=15){if(1===tt[c].ctype&&T>0)break;if(void 0===r[d][T])break;var R=u.append("g").attr("data-cell",d);if(0===T)a=no(p[0]-1-Math.random(),1),o=p[1]-2;else{var P=r[d][T];if(T>1){var H=Math.hypot(P[0]-r[d][T-1][0],P[1]-r[d][T-1][1]);if(H<2)continue}a=(.5*p[0]+1.5*P[0])/2,o=(.5*p[1]+1.5*P[1])/2-1}var O="M"+a+","+o+" q-1,0.8 -0.05,1.25 v0.75 h0.1 v-0.75 q0.95,-0.47 -0.05,-1.25 z ",N="M"+a+","+o+" q-1,0.8 -0.05,1.25 h0.1 q0.95,-0.47 -0.05,-1.25 z ",G="M"+a+","+o+" q-1,0.8 -0.05,1.25 q-0.2,-0.55 0,-1.1 z ";R.append("path").attr("d",O),R.append("path").attr("d",N).attr("fill","white").attr("stroke","none"),R.append("path").attr("d",G).attr("fill","#999999").attr("stroke","none")}}}w.selectAll("g").selectAll("g").on("click",Je),console.timeEnd("drawRelief")}function Da(t,e,a,o,n){var i=w.select("#"+e).append("g").attr("data-cell",n);if("mounts"===e){var r=t>=.7?12*(t-.55):1.8,s=.8*Math.random()+.2,l="M"+a+","+o+" L"+(a+r/3+s)+","+(o-r/4-1.2*s)+" L"+(a+r/1.1)+","+(o-r)+" L"+(a+r+s)+","+(o-r/1.2+s)+" L"+(a+2*r)+","+o,u="M"+a+","+o+" L"+(a+r/3+s)+","+(o-r/4-1.2*s)+" L"+(a+r/1.1)+","+(o-r)+" L"+(a+r/1.5)+","+o,c="M"+(a-.1)+","+(o+.3)+" L"+(a+2*r+.1)+","+(o+.3);c+="M"+(a+.4)+","+(o+.6)+" L"+(a+2*r-.3)+","+(o+.6),i.append("path").attr("d",io(l,1)).attr("stroke","#5c5c70"),i.append("path").attr("d",io(u,1)).attr("fill","#999999"),i.append("path").attr("d",io(c,1)).attr("class","strokes")}if("hills"===e){var d=t>.5?10*(t-.4):1.2;d>1.8&&(d=1.8);var p="M"+a+","+o+" Q"+(a+d)+","+(o-d)+" "+(a+2*d)+","+o,h="M"+(a+.6*d)+","+(o+.1)+" Q"+(a+.95*d)+","+(o-.91*d)+" "+(a+2*d*.97)+","+o,v="M"+(a-.1)+","+(o+.2)+" L"+(a+2*d+.1)+","+(o+.2);v+="M"+(a+.4)+","+(o+.4)+" L"+(a+2*d-.3)+","+(o+.4),i.append("path").attr("d",io(p,1)).attr("stroke","#5c5c70"),i.append("path").attr("d",io(h,1)).attr("fill","white"),i.append("path").attr("d",io(v,1)).attr("class","strokes")}if("swamps"===e){var g=Va(a,o);i.append("path").attr("d",io(g,1))}if("forests"===e){Math.random();var m="M"+a+","+o+" q-1,0.8 -0.05,1.25 v0.75 h0.1 v-0.75 q0.95,-0.47 -0.05,-1.25 z ",f="M"+a+","+o+" q-1,0.8 -0.05,1.25 h0.1 q0.95,-0.47 -0.05,-1.25 z ",b="M"+a+","+o+" q-1,0.8 -0.05,1.25 q-0.2,-0.55 0,-1.1 z ";i.append("path").attr("d",m),i.append("path").attr("d",f).attr("fill","white").attr("stroke","none"),i.append("path").attr("d",b).attr("fill","#999999").attr("stroke","none")}return i.on("click",Je),i}function Ua(t,e){return t.data[1]>e.data[1]?1:t.data[1]<e.data[1]?-1:0}function Va(t,e){for(var a=.6,o="",n=0;n<3;n++){var i=void 0,r=void 0;0==n&&(i=t,r=e-.5-Math.random()),1==n&&(i=t+a+Math.random(),r=e+a+Math.random()),2==n&&(i=t-a-Math.random(),r=e+2*a+Math.random()),o+="M"+i+","+r+" H"+(i-a/6)+" M"+i+","+r+" H"+(i+a/6)+" M"+i+","+r+" L"+(i-a/3)+","+(r-a/2)+" M"+i+","+r+" V"+(r-a/1.5)+" M"+i+","+r+" L"+(i+a/3)+","+(r-a/2),o+="M"+(i-a)+","+r+" H"+(i-a/2)+" M"+(i+a/2)+","+r+" H"+(i+a)}return o}function Ya(){if(1===J)if(+landmassCounter.innerHTML<150)v("Insufficient land area! Please add more land cells to complete the map",null,"error");else{Go(),console.time("TOTAL"),be(),ye(),Pe(),He(),ke(),Oe(),Ge(),De(),changeHeights.checked||Ne(),Be(),Ka();var t=ot.length&&at.length;t?an():(ea(),aa()),Ga(),console.timeEnd("TOTAL")}else v('Nothing to complete! Click on "Edit" or "Clear all" to enter a heightmap customization mode',null,"error")}function Wa(){function t(){var t=d3.mouse(this),e=(Ja(t),no(t[0],2)),a=no(t[1],2),o=V.find(e,a),n=V.data().indexOf(o)||0,i=Sa(n),r=H.select("#addedLabels");r.size()||(r=H.append("g").attr("id","addedLabels").attr("fill","#3e3e4b").attr("opacity",1).attr("font-family","Almendra SC").attr("data-font","Almendra+SC").attr("font-size",18).attr("data-size",18));var s="label"+Date.now().toString().slice(7);r.append("text").attr("id",s).attr("x",e).attr("y",a).text(i).on("click",Ue),!1===d3.event.shiftKey&&($("#addLabel").removeClass("pressed"),Vt())}function e(){var t=d3.mouse(this),e=Ja(t),a=no(t[0],2),o=no(t[1],2),n=Q[e].culture;void 0===n&&(n=0);var i=Sa(n);if(Q[e].height<20)v("Cannot place burg in the water! Select a land cell",null,"error");else{if(void 0!==Q[e].manor)return v("There is already a burg in this cell. Please select a free cell",null,"error"),$("#grid").fadeIn(),void d3.select("#toggleGrid").classed("buttonoff",!1);var r=at.length,s=G.select("#towns").attr("size");G.select("#towns").append("circle").attr("id","burg"+r).attr("data-id",r).attr("cx",a).attr("cy",o).attr("r",s).on("click",qe),O.select("#towns").append("text").attr("data-id",r).attr("x",a).attr("y",o).attr("dy","-0.35em").text(i).on("click",qe),Et(),!1===d3.event.shiftKey&&($("#addBurg, #burgAdd, #burgAddfromEditor").removeClass("pressed"),Vt());var l,u=+$("#addBurg").attr("data-state");if(-1!==u){l="neutral"===ot[u].capital?"neutral":u;var c=Q[e].region;l!==c&&(Q[e].region=l,tn())}else l=Q[e].region,u="neutral"===l?ot.length-1:l;Q[e].manor=r;var d=Q[e].score;d<=0&&(d=no(Math.random(),2)),Q[e].crossroad&&(d+=Q[e].crossroad),Q[e].confluence&&(d+=Math.pow(Q[e].confluence,.3)),void 0!==Q[e].port&&(d*=3);var p=no(d,1);at.push({i:r,cell:e,x:a,y:o,region:l,culture:n,name:i,population:p}),qa(u),Qo(),v("",!0)}}function a(){var t=d3.mouse(this),e=i.find(t[0],t[1]).index,a=Q[e];if(!(a.river||a.height<20)){var o=[],n=$("#rivers > path").last(),r=n.length?+n.attr("id").slice(5)+1:0;a.flux=.85;var s=function(){a.river=r;var t=a.data[0],n=a.data[1];o.push({x:t,y:n,cell:e});var i=[];a.neighbors.forEach(function(t){i.push(Q[t].height)});var s=i.indexOf(d3.min(i)),l=a.neighbors[s],d=Q[l].data[0],p=Q[l].data[1];if(Q[l].height<20){var h=(t+d)/2,v=(n+p)/2;o.push({x:h,y:v,cell:e}),a=void 0}else if(void 0===Q[l].river)Q[l].flux+=a.flux,a=Q[l];else{var g=Q[l].river,m=$("#river"+g),f=$.grep(tt,function(t){return t.river===g});f.sort(function(t,e){return e.height-t.height});var b=$.grep(f,function(t){return t.height>Q[l].height});if(o.length>b.length){var y=no(precInput.value/Math.sqrt(Q.length),2),k=[];f.map(function(t){t.height<Q[l].height?(Q[t.index].river=void 0,Q[t.index].flux=y):k.push({x:t.data[0],y:t.data[1],cell:t.index})}),Q[l].flux+=a.flux,Q[l].confluence?Q[l].confluence+=b.length:Q[l].confluence=b.length,a=Q[l],k.length>1?(u=_e(k,1),c=je(u,1.3,1),m.attr("d",c).attr("data-width",1.3).attr("data-increment",1)):(m.remove(),k.map(function(t){Q[t.cell].river=void 0}))}else Q[l].confluence?Q[l].confluence+=o.length:Q[l].confluence=o.length,Q[l].flux+=a.flux,o.push({x:d,y:p,cell:l}),a=void 0}};while(a){s()}var l=.2+1.6*Math.random(),u=_e(o,l),c=je(u,1.3,1);S.append("path").attr("d",c).attr("id","river"+r).attr("data-width",1.3).attr("data-increment",1).on("click",Ve)}}function o(){var t=d3.mouse(this),e=Ja(t),a=Q[e].height;if(a<20)v("Cannot place icon in the water! Select a land cell");else{var o=no(t[0],2),n=no(t[1],2),i=reliefGroup.value;Da(a/100,i,o,n,e),!1===d3.event.shiftKey&&($("#addRelief").removeClass("pressed"),Vt()),v("",!0)}}function n(){var t=d3.mouse(this),e=no(t[0],2),a=no(t[1],2),o=markerSelectGroup.value,n=o&&1===d3.select("#defs-markers").select("#"+o).size(),i=n?"#"+o:"#marker0",r=n?F.select("[data-id='"+i+"']").attr("data-size"):1;isNaN(r)&&(r=1);var s="marker"+Date.now().toString().slice(7),l=5*r+25/bt;F.append("use").attr("id",s).attr("xlink:href",i).attr("data-id",i).attr("data-x",e).attr("data-y",a).attr("x",e-l/2).attr("y",a-l).attr("data-size",r).attr("width",l).attr("height",l).on("click",Xe),!1===d3.event.shiftKey&&($("#addMarker, #markerAdd").removeClass("pressed"),Vt())}W.clickToAdd||(W.clickToAdd=!0,$("#addLabel").click(function(){$(this).hasClass("pressed")?($(".pressed").removeClass("pressed"),Vt()):($(".pressed").removeClass("pressed"),$(this).addClass("pressed"),Fa(".stable"),h.style("cursor","crosshair").on("click",t))}),$("#addBurg").click(function(){$(this).hasClass("pressed")?($(".pressed").removeClass("pressed"),Vt(),v("",!0)):($(".pressed").removeClass("pressed"),$(this).attr("data-state",-1).addClass("pressed"),$("#burgAdd, #burgAddfromEditor").addClass("pressed"),h.style("cursor","crosshair").on("click",e),v("Click on map to place burg icon with a label. Hold Shift to place several",!0))}),$("#addRiver").click(function(){$(this).hasClass("pressed")?($(".pressed").removeClass("pressed"),Ze()):($(".pressed").removeClass("pressed"),Ze(),$(this).addClass("pressed"),Fa(".stable"),h.style("cursor","crosshair").on("click",a),v("Click on map to place new river or extend an existing one",!0))}),$("#addRelief").click(function(){$(this).hasClass("pressed")?($(".pressed").removeClass("pressed"),Vt()):($(".pressed").removeClass("pressed"),$(this).addClass("pressed"),Fa(".stable"),h.style("cursor","crosshair").on("click",o),v("Click on map to place relief icon. Hold Shift to place several",!0))}),$("#addRoute").click(function(){W.editRoute||Ye(),$("#routeNew").click()}),$("#addMarker").click(function(){$(this).hasClass("pressed")?($(".pressed").removeClass("pressed"),Vt()):($(".pressed").removeClass("pressed"),$(this).addClass("pressed"),$("#markerAdd").addClass("pressed"),h.style("cursor","crosshair").on("click",n))}))}function Ja(t){var e=i.find(t[0],t[1]);if(e)return e.index;console.error("Cannot find closest cell for points"+t[0]+", "+t[1])}function qa(t){var e=ot[t]||ot[ot.length-1];"neutral"===e.capital&&(t="neutral");var a=$.grep(at,function(e){return e.region===t});e.burgs=a.length;var o=0;a.map(function(t){o+=t.population}),e.urbanPopulation=no(o,1);var n=$.grep(Q,function(e){return e.region===t}),i=0,r=0;n.map(function(t){i+=t.pop,r+=t.area}),e.cells=n.length,e.area=no(r),e.ruralPopulation=no(i,1)}function Xa(){var t=d3.mouse(this),e=i.find(t[0],t[1]).index;if(!(Q[e].height<20)){var a;if($(".selected").removeClass("selected"),2===J){var o=x.select("#temp").select("path[data-cell='"+e+"']"),n=o.size()?o.attr("data-state"):Q[e].region;"neutral"===n&&(n=ot.length-1),a=ot[n].color,"neutral"===a&&(a="white"),$("#state"+n).addClass("selected")}if(4===J){var r=M.select("#cult"+e),s=null!==r.attr("data-culture")?+r.attr("data-culture"):Q[e].culture;a=lt[s].color,$("#culture"+s).addClass("selected")}j.selectAll(".circle").attr("stroke",a)}}function Za(){if(!$('link[href="fonts.css"]').length){$("head").append('<link rel="stylesheet" type="text/css" href="fonts.css">');var t=["Amatic+SC:700","IM+Fell+English","Great+Vibes","MedievalSharp","Metamorphous","Nova+Script","Uncial+Antiqua","Underdog","Caesar+Dressing","Bitter","Yellowtail","Montez","Shadows+Into+Light","Fredericka+the+Great","Orbitron","Dancing+Script:700","Architects+Daughter","Kaushan+Script","Gloria+Hallelujah","Satisfy","Comfortaa:700","Cinzel"];t.forEach(function(t){-1===rt.indexOf(t)&&rt.push(t)}),eo()}}function Qa(t){return new Promise(function(e,a){if(""!==t){-1===t.indexOf("http")&&(t=t.replace(t.charAt(0),t.charAt(0).toUpperCase()).split(" ").join("+"),t="https://fonts.googleapis.com/css?family="+t);to(t).then(function(t){void 0!==t?0!==t?(eo(),1===t?v("Font "+rt[rt.length-1]+" is fetched"):t>1&&v(t+" fonts are added to the list"),e(t)):v("Already in the fonts list!"):v("Cannot fetch font for this value!")})}else v("Use a direct link to any @font-face declaration or just font name to fetch from Google Fonts")})}function to(t){return $("head").append('<link rel="stylesheet" type="text/css" href="'+t+'">'),fetch(t).then(function(t){return t.text()}).then(function(t){var e=document.createElement("style");e.innerHTML=t,document.head.appendChild(e);var a=Array.prototype.filter.call(document.styleSheets,function(t){return t.ownerNode===e})[0],o=function(t){var e=t.style.getPropertyValue("font-family"),a=e.replace(/['"]+/g,"").replace(/ /g,"+"),o=t.style.getPropertyValue("font-weight");"400"!==o&&(a+=":"+o),-1==rt.indexOf(a)&&(rt.push(a),n++)},n=0,i=!0,r=!1,s=void 0;try{for(var l,u=a.cssRules[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){var c=l.value;o(c)}}catch(t){r=!0,s=t}finally{try{i||null==u.return||u.return()}finally{if(r)throw s}}return document.head.removeChild(e),n}).catch(function(){})}function eo(){labelFontSelect.innerHTML="";for(var t=0;t<rt.length;t++){var e=document.createElement("option");e.value=t;var a=rt[t].split(":")[0].replace(/\+/g," ");e.style.fontFamily=e.innerHTML=a,labelFontSelect.add(e)}burgSelectDefaultFont.innerHTML=labelFontSelect.innerHTML}function ao(t){return"#"===t.charAt(0)?t:(t=t.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i),t&&4===t.length?"#"+("0"+parseInt(t[1],10).toString(16)).slice(-2)+("0"+parseInt(t[2],10).toString(16)).slice(-2)+("0"+parseInt(t[3],10).toString(16)).slice(-2):"")}function oo(t,e){return void 0===t&&void 0===!e?Math.random():(void 0===e&&(e=t,t=0),Math.floor(Math.random()*(e-t+1))+t)}function no(t,e){e=e||0;var a=Math.pow(10,e);return Math.round(t*a)/a}function io(t,e){e=e||1;return t.replace(/[\d\.-][\d\.e-]*/g,function(t){return no(t,e)})}function ro(t){return t>=1e9?no(t/1e9,1)+"B":t>=1e8?no(t/1e6)+"M":t>=1e6?no(t/1e6,1)+"M":t>=1e4?no(t/1e3)+"K":t>=1e3?no(t/1e3,1)+"K":no(t)}function so(t){var e=t.slice(-1);return"K"===e?parseInt(1e3*t.slice(0,-1)):"M"===e?parseInt(1e6*t.slice(0,-1)):"B"===e?parseInt(1e9*t.slice(0,-1)):parseInt(t)}function lo(t){console.time("saveAsImage");var e=["Georgia","Times+New+Roman","Comic+Sans+MS","Lucida+Sans+Unicode","Courier+New","Verdana","Arial","Impact"],a=[];H.selectAll("g").each(function(t){var o=d3.select(this).attr("data-font");o&&-1===e.indexOf(o)&&-1===a.indexOf(o)&&a.push(o)});var o="https://fonts.googleapis.com/css?family="+a.join("|"),n=document.getElementsByTagName("svg")[0].cloneNode(!0);n.id="fantasyMap",document.getElementsByTagName("body")[0].appendChild(n);var i=d3.select("#fantasyMap");if("svg"===t){if(i.attr("width",Ct).attr("height",St),i.select("#viewbox").attr("transform",null),wt!==Ct||Mt!==St){var r=i.select("#scaleBar");if(!r.size())return;var s=r.select("rect").node().getBBox(),l=[Ct-s.width,St-(s.height-10)];r.attr("transform","translate("+no(l[0])+","+no(l[1])+")")}i.selectAll("use").each(function(){var t=this.parentNode.getAttribute("size")||1;this.setAttribute("width",t+"px"),this.setAttribute("height",t+"px")})}var u=i.append("g").node(),c=window.getComputedStyle(u);i.select("#labels").selectAll(".hidden").each(function(t){var e=d3.select(this).attr("font-size");d3.select(this).classed("hidden",!1).attr("font-size",no(.4*e,2))}),i.selectAll("g, #ruler > g > *, #scaleBar > text").each(function(t){for(var e=window.getComputedStyle(this),a="",o=0;o<e.length;o++){var n=e[o],i=e.getPropertyValue(n);"mask-image"!==n||i===c.getPropertyValue(n)?"cursor"!==n&&(this.hasAttribute(n)||i!==c.getPropertyValue(n)&&(a+=n+":"+i+";")):a+="mask-image: url('#shape');"}""!=a&&this.setAttribute("style",a)}),u.remove(),uo(o).then(function(e){i.select("defs").append("style").text(e.join("\n"));var a=(new XMLSerializer).serializeToString(i.node());i.remove();var o=new Blob([a],{type:"image/svg+xml;charset=utf-8"}),n=window.URL.createObjectURL(o),r=document.createElement("a");if(r.target="_blank","png"===t){ht.width=wt*pngResolutionInput.value,ht.height=Mt*pngResolutionInput.value;var s=new Image;s.src=n,s.onload=function(){window.URL.revokeObjectURL(n),vt.drawImage(s,0,0,ht.width,ht.height),r.download="fantasy_map_"+Date.now()+".png",ht.toBlob(function(t){r.href=window.URL.createObjectURL(t),document.body.appendChild(r),r.click(),window.setTimeout(function(){window.URL.revokeObjectURL(r.href)},5e3)}),ht.style.opacity=0,ht.width=wt,ht.height=Mt}}else r.download="fantasy_map_"+Date.now()+".svg",r.href=n,document.body.appendChild(r),r.click();console.timeEnd("saveAsImage"),window.setTimeout(function(){window.URL.revokeObjectURL(n)},5e3)})}function uo(t){return fetch(t).then(function(t){return t.text()}).then(function(t){var e=document.createElement("style");e.innerHTML=t,document.head.appendChild(e);var a=Array.prototype.filter.call(document.styleSheets,function(t){return t.ownerNode===e})[0],o=function(t){var e=t.style.getPropertyValue("src"),a=(t.style.getPropertyValue("font-family"),e.split("url(")[1].split(")")[0]);return{rule:t,src:e,url:a.substring(a.length-1,1)}},n=[],i=[],r=!0,s=!1,l=void 0;try{for(var u,c=function(){var t=u.value,e=o(t);n.push(e),i.push(fetch(e.url).then(function(t){return t.blob()}).then(function(t){return new Promise(function(e){var a=new FileReader;a.onload=function(t){return e(a.result)},a.readAsDataURL(t)})}).then(function(t){return e.rule.cssText.replace(e.url,t)}))},d=a.cssRules[Symbol.iterator]();!(r=(u=d.next()).done);r=!0)c()}catch(t){s=!0,l=t}finally{try{r||null==d.return||d.return()}finally{if(s)throw l}}return document.head.removeChild(e),Promise.all(i)})}function co(){console.time("saveMap");var e=new Date,o=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate(),n="File can be loaded in azgaar.github.io/Fantasy-Map-Generator",i=t+"|"+n+"|"+o+"|"+a,r=J+"|"+distanceUnit.value+"|"+distanceScale.value+"|"+areaUnit.value+"|"+barSize.value+"|"+barLabel.value+"|"+barBackOpacity.value+"|"+barBackColor.value+"|"+populationRate.value+"|"+urbanization.value;l.attr("width",Ct).attr("height",St);var s=d3.zoomTransform(l.node());h.attr("transform",null);var u=g.select("rect"),c=[u.attr("x"),u.attr("y"),u.attr("width"),u.attr("height")];u.attr("x",0).attr("y",0).attr("width",Ct).attr("height",St);var d=(new XMLSerializer).serializeToString(l.node()),p="\r\n",v=i+p+JSON.stringify(Y)+p+JSON.stringify(Q)+p;v+=JSON.stringify(at)+p+JSON.stringify(ot)+p+d+p+r+p,v+=JSON.stringify(lt)+p+""+p+p+K+p+JSON.stringify(it)+p;var m=new Blob([v],{type:"text/plain"}),f=window.URL.createObjectURL(m),b=document.createElement("a");b.download="fantasy_map_"+Date.now()+".map",b.href=f,document.body.appendChild(b),b.click(),l.attr("width",wt).attr("height",Mt),yt.transform(l,s),u.attr("x",c[0]).attr("y",c[1]).attr("width",c[2]).attr("height",c[3]),console.timeEnd("saveMap"),window.setTimeout(function(){window.URL.revokeObjectURL(f)},4e3)}function po(e,a){console.time("loadMap");var o=new FileReader;o.onload=function(e){var a=e.target.result,o=a.split("\r\n"),n=o[0].split("|"),i=n[0]||o[0];if(i!==t){var r="The Map version ";i.length<=10?r+="(".concat(i,") does not match the Generator version (").concat(t,'). The map will be auto-updated.\n                      In case of critical issues you may send the .map file\n                      <a href="mailto:maxganiev@yandex.ru?Subject=Map%20update%20request" target="_blank">to me</a>\n                      or just keep using\n                      <a href="https://github.com/Azgaar/Fantasy-Map-Generator/wiki/Changelog" target="_blank">an appropriate version</a>\n                      of the Generator'):(!i||parseFloat(i)<.54)&&(r+='you are trying to load is too old and cannot be updated. Please re-create the map or just keep using\n                      <a href="https://github.com/Azgaar/Fantasy-Map-Generator/wiki/Changelog" target="_blank">an archived version</a>\n                      of the Generator. Please note the Generator is still on demo and a lot of changes are being made every month'),alertMessage.innerHTML=r,$("#alert").dialog({title:"Warning",buttons:{OK:function(){ho(o)}}})}else ho(o);i.length>10&&console.error("Cannot load map")},o.readAsText(e,"UTF-8"),a&&a()}function ho(t){Fa();var e=t[0].split("|");if(e[3]&&(a=e[3],optionsSeed.value=a),"0.52b"===t[0]||"0.53b"===t[0])J=0;else if(t[6]){var o=t[6].split("|");J=+o[0]||0,o[1]&&(distanceUnit.value=o[1]),o[2]&&(distanceScale.value=o[2]),o[3]&&(areaUnit.value=o[3]),o[4]&&(barSize.value=o[4]),o[5]&&(barLabel.value=o[5]),o[6]&&(barBackOpacity.value=o[6]),o[7]&&(barBackColor.value=o[7]),o[8]&&(populationRate.value=o[8]),o[9]&&(urbanization.value=o[9])}l.remove(),"0.52b"===t[0]||"0.53b"===t[0]?(ot=[],document.body.insertAdjacentHTML("afterbegin",t[4])):(ot=JSON.parse(t[4]),document.body.insertAdjacentHTML("afterbegin",t[5])),l=d3.select("svg");var i=+l.attr("width"),r=+l.attr("height");Ct=i,St=r,n=d3.voronoi().extent([[-1,-1],[Ct+1,St+1]]),yt.translateExtent([[0,0],[Ct,St]]).scaleExtent([1,20]).scaleTo(l,1),h.attr("transform",null),l.attr("width",wt).attr("height",Mt),i!==wt||r!==Mt?(alertMessage.innerHTML="The loaded map has size ".concat(i," x ").concat(r," pixels, while the current canvas size is ").concat(wt," x ").concat(Mt,' pixels.\n                                Click "Rescale" to fit the map to the current canvas size. Click "OK" to browse the map without rescaling'),$("#alert").dialog({title:"Map size conflict",buttons:{Rescale:function(){vo(t);var e=wt/i,a=Mt/r,o=no(Math.min(e,a),4),n=100/o+"%",s=(i*o-wt)/2/o,u=(r*o-Mt)/2/o;l.select("#ocean").selectAll("rect").attr("x",s).attr("y",u).attr("width",n).attr("height",n),yt.translateExtent([[0,0],[i,r]]).scaleExtent([o,20]).scaleTo(l,o),$(this).dialog("close")},OK:function(){sn(),vo(t),$(this).dialog("close")}}})):vo(t)}function vo(t){if(p=l.select("#deftemp"),h=l.select("#viewbox"),g=h.select("#ocean"),m=g.select("#oceanLayers"),f=g.select("#oceanPattern"),b=h.select("#landmass"),k=h.select("#grid"),C=h.select("#overlay"),y=h.select("#terrs"),M=h.select("#cults"),z=h.select("#routes"),T=z.select("#roads"),L=z.select("#trails"),S=h.select("#rivers"),w=h.select("#terrain"),x=h.select("#regions"),A=h.select("#borders"),B=A.select("#stateBorders"),E=A.select("#neutralBorders"),P=h.select("#coastline"),I=h.select("#lakes"),R=z.select("#searoutes"),H=h.select("#labels"),N=h.select("#icons"),F=h.select("#markers"),_=h.select("#ruler"),j=h.select("#debug"),!d3.select("#defs-markers").size()){var e='<g id="defs-markers"><symbol id="marker0" viewBox="0 0 30 30"><path d="M6,19 l9,10 L24,19" fill="#000000" stroke="none"></path><circle cx="15" cy="15" r="10" stroke-width="1" stroke="#000000" fill="#ffffff"></circle><text x="50%" y="50%" fill="#000000" stroke-width="0" stroke="#000000" font-size="22px" dominant-baseline="central">?</text></symbol></g>',a=document.getElementsByTagName("defs");a[0].insertAdjacentHTML("afterbegin",e),F=h.append("g").attr("id","markers")}H.select("#burgLabels").size()||(H.append("g").attr("id","burgLabels"),$("#labels #capitals, #labels #towns").detach().appendTo($("#burgLabels"))),N.select("#burgIcons").size()||(N.append("g").attr("id","burgIcons"),$("#icons #capitals, #icons #towns").detach().appendTo($("#burgIcons")),N.select("#burgIcons").select("#capitals").attr("size",1).attr("fill-opacity",.7).attr("stroke-opacity",1),N.select("#burgIcons").select("#towns").attr("size",.5).attr("fill-opacity",.7).attr("stroke-opacity",1)),N.selectAll("g").each(function(){var t=this.getAttribute("font-size");null!==t&&void 0!==t&&(this.removeAttribute("font-size"),this.setAttribute("size",t))}),N.select("#burgIcons").selectAll("circle").each(function(){this.setAttribute("r",this.parentNode.getAttribute("size"))}),N.selectAll("use").each(function(){var t=this.parentNode.getAttribute("size");null!==t&&void 0!==t&&(this.setAttribute("width",t),this.setAttribute("height",t))}),H.select("#countries").size()||H.append("g").attr("id","countries").attr("fill","#3e3e4b").attr("opacity",1).attr("font-family","Almendra SC").attr("data-font","Almendra+SC").attr("font-size",14).attr("data-size",14),O=H.select("#burgLabels"),G=N.select("#burgIcons"),l.call(yt),Vt(),h.on("touchmove mousemove",_t),C.selectAll("*").call(d3.drag().on("start",Ie)),w.selectAll("g").selectAll("g").on("click",Je),H.selectAll("text").on("click",Ue),N.selectAll("circle, path, use").on("click",We),O.selectAll("text").on("click",qe),G.selectAll("circle, path, use").on("click",qe),S.selectAll("path").on("click",Ve),z.selectAll("path").on("click",Ye),F.selectAll("use").on("click",Xe),l.select("#scaleBar").call(d3.drag().on("start",Ie)).on("click",Xo),_.selectAll("g").call(d3.drag().on("start",Ie)),_.selectAll("g").selectAll("text").on("click",Yt),_.selectAll(".opisometer").selectAll("circle").call(d3.drag().on("start",Le)),_.selectAll(".linear").selectAll("circle:not(.center)").call(d3.drag().on("drag",ze)),_.selectAll(".linear").selectAll("circle.center").call(d3.drag().on("drag",Te));var o=[];function n(){var t=Math.floor(Math.random()*Ct*.8+.1*Ct),e=Math.floor(Math.random()*St*.8+.1*St);return[t,e]}et=[],[],D="",Y=JSON.parse(t[1]),Q=JSON.parse(t[2]),at=JSON.parse(t[3]),t[7]&&(lt=JSON.parse(t[7])),void 0===t[7]&&ea(),t[11]&&(it=JSON.parse(t[11])),dt[0]||Ot(),lt.forEach(function(t){var e=t.base;void 0===e&&(t.base=0),dt[e]&&ct[e]||(t.base=0),void 0===t.center&&(t.center=n())});var s=90/Math.sqrt(Q.length,2);if(Q.forEach(function(t,e){if(o.push(t.data),t.height<1&&(t.height=Math.trunc(100*t.height)),1===t.height&&void 0!==t.region&&void 0!==t.flux&&(t.height=100),t.culture>lt.length-1){var a=[t.data[0],t.data[1]],n={name:"AUTO_"+t.culture,color:"#ff0000",base:0,center:a};lt.push(n)}if(t.height>=20){if(!r[e]||!r[e].length)return;if(void 0===t.area||isNaN(t.area)){var i=d3.polygonArea(r[e]);t.area=no(Math.abs(i),2)}if(void 0===t.pop||isNaN(t.pop)){var l=0,u=Math.pow((100-t.height)/100,3);l=u*t.area*s,"neutral"===t.region&&(l*=.5),t.pop=no(l,1)}(void 0===t.culture||isNaN(t.culture))&&(t.culture=0)}}),tt=$.grep(Q,function(t){return t.height>=20}),Ft(o),t[10])K=new Uint8Array(t[10].split(","));else{K=new Uint8Array(Y.length);for(var u=0;u<Y.length;u++){var c=i.find(Y[u][0],Y[u][1]).index;K[u]=Q[c].height}}1===J&&(optionsTrigger.click(),$("#customizeHeightmap, #customizationMenu").slideDown(),$("#openEditor").slideUp(),Me(),customizeTab.click(),paintBrushes.click(),v("The map is in Heightmap customization mode. Please finalize the Heightmap",!0)),2!==J&&3!==J||v("The map is in Country Edition mode. Please complete the assignment",!0),d3.select("#toggleCultures").classed("buttonoff",!M.selectAll("path").size()),d3.select("#toggleHeight").classed("buttonoff",!y.selectAll("path").size()),d3.select("#toggleCountries").classed("buttonoff","none"===x.style("display")),d3.select("#toggleRivers").classed("buttonoff","none"===S.style("display")),d3.select("#toggleOcean").classed("buttonoff","none"===f.style("display")),d3.select("#toggleRelief").classed("buttonoff","none"===w.style("display")),d3.select("#toggleBorders").classed("buttonoff","none"===A.style("display")),d3.select("#toggleIcons").classed("buttonoff","none"===N.style("display")),d3.select("#toggleLabels").classed("buttonoff","none"===H.style("display")),d3.select("#toggleRoutes").classed("buttonoff","none"===z.style("display")),d3.select("#toggleGrid").classed("buttonoff","none"===k.style("display")),H.selectAll("g").each(function(t){var e=d3.select(this);if("burgLabels"!==e.attr("id")){var a=e.attr("data-font");a&&-1===rt.indexOf(a)&&to("https://fonts.googleapis.com/css?family="+a),e.attr("data-size")||e.attr("data-size",+e.attr("font-size")),"none"===e.style("display")&&(e.node().style.display=null)}}),Et(),console.timeEnd("loadMap")}function go(){var t=no((Ct+St)/1500,2);s=no(7.5*t/U,2);for(var e=s/2,a=.9*e,o=function(){return 2*Math.random()*a-a},n=[],i=e;i<St;i+=s)for(var r=e;r<Ct;r+=s){var l=no(r+o(),2),u=no(i+o(),2);n.push([l,u])}return n}function mo(t,e){var a=fo(e.item.attr("id"));if(a){var o=fo(e.item.prev().attr("id")),n=fo(e.item.next().attr("id"));o?a.insertAfter(o):n&&a.insertBefore(n)}}function fo(t){return"toggleGrid"===t?$("#grid"):"toggleOverlay"===t?$("#overlay"):"toggleHeight"===t?$("#terrs"):"toggleCultures"===t?$("#cults"):"toggleRoutes"===t?$("#routes"):"toggleRivers"===t?$("#rivers"):"toggleCountries"===t?$("#regions"):"toggleBorders"===t?$("#borders"):"toggleRelief"===t?$("#terrain"):"toggleLabels"===t?$("#labels"):"toggleIcons"===t?$("#icons"):void 0}function bo(t){Fa();var e=[],a=[];if("clean"!==t)for(var o=0;o<Y.length;o++){var n=i.find(Y[o][0],Y[o][1]).index;2===Q[n].lake&&Q[n].neighbors.forEach(function(t){Q[t].height>=20&&(n=t)});var r=Q[n].region;void 0===r&&(r=-1),e.push(r);var s=Q[n].culture;void 0===s&&(s=-1),a.push(s)}else Oo();if(Ft(Y),Qt("grid"),$e(),"keep"===t){l.selectAll("#lakes, #coastline, #terrain, #rivers, #grid, #terrs, #landmass, #ocean, #regions").selectAll("path, circle, line").remove(),l.select("#shape").remove();for(var u=0;u<Y.length;u++)-1!==e[u]&&(Q[u].region=e[u]),-1!==a[u]&&(Q[u].culture=a[u])}Ce(),No(),yo()}function yo(){$("#brushesPanel").is(":visible")||($("#brushesPanel").dialog({title:"Paint Brushes",minHeight:40,width:"auto",maxWidth:200,resizable:!1,position:{my:"right top",at:"right-10 top+10",of:"svg"}}).on("dialogclose",function(){Vt(),$("#brushesButtons > .pressed").removeClass("pressed")}),W.openBrushesPanel||(W.openBrushesPanel=!0,$("#brushesButtons > button").on("click",function(){var t=$("#brushRadiusLabel, #brushRadius");if(j.selectAll(".circle, .tag, .line").remove(),$(this).hasClass("pressed"))$(this).removeClass("pressed"),Vt(),t.attr("disabled",!0).addClass("disabled");else{$("#brushesButtons > .pressed").removeClass("pressed"),$(this).addClass("pressed"),h.style("cursor","crosshair");var e=this.id;"brushRange"===e||"brushTrough"===e?h.on("click",Zt):h.call(xt).on("click",null),$(this).hasClass("feature")?t.attr("disabled",!0).addClass("disabled"):t.attr("disabled",!1).removeClass("disabled")}})))}function ko(){console.time("drawPerspective");var t=320,e=180,a=Ct/t,o=St/e,n=320,i=90,r=document.getElementById("perspective"),s=r.getContext("2d"),l=[],u=n;while(u--){var d=u/n*t|0,p=[];l.push(p);var h=Math.floor(i);while(h--){var v=h/i*e|0,g=Co(d*a,v*o),m=K[g]-20;m<1&&(m=0),p.push([d,v,m])}}s.clearRect(0,0,r.width,r.height);for(var f=0;f<l.length;f++){for(var b=l[f],y=0;y<b.length-1;y++){var k=b[y],C=b[y+1],S=(k[2]+C[2])/200;s.beginPath(),s.moveTo.apply(s,Object(c["a"])(So(k))),s.lineTo.apply(s,Object(c["a"])(So(C)));var w="rgb(81, 103, 169)";0!==S&&(w=gt(1-S-.2)),s.strokeStyle=w,s.stroke()}for(var M=0;M<b.length-1;M++);}console.timeEnd("drawPerspective")}function Co(t,e){var a=i.find(t,e).index;return a}function So(t){var e=320,a=.2,o=wo(t[0],t[1]),n=Object(u["a"])(o,2),i=n[0],r=n[1];return[i+e/2+10,r+10-t[2]*a]}function wo(t,e){var a=1,o=4;return[(t-e)*a,(t+e)/o*a]}function Mo(){if("interval"===this.value){var t=prompt("Populate a height interval (e.g. from 17 to 20), without space, but with hyphen","17-20");if(t){var e='<option value="'+t+'">'+t+"</option>";$(this).append(e).val(t)}}}function xo(t){$("#templateBody").empty(),$("#templateSelect").attr("data-prev",t),"templateVolcano"===t&&(Ao("Mountain"),Ao("Add",10),Ao("Hill",5,.35),Ao("Range",3),Ao("Trough",-4)),"templateHighIsland"===t&&(Ao("Mountain"),Ao("Add",10),Ao("Range",6),Ao("Hill",12,.25),Ao("Trough",3),Ao("Multiply",.75,"land"),Ao("Pit",1),Ao("Hill",3,.15)),"templateLowIsland"===t&&(Ao("Mountain"),Ao("Add",10),Ao("Smooth",2),Ao("Range",2),Ao("Hill",4,.4),Ao("Hill",12,.2),Ao("Trough",8),Ao("Multiply",.35,"land")),"templateContinents"===t&&(Ao("Mountain"),Ao("Add",10),Ao("Hill",30,.25),Ao("Strait","4-7"),Ao("Pit",10),Ao("Trough",10),Ao("Multiply",.6,"land"),Ao("Smooth",2),Ao("Range",3)),"templateArchipelago"===t&&(Ao("Mountain"),Ao("Add",10),Ao("Hill",12,.15),Ao("Range",8),Ao("Strait","2-3"),Ao("Trough",15),Ao("Pit",10),Ao("Add",-5,"land"),Ao("Multiply",.7,"land"),Ao("Smooth",3)),"templateAtoll"===t&&(Ao("Mountain"),Ao("Add",10,"all"),Ao("Hill",2,.35),Ao("Range",2),Ao("Smooth",1),Ao("Multiply",.1,"27-100")),"templateMainland"===t&&(Ao("Mountain"),Ao("Add",10,"all"),Ao("Hill",30,.2),Ao("Range",10),Ao("Pit",20),Ao("Hill",10,.15),Ao("Trough",10),Ao("Multiply",.4,"land"),Ao("Range",10),Ao("Smooth",3)),"templatePeninsulas"===t&&(Ao("Add",15),Ao("Hill",30,0),Ao("Range",5),Ao("Pit",15),Ao("Strait","15-20")),$("#templateBody").attr("data-changed",0)}function Ao(t,e,a){if(t&&("Mountain"===t&&templateMountain.click(),"Hill"===t&&templateHill.click(),"Pit"===t&&templatePit.click(),"Range"===t&&templateRange.click(),"Trough"===t&&templateTrough.click(),"Strait"===t&&templateStrait.click(),"Add"===t&&templateAdd.click(),"Multiply"===t&&templateMultiply.click(),"Smooth"===t&&templateSmooth.click(),e&&$("#templateBody div:last-child .templateElCount").val(e),void 0!==a)){if("land"!==a){var o='<option value="'+a+'">'+a+"</option>";$("#templateBody div:last-child .templateElDist").append(o)}$("#templateBody div:last-child .templateElDist").val(a)}}function Bo(){ht.width=wt,ht.height=Mt,$(".pressed").removeClass("pressed"),Vt();var t=d3.select("#colorScheme");if(0===t.selectAll("*").size()){for(var e=0;e<=100;e++){var a=e<20||e>70?"1px":"3px";0===e&&(a="4px");var o=gt(1-e/100),n="background-color: "+o+"; width: "+a;t.append("div").attr("data-color",e).attr("style",n)}t.selectAll("*").on("touchmove mousemove",zo).on("click",To)}$("#imageConverter").is(":visible")||$("#imageConverter").dialog({title:"Image to Heightmap Converter",minHeight:30,width:260,resizable:!1,position:{my:"right top",at:"right-10 top+10",of:"svg"}}).on("dialogclose",function(){Ho()})}function $o(t){var e=vt.getImageData(0,0,wt,Mt),a=e.data;$("#landmass > path, .color-div").remove(),$("#landmass, #colorsUnassigned").fadeIn(),$("#colorsAssigned").fadeOut();var o=[],n=[];Y.map(function(t){var e=no(t[0]),n=no(t[1]);n==Mt&&n--,e==wt&&e--;var i=4*(e+n*wt),r=a[i],s=a[i+1],l=a[i+2];o.push([r,s,l])});var i=MMCQ.quantize(o,t);K=new Uint8Array(Y.length),r.map(function(t,e){var a=i.nearest(o[e]),r="rgb("+a[0]+", "+a[1]+", "+a[2]+")",s=ao(r);-1===n.indexOf(s)&&n.push(s),b.append("path").attr("d","M"+t.join("L")+"Z").attr("data-i",e).attr("fill",s).attr("stroke",s)}),b.selectAll("path").on("click",Eo),n.sort(function(t,e){return d3.lab(t).b-d3.lab(e).b}).map(function(t){$("#colorsUnassigned").append('<div class="color-div" id="'+t.substr(1)+'" style="background-color: '+t+';"/>')}),$(".color-div").click(Io)}function Eo(){var t=d3.select(this).attr("fill");$("#"+t.slice(1)).click()}function Io(){b.selectAll(".selectedCell").classed("selectedCell",0);var t=d3.select(this);if(t.classed("selectedColor"))t.classed("selectedColor",0);else{if($(".selectedColor").removeClass("selectedColor"),t.classed("selectedColor",1),$("#colorScheme .hoveredColor").removeClass("hoveredColor"),$("#colorsSelectValue").text(0),t.attr("data-height")){var e=t.attr("data-height");$("#colorScheme div[data-color='"+e+"']").addClass("hoveredColor"),$("#colorsSelectValue").text(e)}var a="#"+d3.select(this).attr("id");b.selectAll("path").classed("selectedCell",0),b.selectAll("path[fill='"+a+"']").classed("selectedCell",1)}}function zo(){var t=d3.select(this),e=t.attr("data-color");$("#colorsSelectValue").text(e),$("#colorScheme .hoveredColor").removeClass("hoveredColor"),t.classed("hoveredColor",1)}function To(){var t=$(".selectedColor")[0],e=+d3.select(this).attr("data-color"),a=gt(1-e/100),o=ao(a);t.style.backgroundColor=a,t.setAttribute("data-height",e);t.id;t.id=o.substr(1),b.selectAll(".selectedCell").each(function(){d3.select(this).attr("fill",o).attr("stroke",o);var t=+d3.select(this).attr("data-i");K[t]=e});var n=t.parentNode;"colorsUnassigned"===n.id&&(colorsAssigned.appendChild(t),$("#colorsAssigned").fadeIn(),$("#colorsUnassigned .color-div").length<1&&$("#colorsUnassigned").fadeOut()),$("#colorsAssigned .color-div").length>1&&Lo()}function Lo(){var t=[],e=d3.select("#colorsAssigned").selectAll(".color-div");e.each(function(e){var a=d3.select(this).attr("id"),o=+d3.select(this).attr("data-height");t.push({id:a,height:o})}),t.sort(function(t,e){return t.height-e.height}).map(function(t){$("#colorsAssigned").append($("#"+t.id))})}function Ro(t){var e=vt.getImageData(0,0,wt,Mt),a=e.data;$("#landmass > path, .color-div").remove(),$("#colorsAssigned").fadeIn(),$("#colorsUnassigned").fadeOut(),r.forEach(function(e,o){var n=no(e.data[0]),i=no(e.data[1]);i==Mt&&i--,n==wt&&n--;var r=4*(n+i*wt),s=a[r],l=a[r+1],u=a[r+2],c=d3.lab("rgb("+s+", "+l+", "+u+")");if("hue"===t)var d=no(Po(c.b+c.a/2,-50,200),2);else d=no(Po(c.l,0,100),2);var p=gt(1-d),h=ao(p);K[o]=100*d,b.append("path").attr("d","M"+e.join("L")+"Z").attr("data-i",o).attr("fill",h).attr("stroke",h)});var o=Object(c["a"])(new Set(K)).sort();o.forEach(function(t){var e=gt(1-t/100),a=ao(e);$("#colorsAssigned").append('<div class="color-div" id="'+a.substr(1)+'" data-height="'+t+'" style="background-color: '+a+';"/>')}),$(".color-div").click(Io)}function Po(t,e,a){var o=(t-e)/(a-e);return o<0&&(o=0),o>1&&(o=1),o}function Ho(){Ce(),Ae(),$(".color-div").remove(),$("#colorsAssigned, #colorsUnassigned").fadeOut(),k.attr("stroke-width",.1),ht.style.opacity=convertOverlay.value=convertOverlayValue.innerHTML=0,h.style("cursor","crosshair").call(xt),$("#imageConverter").dialog("close")}function Oo(){h.selectAll("path, circle, line, text, use, #ruler > g").remove(),p.selectAll("*").remove(),b.select("rect").remove(),Q=[],tt=[],et=[],at=[],ot=[],nt=[],[]}function No(){J=1,v('Heightmap customization mode is active. Click on "Complete" to finalize the Heightmap',!0),$("#getMap").removeClass("buttonoff").addClass("glow"),$t(),landmassCounter.innerHTML="0",$("#grid").fadeIn(),$("#toggleGrid").removeClass("buttonoff"),Ae(),$("#customizationMenu").slideDown(),$("#openEditor").slideUp()}function Go(){J=0,v("",!0),ht.style.opacity=0,$("#customizationMenu").slideUp(),$("#getMap").addClass("buttonoff").removeClass("glow"),$("#landmass").empty(),$("#grid").empty().fadeOut(),$("#toggleGrid").addClass("buttonoff"),Vt(),$("#toggleHeight").hasClass("buttonoff")||Ra(),Fa(),q=[],X=0,$("#customizeHeightmap").slideUp(),$("#openEditor").slideDown(),j.selectAll(".circle, .tag, .line").remove()}function Fo(){M.selectAll("path").size()&&$("#toggleCultures").click(),"none"===x.style("display")&&$("#toggleCountries").click(),layoutPreset.value="layoutPolitical",$("#countriesBody").empty(),$("#countriesHeader").children().removeClass("icon-sort-name-up icon-sort-name-down icon-sort-number-up icon-sort-number-down");var t,e,a=0,o=0;t="square"===areaUnit.value?" "+distanceUnit.value+"²":" "+areaUnit.value;for(var n=0,i=0;i<ot.length;i++){$("#countriesBody").append('<div class="states" id="state'+i+'"></div>');var r=$("#countriesBody div:last-child"),s=ot[i].burgs;o+=s;var l=no(ot[i].area*Math.pow(distanceScale.value,2));a+=l,e=ro(l)+t;var u=no(ot[i].urbanPopulation*urbanization.value*populationRate.value),c=no(ot[i].ruralPopulation*populationRate.value),d=1e3*(u+c);n+=d;var p=ro(d),g="'Total population: "+p+"; Rural population: "+c+"K; Urban population: "+u+"K'",m="neutral"===ot[i].color||"neutral"===ot[i].capital;if(m)r.append('<input class="stateColor placeholder" disabled type="color"/>'),r.append('<input onmouseover="tip(\'Neutral burgs are united into this group. Click to change the group name\')" class="stateName italic" id="stateName'+i+'" value="'+ot[i].name+'" autocorrect="off" spellcheck="false"/>'),r.append('<span class="icon-star-empty placeholder"></span>'),r.append('<input class="stateCapital placeholder"/>'),r.append('<span class="icon-resize-full hidden placeholder"></span>'),r.append('<input class="statePower hidden placeholder" value="0.0"/>');else{r.append('<input onmouseover="tip(\'Country color. Click to change\')" class="stateColor" type="color" value="'+ot[i].color+'"/>'),r.append('<input onmouseover="tip(\'Country name. Click and type to change\')" class="stateName" value="'+ot[i].name+'" autocorrect="off" spellcheck="false"/>');var f="select"!==ot[i].capital?at[ot[i].capital].name:"select";"select"===f?r.append('<button onmouseover="tip(\'Click on map to select a capital or to create a new capital\')" class="selectCapital" id="selectCapital'+i+'">★ select</button>'):(r.append('<span onmouseover="tip(\'Country capital. Click to enlange\')" class="icon-star-empty enlange"></span>'),r.append('<input onmouseover="tip(\'Capital name. Click and type to rename\')" class="stateCapital" value="'+f+'" autocorrect="off" spellcheck="false"/>')),r.append('<span onmouseover="tip(\'Country expansionism (defines competitive size)\')" class="icon-resize-full hidden"></span>'),r.append('<input onmouseover="tip(\'Capital expansionism (defines competitive size)\')" class="statePower hidden" type="number" min="0" max="99" step="0.1" value="'+ot[i].power+'"/>')}r.append('<span onmouseover="tip(\'Cells count\')" class="icon-check-empty"></span>'),r.append('<div onmouseover="tip(\'Cells count\')" class="stateCells">'+ot[i].cells+"</div>"),r.append('<span onmouseover="tip(\'Burgs count. Click to see a full list\')" style="padding-right: 1px" class="stateBIcon icon-dot-circled"></span>'),r.append('<div onmouseover="tip(\'Burgs count. Click to see a full list\')" class="stateBurgs">'+s+"</div>"),r.append("<span onmouseover=\"tip('Country area: "+(l+t)+'\')" style="padding-right: 4px" class="icon-map-o"></span>'),r.append("<div onmouseover=\"tip('Country area: "+(l+t)+'\')" class="stateArea">'+e+"</div>"),r.append('<span onmouseover="tip('+g+')" class="icon-male"></span>'),r.append('<input onmouseover="tip('+g+')" class="statePopulation" value="'+p+'">'),m?r.attr("data-country","bottom").attr("data-capital","bottom").attr("data-expansion","bottom").attr("data-cells",ot[i].cells).attr("data-burgs",ot[i].burgs).attr("data-area",l).attr("data-population",d):(r.append('<span onmouseover="tip(\'Remove country, all assigned cells will become Neutral\')" class="icon-trash-empty"></span>'),r.attr("data-country",ot[i].name).attr("data-capital",f).attr("data-expansion",ot[i].power).attr("data-cells",ot[i].cells).attr("data-burgs",ot[i].burgs).attr("data-area",l).attr("data-population",d))}function b(){var t=d3.mouse(this),e=Ja(t),a=no(t[0],2),o=no(t[1],2);if(Q[e].height<20)v("Cannot place capital on the water! Select a land cell");else{var n=+$(".selectCapital.pressed").attr("id").replace("selectCapital",""),i=Q[e].region;if("neutral"===i&&(i=ot.length-1),void 0!==Q[e].manor){var r=Q[e].manor;if(ot[i].capital===r)return void v("Existing capital cannot be selected as a new state capital! Select other cell");var s=.9;at[r].region=n,"neutral"===i&&(at[r].population*=1/s),at[r].population*=2,ot[n].capital=r,ta(r,"capitals")}else{var l=V.find(a,o),u=V.data().indexOf(l)||0,c=Sa(u),d=at.length;Q[e].manor=d,ot[n].capital=d;var p=Q[e].score;p<=0&&(p=no(Math.random(),2)),Q[e].crossroad&&(p+=Q[e].crossroad),Q[e].confluence&&(p+=Math.pow(Q[e].confluence,.3)),void 0!==Q[e].port&&(p*=3);var h=no(p,1);at.push({i:d,cell:e,x:a,y:o,region:n,culture:u,name:c,population:h}),G.select("#capitals").append("circle").attr("id","burg"+d).attr("data-id",d).attr("cx",a).attr("cy",o).attr("r",1).on("click",qe),O.select("#capitals").append("text").attr("data-id",d).attr("x",a).attr("y",o).attr("dy","-0.35em").text(c).on("click",qe)}Q[e].region=n,Q[e].neighbors.map(function(t){Q[t].height<20||void 0===Q[t].manor&&(Q[t].region=n)}),tn(),qa(i),qa(n),Fo(),Vt()}}function y(t){var e=ot[t].cells,a=+ot[t].capital;if(isNaN(a)||ta(a,"towns"),ot.splice(t,1),ot.map(function(t,e){t.i=e}),tt.map(function(e){e.region===t?e.region="neutral":e.region>t&&(e.region-=1)}),e){at.map(function(e){e.region===t&&(e.region="neutral")});var o=ot.length;"neutral"!==ot[o-1].capital&&ot.push({i:o,color:"neutral",name:"Neutrals",capital:"neutral"}),qa(o-1),tn()}Fo()}$("#countriesEditor").is(":visible")||$("#countriesEditor").dialog({title:"Countries Editor",minHeight:"auto",minWidth:Math.min(wt,390),position:{my:"right top",at:"right-10 top+10",of:"svg"}}).on("dialogclose",function(){2!==J&&3!==J||$("#countriesManuallyCancel").click()}),3===J?($("div[data-sortby='expansion'],.statePower, .icon-resize-full").removeClass("hidden"),$("div[data-sortby='cells'],.stateCells, .icon-check-empty").addClass("hidden")):($("div[data-sortby='expansion'],.statePower, .icon-resize-full").addClass("hidden"),$("div[data-sortby='cells'],.stateCells, .icon-check-empty").removeClass("hidden")),countriesFooterCountries.innerHTML=ot.length,"neutral"===ot[ot.length-1].capital&&(countriesFooterCountries.innerHTML=ot.length-1),countriesFooterBurgs.innerHTML=o,countriesFooterArea.innerHTML=ro(a)+t,countriesFooterPopulation.innerHTML=ro(n),$("#countriesBody .states").hover(jo,Ko),$(".enlange").click(function(){var t=+this.parentNode.id.slice(5),e=ot[t].capital,a=H.select("[data-id='"+e+"']"),o=+a.attr("x"),n=+a.attr("y");Bt(o,n,8,1600)}),$(".stateName").on("input",function(){var t=+this.parentNode.id.slice(5);if(ot[t].name=this.value,H.select("#regionLabel"+t).text(this.value),$("#burgsEditor").is(":visible")&&$("#burgsEditor").attr("data-state")==t){var e='<input title="Country color. Click to change" type="color" class="stateColor" value="'+ot[t].color+'"/>';$("div[aria-describedby='burgsEditor'] .ui-dialog-title").text("Burgs of "+this.value).prepend(e)}}),$(".states > .stateColor").on("change",function(){var t=+this.parentNode.id.slice(5);ot[t].color=this.value,x.selectAll(".region"+t).attr("fill",this.value).attr("stroke",this.value),$("#burgsEditor").is(":visible")&&$("#burgsEditor").attr("data-state")==t&&$(".ui-dialog-title > .stateColor").val(this.value)}),$(".stateCapital").on("input",function(){var t=+this.parentNode.id.slice(5),e=ot[t].capital;at[e].name=this.value,H.select("[data-id='"+e+"']").text(this.value),$("#burgsEditor").is(":visible")&&$("#burgsEditor").attr("data-state")==t&&$("#burgs"+e+" > .burgName").val(this.value)}).hover(Do,Yo),$(".stateBurgs, .stateBIcon").on("click",_o).hover(Uo,Yo),$("#countriesBody > .states").on("click",function(){if(2===J){$(".selected").removeClass("selected"),$(this).addClass("selected");var t=+$(this).attr("id").slice(5),e=ot[t].color;"neutral"===e&&(e="white"),j.selectAll(".circle").size()&&j.selectAll(".circle").attr("stroke",e)}}),$(".selectCapital").on("click",function(){$(this).hasClass("pressed")?($(this).removeClass("pressed"),tooltip.setAttribute("data-main",""),Vt()):($(this).addClass("pressed"),h.style("cursor","crosshair").on("click",b),v("Click on the map to select or create a new capital",!0))}),$(".statePower").on("input",function(){var t=+this.parentNode.id.slice(5);ot[t].power=+this.value,on()}),$(".statePopulation").on("change",function(){var t=+this.parentNode.id.slice(5),e=+$(this).parent().attr("data-population"),a=so(this.value);if(!Number.isInteger(a)||a<1e3)this.value=ro(e);else{var o=a/e;ot[t].urbanPopulation=no(ot[t].urbanPopulation*o,2),ot[t].ruralPopulation=no(ot[t].ruralPopulation*o,2);var n=no(ot[t].urbanPopulation*urbanization.value*populationRate.value),i=no(ot[t].ruralPopulation*populationRate.value),r=1e3*(n+i);$(this).parent().attr("data-population",r),this.value=ro(r);var s=0;$("#countriesBody > div").each(function(t,e){s+=+$(this).attr("data-population")}),countriesFooterPopulation.innerHTML=ro(s),"neutral"===ot[t].capital&&(t="neutral"),at.map(function(e){e.region===t&&(e.population=no(e.population*o,2))})}}),$("#countriesBody .icon-trash-empty").on("click",function(){var t=+this.parentNode.id.slice(5);alertMessage.innerHTML="Are you sure you want to remove the country? All lands and burgs will become neutral",$("#alert").dialog({resizable:!1,title:"Remove country",buttons:{Remove:function(){y(t),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})}),$("#countriesNeutral, #countriesNeutralNumber").on("change",on)}function _o(t,e){void 0===e&&(e=+this.parentNode.id.slice(5)),$("#burgsEditor").attr("data-state",e),$("#burgsBody").empty(),$("#burgsHeader").children().removeClass("icon-sort-name-up icon-sort-name-down icon-sort-number-up icon-sort-number-down");var a="neutral"===ot[e].capital?"neutral":e,o=$.grep(at,function(t){return t.region===a}),n=[];if(o.map(function(t){$("#burgsBody").append('<div class="states" id="burgs'+t.i+'"></div>');var a=$("#burgsBody div:last-child");a.append('<span title="Click to enlarge the burg" style="padding-right: 2px" class="enlarge icon-globe"></span>'),a.append('<input title="Burg name. Click and type to change" class="burgName" value="'+t.name+'" autocorrect="off" spellcheck="false"/>'),a.append('<span title="Burg culture" class="icon-book" style="padding-right: 2px"></span>'),a.append('<div title="Burg culture" class="burgCulture">'+lt[t.culture].name+"</div>");var o=t.population*urbanization.value*populationRate.value*1e3;n.push(o),o=o>1e4?ro(o):no(o,-1),a.append('<span title="Population" class="icon-male"></span>'),a.append('<input title="Population. Input to change" class="burgPopulation" value="'+o+'"/>');var i=ot[e].capital,r="z-burg";t.i===i?(a.append('<span title="Capital" class="icon-star-empty"></span>'),r="c-capital"):a.append('<span class="icon-star-empty placeholder"></span>'),void 0!==Q[t.cell].port?(a.append('<span title="Port" class="icon-anchor small"></span>'),r="c-capital"===r?"a-capital-port":"p-port"):a.append('<span class="icon-anchor placeholder"></span>'),t.i!==i&&a.append('<span title="Remove burg" class="icon-trash-empty"></span>'),a.attr("data-burg",t.name).attr("data-culture",lt[t.culture].name).attr("data-population",t.population).attr("data-type",r)}),!$("#burgsEditor").is(":visible")){$("#burgsEditor").dialog({title:"Burgs of "+ot[e].name,minHeight:"auto",width:"auto",position:{my:"right bottom",at:"right-10 bottom-10",of:"svg"}});var i='<input title="Country color. Click to change" type="color" class="stateColor" value="'+ot[e].color+'"/>';"neutral"!==a&&$("div[aria-describedby='burgsEditor'] .ui-dialog-title").prepend(i)}burgsFooterBurgs.innerHTML=o.length,burgsFooterCulture.innerHTML=$("#burgsBody div:first-child .burgCulture").text();var r=no(d3.mean(n),-1);burgsFooterPopulation.value=r,$(".enlarge").click(function(){var t=+this.parentNode.id.slice(5),e=H.select("[data-id='"+t+"']"),a=+e.attr("x"),o=+e.attr("y");Bt(a,o,8,1600)}),$("#burgsBody > div").hover(Vo,Yo),$("#burgsBody > div").click(function(){if($("#changeCapital").hasClass("pressed")){var t=+$("#burgsEditor").attr("data-state"),e=+$(this).attr("id").slice(5),a=+ot[t].capital;e!==a?($("#changeCapital").removeClass("pressed"),ot[t].capital=e,isNaN(a)||ta(a,"towns"),qa(t),ta(e,"capitals")):v("This burg is already a capital! Please select a different burg",null,"error")}}),$(".burgName").on("input",function(){var t=+this.parentNode.id.slice(5);at[t].name=this.value,H.select("[data-id='"+t+"']").text(this.value),t===e&&$("#countriesEditor").is(":visible")&&$("#state"+e+" > .stateCapital").val(this.value)}),$(".ui-dialog-title > .stateColor").on("change",function(){ot[e].color=this.value,x.selectAll(".region"+e).attr("fill",this.value).attr("stroke",this.value),$("#countriesEditor").is(":visible")&&$("#state"+e+" > .stateColor").val(this.value)}),$(".burgPopulation").on("change",function(){var t=+this.parentNode.id.slice(5),e=so(this.value);if(!Number.isInteger(e)||e<10){var a=no(at[t].population*urbanization.value*populationRate.value*1e3,2);this.value=ro(a)}else{populationRaw=no(e/urbanization.value/populationRate.value/1e3,2);var o=populationRaw-at[t].population;at[t].population=populationRaw,$(this).parent().attr("data-population",populationRaw),this.value=ro(e);var n=at[t].region;"neutral"===n&&(n=ot.length-1),ot[n].urbanPopulation+=o,Zo(n);var i=ot[n].urbanPopulation/ot[n].burgs*urbanization.value*populationRate.value*1e3;burgsFooterPopulation.value=no(i,-1)}}),$("#burgsFooterPopulation").on("change",function(){var t=+$("#burgsEditor").attr("data-state"),e=+this.value,a=ot[t].urbanPopulation/ot[t].burgs*urbanization.value*populationRate.value*1e3;if(!Number.isInteger(e)||e<10)this.value=no(a,-1);else{var o=+this.value/a;$("#burgsBody > div").each(function(t,e){var a=+this.id.slice(5),n=no(at[a].population*o,2);at[a].population=n,$(this).attr("data-population",n);var i=n*urbanization.value*populationRate.value*1e3;i=i>1e4?ro(i):no(i,-1),$(this).children().filter(".burgPopulation").val(i)}),ot[t].urbanPopulation=no(ot[t].urbanPopulation*o,2),Zo(t)}}),$("#burgsBody .icon-trash-empty").on("click",function(){alertMessage.innerHTML="Are you sure you want to remove the burg?";var t=+this.parentNode.id.slice(5);$("#alert").dialog({resizable:!1,title:"Remove burg",buttons:{Remove:function(){$(this).dialog("close");var e=+$("#burgsEditor").attr("data-state");$("#burgs"+t).remove();var a=at[t].cell;at[t].region="removed",Q[a].manor=void 0,ot[e].burgs=ot[e].burgs-1,burgsFooterBurgs.innerHTML=ot[e].burgs,countriesFooterBurgs.innerHTML=+countriesFooterBurgs.innerHTML-1,ot[e].urbanPopulation=ot[e].urbanPopulation-at[t].population;var o=ot[e].urbanPopulation/ot[e].burgs*urbanization.value*populationRate.value*1e3;burgsFooterPopulation.value=no(o,-1),$("#countriesEditor").is(":visible")&&$("#state"+e+" > .stateBurgs").text(ot[e].burgs),H.select("[data-id='"+t+"']").remove(),N.select("[data-id='"+t+"']").remove()},Cancel:function(){$(this).dialog("close")}}})})}function jo(){var t=+this.id.slice(5);H.select("#regionLabel"+t).classed("drag",!0),document.getElementsByClassName("region"+t)[0].style.stroke="red",document.getElementsByClassName("region"+t)[0].setAttribute("filter","url(#blur1)")}function Ko(){var t=+this.id.slice(5);H.select("#regionLabel"+t).classed("drag",!1),document.getElementsByClassName("region"+t)[0].style.stroke="none",document.getElementsByClassName("region"+t)[0].setAttribute("filter",null)}function Do(){var t=+this.parentNode.id.slice(5),e=ot[t].capital;H.select("[data-id='"+e+"']").classed("drag",!0),N.select("[data-id='"+e+"']").classed("drag",!0)}function Uo(){var t=+this.parentNode.id.slice(5),e=$.grep(at,function(e){return e.region===t});e.map(function(t){H.select("[data-id='"+t.i+"']").classed("drag",!0),N.select("[data-id='"+t.i+"']").classed("drag",!0)})}function Vo(){var t=+this.id.slice(5),e=H.select("[data-id='"+t+"']");e.classed("drag",!0)}function Yo(){$(".drag").removeClass("drag")}function Wo(){M.selectAll("path").size()||$("#toggleCultures").click(),"none"!==x.style("display")&&$("#toggleCountries").click(),layoutPreset.value="layoutCultural",$("#culturesBody").empty(),$("#culturesHeader").children().removeClass("icon-sort-name-up icon-sort-name-down icon-sort-number-up icon-sort-number-down");var t=[],e=[],a=[],o=[],n="square"===areaUnit.value?" "+distanceUnit.value+"²":" "+areaUnit.value;tt.map(function(o){var n=o.culture;void 0!==n&&(t[n]=t[n]?t[n]+1:1,e[n]=e[n]?e[n]+o.area:o.area,a[n]=a[n]?a[n]+o.pop:o.pop)}),at.map(function(t){var e=t.culture;isNaN(e)||(o[e]=o[e]?o[e]+t.population:t.population)}),ct[0]||Ot();for(var i=0;i<lt.length;i++){$("#culturesBody").append('<div class="states cultures" id="culture'+i+'"></div>'),void 0===t[i]&&(t[i]=0,e[i]=0,a[i]=0),void 0===o[i]&&(o[i]=0);var r=no(e[i]*Math.pow(distanceScale.value,2)),s=ro(r)+n,l=no(o[i]*+urbanization.value*populationRate.value),u=no(a[i]*populationRate.value),c=1e3*(l+u),d=ro(c),p="'Total population: "+d+"; Rural population: "+u+"K; Urban population: "+l+"K'",g=lt[i].base;g>=ct.length&&(g=0);var m=ct[g].name,f=$("#culturesBody div:last-child");f.append('<input onmouseover="tip(\'Culture color. Click to change\')" class="stateColor" type="color" value="'+lt[i].color+'"/>'),f.append('<input onmouseover="tip(\'Culture name. Click and type to change\')" class="cultureName" value="'+lt[i].name+'" autocorrect="off" spellcheck="false"/>'),f.append('<span onmouseover="tip(\'Culture cells count\')" class="icon-check-empty"></span>'),f.append('<div onmouseover="tip(\'Culture cells count\')" class="stateCells">'+t[i]+"</div>"),f.append("<span onmouseover=\"tip('Culture area: "+s+'\')" style="padding-right: 4px" class="icon-map-o"></span>'),f.append("<div onmouseover=\"tip('Culture area: "+s+'\')" class="stateArea">'+s+"</div>"),f.append('<span onmouseover="tip('+p+')" class="icon-male"></span>'),f.append('<div onmouseover="tip('+p+')" class="culturePopulation">'+d+"</div>"),f.append('<span onmouseover="tip(\'Click to re-generate names for burgs with this culture assigned\')" class="icon-arrows-cw"></span>'),f.append('<select onmouseover="tip(\'Culture namesbase. Click to change\')" class="cultureBase"></select>'),lt.length>1&&f.append('<span onmouseover="tip(\'Remove culture. Remaining cultures will be recalculated\')" class="icon-trash-empty"></span>'),f.attr("data-color",lt[i].color).attr("data-culture",lt[i].name).attr("data-cells",t[i]).attr("data-area",r).attr("data-population",c).attr("data-base",m)}C(),S();var b=t.reduce(function(t,e){return e?t+1:t},0);culturesFooterCultures.innerHTML=b+"/"+lt.length,culturesFooterCells.innerHTML=tt.length;var y=e.reduce(function(t,e){return t+e});y=no(y*Math.pow(distanceScale.value,2)),culturesFooterArea.innerHTML=ro(y)+n;var k=a.reduce(function(t,e){return t+e})*urbanization.value;function C(){$(".cultureBase").each(function(){for(var t=+this.parentNode.id.slice(7),e=0;e<ct.length;e++)this.options.add(new Option(ct[e].name,e));this.value=lt[t].base,this.addEventListener("change",function(){lt[t].base=+this.value})})}function S(){var t=j.select("#cultureCenters");t.size()?t.selectAll("*").remove():t=j.append("g").attr("id","cultureCenters");for(var e=0;e<lt.length;e++)t.append("circle").attr("id","cultureCenter"+e).attr("cx",lt[e].center[0]).attr("cy",lt[e].center[1]).attr("r",6).attr("stroke-width",2).attr("stroke","#00000080").attr("fill",lt[e].color).on("mousemove",w).on("mouseleave",function(){v("",!0)}).call(d3.drag().on("start",A))}function w(){v("Drag to move culture center and re-calculate cultures",!0)}function A(){var t=d3.select(this),e=+this.id.slice(13);d3.event.on("drag",function(){var a=d3.event.x,o=d3.event.y;t.attr("cx",a).attr("cy",o),lt[e].center=[a,o];var n=lt.map(function(t){return t.center});V=d3.quadtree(n),Ea()})}function B(){j.selectAll(".circle").remove(),$("#culturesBottom").children().show(),$("#culturesManuallyButtons").hide(),$(".selected").removeClass("selected"),J=0,Vt()}k+=o.reduce(function(t,e){return t+e}),culturesFooterPopulation.innerHTML=ro(1e3*k*populationRate.value),$("#culturesEditor").is(":visible")||$("#culturesEditor").dialog({title:"Cultures Editor",minHeight:"auto",minWidth:Math.min(wt,336),position:{my:"right top",at:"right-10 top+10",of:"svg"},close:function(){j.select("#cultureCenters").selectAll("*").remove(),B()}}),$(".cultures").hover(function(){var t=+this.id.slice(7);j.select("#cultureCenter"+t).attr("stroke","#000000e6")},function(){var t=+this.id.slice(7);j.select("#cultureCenter"+t).attr("stroke","#00000080")}),$(".cultures").on("click",function(){if(4===J){var t=+this.id.slice(7);$(".selected").removeClass("selected"),$(this).addClass("selected");var e=lt[t].color;j.selectAll(".circle").attr("stroke",e)}}),$(".cultures .stateColor").on("input",function(){var t=+this.parentNode.id.slice(7),e=lt[t].color;lt[t].color=this.value,j.select("#cultureCenter"+t).attr("fill",this.value),M.selectAll('[fill="'+e+'"]').attr("fill",this.value).attr("stroke",this.value)}),$(".cultures .cultureName").on("input",function(){var t=+this.parentNode.id.slice(7);lt[t].name=this.value}),$(".cultures .icon-arrows-cw").on("click",function(){var t=+this.parentNode.id.slice(7);at.forEach(function(e){"removed"!==e.region&&e.culture===t&&(e.name=Sa(t),H.select("[data-id='"+e.i+"']").text(e.name))})}),$("#culturesBody .icon-trash-empty").on("click",function(){var t=+this.parentNode.id.slice(7);lt.splice(t,1);var e=lt.map(function(t){return t.center});V=d3.quadtree(e),Ea("fullRedraw"),Wo()}),W.editCultures||(W.editCultures=!0,$("#culturesPercentage").on("click",function(){var t=$("#culturesEditor");if("absolute"===t.attr("data-type")){t.attr("data-type","percentage");var e=tt.length,a=culturesFooterArea.innerHTML;a=so(a.split(" ")[0]);var o=so(culturesFooterPopulation.innerHTML);$("#culturesBody > .cultures").each(function(){var t=no($(this).attr("data-cells")/e*100),n=no($(this).attr("data-area")/a*100),i=no($(this).attr("data-population")/o*100);$(this).children().filter(".stateCells").text(t+"%"),$(this).children().filter(".stateArea").text(n+"%"),$(this).children().filter(".culturePopulation").text(i+"%")})}else t.attr("data-type","absolute"),Wo()}),$("#culturesManually").on("click",function(){J=4,v("Click to select a culture, drag the circle to re-assign",!0),$("#culturesBottom").children().hide(),$("#culturesManuallyButtons").show(),h.style("cursor","crosshair").call(xt).on("click",Xa),j.select("#cultureCenters").selectAll("*").remove()}),$("#culturesManuallyComplete").on("click",function(){var t=M.selectAll("[data-culture]");t.each(function(){var t=+this.id.slice(4),e=+this.getAttribute("data-culture");this.removeAttribute("data-culture"),Q[t].culture=e;var a=Q[t].manor;void 0!==a&&(at[a].culture=e)}),B(),t.size()&&Wo()}),$("#culturesManuallyCancel").on("click",function(){M.selectAll("[data-culture]").each(function(){var t=+this.id.slice(4),e=Q[t].culture;this.removeAttribute("data-culture");var a=lt[e].color;this.setAttribute("fill",a),this.setAttribute("stroke",a)}),B(),S()}),$("#culturesRandomize").on("click",function(){var t=lt.map(function(t){var e=Math.floor(Math.random()*Ct*.8+.1*Ct),a=Math.floor(Math.random()*St*.8+.1*St),o=[e,a];return t.center=o,o});V=d3.quadtree(t),Ea(),S(),Wo()}),$("#culturesExport").on("click",function(){var t="square"===areaUnit.value?distanceUnit.value+"2":areaUnit.value,e="Culture,Cells,Area ("+t+"),Population,Namesbase\n";$("#culturesBody > .cultures").each(function(){e+=$(this).attr("data-culture")+",",e+=$(this).attr("data-cells")+",",e+=$(this).attr("data-area")+",",e+=$(this).attr("data-population")+",",e+=$(this).attr("data-base")+"\n"});var a=new Blob([e],{type:"text/plain"}),o=window.URL.createObjectURL(a),n=document.createElement("a");document.body.appendChild(n),n.download="cultures_data"+Date.now()+".csv",n.href=o,n.click(),window.setTimeout(function(){window.URL.revokeObjectURL(o)},2e3)}),$("#culturesRegenerateNames").on("click",function(){at.forEach(function(t){if("removed"!==t.region){var e=t.culture;t.name=Sa(e),H.select("[data-id='"+t.i+"']").text(t.name)}})}),$("#culturesEditNamesBase").on("click",Jo),$("#culturesAdd").on("click",function(){var t,e,a,o,n=Math.floor(Math.random()*Ct*.8+.1*Ct),i=Math.floor(Math.random()*St*.8+.1*St),r=[n,i];lt.length<st.length?(t=lt.length,e=st[t].base,o=st[t].color,a=st[t].name):(t=oo(lt.length-1),a=Sa(t),o=ft(lt.length%20),e=lt[t].base),lt.push({name:a,color:o,base:e,center:r});var s=lt.map(function(t){return t.center});V=d3.quadtree(s),Ea(),Wo()}))}function Jo(){for(var t=document.getElementById("namesbaseSelect"),e=t.options.length;e<ct.length;e++){var a=new Option(ct[e].name,e);t.options.add(a)}var o=document.getElementById("namesbaseTextarea"),n=+o.getAttribute("data-base");n>=ct.length&&(n=0),t.value=n,""===o.value&&r(n);var i=document.getElementById("namesbaseExamples");function r(t){var e=document.getElementById("namesbaseTextarea");e.value=dt[t].join(", "),e.setAttribute("data-base",t);var a=document.getElementById("namesbaseName"),o=document.getElementById("namesbaseMethod"),n=document.getElementById("namesbaseMin"),i=document.getElementById("namesbaseMax"),r=document.getElementById("namesbaseDouble");a.value=ct[t].name,o.value=ct[t].method,n.value=ct[t].min,i.value=ct[t].max,r.value=ct[t].d}function s(t){for(var e=document.getElementById("namesbaseExamples"),a="",o=0;o<10;o++){var n=Sa(!1,t);if(void 0===n){a="Cannot generate examples. Please verify the data";break}0!==o&&(a+=", "),a+=n}e.innerHTML=a}""===i.innerHTML&&s(n),$("#namesbaseEditor").dialog({title:"Namesbase Editor",minHeight:"auto",minWidth:Math.min(wt,400),position:{my:"center",at:"center",of:"svg"}}),W.editNamesbase||(W.editNamesbase=!0,$("#namesbaseSelect").on("change",function(){var t=+this.value;r(t),s(t)}),$("#namesbaseName").on("input",function(){var t=+o.getAttribute("data-base"),e=document.getElementById("namesbaseSelect");e.options[t].innerHTML=this.value,ct[t].name=this.value}),$("#namesbaseTextarea").on("input",function(){var t=+this.getAttribute("data-base"),e=o.value.replace(/ /g,"").split(",");if(dt[t]=e,e.length<3){ut[t]=[];var a=document.getElementById("namesbaseExamples");a.innerHTML="Please provide a correct source data"}else{var n=document.getElementById("namesbaseMethod").value;"selection"!==n&&(ut[t]=Ca(t))}}),$("#namesbaseMethod").on("change",function(){var t=+o.getAttribute("data-base");ct[t].method=this.value,"selection"!==this.value&&(ut[t]=Ca(t))}),$("#namesbaseMin").on("change",function(){var t=+o.getAttribute("data-base");+this.value>ct[t].max?v("Minimal length cannot be greated that maximal"):ct[t].min=+this.value}),$("#namesbaseMax").on("change",function(){var t=+o.getAttribute("data-base");+this.value<ct[t].min?v("Maximal length cannot be less than minimal"):ct[t].max=+this.value}),$("#namesbaseDouble").on("change",function(){var t=+o.getAttribute("data-base");ct[t].d=this.value}),$("#namesbaseDefault").on("click",function(){alertMessage.innerHTML="Are you sure you want to restore the default namesbase?\n        All custom bases will be removed and default ones will be assigned to existing cultures.\n        Meanwhile existing names will not be changed.",$("#alert").dialog({resizable:!1,title:"Restore default data",buttons:{Restore:function(){$(this).dialog("close"),$("#namesbaseEditor").dialog("close");var t=document.getElementById("namesbaseSelect");t.options.length=0,document.getElementById("namesbaseTextarea").value="",document.getElementById("namesbaseTextarea").setAttribute("data-base",0),document.getElementById("namesbaseExamples").innerHTML,Ot();var e=ct.length-1;lt.forEach(function(t){t.base>e&&(t.base=e)}),chains={},ka(),Wo(),Jo()},Cancel:function(){$(this).dialog("close")}}})}),$("#namesbaseAdd").on("click",function(){var t=ct.length,e="Base"+t,a=document.getElementById("namesbaseMethod").value,o=document.getElementById("namesbaseSelect");o.options.add(new Option(e,t)),o.value=t,ct.push({name:e,method:a,min:4,max:10,d:"",m:1}),dt.push([]),document.getElementById("namesbaseName").value=e;var n=document.getElementById("namesbaseTextarea");n.value="",n.setAttribute("data-base",t),document.getElementById("namesbaseExamples").innerHTML="",ut[t]=[],Wo()}),$("#namesbaseExamples, #namesbaseUpdateExamples").on("click",function(){var t=document.getElementById("namesbaseSelect");s(+t.value)}),$("#namesbaseDownload").on("click",function(){var t=JSON.stringify(dt)+"\r\n",e=JSON.stringify(ct),a=new Blob([t+e],{type:"text/plain"}),o=window.URL.createObjectURL(a),n=document.createElement("a");n.download="namebase"+Date.now()+".txt",n.href=o,n.click()}),$("#namesbaseUpload").on("click",function(){namesbaseToLoad.click()}),$("#namesbaseToLoad").change(function(){var t=this.files[0];this.value="";var e=new FileReader;e.onload=function(t){var e=t.target.result,a=e.split("\r\n");if(a[0]&&a[1]){dt=JSON.parse(a[0]),ct=JSON.parse(a[1]);var o=document.getElementById("namesbaseSelect");o.options.length=0,document.getElementById("namesbaseTextarea").value="",document.getElementById("namesbaseTextarea").setAttribute("data-base",0),document.getElementById("namesbaseExamples").innerHTML;var n=ct.length-1;lt.forEach(function(t){t.base>n&&(t.base=n)}),chains={},ka(),Wo(),Jo()}else v("Cannot load a namesbase. Please check the data format")},e.readAsText(t,"UTF-8")}))}function qo(t,e){for(var a=document.getElementById("legendSelect"),o=a.options.length;o<it.length;o++){var n=new Option(it[o].id,it[o].id);a.options.add(n)}if(t){var i=it.find(function(e){return e.id===t});if(void 0===i){e||(e=t),i={id:t,name:e,legend:""},it.push(i);var r=new Option(t,t);a.options.add(r)}a.value=t,legendName.value=i.name,legendText.value=i.legend}function s(t){if(!j.select(".highlighted").size()){var e=t.getBBox(),a=t.getAttribute("transform")||null,o=d3.transition().duration(1e3).ease(d3.easeBounceOut),n=d3.transition().duration(500).ease(d3.easeLinear),i=j.append("rect").attr("x",e.x).attr("y",e.y).attr("width",e.width).attr("height",e.height).attr("transform",a);i.classed("highlighted",1).transition(o).style("outline-offset","0px").transition(n).style("outline-color","transparent").remove();var r=Qe(a),s=e.x+e.width/2;r[0]&&(s+=r[0]);var l=e.y+e.height/2;r[1]&&(l+=r[1]),bt>=2&&Bt(s,l,bt,1600)}}function l(){var t=document.getElementById("legendSelect"),e=it.findIndex(function(e){return e.id===t.value});it.splice(e,1),t.options.length=0,0!==it.length?qo(it[0].id,it[0].name):$("#legendEditor").dialog("close")}$("#legendEditor").dialog({title:"Legends Editor",minHeight:"auto",minWidth:Math.min(wt,400),position:{my:"center",at:"center",of:"svg"}}),W.editLegends||(W.editLegends=!0,document.getElementById("legendSelect").addEventListener("change",function(){var t=this,e=it.find(function(e){return e.id===t.value});legendName.value=e.name,legendText.value=e.legend}),document.getElementById("legendName").addEventListener("input",function(){var t=document.getElementById("legendSelect"),e=t.value,a=it.find(function(t){return t.id===e});a.name=this.value}),document.getElementById("legendText").addEventListener("input",function(){var t=document.getElementById("legendSelect"),e=t.value,a=it.find(function(t){return t.id===e});a.legend=this.value}),document.getElementById("legendFocus").addEventListener("click",function(){var t=document.getElementById("legendSelect"),e=document.getElementById(t.value);if(null===e){var a="Related element is not found. Would you like to remove the note (legend item)?";return alertMessage.innerHTML=a,void $("#alert").dialog({resizable:!1,title:"Element not found",buttons:{Remove:function(){$(this).dialog("close"),l()},Keep:function(){$(this).dialog("close")}}})}s(e)}),document.getElementById("legendDownload").addEventListener("click",function(){var t=JSON.stringify(it),e=new Blob([t],{type:"text/plain"}),a=window.URL.createObjectURL(e),o=document.createElement("a");o.download="legends"+Date.now()+".txt",o.href=a,o.click()}),document.getElementById("legendUpload").addEventListener("click",function(){document.getElementById("lagendsToLoad").click()}),document.getElementById("lagendsToLoad").addEventListener("change",function(){var t=this.files[0];this.value="";var e=new FileReader;e.onload=function(t){var e=t.target.result;if(e){it=JSON.parse(e);var a=document.getElementById("legendSelect");a.options.length=0,qo(it[0].id,it[0].name)}else v("Cannot load a file. Please check the data format")},e.readAsText(t,"UTF-8")}),document.getElementById("legendRemove").addEventListener("click",function(){alertMessage.innerHTML="Are you sure you want to remove the selected legend?",$("#alert").dialog({resizable:!1,title:"Remove legend element",buttons:{Remove:function(){$(this).dialog("close"),l()},Keep:function(){$(this).dialog("close")}}})}))}function Xo(){$("#ruler").fadeIn(),$("#scaleEditor").dialog({title:"Scale Editor",minHeight:"auto",width:"auto",resizable:!1,position:{my:"center bottom",at:"center bottom-10",of:"svg"}})}function Zo(t){if($("#countriesEditor").is(":visible")){var e=no(ot[t].urbanPopulation*+urbanization.value*populationRate.value),a=no(ot[t].ruralPopulation*populationRate.value),o=1e3*(e+a);$("#state"+t).attr("data-population",o),$("#state"+t).children().filter(".statePopulation").val(ro(o))}}function Qo(){if($("#countriesEditor").is(":visible")&&Fo(),$("#burgsEditor").is(":visible")){var t=+$("#burgsEditor").attr("data-state");_o(this,t)}}function tn(){x.selectAll("*").remove(),A.selectAll("path").remove(),en("countries"),Ma()}function en(t){H.select("#"+t).selectAll("text").each(function(){p.select("#textPath_"+this.id).remove(),this.remove()}),"countries"!==t&&(H.select("#"+t).remove(),cn())}function an(){A.selectAll("path").remove(),en("countries"),at.map(function(t){var e=i.find(t.x,t.y).index;Q[e].height<20?(t.region="removed",t.cell=e,d3.selectAll("[data-id='"+t.i+"']").remove()):(t.cell=e,Q[e].manor=t.i)}),Q.map(function(t){if(t.height<20)return delete t.region,void delete t.culture;if(void 0===t.region&&(t.region="neutral","neutral"!==ot[ot.length-1].capital&&ot.push({i:ot.length,color:"neutral",capital:"neutral",name:"Neutrals"})),void 0===t.culture){var e=V.find(t.data[0],t.data[1]);t.culture=V.data().indexOf(e)}}),ot.map(function(t){qa(t.i)}),Ma()}function on(){x.selectAll("*").remove();var t=neutralInput.value=+countriesNeutral.value;at.forEach(function(e){if("removed"!==e.region){var a="neutral",o=t;ot.map(function(t){if("neutral"!==t.capital&&"select"!==t.capital){var n=at[t.capital],i=Math.hypot(n.x-e.x,n.y-e.y)/t.power;Q[e.cell].fn!==Q[n.cell].fn&&(i*=3),i<o&&(a=t.i,o=i)}}),e.region=a,Q[e.cell].region=a}}),wa();var e=x.append("g").attr("id","temp");tt.forEach(function(t){if(void 0!==t.region&&"neutral"!==t.region){var a=ot[t.region].color;e.append("path").attr("data-cell",t.index).attr("data-state",t.region).attr("d","M"+r[t.index].join("L")+"Z").attr("fill",a).attr("stroke",a)}});var a=$.grep(Q,function(t){return"neutral"===t.region}),o=ot.length-1,n=ot[o].color;"neutral"!==n||a.length||($("#state"+o).remove(),ot.splice(-1)),ot.map(function(t){qa(t.i),$("#state"+t.i+" > .stateCells").text(t.cells),$("#state"+t.i+" > .stateBurgs").text(t.burgs);var e=no(t.area*Math.pow(distanceScale.value,2)),a="square"===areaUnit.value?" "+distanceUnit.value+"²":" "+areaUnit.value;$("#state"+t.i+" > .stateArea").text(ro(e)+a);var o=no(t.urbanPopulation*urbanization.value*populationRate.value),n=no(t.ruralPopulation*populationRate.value),i=1e3*(o+n);$("#state"+t.i+" > .statePopulation").val(ro(i)),$("#state"+t.i).attr("data-cells",t.cells).attr("data-burgs",t.burgs).attr("data-area",e).attr("data-population",i)}),"neutral"!==n&&a.length&&(ot.push({i:ot.length,color:"neutral",capital:"neutral",name:"Neutrals"}),qa(ot.length-1),Fo())}function nn(){"inline"!==k.style("display")&&toggleGrid.click(),"none"!==H.style("display")&&toggleLabels.click(),B.selectAll("*").remove(),E.selectAll("*").remove()}function rn(){wt=Ct=+mapWidthInput.value,Mt=St=+mapHeightInput.value,l.attr("width",wt).attr("height",Mt),n=d3.voronoi().extent([[-1,-1],[Ct+1,St+1]]),yt.translateExtent([[0,0],[Ct,St]]).scaleExtent([1,20]).scaleTo(l,1),h.attr("transform",null),g.selectAll("rect").attr("x",0).attr("y",0).attr("width",Ct).attr("height",St)}function sn(){ln(),wt=+mapWidthInput.value,Mt=+mapHeightInput.value,l.attr("width",wt).attr("height",Mt);var t=Math.max(wt,Ct),e=Math.max(Mt,St);yt.translateExtent([[0,0],[t,e]]),l.select("#ocean").selectAll("rect").attr("x",0).attr("y",0).attr("width",t).attr("height",e)}function ln(){var t=d3.select("#scaleBar");if(t.select("rect").size()){var e=t.select("rect").node().getBBox(),a=[wt-e.width,Mt-(e.height-10)];if(sessionStorage.getItem("scaleBar")){var o=sessionStorage.getItem("scaleBar").split(",");a=[+o[0]-e.width,+o[1]-e.height]}t.attr("transform","translate("+no(a[0])+","+no(a[1])+")")}}function un(){h.on("touchmove mousemove",_t),b.attr("opacity",1).attr("fill","#eef6fb"),P.attr("opacity",.5).attr("stroke","#1f3846").attr("stroke-width",.7).attr("filter","url(#dropShadow)"),x.attr("opacity",.4),B.attr("opacity",.8).attr("stroke","#56566d").attr("stroke-width",.7).attr("stroke-dasharray","1.2 1.5").attr("stroke-linecap","butt"),E.attr("opacity",.8).attr("stroke","#56566d").attr("stroke-width",.5).attr("stroke-dasharray","1 1.5").attr("stroke-linecap","butt"),M.attr("opacity",.6),S.attr("opacity",1).attr("fill","#5d97bb"),I.attr("opacity",.5).attr("fill","#a6c1fd").attr("stroke","#5f799d").attr("stroke-width",.7),N.selectAll("g").attr("opacity",1).attr("fill","#ffffff").attr("stroke","#3e3e4b"),T.attr("opacity",.9).attr("stroke","#d06324").attr("stroke-width",.35).attr("stroke-dasharray","1.5").attr("stroke-linecap","butt"),L.attr("opacity",.9).attr("stroke","#d06324").attr("stroke-width",.15).attr("stroke-dasharray",".8 1.6").attr("stroke-linecap","butt"),R.attr("opacity",.8).attr("stroke","#ffffff").attr("stroke-width",.35).attr("stroke-dasharray","1 2").attr("stroke-linecap","round"),k.attr("opacity",1).attr("stroke","#808080").attr("stroke-width",.1),_.attr("opacity",1).style("display","none").attr("filter","url(#dropShadow)"),C.attr("opacity",.8).attr("stroke","#808080").attr("stroke-width",.5),F.attr("filter","url(#dropShadow01)"),l.style("background-color","#000000"),g.attr("opacity",1),m.select("rect").attr("fill","#53679f"),m.attr("filter",""),f.attr("opacity",1),m.selectAll("path").attr("display",null),styleOceanPattern.checked=!0,styleOceanLayers.checked=!0,H.attr("opacity",1).attr("stroke","#3a3a3a").attr("stroke-width",0);var t=no(8-regionsInput.value/20);t<3&&(t=3),O.select("#capitals").attr("fill","#3e3e4b").attr("opacity",1).attr("font-family","Almendra SC").attr("data-font","Almendra+SC").attr("font-size",t).attr("data-size",t),O.select("#towns").attr("fill","#3e3e4b").attr("opacity",1).attr("font-family","Almendra SC").attr("data-font","Almendra+SC").attr("font-size",3).attr("data-size",4),G.select("#capitals").attr("size",1).attr("stroke-width",.24).attr("fill","#ffffff").attr("stroke","#3e3e4b").attr("fill-opacity",.7).attr("stroke-opacity",1).attr("opacity",1),G.select("#towns").attr("size",.5).attr("stroke-width",.12).attr("fill","#ffffff").attr("stroke","#3e3e4b").attr("fill-opacity",.7).attr("stroke-opacity",1).attr("opacity",1),t=no(16-regionsInput.value/6),t<6&&(t=6),H.select("#countries").attr("fill","#3e3e4b").attr("opacity",1).attr("font-family","Almendra SC").attr("data-font","Almendra+SC").attr("font-size",t).attr("data-size",t),N.select("#capital-anchors").attr("fill","#ffffff").attr("stroke","#3e3e4b").attr("stroke-width",1.2).attr("size",2),N.select("#town-anchors").attr("fill","#ffffff").attr("stroke","#3e3e4b").attr("stroke-width",1.2).attr("size",1)}function cn(){if("labels"===styleElementSelect.value){var t=d3.select("#styleLabelGroupItems");t.selectAll("button").remove(),H.selectAll("g").each(function(){var e=d3.select(this),a=e.attr("id"),o=a.charAt(0).toUpperCase()+a.substr(1),n=e.classed("hidden");"burgLabels"!==a&&t.append("button").attr("id",a).text(o).classed("buttonoff",n).on("click",function(){hideLabels.checked&&hideLabels.click();var t=d3.select("#"+this.id),e=!t.classed("hidden");t.classed("hidden",e),d3.select(this).classed("buttonoff",e)})})}}function dn(){var t=styleOverlaySize.value;if("windrose"!==styleOverlayType.value){"pointyHex"!==styleOverlayType.value&&"flatHex"!==styleOverlayType.value||(t*=2*Math.cos(30*Math.PI/180));var e="("+no(t*distanceScale.value)+" "+distanceUnit.value+")";styleOverlaySizeFriendly.value=e}else styleOverlaySizeFriendly.innerHTML=""}function pn(){document.addEventListener("dragover",function(t){t.stopPropagation(),t.preventDefault(),$("#map-dragged").show()}),document.addEventListener("dragleave",function(t){$("#map-dragged").hide()}),document.addEventListener("drop",function(t){if(t.stopPropagation(),t.preventDefault(),$("#map-dragged").hide(),null!=t.dataTransfer.items&&1==t.dataTransfer.items.length){var e=t.dataTransfer.items[0].getAsFile();if(-1==e.name.indexOf(".map"))return alertMessage.innerHTML="Please upload a <b>.map</b> file you have previously downloaded",void $("#alert").dialog({resizable:!1,title:"Invalid file format",width:400,buttons:{Close:function(){$(this).dialog("close")}},position:{my:"center",at:"center",of:"svg"}});$("#map-dragged > p").text("Uploading<span>.</span><span>.</span><span>.</span>"),po(e,function(){$("#map-dragged > p").text("Drop to upload")})}})}It!=t&&(alertMessage.innerHTML="<b>2018-29-23</b>:\n      The <i>Fantasy Map Generator</i> is updated up to version <b>".concat(t,"</b>.\n      Main changes:<br><br>\n      <li>Map Markers</li>\n      <li>Legend Editor (text notes)</li>\n      <li>Bug fixes</li>\n      <br>See a <a href='https://www.reddit.com/r/FantasyMapGenerator/comments/9iarje/update_new_version_is_published_v060b' target='_blank'>dedicated post</a> for the details.\n      <br><br>\n      <i>Join our <a href='https://www.reddit.com/r/FantasyMapGenerator/' target='_blank'>Reddit community</a>\n      to share created maps, discuss the Generator, report bugs, ask questions and propose new features.\n      You may also report bugs <a href='https://github.com/Azgaar/Fantasy-Map-Generator/issues' target='_blank'>here</a>.</i>"),$("#alert").dialog({resizable:!1,title:"Fantasy Map Generator update",width:320,buttons:{"Don't show again":function(){localStorage.setItem("version",t),$(this).dialog("close")},Close:function(){$(this).dialog("close")}},position:{my:"center",at:"center",of:"svg"}})),Tt(),Ht(),zt(),un(),Ta(),Et(),$("#renderOcean").click(Ce),$("#customizeTab").click(Wa),$("#mapToLoad").change(function(){console.time("loadMap"),Fa();var t=this.files[0];this.value="",po(t)}),d3.select("body").on("keydown",function(){var t=document.activeElement.tagName;if("INPUT"!==t&&"SELECT"!==t&&"TEXTAREA"!==t){var e=d3.event.keyCode,a=d3.event.ctrlKey,o=d3.mouse(this);117===e?$("#randomMap").click():27===e?Fa():79===e?optionsTrigger.click():80===e?lo("png"):83===e?lo("svg"):77===e?co():76===e?mapToLoad.click():32===e?console.table(Q[i.find(o[0],o[1]).index]):192===e?console.log(Q):66===e?console.table(at):67===e?console.table(ot):70===e?console.table(nt):37===e?yt.translateBy(l,10,0):39===e?yt.translateBy(l,-10,0):38===e?yt.translateBy(l,0,10):40===e?yt.translateBy(l,0,-10):107===e?yt.scaleBy(l,1.2):109===e?yt.scaleBy(l,.8):48===e||96===e?$t():49===e||97===e?yt.scaleTo(l,1):50===e||98===e?yt.scaleTo(l,2):51===e||99===e?yt.scaleTo(l,3):52===e||100===e?yt.scaleTo(l,4):53===e||101===e?yt.scaleTo(l,5):54===e||102===e?yt.scaleTo(l,6):55===e||103===e?yt.scaleTo(l,7):56===e||104===e?yt.scaleTo(l,8):57===e||105===e?yt.scaleTo(l,9):9===e?$("#updateFullscreen").click():a&&90===e?undo.click():a&&89===e&&redo.click()}}),$("#optionsTrigger").on("click",function(){"Сlick the arrow button to open options"===tooltip.getAttribute("data-main")&&(tooltip.setAttribute("data-main",""),tooltip.innerHTML="",localStorage.setItem("disable_click_arrow_tooltip",!0)),"none"===$("#options").css("display")?($("#regenerate").hide(),$("#options").fadeIn(),$("#layoutTab").click(),$("#optionsTrigger").removeClass("icon-right-open glow").addClass("icon-left-open")):($("#options").fadeOut(),$("#optionsTrigger").removeClass("icon-left-open").addClass("icon-right-open"))}),$("#collapsible").hover(function(){$("#optionsTrigger").hasClass("glow")||"none"===$("#options").css("display")&&($("#regenerate").show(),$("#optionsTrigger").removeClass("glow"))},function(){$("#regenerate").hide()}),$("button, a, li, i").on("click",function(){var t=this.id,e=this.parentNode.id;if(j.selectAll(".tag").size()&&j.selectAll(".tag, .line").remove(),"toggleHeight"===t&&Ra(),"toggleCountries"===t&&$("#regions").fadeToggle(),"toggleCultures"===t&&Pa(),"toggleOverlay"===t&&Ha(),"toggleFlux"===t&&ja(),"mapLayers"!==e&&"styleContent"!==e||$(this).toggleClass("buttonoff"),"randomMap"===t||"regenerate"===t)return Lt(),Go(),Oo(),$t(1e3),void zt();if("editCountries"===t&&Fo(),"editCultures"===t&&Wo(),"editScale"!==t&&"editScaleCountries"!==t&&"editScaleBurgs"!==t||Xo(),"countriesManually"===t){J=2,v("Click to select a country, drag the circle to re-assign",!0),nn();var a=x.append("g").attr("id","temp");$("#countriesBottom").children().hide(),$("#countriesManuallyButtons").show(),ot.map(function(t){if("neutral"!==t.capital&&"select"!==t.capital){var e=t.capital,o=at[e].cell;a.append("path").attr("data-cell",o).attr("data-state",t.i).attr("d","M"+r[o].join("L")+"Z").attr("fill",t.color).attr("stroke","red").attr("stroke-width",.7)}}),h.style("cursor","crosshair").call(xt).on("click",Xa)}if("countriesRegenerate"===t&&(J=3,v('Manually change "Expansion" value for a country or click on "Randomize" button',!0),nn(),x.append("g").attr("id","temp"),$("#countriesBottom").children().hide(),$("#countriesRegenerateButtons").show(),$(".statePower, .icon-resize-full, .stateCells, .icon-check-empty").toggleClass("hidden"),$("div[data-sortby='expansion'],div[data-sortby='cells']").toggleClass("hidden")),"countriesManuallyComplete"===t){j.selectAll(".circle").remove();var o=x.select("#temp").selectAll("path"),n=[];o.each(function(){var t=d3.select(this),e=+t.attr("data-cell"),a=Q[e].region;"neutral"===a&&(a=ot.length-1);var o=+t.attr("data-state"),i="neutral"===ot[o].color?"neutral":o;Q[e].region=i,void 0!==Q[e].manor&&(at[Q[e].manor].region=i),n.push(o,a)}),n=Object(c["a"])(new Set(n)),n.map(function(t){qa(t)});var i=ot.length-1;"neutral"===ot[i].capital&&0===ot[i].cells&&($("#state"+i).remove(),ot.splice(-1)),$("#countriesManuallyCancel").click(),n.length&&Fo()}if("countriesManuallyCancel"===t&&(tn(),j.selectAll(".circle").remove(),"inline"===k.style("display")&&toggleGrid.click(),"none"===H.style("display")&&toggleLabels.click(),$("#countriesBottom").children().show(),$("#countriesManuallyButtons, #countriesRegenerateButtons").hide(),$(".selected").removeClass("selected"),$("div[data-sortby='expansion'],.statePower, .icon-resize-full").addClass("hidden"),$("div[data-sortby='cells'],.stateCells, .icon-check-empty").removeClass("hidden"),J=0,Vt()),"countriesApply"===t&&$("#countriesManuallyCancel").click(),"countriesRandomize"===t){var s=2*+powerInput.value;$(".statePower").each(function(t,e){var a=+this.parentNode.id.slice(5);if("neutral"!==ot[a].capital){var o=no(Math.random()*s/2+1,1);$(this).val(o),$(this).parent().attr("data-expansion",o),ot[a].power=o}}),on()}if("countriesAddM"===t||"countriesAddR"===t||"countriesAddG"===t){var u=ot.length;"neutral"===ot[u-1].capital&&(ot[u-1].i=u,u-=1);var d=$a(0),p=ft(u);ot.push({i:u,color:p,name:d,capital:"select",cells:0,burgs:0,urbanPopulation:0,ruralPopulation:0,area:0,power:1}),ot.sort(function(t,e){return t.i-e.i}),Fo()}if("countriesRegenerateNames"===t){var g=d3.select("#countriesBody");ot.forEach(function(t){"neutral"!==t.capital&&(t.name=$a(t.i),H.select("#regionLabel"+t.i).text(t.name),g.select("#state"+t.i).select(".stateName").attr("value",t.name))})}if("countriesPercentage"===t){var m=$("#countriesEditor");if("absolute"===m.attr("data-type")){m.attr("data-type","percentage");var f=tt.length,b=+countriesFooterBurgs.innerHTML,y=countriesFooterArea.innerHTML;y=so(y.split(" ")[0]);var C=so(countriesFooterPopulation.innerHTML);$("#countriesBody > .states").each(function(){var t=no($(this).attr("data-cells")/f*100),e=no($(this).attr("data-burgs")/b*100),a=no($(this).attr("data-area")/y*100),o=no($(this).attr("data-population")/C*100);$(this).children().filter(".stateCells").text(t+"%"),$(this).children().filter(".stateBurgs").text(e+"%"),$(this).children().filter(".stateArea").text(a+"%"),$(this).children().filter(".statePopulation").val(o+"%")})}else m.attr("data-type","absolute"),Fo()}if("countriesExport"===t){if(0===$(".statePower").length)return;var S="square"===areaUnit.value?distanceUnit.value+"2":areaUnit.value,w="Country,Capital,Cells,Burgs,Area ("+S+"),Population\n";$("#countriesBody > .states").each(function(){var t=$(this).attr("data-country");w+="bottom"===t?"neutral,":t+",";var e=$(this).attr("data-capital");w+="bottom"===e||"select"===e?",":e+",",w+=$(this).attr("data-cells")+",",w+=$(this).attr("data-burgs")+",",w+=$(this).attr("data-area")+",";var a=+$(this).attr("data-population");w+=a+"\n"}),w+="\nBurg,Country,Culture,Population\n",at.map(function(t){if("removed"!==t.region){w+=t.name+",";var e="neutral"===t.region?"neutral":ot[t.region].name;w+=e+",",w+=lt[t.culture].name+",";var a=t.population*urbanization.value*populationRate.value*1e3;w+=a+"\n"}});var M=new Blob([w],{type:"text/plain"}),A=window.URL.createObjectURL(M),B=document.createElement("a");document.body.appendChild(B),B.download="countries_data"+Date.now()+".csv",B.href=A,B.click(),window.setTimeout(function(){window.URL.revokeObjectURL(A)},2e3)}if("burgNamesImport"===t&&burgsListToLoad.click(),"removeCountries"===t&&(alertMessage.innerHTML="Are you sure you want remove all countries?",$("#alert").dialog({resizable:!1,title:"Remove countries",buttons:{Cancel:function(){$(this).dialog("close")},Remove:function(){$(this).dialog("close"),$("#countriesBody").empty(),at.map(function(t){t.region="neutral"}),tt.map(function(t){t.region="neutral"}),ot.map(function(t){var e=+t.capital;isNaN(e)||ta(e,"towns")}),en("countries"),x.selectAll("path").remove(),ot=[],ot.push({i:0,color:"neutral",capital:"neutral",name:"Neutrals"}),qa(0),$("#burgsEditor").is(":visible")&&$("#burgsEditor").dialog("close"),Fo()}}})),"removeBurgs"===t&&(alertMessage.innerHTML="Are you sure you want to remove all burgs associated with the country?",$("#alert").dialog({resizable:!1,title:"Remove associated burgs",buttons:{Cancel:function(){$(this).dialog("close")},Remove:function(){$(this).dialog("close");var t=+$("#burgsEditor").attr("data-state"),e="neutral"===ot[t].capital?"neutral":t;$("#burgsBody").empty(),at.map(function(t){t.region===e&&(t.region="removed",Q[t.cell].manor=void 0,H.select("[data-id='"+t.i+"']").remove(),N.selectAll("[data-id='"+t.i+"']").remove())}),ot[t].urbanPopulation=0,ot[t].burgs=0,ot[t].capital="select",$("#countriesEditor").is(":visible")&&(Fo(),$("#burgsEditor").dialog("moveToTop")),burgsFooterBurgs.innerHTML=0,burgsFooterPopulation.value=0}}})),"changeCapital"===t&&($(this).hasClass("pressed")?$(this).removeClass("pressed"):($(".pressed").removeClass("pressed"),$(this).addClass("pressed"))),"regenerateBurgNames"===t){var E=+$("#burgsEditor").attr("data-state");if($(".burgName").each(function(t,e){var a=+this.parentNode.id.slice(5),o=Sa(at[a].culture);$(this).val(o),$(this).parent().attr("data-burg",o),at[a].name=o,H.select("[data-id='"+a+"']").text(o)}),$("#countriesEditor").is(":visible")){if("neutral"===ot[E].capital)return;var I=ot[E].capital;$("#state"+E).attr("data-capital",at[I].name),$("#state"+E+" > .stateCapital").val(at[I].name)}}if("burgAdd"===t){var z=+$("#burgsEditor").attr("data-state");Wa(),$("#addBurg").click().attr("data-state",z)}if("toggleScaleBar"===t&&$("#scaleBar").toggleClass("hidden"),"addRuler"!==t)if("addOpisometer"!==t&&"addPlanimeter"!==t){if("removeAllRulers"===t){if($("#ruler > g").length<1)return;return alertMessage.innerHTML="Are you sure you want to remove all placed rulers?",void $("#alert").dialog({resizable:!1,title:"Remove all rulers",buttons:{Remove:function(){$(this).dialog("close"),$("#ruler > g").remove()},Cancel:function(){$(this).dialog("close")}}})}if("editHeightmap"===t&&$("#customizeHeightmap").slideToggle(),"fromScratch"===t&&(alertMessage.innerHTML="Are you sure you want to clear the map? All progress will be lost",$("#alert").dialog({resizable:!1,title:"Clear map",buttons:{Clear:function(){Fa(),Oo(),Gt(),Ft(Y),Qt("grid"),$e(),No(),yo(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})),"fromHeightmap"===t){var T="Hightmap is a basic element on which secondary data (rivers, burgs, countries etc) is based.\n      If you want to significantly change the hightmap, it may be better to clean up all the secondary data\n      and let the system to re-generate it based on the updated hightmap. In case of minor changes, you can keep the data.\n      Newly added lands will be considered as neutral. Burgs located on a removed land cells will be deleted.\n      Rivers and small lakes will be re-gerenated based on updated heightmap. Routes won't be regenerated.";return alertMessage.innerHTML=T,void $("#alert").dialog({resizable:!1,title:"Edit Heightmap",buttons:{"Clean up":function(){bo("clean"),$(this).dialog("close")},Keep:function(){$(this).dialog("close"),bo("keep")},Cancel:function(){$(this).dialog("close")}}})}if(1===J){if("paintBrushes"===t&&yo(),"rescaleExecute"===t){var L=rescaleLower.value+"-"+rescaleHigher.value,R=conditionSign.value,P=rescaleModifier.value;"×"===R&&ge(L,0,+P),"÷"===R&&ge(L,0,1/P),"+"===R&&ge(L,+P,1),"-"===R&&ge(L,-1*P,1),"^"===R&&ge(L,0,"^"+P),Se(),Me()}if("rescaleButton"===t&&$("#modifyButtons").children().not("#rescaleButton, .condition").toggle(),"rescaleCondButton"===t&&$("#modifyButtons").children().not("#rescaleCondButton, #rescaler").toggle(),"undo"!==t&&"templateUndo"!==t||xe(X-1),"redo"!==t&&"templateRedo"!==t||xe(X+1),"smoothHeights"===t&&(me(4),Se(),Me()),"disruptHeights"===t&&(fe(),Se(),Me()),"getMap"===t&&Ya(),"applyTemplate"===t){if($("#templateEditor").is(":visible"))return;$("#templateEditor").dialog({title:"Template Editor",minHeight:"auto",width:"auto",resizable:!1,position:{my:"right top",at:"right-10 top+10",of:"svg"}})}if("convertImage"===t&&Bo(),"convertImageGrid"===t&&$("#grid").fadeToggle(),"convertImageHeights"===t&&$("#landmass").fadeToggle(),"perspectiveView"===t){if($("#perspectivePanel").is(":visible"))return;return $("#perspectivePanel").dialog({title:"Perspective View",width:520,height:190,position:{my:"center center",at:"center center",of:"svg"}}),void ko()}}if("restoreStyle"===t&&(alertMessage.innerHTML="Are you sure you want to restore default style?",$("#alert").dialog({resizable:!1,title:"Restore style",buttons:{Restore:function(){un(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}})),"mapFilters"===e)return $("svg").attr("filter",""),void($(this).hasClass("pressed")?$("#mapFilters .pressed").removeClass("pressed"):($("#mapFilters .pressed").removeClass("pressed"),$(this).addClass("pressed"),$("svg").attr("filter","url(#filter-"+t+")")));if("updateFullscreen"===t&&(mapWidthInput.value=window.innerWidth,mapHeightInput.value=window.innerHeight,localStorage.removeItem("mapHeight"),localStorage.removeItem("mapWidth"),sn()),"zoomExtentDefault"===t&&(zoomExtentMin.value=1,zoomExtentMax.value=20,yt.scaleExtent([1,20]).scaleTo(l,1)),"saveButton"===t&&$("#saveDropdown").slideToggle(),"loadMap"===t&&mapToLoad.click(),"zoomReset"===t&&$t(1e3),"zoomPlus"===t&&(bt+=1,bt>40&&(bt=40),Et()),"zoomMinus"===t&&(bt-=1,bt<=1&&(bt=1,0,0),Et()),"styleFontPlus"===t||"styleFontMinus"===t){m=h.select("#"+styleElementSelect.value);var O="styleFontPlus"===t?1.1:.9;return m.selectAll("g").each(function(){var t=d3.select(this),e=no(t.attr("data-size")*O,2);e<2&&(e=2),t.attr("data-size",e).attr("font-size",no((e+e/bt)/2,2))}),void Et()}if("brushClear"===t)if(1===J){var G="Are you sure you want to clear the map?";alertMessage.innerHTML=G,$("#alert").dialog({resizable:!1,title:"Clear map",buttons:{Clear:function(){$(this).dialog("close"),h.style("cursor","crosshair").call(xt),landmassCounter.innerHTML="0",$("#landmass").empty(),K=new Uint8Array(K.length),q=[],X=0,Me(),redo.disabled=templateRedo.disabled=!0,undo.disabled=templateUndo.disabled=!0},Cancel:function(){$(this).dialog("close")}}})}else start.click();if("templateComplete"===t&&Ya(),"convertColorsMinus"===t){var F=+convertColors.value-1;F<4&&(F=3),convertColors.value=F,$o(F)}if("convertColorsPlus"===t){F=+convertColors.value+1;F>255&&(F=256),convertColors.value=F,$o(F)}"convertOverlayButton"===t&&$("#convertImageButtons").children().not(this).not("#convertColors").toggle(),"convertAutoLum"===t&&Ro("lum"),"convertAutoHue"===t&&Ro("hue"),"convertComplete"===t&&Ho()}else $(this).hasClass("pressed")?(Vt(),$(this).removeClass("pressed")):($(this).addClass("pressed"),h.style("cursor","crosshair").call(xt));else{$("#ruler").show();var D=_.append("g").attr("class","linear").call(d3.drag().on("start",Ie)),U=no(1/Math.pow(bt,.3),1),V=Math.floor(Math.random()*St*.5+.25*St),W=.2*Ct,Z=.8*Ct,et=no(30/distanceScale.value,2);D.append("line").attr("x1",W).attr("y1",V).attr("x2",Z).attr("y2",V).attr("class","white").attr("stroke-width",U),D.append("line").attr("x1",W).attr("y1",V).attr("x2",Z).attr("y2",V).attr("class","gray").attr("stroke-width",U).attr("stroke-dasharray",et),D.append("circle").attr("r",2*U).attr("stroke-width",.5*U).attr("cx",W).attr("cy",V).attr("data-edge","left").call(d3.drag().on("drag",ze)),D.append("circle").attr("r",2*U).attr("stroke-width",.5*U).attr("cx",Z).attr("cy",V).attr("data-edge","rigth").call(d3.drag().on("drag",ze)),D.append("circle").attr("r",1.2*U).attr("stroke-width",.3*U).attr("cx",Ct/2).attr("cy",V).attr("class","center").call(d3.drag().on("start",Te));var nt=no(Z-W),it=no(nt*distanceScale.value)+" "+distanceUnit.value;D.append("text").attr("x",Ct/2).attr("y",V).attr("dy",-1).attr("data-dist",nt).text(it).text(it).on("click",Yt).attr("font-size",10*U)}}),$("#saveDropdown > div").click(function(){var t=this.id,e=localStorage.getItem("dns_allow_popup_message");if(!e){localStorage.clear();var a="Generator uses pop-up window to download files. ";a+="Please ensure your browser does not block popups. ",a+="Please check browser settings and turn off adBlocker if it is enabled",alertMessage.innerHTML=a,$("#alert").dialog({title:"File saver. Please enable popups!",buttons:{"Don't show again":function(){localStorage.setItem("dns_allow_popup_message",!0),$(this).dialog("close")},Close:function(){$(this).dialog("close")}},position:{my:"center",at:"center",of:"svg"}})}"saveMap"===t&&co(),"saveSVG"===t&&lo("svg"),"savePNG"===t&&lo("png"),$("#saveDropdown").slideUp("fast")}),$("#options i[class^='icon-lock']").click(function(){$(this).toggleClass("icon-lock icon-lock-open");var t=+$(this).hasClass("icon-lock");$(this).attr("data-locked",t);var e=this.id.slice(4,-5).toLowerCase(),a=$("#"+e+"Input").val();t?localStorage.setItem(e,a):localStorage.removeItem(e)}),$("#templateTools > button").on("click",function(){var t=this.id;if(t=t.replace("template",""),"Mountain"===t){var e=$("#templateBody > div").length;if(e>0)return}$("#templateBody").attr("data-changed",1),$("#templateBody").append('<div data-type="'+t+'">'+t+"</div>");var a=$("#templateBody div:last-child");if("Hill"===t||"Pit"===t||"Range"===t||"Trough"===t)var o='<label>count:<input class="templateElCount" onmouseover="tip(\'Blobs to add\')" type="number" value="1" min="1" max="99"></label>';if("Hill"===t)var n='<label>distribution:<input class="templateElDist" onmouseover="tip(\'Set blobs distribution. 0.5 - map center; 0 - any place\')" type="number" value="0.25" min="0" max="0.5" step="0.01"></label>';if("Add"===t||"Multiply"===t)n='<label>to:<select class="templateElDist" onmouseover="tip(\'Change only land or all cells\')"><option value="all" selected>all cells</option><option value="land">land only</option><option value="interval">interval</option></select></label>';if("Add"===t)o='<label>value:<input class="templateElCount" onmouseover="tip(\'Add value to height of all cells (negative values are allowed)\')" type="number" value="-10" min="-100" max="100" step="1"></label>';if("Multiply"===t)o='<label>by value:<input class="templateElCount" onmouseover="tip(\'Multiply all cells Height by the value\')" type="number" value="1.1" min="0" max="10" step="0.1"></label>';if("Smooth"===t)o='<label>fraction:<input class="templateElCount" onmouseover="tip(\'Set smooth fraction. 1 - full smooth, 2 - half-smooth, etc.\')" type="number" min="1" max="10" value="2"></label>';if("Strait"===t)o='<label>width:<input class="templateElCount" onmouseover="tip(\'Set strait width\')" value="1-7"></label>';a.append('<span onmouseover="tip(\'Remove step\')" class="icon-trash-empty"></span>'),$("#templateBody .icon-trash-empty").on("click",function(){$(this).parent().remove()}),n&&a.append(n),o&&a.append(o),a.find("select.templateElDist").on("input",Mo),$("#templateBody").attr("data-changed",1)}),$("#templateSelect").on("input",function(){var t=$("#templateBody > div").length,e=+$("#templateBody").attr("data-changed"),a=this.value;t&&1===e&&(alertMessage.innerHTML="Are you sure you want to change the base template? All the changes will be lost.",$("#alert").dialog({resizable:!1,title:"Change Template",buttons:{Change:function(){xo(a),$(this).dialog("close")},Cancel:function(){var t=$("#templateSelect").attr("data-prev");$("#templateSelect").val(t),$(this).dialog("close")}}})),0!==t&&0!==e||xo(a)}),$("#templateRun").on("click",function(){if(1===J){var t=$("#templateBody > div").length;if(t){K=new Uint8Array(K.length);for(var e=1;e<=t;e++){var a=$("#templateBody div:nth-child("+e+")").attr("data-type");if("Mountain"!==a){var o=$("#templateBody div:nth-child("+e+") .templateElCount").val(),n=$("#templateBody div:nth-child("+e+") .templateElDist").val();if(o)if("-"!==o[0]&&o.includes("-")){var i=o.split("-");o=Math.floor(Math.random()*(+i[1]-+i[0]+1)+ +i[0])}else o=+o;"Hill"===a&&ce(o,+n),"Pit"===a&&ve(o),"Range"===a&&pe(o),"Trough"===a&&pe(-1*o),"Strait"===a&&he(o),"Add"===a&&ge(n,o,1),"Multiply"===a&&ge(n,0,o),"Smooth"===a&&me(o)}else ue()}Ce(),Me()}}}),$("#templateSave").on("click",function(){for(var t=$("#templateBody > div").length,e="",a=1;a<=t;a++){var o=$("#templateBody div:nth-child("+a+")"),n=o.attr("data-type"),i=$("#templateBody div:nth-child("+a+") .templateElCount").val(),r=$("#templateBody div:nth-child("+a+") .templateElDist").val();i||(i="0"),r||(r="0"),e+=n+" "+i+" "+r+"\r\n"}var s=new Blob([e],{type:"text/plain"}),l=window.URL.createObjectURL(s),u=document.createElement("a");u.download="template_"+Date.now()+".txt",u.href=l,u.click(),$("#templateBody").attr("data-changed",0)}),$("#templateLoad").on("click",function(){templateToLoad.click()}),$("#templateToLoad").change(function(){var t=this.files[0];this.value="";var e=new FileReader;e.onload=function(t){var e=t.target.result,a=e.split("\r\n");$("#templateBody").empty(),a.length>0&&($("#templateBody").attr("data-changed",1),$("#templateSelect").attr("data-prev","templateCustom").val("templateCustom"));for(var o=0;o<a.length;o++){var n=a[o].split(" ");Ao(n[0],n[1],n[2])}},e.readAsText(t,"UTF-8")}),$("#convertImageLoad").on("click",function(){imageToLoad.click()}),$("#imageToLoad").change(function(){console.time("loadImage"),$t(),k.attr("stroke-width",.2);var t=this.files[0];this.value="";var e=new FileReader,a=new Image;a.onload=function(){vt.drawImage(a,0,0,wt,Mt),$o(+convertColors.value),console.timeEnd("loadImage")},e.onloadend=function(){a.src=e.result},e.readAsDataURL(t)}),$(".stable").on("dialogdragstop",function(t,e){sessionStorage.setItem(this.id,[e.offset.left,e.offset.top])}),$(".stable").on("dialogopen",function(t,e){var a=sessionStorage.getItem(this.id);if(a&&(a=a.split(","),!(a[0]>$(window).width()-100||a[1]>$(window).width()-40))){var o="left+".concat(a[0]," top+").concat(a[1]);$(this).dialog("option","position",{my:"left top",at:o,of:"svg"})}}),$(".sortable").on("click",function(){var t=$(this);t.siblings().removeClass("icon-sort-name-up icon-sort-name-down icon-sort-number-up icon-sort-number-down");var e=t.hasClass("alphabetically")?"name":"number",a="no";t.is("[class*='down']")&&(a="asc"),t.is("[class*='up']")&&(a="desc");var o=t.attr("data-sortby"),n=t.parent().next(),i=n.children("div");"no"!==a&&"asc"!==a||(t.removeClass("icon-sort-"+e+"-down"),t.addClass("icon-sort-"+e+"-up"),i.sort(function(t,a){var n=t.getAttribute("data-"+o);if("bottom"===n)return 1;var i=a.getAttribute("data-"+o);return"bottom"===i?-1:("number"===e&&(n=+n,i=+i),n>i?1:n<i?-1:0)})),"desc"===a&&(t.removeClass("icon-sort-"+e+"-up"),t.addClass("icon-sort-"+e+"-down"),i.sort(function(t,a){var n=t.getAttribute("data-"+o);if("bottom"===n)return 1;var i=a.getAttribute("data-"+o);return"bottom"===i?-1:("number"===e&&(n=+n,i=+i),n<i?1:n>i?-1:0)})),i.detach().appendTo(n)}),$("#burgsListToLoad").change(function(){var t=this.files[0];this.value="";var e=new FileReader;e.onload=function(t){var e=t.target.result,a=e.split("\r\n");if(0!==a.length){var o=[],n="Burgs will be renamed as below. Please confirm";n+='<div class="overflow-div"><table class="overflow-table"><tr><th>Id</th><th>Current name</th><th>New Name</th></tr>';for(var i=0;i<a.length&&i<at.length;i++){var r=a[i];""!==r&&void 0!==r&&(r!==at[i].name&&(o.push({i:i,name:r}),n+='<tr><td style="width:20%">'.concat(i,'</td><td style="width:40%">').concat(at[i].name,'</td><td style="width:40%">').concat(r,"</td></tr>")))}n+="</tr></table></div>",alertMessage.innerHTML=n,$("#alert").dialog({title:"Burgs bulk renaming",position:{my:"center",at:"center",of:"svg"},buttons:{Cancel:function(){$(this).dialog("close")},Confirm:function(){for(var t=0;t<o.length;t++){var e=o[t].i;at[e].name=o[t].name,H.select("[data-id='"+e+"']").text(o[t].name)}$(this).dialog("close"),Qo()}}})}},e.readAsText(t,"UTF-8")}),$(window).resize(function(t){!1!==Z&&(mapWidthInput.value=window.innerWidth,mapHeightInput.value=window.innerHeight,sn())}),$("#styleElementSelect").on("change",function(){var t=this.value,e=h.select("#"+t);"ocean"==t&&(e=m.select("rect")),$("#styleInputs > div").hide(),$("#styleOpacity, #styleFilter").css("display","block");var a=e.attr("opacity")||1;if(styleOpacityInput.value=styleOpacityOutput.value=a,"ocean"==t&&(e=m),styleFilterInput.value=e.attr("filter")||"","rivers"!==t&&"lakes"!==t&&"landmass"!==t||($("#styleFill").css("display","inline-block"),styleFillInput.value=styleFillOutput.value=e.attr("fill")),"roads"===t||"trails"===t||"searoutes"===t||"lakes"===t||"stateBorders"===t||"neutralBorders"===t||"grid"===t||"overlay"===t||"coastline"===t){$("#styleStroke").css("display","inline-block"),styleStrokeInput.value=styleStrokeOutput.value=e.attr("stroke"),$("#styleStrokeWidth").css("display","block");var o=e.attr("stroke-width")||"";styleStrokeWidthInput.value=styleStrokeWidthOutput.value=o}"roads"!==t&&"trails"!==t&&"searoutes"!==t&&"stateBorders"!==t&&"neutralBorders"!==t&&"overlay"!==t||($("#styleStrokeDasharray, #styleStrokeLinecap").css("display","block"),styleStrokeDasharrayInput.value=e.attr("stroke-dasharray")||"",styleStrokeLinecapInput.value=e.attr("stroke-linecap")||"inherit"),"terrs"===t&&$("#styleScheme").css("display","block"),"heightmap"===t&&$("#styleScheme").css("display","block"),"overlay"===t&&$("#styleOverlay").css("display","block"),"labels"===t&&($("#styleFill, #styleStroke, #styleStrokeWidth, #styleFontSize").css("display","inline-block"),styleFillInput.value=styleFillOutput.value=e.select("g").attr("fill")||"#3e3e4b",styleStrokeInput.value=styleStrokeOutput.value=e.select("g").attr("stroke")||"#3a3a3a",styleStrokeWidthInput.value=styleStrokeWidthOutput.value=e.attr("stroke-width")||0,$("#styleLabelGroups").css("display","inline-block"),cn()),"ocean"===t&&($("#styleOcean").css("display","block"),styleOceanBack.value=styleOceanBackOutput.value=l.style("background-color"),styleOceanFore.value=styleOceanForeOutput.value=m.select("rect").attr("fill"))}),$("#styleFillInput").on("input",function(){styleFillOutput.value=this.value;var t=l.select("#"+styleElementSelect.value);"labels"!==styleElementSelect.value?t.attr("fill",this.value):t.selectAll("g").attr("fill",this.value)}),$("#styleStrokeInput").on("input",function(){styleStrokeOutput.value=this.value;var t=l.select("#"+styleElementSelect.value);t.attr("stroke",this.value)}),$("#styleStrokeWidthInput").on("input",function(){styleStrokeWidthOutput.value=this.value;var t=l.select("#"+styleElementSelect.value);t.attr("stroke-width",+this.value)}),$("#styleStrokeDasharrayInput").on("input",function(){var t=styleElementSelect.value;l.select("#"+t).attr("stroke-dasharray",this.value)}),$("#styleStrokeLinecapInput").on("change",function(){var t=styleElementSelect.value;l.select("#"+t).attr("stroke-linecap",this.value)}),$("#styleOpacityInput").on("input",function(){styleOpacityOutput.value=this.value;var t=styleElementSelect.value;l.select("#"+t).attr("opacity",this.value)}),$("#styleFilterInput").on("change",function(){var t=styleElementSelect.value;"ocean"==t&&(t="oceanLayers");var e=l.select("#"+t);e.attr("filter",this.value),yt.scaleBy(l,1.00001)}),$("#styleSchemeInput").on("change",function(){y.selectAll("path").remove(),Ra()}),$("#styleOverlayType").on("change",function(){C.selectAll("*").remove(),$("#toggleOverlay").hasClass("buttonoff")||Ha()}),$("#styleOverlaySize").on("change",function(){C.selectAll("*").remove(),$("#toggleOverlay").hasClass("buttonoff")||Ha(),styleOverlaySizeOutput.value=this.value}),$("#styleOceanBack").on("input",function(){l.style("background-color",this.value),styleOceanBackOutput.value=this.value}),$("#styleOceanFore").on("input",function(){m.select("rect").attr("fill",this.value),styleOceanForeOutput.value=this.value}),$("#styleOceanPattern").on("click",function(){f.attr("opacity",+this.checked)}),$("#styleOceanLayers").on("click",function(){var t=this.checked?"block":"none";m.selectAll("path").attr("display",t)}),$("input, select").on("input change",function(){var t=this.id;if("hideLabels"===t&&Et(),"mapWidthInput"!==t&&"mapHeightInput"!==t||(sn(),Z=!1,localStorage.setItem("mapWidth",mapWidthInput.value),localStorage.setItem("mapHeight",mapHeightInput.value)),"sizeInput"===t&&(U=sizeOutput.value=+this.value,3===U&&(sizeOutput.style.color="red"),2===U&&(sizeOutput.style.color="yellow"),1===U&&(sizeOutput.style.color="green")),"templateInput"===t&&localStorage.setItem("template",this.value),"manorsInput"===t&&(manorsOutput.value=this.value,localStorage.setItem("manors",this.value)),"regionsInput"===t){regionsOutput.value=this.value;var e=no(6-this.value/20);e<3&&(e=3),O.select("#capitals").attr("data-size",e),e=no(18-this.value/6),e<4&&(e=4),H.select("#countries").attr("data-size",e),localStorage.setItem("regions",this.value)}if("powerInput"===t&&(powerOutput.value=this.value,localStorage.setItem("power",this.value)),"neutralInput"===t&&(neutralOutput.value=countriesNeutral.value=this.value,localStorage.setItem("neutal",this.value)),"culturesInput"===t&&(culturesOutput.value=this.value,localStorage.setItem("cultures",this.value)),"precInput"===t&&(precOutput.value=+precInput.value,localStorage.setItem("prec",this.value)),"swampinessInput"===t&&(swampinessOutput.value=this.value,localStorage.setItem("swampiness",this.value)),"outlineLayersInput"===t&&localStorage.setItem("outlineLayers",this.value),"transparencyInput"===t&&_a(this.value),"pngResolutionInput"===t&&localStorage.setItem("pngResolution",this.value),"zoomExtentMin"!==t&&"zoomExtentMax"!==t||(yt.scaleExtent([+zoomExtentMin.value,+zoomExtentMax.value]),yt.scaleTo(l,+this.value)),"convertOverlay"===t&&(ht.style.opacity=convertOverlayValue.innerHTML=+this.value),"populationRate"===t&&(populationRateOutput.value=ro(1e3*+populationRate.value),Qo()),"urbanization"===t&&(urbanizationOutput.value=this.value,Qo()),"distanceUnit"===t||"distanceScale"===t||"areaUnit"===t){var a=distanceUnit.value;if("distanceUnit"===t&&"custom_name"===a){var o=prompt("Provide a custom name for distance unit");if(!o)return void(this.value="km");var n=document.createElement("option");n.value=n.innerHTML=o,distanceUnit.add(n),distanceUnit.value=o}var i=distanceScale.value;scaleOutput.value=i+" "+a,_.selectAll("g").each(function(){var t,e=d3.select(this),o=+e.select("text").attr("data-area");if(o){var n=o*Math.pow(i,2),r=areaUnit.value;r="square"===r?a+"²":areaUnit.value,t=ro(n)+" "+r}else{var s=+e.select("text").attr("data-dist");t=no(s*i)+" "+a}e.select("text").text(t)}),_.selectAll(".gray").attr("stroke-dasharray",no(30/i,2)),$e(),Qo()}"barSize"===t&&(barSizeOutput.innerHTML=this.value,$("#scaleBar").removeClass("hidden"),$e()),"barLabel"===t&&($("#scaleBar").removeClass("hidden"),$e()),"barBackOpacity"!==t&&"barBackColor"!==t||(d3.select("#scaleBar > rect").attr("opacity",+barBackOpacity.value).attr("fill",barBackColor.value),$("#scaleBar").removeClass("hidden"))}),$("#scaleOutput").change(function(){if(""===this.value||isNaN(+this.value)||this.value<.01||this.value>10)return v("Manually entered distance scale should be a number in a [0.01; 10] range"),void(this.value=distanceScale.value+" "+distanceUnit.value);distanceScale.value=+this.value,scaleOutput.value=this.value+" "+distanceUnit.value,Qo()}),$("#populationRateOutput").change(function(){if(""===this.value||isNaN(+this.value)||this.value<.001||this.value>10)return v("Manually entered population rate should be a number in a [0.001; 10] range"),void(this.value=ro(1e3*populationRate.value));populationRate.value=+this.value,populationRateOutput.value=ro(1e3*this.value),Qo()}),$("#urbanizationOutput").change(function(){if(""===this.value||isNaN(+this.value)||this.value<0||this.value>10)return v("Manually entered urbanization rate should be a number in a [0; 10] range"),void(this.value=urbanization.value);var t=parseFloat(+this.value);t>2&&urbanization.setAttribute("max",t),urbanization.value=urbanizationOutput.value=t,Qo()}),$("#optionsContent input, #optionsContent select").change(function(){var t="lock"+this.id.charAt(0).toUpperCase()+this.id.slice(1),e=document.getElementById(t);e&&(e.setAttribute("data-locked",1),e.className="icon-lock")}),$("#optionsReset").click(Pt),$("#rescaler").change(function(){var t=no(+this.value-5,2);ge("all",t,1),Se(),Me(),rescaler.value=5}),$("#layoutPreset").on("change",function(){var t=this.value;$("#mapLayers li").not("#toggleOcean").addClass("buttonoff"),$("#toggleOcean").removeClass("buttonoff"),$("#oceanPattern").fadeIn(),$("#rivers, #terrain, #borders, #regions, #icons, #labels, #routes, #grid, #markers").fadeOut(),M.selectAll("path").remove(),y.selectAll("path").remove(),"layoutPolitical"===t&&(toggleRivers.click(),toggleRelief.click(),toggleBorders.click(),toggleCountries.click(),toggleIcons.click(),toggleLabels.click(),toggleRoutes.click(),toggleMarkers.click()),"layoutCultural"===t&&(toggleRivers.click(),toggleRelief.click(),toggleBorders.click(),$("#toggleCultures").click(),toggleIcons.click(),toggleLabels.click(),toggleMarkers.click()),"layoutHeightmap"===t&&($("#toggleHeight").click(),toggleRivers.click())}),$(".tab > button").on("click",function(){$(".tabcontent").hide(),$(".tab > button").removeClass("active"),$(this).addClass("active");var t=this.id;"layoutTab"===t&&$("#layoutContent").show(),"styleTab"===t&&$("#styleContent").show(),"optionsTab"===t&&$("#optionsContent").show(),"customizeTab"===t&&$("#customizeContent").show(),"aboutTab"===t&&$("#aboutContent").show()}),$("#optionsSeedGenerate").on("click",function(){if(optionsSeed.value!=a){a=optionsSeed.value;var t=new URL(window.location.href);window.location.href=t.pathname+"?seed="+a}})}function v(t,e,a){var o=d3.select("#tooltip"),n="linear-gradient(0.1turn, #ffffff00, #5e5c5c4d, #ffffff00)",i="linear-gradient(0.1turn, #ffffff00, #c71d1d66, #ffffff00)";o.text(t).style("background",a?i:n),e&&o.attr("data-main",t)}window.tip=v,$("#optionsContainer *").on("mouseout",function(){tooltip.innerHTML=tooltip.getAttribute("data-main")});var g=p,m=(o("270f"),o("2877")),f=Object(m["a"])(g,s,l,!1,null,"7dc4d9f6",null);f.options.__file="FantasyMapGenerator.vue";var b=f.exports,y={name:"app",components:{FantasyMapGenerator:b}},k=y,C=(o("034f"),Object(m["a"])(k,i,r,!1,null,null,null));C.options.__file="App.vue";var S=C.exports;n["a"].config.productionTip=!1,new n["a"]({render:function(t){return t(S)}}).$mount("#app")},7676:function(t,e,a){},c21b:function(t,e,a){}});
//# sourceMappingURL=app.46644ca9.js.map